angular.module("xiaomaiApp",window.__SYS_CONF.dependent_modules),angular.module("xiaomaiApp").config(["$stateProvider","$urlRouterProvider",function(n,e){n.state("root",{url:"/",templateUrl:"../assets/views/root/root.html"}).state("root.buy",{url:"buy/?goodId&sourceType",controller:"buyCtrl",templateUrl:"../assets/views/buy/buy.html"}).state("root.buy.nav",{url:"nav/",templateUrl:"../assets/views/nav/nav.html"}).state("root.buy.nav.all",{url:"all/",templateUrl:"../assets/views/all/all.html",controller:"nav.allCtrl"}).state("root.buy.nav.recommend",{url:"recommend/",controller:"nav.recommendCtrl",templateUrl:"../assets/views/recommend/recommend.html"}).state("root.buy.nav.active",{url:"active/?collegeId&activityId",controller:"nav.activeCtrl",templateUrl:"../assets/views/active/nav.active.html"}).state("root.buy.active",{url:"active/?collegeId&activityId",controller:"buy.activeCtrl",templateUrl:"../assets/views/active/active.html"}).state("root.buy.skactive",{url:"skactive/?collegeId&activityId",controller:"buy.skactiveCtrl",templateUrl:"../assets/views/skactive/skactive.html"}).state("root.buy.nav.category",{url:"category/?collegeId&categoryId",controller:"nav.categoryCtrl",templateUrl:"../assets/views/category/category.html"}).state("root.locate",{url:"locate/",controller:"positionCtrl",templateUrl:"../assets/views/locate/locate.html"}).state("root.colleges",{url:"colleges/?cityid",controller:"collegesCtrl",templateUrl:"../assets/views/colleges/colleges.html"}).state("root.buy.coupon",{url:"coupon/",controller:"buy.couponCtrl",templateUrl:"../assets/views/coupon/coupon.html"}).state("root.feedback",{url:"feedback",controller:"feedbackCtrl",templateUrl:"../assets/views/feedback/feedback.html"}).state("root.notfound",{url:"404/",templateUrl:"../assets/views/notfound/notfound.html"})}]),angular.module("xiaomaiApp").run(["$state",function(n){n.go("root.buy.nav.all")}]),document.addEventListener("touchmove",function(n){n.preventDefault()},!1),angular.module("xiaomaiApp").filter("hhmmss",function(){return function(n){return n}}),angular.module("xiaomaiApp").filter("xiaomaiprice",function(){return function(n){return(n/100).toFixed(2)}}),angular.module("xiaomaiApp").factory("xiaomaimodelManage",function(){var n={navgatorlist:{url:"/wap/navigate/index",type:"GET"},locate:{url:"/wap/college/locate",type:"GET"},citylist:{url:"/wap/geography/cities",type:"GET"},collegelist:{url:"/wap/geography/colleges",type:"GET"},getSchool:{url:"/wap/college/detail",type:"GET"},saveSchool:{url:"/wap/college/detail",type:"POST"},activities:{url:"/wap/college/activities",type:"GET"},activeGoods:{url:"/wap/activity/goods",type:"GET"},activeBanner:{url:"/wap/activity/banners",type:"GET"},categoryGoods:{url:"/wap/index/categoryGoods",type:"GET"},categoryBanners:{type:"GET",url:"/wap/category/banners"},goods:{url:"/wap/category/goods",type:"GET"},goodDetail:{url:"/wap/goods/detail",type:"GET"},removeCart:{url:"/wap/cart/remove",type:"POST"},whitelist:{type:"GET",url:"/wap/college/whitelist"},addCart:{url:"/wap/cart/add",type:"POST"},queryCart:{url:"/wap/cart/sync",type:"GET"},queryCartDetail:{url:"/wap/cart/get",type:"GET"},mycoupon:{url:"/couponwap/myCouponList",type:"GET"},getWxConfig:{url:"/wap/getWxConfig",type:"GET"},feedback:{url:"/wap/feedback/detail",type:"POST"}},e=function(){var e=Array.prototype.slice.call(arguments,0),a=e[0],o=e[1]||"GET";return n.hasOwnProperty(a)&&n[a].type===o?n[a].url:!1};return e}),angular.module("xiaomaiApp").factory("urlInterceptor",["env",function(n){var e=function(e){return"develop"!==n?e:"/api"+e+".json"};return e}]),angular.module("xiaomaiApp").factory("xiaomaiService",["env","$q","urlInterceptor","xiaomaimodelManage","$http","xiaomaiCacheManager","getDataType","httpRequstParam","$timeout",function(n,e,a,o,t,i,r,s,c){var l=function(n,e){var a=o(n,e);return a},d=function(n){return 0==n.code&&n.data&&("number"!=r(n.data)||n.data.length)&&("object"!=r(n.data)||Object.keys(n.data).length)?n.data:!1},u=function(){return e.defer()},g=function(n){var e,o=u(),s=Array.prototype.slice.call(arguments,0),n=s[0],c={};return"object"==r(s[1])&&(c=s[1]),e=l(n,"GET"),(e=a(e))?i.readCache(n)?(o.resolve(i.readCache(n)),o.promise):(t({url:e,method:"GET",params:angular.extend({v:Math.random().toString().replace(/\./,"")},c)}).success(function(n){d(n)===!1?o.reject(n.msg):o.resolve(n.hasOwnProperty("data")?n.data:n)}).error(function(n){o.reject("接口请求错误")}),o.promise):(o.reject("接口错误或接口请求方式错误"),o.promise)},p=function(){},v=function(){},m=function(e,o){var i=u();if(url=l(e,"POST"),url=a(url),!url)return i.reject("接口错误或接口请求方式错误"),i.promise;var r="develop"==n?{method:"GET",params:o}:{method:"POST",data:s(o)};return t(angular.extend(r,{url:url,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})).success(function(n){0==n.code?i.resolve(n.data):i.reject(n.msg)}).error(function(){i.reject("接口异常")}),i.promise};return{fetchOne:g,fetchAll:p,fetchOrder:v,save:m}}]),angular.module("xiaomaiApp").factory("httpRequstParam",[function(){var n=function(e){var a,o,t,i,r,s,c,l="";for(a in e)if(o=e[a],o instanceof Array)for(c=0;c<o.length;++c)r=o[c],t=a+"["+c+"]",s={},s[t]=r,l+=n(s)+"&";else if(o instanceof Object)for(i in o)r=o[i],null!=r&&(t=a+"."+i,s={},s[t]=r,l+=n(s)+"&");else void 0!==o&&(l+=encodeURIComponent(a)+"="+encodeURIComponent(o)+"&");return l.length?l.substr(0,l.length-1):l};return n}]),angular.module("xiaomaiApp").factory("xiaomaiQuicksort",[function(){var n=function(e){if(e.length<=1)return e;var a=Array.prototype.slice.call(arguments,0),e=a[0],o=a[1]||"number",t=a[2],i=Math.ceil(e.length/2),r="number"==o?e[i]:e[i][t],s=[],c=[];return $.each(e,function(n,e){var a="number"===o?e:e[t];return n==i?!0:void(r>=a?s.push(e):c.push(e))}),n(s).concat([e[i]]).concat(n(c))};return n}]),angular.module("xiaomaiApp").factory("xiaomaiCacheManager",["xiaomaiQuicksort",function(n){var e=[],a=20,o=function(n){var a=t(n);return a===!1?!1:(e[a].timestamp=+new Date,angular.extend({},e[a].result))},t=function(n){if(!e.length)return!1;var a=-1;return angular.forEach(e,function(e,o){return e.name===n?(a=o,!1):void 0}),-1===a?!1:a},i=function(o,i){var r=t(o);return r!==!1?(e[r]={name:o,result:i,timestamp:+new Date},!1):(e.length==a&&(e=n(e,"object",timestamp),e.shift()),void e.push({name:o,result:i,timestamp:+new Date}))},r=function(n){var a=t(n);a!==!1&&e.splice(a,1)};return{readCache:o,writeCache:i,clean:r}}]),angular.module("xiaomaiApp").factory("skuListToObject",function(){return function(n){var e={};return angular.forEach(n,function(n,a){var o=[];angular.forEach(n.skuPropertyList,function(n,e){o.push(n.propertyNameId+"="+n.propertyValueId)}),e[o.join("&")]=n}),e}}),angular.module("xiaomaiApp").factory("cartManager",["$q","xiaomaiService","xiaomaiCacheManager","env","$timeout",function(n,e,a,o,t){var i,r=function(n){a.writeCache("queryCart",n),a.clean("queryCartDetail"),i&&i(n)},s=function(){return n.defer()},c=function(n){var a=s();return e.save("addCart",n).then(function(n){"develop"==o?t(function(){r(n),a.resolve(n)},2e3):(r(n),a.resolve(n))},function(n){a.reject(n)}),a.promise},l=function(n){var a=s();return e.save("removeCart",n).then(function(n){r(n),a.resolve(n)},function(n){a.reject(n)}),a.promise},d=function(n){i=n,e.fetchOne("queryCart").then(function(n){i(n),a.writeCache("queryCart",n)},function(n){i("error")})},u=function(n){n&&angular.isObject(n)?a.writeCache("queryCart",n):a.clean("queryCart")},g=function(){return a.readCache("queryCart")},p=function(){},v=function(){var o=n.defer();return e.fetchOne("queryCartDetail").then(function(n){o.resolve(n),a.writeCache("queryCartDetail",n)}),o.promise},m=function(e){var a=[],o=n.defer();return v().then(function(n){return a=n,a.goods}).then(function(n){var a=-1;angular.forEach(n,function(n,o){var t=n.skuList[0];t.skuId==e&&(a=o)}),o.resolve(-1==a?0:n[a].skuList[0].numInCart)},function(){o.reject(!1)}),o.promise};return{getnumInCart:m,add:c,remove:l,query:d,clear:p,store:u,readCartCache:g,queryCartDetail:v}}]),angular.module("xiaomaiApp").factory("getSkuInfo",[function(){var n=/([^&=]+)=([^&=]+)/;return function(e,a){var o=!1;return angular.forEach(a,function(a,t){var i=!0;angular.forEach(t.split("&"),function(a){if(!a.match(n)||!a.match(n).length)return i=!1,!1;var o=a.match(n),t=o[1],r=o[2];return e.hasOwnProperty(t)?e[t]!=r?(i=!1,!1):void 0:(i=!1,!1)}),1==i&&(o=a)}),o}}]),angular.module("xiaomaiApp").factory("buyProcessManager",["$q","cartManager",function(n,e){var a=!1;return function(){var o=n.defer(),t=Array.prototype.slice.call(arguments,0),i=t[0]||{},r=t[1],s=t[2],c=t[3],l=i.skuId,d="plus"==r?"add":"remove";if(a)return o.reject("正在添加到购物车,请稍等"),o.promise;if(t.length<3)return o.reject("参数缺失!"),o.promise;if("minus"==r&&0>=c)return o.reject("该商品已经不存在"),o.promise;if(angular.isNumber(c)){if("plus"==r&&c>=s)return o.reject("该商品购买数量超上限了哦~"),o.promise;e[d](i).then(function(){o.resolve("plus"==r?c+1:c-1)},function(n){o.reject(n)})}else{var u=void 0;e.getnumInCart(l).then(function(n){return angular.isNumber(n)&&s>n?(c=n,e[d](i)):void o.reject("该商品购买数量超上限了哦")}).then(function(n){u="plus"==r?u+1:u-1,o.resolve(c)},function(){o.reject("操作失败")})}return o.promise}}]),angular.module("xiaomaiApp").factory("env",["$window",function(n){var e=/h5\.imxiaomai\.com/,a=/wap\.tmall\.imxiaomai\.com/,o=n.location.host;return e.test(o)?"online":a.test(o)?"test":"develop"}]),angular.module("xiaomaiApp").factory("systemInfo",["$window",function(n){var e,a,o,t,i=n.navigator.userAgent,r=/(android)\s+([\d\.]+)/i,s=/(iphone|ipad).+(os\s[\d_]+)/i,c=/micromessenger/;return i.match(r)&&i.match(r).length?(t=i.match(r),e=t[1],a=i.match(r)[2]):i.match(s)&&i.match(r).length?(t=i.match(s),e=t[1],a=t[2]):(e="unknown",a="unknown"),o=c.test(i)?"wechart":"other",{platform:e,version:a,browser:o}}]),angular.module("xiaomaiApp").factory("getDataType",[function(){return function(n){var e=Object.prototype.toString.call(n),a=/\s(\w+)/;return e.match(a)[1].toLowerCase()}}]),angular.module("xiaomaiApp").factory("parseUrlParams",[function(){return function(n,e){var a=new RegExp("[\\?&]"+e+"=([^\\?&]+)"),o=n.match(a);return o&&o.length?o[1]:!1}}]),angular.module("xiaomaiApp").factory("cookieManager",["ipCookie",function(n){}]),angular.module("xiaomaiApp").factory("cookie_openid",["env","ipCookie",function(n,e){return"online"==n?e("xiaomai_open_id"):"oTS2xjtXWVPcdQd9OPI11jjBheco"}]),angular.module("xiaomaiApp").directive("maskGui",["xiaomaiMessageNotify",function(n){var e=function(e,a,o){n.sub("maskManager",function(n){a.css({display:"show"==n?"block":"none"})})};return{link:e}}]),angular.module("xiaomaiApp").factory("xiaomaiMessageNotify",["xiaomaiCacheManager","$window",function(n,e){var a={},o=function(n,e){var o=a.hasOwnProperty(n)?a[n]:{},t=(""+Math.random()).replace(/\./,"");return o[t]=e,a[n]=o,t},t=function(n){var o=a[n];if(!angular.isObject(o)||!Object.keys(o).length)return!1;var t=Array.prototype.slice.call(arguments,1);angular.forEach(o,function(n){angular.isFunction(n)&&n.apply(e,t)})},i=function(n,e){var o=a[n];angular.isObject(o)&&o.hasOwnProperty(e)&&delete o[e]},r=function(n){delete a[n]};return{pub:t,sub:o,removeOne:i,remove:r}}]),angular.module("xiaomaiApp").factory("schoolManager",["$q","xiaomaiService","env","xiaomaiCacheManager",function(n,e,a,o){var t=[],i=!1,r=function(){if(i=!1,!t.length)return!1;var n=t.shift();s(n)},s=function(n){i=!0;var a;e.fetchOne("getSchool").then(function(n){return o.writeCache("getSchool",n),a=n,console.log(a.collegeName+"的ID是:"+a.collegeId),e.fetchOne("whitelist")}).then(function(e){console.log("白名单是:"+e.collegeWhiteList);new RegExp(",?("+a.collegeId+"),?");o.writeCache("whitelist",e),n.resolve(a),r()})},c=function(){var e=n.defer();return i?t.push(e):s(e),e.promise},l=function(t){var i=n.defer(),r=t;return e.save("saveSchool",{collegeId:t.collegeId}).then(function(n){return o.writeCache("getSchool",n),e.fetchOne("whitelist")}).then(function(n){var e=new RegExp(",?("+r.collegeId+"),?");if(o.writeCache("whitelist",n),e.test(n.collegeWhiteList))i.resolve(r);else{alert("当前学校不在商城V4的白名单,将跳到旧版商城!");var t="online"==a?"http://h5.imxiaomai.com/":"http://wap.tmall.imxiaomai.com/";window.location.href=t}return!1},function(n){i.reject(n)}),i.promise};return{get:c,set:l}}]),angular.module("xiaomaiApp").factory("siblingsNav",["$q","xiaomaiService",function(n,e){var a=function(n,e,a,o){var t=-1;switch(a){case 0:angular.forEach(n,function(n,e){return 0==n.displayType?(t=e,!1):void 0});break;case 1:angular.forEach(n,function(n,e){return 1==n.displayType?(t=e,!1):void 0});break;case 2:angular.forEach(n,function(n,e){return 2==n.displayType&&n.activityId==o?(t=e,!1):void 0});break;case 3:angular.forEach(n,function(n,e){return 3==n.displayType&&n.categoryId==o?(t=e,!1):void 0})}return"up"==e?-1==t?!1:t-1:"down"==e?t==n.length-1?!1:t+1:void 0},o=function(n,e){var a={0:"root.buy.nav.all",1:"root.buy.nav.recommend",2:"root.buy.nav.active",3:"root.buy.nav.category"};return{text:n.navigateName,name:a[n.displayType],params:{collegeId:e,categoryId:n.categoryId,activityId:n.activityId}}};return function(t,i,r,s){var c=n.defer();return e.fetchOne("navgatorlist",{collegeId:i}).then(function(n){var e=n.navigateItems,l=a(e,t,r,s);angular.isNumber(l)?c.resolve(o(e[l],i)):c.reject()}),c.promise}}]),angular.module("xiaomaiApp").factory("registerWx",["$q","xiaomaiService","env",function(n,e,a){var o=n.defer(),t=["onMenuShareTimeline","onMenuShareAppMessage","getNetworkType","getLocation","openLocation"],i=function(n){wx.config({debug:!1,appId:n.appId,timestamp:n.timestamp,nonceStr:n.nonceStr,signature:n.signature,jsApiList:t}),wx.ready(function(){o.resolve()}),wx.error(function(n){o.reject(JSON.stringify(n))})};return e.fetchOne("getWxConfig",{url:encodeURIComponent([location.protocol,"//",location.host,location.pathname,location.search].join(""))}).then(function(n){i(n)}),o.promise}]),angular.module("xiaomaiApp").factory("locationManager",["$q","$timeout","env","registerWx",function(n,e,a,o){var t=function(){var a=n.defer(),t=e(function(){a.reject("网络超时")},5e3);return o.then(function(){wx.getLocation({type:"wgs84",success:function(n){var o=n.latitude,i=n.longitude;e.cancel(t),a.resolve({lat:o,lng:i})}})},function(n){a.reject(n)}),a.promise};return t}]),angular.module("xiaomaiApp").factory("networkType",["$q",function(n){return xiaomaiApp}]),angular.module("xiaomaiApp").run(["$templateCache",function(n){n.put("../assets/views/active/active.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-back" ng-click="goback();"></div>\n  <div class="location-info">{{activityShowName}}</div>\n  <div class="iconfont   icon-share icon-locate-right" ng-click="showShareModel();"></div>\n</div>\n\n<div class="activeWrap" down-tip-cls="{{\'skactive-downtip\'}}" xiaomai-iscroll subname="{{\'activeheightstatus\'}}" pubname="{{\'activeiscrollupdate\'}}">\n  <div>\n    <div class="banner">\n      <ks-swiper-container on-ready="onReadySwiper(swiper)" swiper="swiper">\n        <ks-swiper-slide class="swiper-slide" ng-repeat="banner in banners">\n          <div class="activeGoodBanner" ng-click="gotoActive(banner);" ng-style="{\'background-image\':\'url(\'+banner.imageUrl+\')\'}"></div>\n        </ks-swiper-slide>\n      </ks-swiper-container>\n    </div>\n    <ul class="activeGoodList">\n      <li class="errortip" ng-if="haserror">\n        错误提示....\n      </li>\n      <li class="loading" ng-if="isloading">\n        loading....\n      </li>\n      <li ng-repeat="good in goods">\n        <div class="goodItem">\n          <div class="imgCont" ng-click="gotoDetail(good);" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'>\n            <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n          </div>\n          <div class="details">\n<!-- 输出标签29分钟达/次日达 -->\n            <p class="goodname" ng-click="gotoDetail(good);">{{good.activityGoodsName}}</p>\n            <p class="priceCont">\n<!-- 单品或者组合最高价-->\n              <span class="new-price" ng-if="good.goodsType==1||good.goodsType==2">\n                &yen;<i>{{good.skuList[0].activityPrice|xiaomaiprice}}</i>\n              </span>\n              <span class="old-price" ng-if="good.goodsType==1||good.goodsType==2">\n                &yen;{{good.skuList[0].originPrice|xiaomaiprice}}</span>\n<!-- 聚合 -->\n              <span class="aggregate-price" ng-if="good.goodsType==3">\n                &yen;{{good.minWapPrice|xiaomaiprice}} ~ &yen;{{good.maxWapPrice|xiaomaiprice}}\n              </span>\n            </p>\n            <p class="buy-icon iconfont icon-plus" ng-class="{paying:good.isPaying}" ng-click="buyHandler(good,$index);" ng-if="good.goodsStatusDisplay!=3"></p>\n            <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n'),n.put("../assets/views/active/nav.active.html",'<div class="errortip" ng-if="haserror">\n  活动已经结束 去其他类目看看吧\n</div>\n<div class="loading" ng-if="isloading">\n  正在加载......\n</div>\n<div class="GoodsCont">\n  <div class="GoodCont" ng-repeat="good in goods">\n  <div class="imgCont" ng-click="gotoDetail(good);" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'></div>\n  <div class="details">\n    <p class="goodname" ng-click="gotoDetail(good);">{{good.activityGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n    <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n    <p class="priceCont">\n<!-- 单品或者组合最高价-->\n      <span class="new-price" ng-if="good.goodsType==1||good.goodsType==2">\n        &yen;<i>{{good.skuList[0].activityPrice|xiaomaiprice}}</i>\n      </span>\n      <span class="old-price" ng-if="good.goodsType==1||good.goodsType==2">\n        &yen;{{good.skuList[0].originPrice|xiaomaiprice}}</span>\n<!-- 聚合 -->\n      <span class="aggregate-price" ng-if="good.goodsType==3">\n        &yen;{{good.minWapPrice|xiaomaiprice}} ~ &yen;{{good.maxWapPrice|xiaomaiprice}}\n      </span>\n    </p>\n    <p  ng-class="{paying:good.isPaying}" class="buy-icon iconfont icon-plus" ng-click="buyHandler(good,$index);" ng-if="good.goodsStatusDisplay!=3"></p>\n    <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n  </div>\n</div>\n</div>\n'),n.put("../assets/views/all/all.html",'<ul class="category-active-list" style="">\n  <li class="loading" ng-if="isloading">loading...</li>\n  <li class="errortip" ng-if="haserror">错误提示....</li>\n  <li ng-repeat="item in activities" class="tag-active" ng-click="goto(item);" ng-style="{\'background-image\':\'url(\'+item.wapImageUrl+\')\'}"></li>\n</ul>\n'),n.put("../assets/views/buy/buy.html",'<div ui-view></div>\n<!-- 购物车x-->\n<div class="pub-footer" ng-controller="buy.cartThumbCtrl">\n  <div class="cartThumb" ng-class="{showcart:isShowCart,showdetail:isShowDetail}">\n    <span class="iconfont icon-cart" ng-click="gotoDetail();">\n      <span class="totalCount" ng-class="{big:hasChange}" ng-show="totalCount && totalCount!=0">{{totalCount}}</span>\n    </span>\n    <p class="totalPrice" ng-show="totalCount && totalCount!=0">共计<em>&yen;</em>\n      <span>{{totalPrice|xiaomaiprice}}</span></p>\n    <div class="gotoPay" ng-show="totalCount && totalCount!=0" ng-click="goSettlement();">选好了</div>\n    <p class="emptyTip" ng-show="!totalCount || totalCount==0">购物车是空的,快快选购吧~</p>\n  </div>\n  <div class="cartDetail" ng-class="{\'cartDetail-show\':showcart}" ng-controller="buy.cartDetailCtrl">\n    <span class="goback" ng-click="continueShop();">继续购物<i class=" iconfont icon-YF_more"></i>\n    </span>\n    <div class="cartDetailWrap" subname="{{\'shopcartdetailheightupdate\'}}" xiaomai-iscroll>\n      <div>\n        <div class="haserror" ng-click="goHomepage();" ng-if="haserror">购物车空了 赶快去<span>购物吧</span></div>\n        <div class="good-info" ng-repeat="good in goods">\n          <div class="goodWrap">\n            <p class="good-title">{{good.sourceType==2?good.activityGoodsName:good.bgGoodsName}}</p>\n            <p class="good-price">&yen;{{good.minWapPrice|xiaomaiprice}}</p>\n            <lable class="label" ng-class="{ldc:$index==0,rdc:$index==1}" ng-repeat="distribute in good.distributeTypeDisplay" ng-show="distribute.length">{{distribute}}</lable>\n          </div>\n          <div class="iconWrap">\n            <i class="iconfont icon-minus" ng-class="{paying:good.isPaying}" ng-click="buyHandler(\'minus\',$index);"></i>\n            <span class="good-count">{{good.skuList[0].numInCart}}</span>\n            <i class="iconfont icon-plus" ng-class="{paying:goo.isPaying}" ng-click="buyHandler(\'plus\',$index);"></i>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="cartDetail-tip">\n      <p class="cartDetail-tip-freight" ng-if="ldcFreight.sub && ldcFreight.sub!=0">29分钟达产品满{{ldcFreight.total|xiaomaiprice}}减{{ldcFreight.sub|xiaomaiprice}}</p>\n      <p class="cartDetail-tip-coupon" ng-if="coupons.length">{{coupons.length}}张可用优惠劵<i class="couponMore iconfont icon-YF_more"></i>\n      </p>\n      <p class="cartDetail-tip-coupon" ng-if="!coupons.length">暂无可用优惠劵</p>\n    </div>\n  </div>\n</div>\n<!--遮罩-->\n<div class="mask" mask-gui ng-click="closeMask();"></div>\n<div class="shareModel" ng-show="shareIsShow" ng-click="closeShare();"></div>\n\n\n\n\n<div class="goodDetail" ng-class="{\'goodDetail-show\':showdetail}" ng-controller="buy.detailCtrl">\n  <div class="detailCont">\n    <div class="goodIconWrap">\n      <div class="iconfont icon-share" ng-click="showShareModel();"></div>\n      <div class="iconfont icon-unfold" ng-click="closeDetail();"></div>\n    </div>\n    <div class="goodDetailWrap" subname="{{\'detailgoodheightupdate\'}}" xiaomai-iscroll>\n      <div>\n        <div class="imgCont" ng-style="{\'background-image\':\'url(\'+(skuInfo&&skuInfo.imageUrl?skuInfo.imageUrl:good.imageUrl)+\')\'}">\n<!--到达类型-->\n          <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n        </div>\n        <div class="good-normal-info">\n<!--产品名称-->\n          <p class="title">{{good.sourceType==2?good.activityGoodsName:good.bgGoodsName}}</p>\n<!--产品价格-->\n          <p class="priceCont" ng-if="skuInfo">\n            <span class="new-price">&yen;<i>{{good.sourceType==2?skuInfo.activityPrice:skuInfo.wapPrice|xiaomaiprice}}</i></span>\n            <span class="old-price">&yen;{{skuInfo.originPrice|xiaomaiprice}}</span>\n          </p>\n          <p class="priceCont" ng-if="!skuInfo">\n            <span class="aggregate-price">&yen;{{good.minWapPrice|xiaomaiprice}}</span>\n            <span class="f14 aggregate-price">\n            ~&yen;{{good.maxWapPrice|xiaomaiprice}}\n            </span>\n          </p>\n<!--普通类活动-->\n          <div ng-if="good.isSeckill!=1">\n<!--如果没有货 显示补货中-->\n            <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n<!--进行数量选择-->\n            <p class="buy-handler-cont " ng-if="good.goodsStatusDisplay!=3">\n              <span class="buy-handler iconfont icon-minus" ng-class="{\'disabled\':!skuInfo||numInCart<1}" ng-click="buyHandler(\'minus\');"></span>\n<!--当前已经购买的数量 -->\n              <span class="buy-result">{{numInCart}}</span>\n              <span class="buy-handler iconfont icon-plus buy-icon" ng-class="{\'disabled\':!skuInfo}" ng-class="{paying:good.isPaying}" ng-click="buyHandler(\'plus\');"></span>\n            </p>\n          </div>\n<!--秒杀类产品-->\n          <div ng-if="good.isSeckill==1">\n<!--倒计时-->\n            <p class="countdown" ng-if="good.killStarted==0">\n              距开始\n              <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.timeBeforeStart}}" timeid="{{good.activityBgGoodsId}}"></span>\n            </p>\n<!-- 活动已开始-->\n            <p class="countdown" ng-if="good.killStarted==1">\n              距结束\n              <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.buyLeftTime}}" timeid="{{good.activityBgGoodsId}}"></span>\n            </p>\n<!-- 未开始-->\n            <p class="sk-icon disabled" ng-if="good.killStarted==0">抢</p>\n<!-- 已结束-->\n            <p class="sk-end" ng-if="good.killStarted==2">已结束</p>\n<!-- 已经售空-->\n            <p class="sold-out" ng-if="good.killStarted==1 && good.goodsStatusDisplay==3">已售空</p>\n<!-- 已经抢过了 -->\n            <p class="sold-geted" ng-if="good.killStarted==1 && good.killed">已抢购</p>\n<!-- 抢购开始 & 没抢购过 & 商品上架状态 -->\n            <p class="sk-icon" ng-class="{paying:good.isPaying}" ng-click="buyHandler(\'plus\',true)" ng-if="good.killStarted==1 && !good.killed && good.goodsStatusDisplay==2">抢</p>\n          </div>\n        </div>\n<!--如果是聚合类产品-->\n        <div class="complex-properties" ng-if="good.goodsType==3">\n          <div class="complex-property" ng-repeat="goodProperty in good.skuGoodsPropertyList">\n            <p class="complex-property-name">{{goodProperty.propertyName}}</p>\n            <div class="complex-property-values">\n              <span ng-class="{checked:checkedProperties[goodProperty.propertyNameId]==valueItem.propertyValueId}" ng-click="complexCheckProperty(goodProperty.propertyNameId,valueItem.propertyValueId)" ng-repeat="valueItem in goodProperty.propertyValues">{{valueItem.propertyValue}}</span>\n            </div>\n          </div>\n        </div>\n<!-- 产品描述-->\n        <div class="detail-desc">\n          <div class="detail-desc-key">产品描述:</div>\n          <div class="detail-desc-main">{{good.goodsDesc}}</div>\n        </div>\n        <div class="detail-desc">\n          <div class="detail-desc-key">产品规格:</div>\n          <div class="detail-desc-main">{{good.saleSpec}}/{{good.unit}}</div>\n        </div>\n        <div class="detail-desc">\n          <div class="detail-desc-key">产地:</div>\n          <div class="detail-desc-main">{{good.originPlace}}</div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'),n.put("../assets/views/category/category.html",'<div class="GoodsCont">\n\n  <div class="errortip" ng-if="haserror">{{errortip}}</div>\n  <div  ng-if="isloading" class="loading">\n      loading....\n  </div>\n  <!-- <div class="banner">\n    <ks-swiper-container swiper="swiper">\n      <ks-swiper-slide class="swiper-slide" ng-repeat="banner in banners">\n        <div class="categoryBanners" ng-click="gotoActive(banner);" ng-style="{\'background-image\':\'url(\'+banner.imageUrl+\')\'}"></div>\n      </ks-swiper-slide>\n    </ks-swiper-container>\n  </div> -->\n  <div class="GoodCont" ng-repeat="good in goods">\n    <div class="imgCont" ng-click="gotoDetail(good);" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'></div>\n    <div class="details">\n      <p class="goodname" ng-click="gotoDetail(good);">{{good.bgGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n      <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n      <p class="priceCont">\n<!-- 单品或者组合最高价-->\n        <span class="new-price" ng-if="good.goodsType!=3">\n          &yen;<i>{{good.skuList[0].wapPrice|xiaomaiprice}}</i>\n        </span>\n        <span class="old-price" ng-if="good.goodsType!=3">\n          &yen;{{good.skuList[0].originPrice|xiaomaiprice}}\n        </span>\n<!-- 聚合 -->\n        <span class="aggregate-price" ng-if="good.goodsType==3">\n          &yen;{{good.minWapPrice|xiaomaiprice}} ~ &yen;{{good.maxWapPrice|xiaomaiprice}}\n        </span>\n      </p>\n      <p ng-class="{paying:good.isPaying}" ng-click="buyHandler(good,$index);" class="buy-icon iconfont icon-plus" ng-if="good.goodsStatusDisplay!=3"></p>\n      <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n    </div>\n  </div>\n</div>\n'),n.put("../assets/views/colleges/colleges.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-back" ng-click="goback();"></div>\n  <div class="location-info">选择学校</div>\n  <div class="iconfont icon-locate-right"></div>\n</div>\n<div class="colleges_content" xiaomai-iscroll subname="{{\'collegesheightupdate\'}}">>\n  <ul class="countrylist">\n    <li class="loading" ng-if="isloading">学校信息正在加载....</li>\n    <li class="errortip" ng-if="haserror">该城市还没有相关学校</li>\n    <li ng-repeat="country in countrylist" >\n      <p class="countryname">{{country.cityName}}</p>\n      <div ng-class="{holiday:college.isOpen!=1}" class="" ng-click="checkCollege(college)" ng-click="checkCollege(college);" ng-repeat="college in country.colleges">{{college.collegeName}}</div>\n    </li>\n  </ul>\n</div>\n'),n.put("../assets/views/coupon/coupon.html",""),n.put("../assets/views/feedback/feedback.html",'<div class="feedback-wrap">\n  <div class="feedback-head">\n    <div back-icon class="iconfont icon-back icon-left" back-icon ng-click="goBack();"></div>\n    <div class="icon-middle">意见反馈</div>\n  </div>\n  <div class="feedback-main">\n    <div class="textareaCont">\n      <textarea class="feedback-cont" ng-model="feedback" placeholder="您的意见或建议是我们不断前进的巨大动力"></textarea>\n    </div>\n    <input placeholder="请留下您的联系方式(可选)" type="number" ng-model="mobile"/>\n    <div ng-click="submit();" class="icon-right submitBtn">提交</div>\n  </div>\n</div>\n'),n.put("../assets/views/nav/nav.html",'<div class="pub-header" ng-controller="nav.headCtrl">\n\n  <div class="iconfont icon-feedback" ng-click="gotoFeedback();"></div>\n  <div class="location-info" ng-click="gotoLocate();">\n    <i class="locate iconfont"></i>\n    {{schoolname}}\n    <i class="changeLocate"></i>\n  </div>\n  <div class="iconfont icon-user"></div>\n\n</div>\n<div class="list-main main-both" >\n  <div class="list-category" xiaomai-iscroll subname="{{\'navheightupdate\'}}">\n    <ul ng-controller="nav.listCtrl">\n      <li ng-repeat="nav in navs" ng-class="{\'nav-checked\':navChecked(nav)}" class="nav  nav-super nav-mark-{{nav.labelType}}" ng-click="goto(nav);" ng-if="nav.displayType!=3">{{nav.navigateName}}</li>\n     <li  class="nav nav-super " ng-init="isShowSub=true;">\n        <p class="arrow-down" ng-class="{\'arrow-up\':!isShowSub}" ng-click="isShowSub=!isShowSub;">聚类导航</p>\n        <ul ng-show="isShowSub">\n          <li ng-click="goto(subnav);" class="nav-sub nav-mark-{{subnav.labelType}}" ng-class="{\'nav-checked\':subnav.categoryId==curcategoryId}" ng-if="subnav.displayType==3" class="nav-sub" ng-repeat="subnav in navs">{{subnav.navigateName}}</li>\n        </ul>\n      </li>\n    </ul>\n  </div>\n  <div class="list-product" up-tip-cls="{{\'navmain-uptip\'}}" down-tip-cls="{{\'navmain-downtip\'}}" xiaomai-iscroll subname="{{\'navmainheightstatus\'}}" pubname="{{\'navmainscrollupdate\'}}">\n      <div ui-view></div>\n  </div>\n</div>\n'),n.put("../assets/views/locate/locate.html",'<div class="pub-header">\n  <div class="iconfont icon-back" ng-click="goback();"></div>\n  <div class="location-info">选择学校</div>\n  <div class="iconfont icon-locate-right"></div>\n</div>\n<div class="colleges_content" xiaomai-iscroll subname="{{\'locateheightupdate\'}}">\n  <div class="">\n    <p class="title">定位学校</p>\n    <div class="localColleges" ng-class="{locating:isLocating}">\n      <p class="" ng-if="isloading"></p>\n      <p class="errortip" ng-if="haserror">小麦迷路了,手动选择一下吧</p>\n      <p class="locateCollege" ng-class="{holiday:item.isOpen!=1}" ng-click="checkCollege(item)" ng-repeat="item in locationResult">{{item.collegeName}}</p>\n    </div>\n    <p class="title">手动选择</p>\n    <div class="allSchools">\n      <ul class="citylist iconfont">\n        <li ng-class="{checked:item.cityId==curcityid}" ng-click="showCollegeList(item);" ng-repeat="item in citylist">{{item.cityName}}</li>\n      </ul>\n    </div>\n  </div>\n</div>\n'),n.put("../assets/views/notfound/notfound.html",""),n.put("../assets/views/root/root.html","<div ui-view></div>\n"),n.put("../assets/views/recommend/recommend.html",'<div class="recommendCategoryCont">\n  <div class="errortip" ng-if="haserror">\n    错误提示....\n  </div>\n  <div class="loading" ng-if="isloading">\n    loading...\n  </div>\n  <div class="" ng-repeat="item in categorys">\n    <div class="recommendCateTitle">\n      <h3>{{item.category.categoryName}}</h3>\n      <span class="iconfont icon-unfold" ng-click="gotocategory(item);"></span>\n    </div>\n    <div class="recommendCateColumn">\n      <div class="recommendCateGood" ng-repeat="good in item.goods">\n        <div class="imgCont" ng-click="gotoDetail(good);" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'></div>\n        <div class="details">\n          <p class="goodname" ng-click="gotoDetail(good);">{{good.bgGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n          <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n          <p class="priceCont">\n<!-- 单品或者组合最高价-->\n            <span class="new-price" ng-if="good.goodsType==1||good.goodsType==2">\n              &yen;<i>{{good.skuList[0].wapPrice|xiaomaiprice}}</i>\n            </span>\n            <span class="old-price" ng-if="good.goodsType==1||good.goodsType==2">\n              &yen;{{good.skuList[0].originPrice|xiaomaiprice}}</span>\n<!-- 聚合 -->\n            <span class="aggregate-price" ng-if="good.goodsType==3">\n              &yen;{{good.minWapPrice|xiaomaiprice}} ~ &yen;{{good.maxWapPrice|xiaomaiprice}}\n            </span>\n          </p>\n          <p class="buy-icon iconfont icon-plus" ng-class="{paying:good.isPaying}" ng-click="buyHandler(good ,$index,$parent.$parent.$index);" ng-if="good.goodsStatusDisplay!=3"></p>\n          <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'),
n.put("../assets/views/skactive/skactive.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-back" ng-click="goback();"></div>\n  <div class="location-info">{{activityShowName}}</div>\n  <div class="iconfont icon-locate-right"></div>\n</div>\n<div class="skWrap" down-tip-cls="{{\'skactive-downtip\'}}" pubname="{{\'skactiveiscrollupdate\'}}" subname="{{\'skactiveheightstatus\'}}" xiaomai-iscroll>\n  <div>\n    <div class="banner">\n      <ks-swiper-container swiper="swiper">\n        <ks-swiper-slide class="swiper-slide" ng-repeat="banner in banners">\n          <div class="skactiveGoodBanner" ng-click="gotoActive(banner);" ng-style="{\'background-image\':\'url(\'+banner.imageUrl+\')\'}"></div>\n        </ks-swiper-slide>\n      </ks-swiper-container>\n    </div>\n    <ul class="skactiveGoodList">\n      <li class="errortip" ng-click="goHomepage();" ng-if="haserror">\n        活动已经结束 去其他活动<span>看看吧</span>\n      </li>\n      <li class="loading" ng-if="isloading">\n        loading....\n      </li>\n      <li ng-repeat="good in goods">\n        <div class="goodItem">\n          <div class="imgCont" ng-click="gotoDetail(good);" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'>\n<!--如果活动未开始-->\n            <p class="countdown" ng-if="good.killStarted==0">\n              距开始\n              <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.timeBeforeStart}}" timeid="{{good.activityBgGoodsId}}"></span>\n            </p>\n<!-- 活动已开始-->\n            <p class="countdown" ng-if="good.killStarted==1">\n              距结束\n              <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.buyLeftTime}}" timeid="{{good.activityBgGoodsId}}"></span>\n            </p>\n          </div>\n          <div class="details">\n            <p class="goodname" ng-click="gotoDetail(good);">{{good.activityGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n            <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n            <p class="priceCont">\n<!-- 单品或者组合最高价-->\n              <span class="new-price" ng-if="good.goodsType==1||good.goodsType==2">\n                &yen;<i>{{good.skuList[0].activityPrice|xiaomaiprice}}</i>\n              </span>\n              <span class="old-price" ng-if="good.goodsType==1||good.goodsType==2">\n                &yen;{{good.skuList[0].originPrice|xiaomaiprice}}</span>\n            </p>\n<!-- 未开始-->\n            <p class="sk-icon disabled" ng-if="good.killStarted==0">抢</p>\n<!-- 已结束-->\n            <p class="sk-end" ng-if="good.killStarted==2">已结束</p>\n<!-- 已经售空-->\n            <p class="sold-out" ng-if="good.killStarted==1 && good.goodsStatusDisplay==3">抢光了</p>\n<!-- 已经抢过了 -->\n            <p class="sold-geted" ng-if="good.killStarted==1 && good.killed">已抢购</p>\n<!-- 抢购开始 & 没抢购过 & 商品上架状态 -->\n            <p class="sk-icon" ng-class="{paying:good.isPaying}" ng-click="buyHandler(good,$index);" ng-if="good.killStarted==1 && !good.killed && good.goodsStatusDisplay==2">抢</p>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n')}]),angular.module("xiaomaiApp").directive("xiaomaiIscroll",["xiaomaiMessageNotify","$timeout","$state",function(n,e,a){var o=function(a,o,t){var i,r=document.createElement("p");r.className+=" "+a.upTipCls;var s=document.createElement("p");s.className+=" "+a.downTipCls;var c=new IScroll(o[0],{click:!0,tap:!0,probeType:1}),l=function(n,e){var a=o.children()[0];r.textContent=n,s.textContent=e,r.className=r.className.replace("pending","").trim(),s.className=s.className.replace("pending","").trim(),a.firstChild!=r&&a.insertBefore(r,a.firstChild),a.lastChild!=s&&a.appendChild(s)};a.scrollstatus="ready",c.on("scrollStart",function(){});var d,u,g=setTimeout(function(){var n=o.children()[0];u=n.offsetHeight-o[0].offsetHeight,c&&c.refresh()},1e3);c.on("scroll",function(){return"ready"!==a.scrollstatus?!1:void(this.y>40?(d&&clearTimeout(d),d=setTimeout(function(){n.pub(a.pubname,"up"),a.scrollstatus="pending"},100)):Math.abs(this.y)>u+15&&(d&&clearTimeout(d),d=setTimeout(function(){n.pub(a.pubname,"down"),a.scrollstatus="pending"},100)))}),a.subname&&n.sub(a.subname,function(e,t,i,d){var p=o.children()[0];"up"==e?"ready"==t?(a.scrollstatus="ready",g&&clearTimeout(g),g=null,setTimeout(function(){c&&c.refresh(),u=p.offsetHeight-o[0].offsetHeight,c.scrollTo(0,0),l(i,d)},50)):(a.scrollstatus="pending",r.className=r.className+" pending",r.textContent=i):"down"==e&&("ready"==t?(a.scrollstatus="ready",g&&clearTimeout(g),g=null,setTimeout(function(){c&&c.refresh(),u=p.offsetHeight-o[0].offsetHeight,l(i,d),n.pub("navmainscrollupdate","down")},500)):(a.scrollstatus="pending",s.className=s.className+" pending",s.textContent=i))}),a.$on("$destroy",function(){c&&c.destroy(),e.cancel(i),c=null,n.remove(a.subname)})};return{scope:{pubname:"@",subname:"@",options:"@",upTipCls:"@",downTipCls:"@"},link:o}}]),angular.module("xiaomaiApp").directive("countdown",["$interval",function(n){function e(n){var e,a,o,t=function(n){return 10>n?"0"+n:n},i=3600,r=60,s=1;return n=Number(n),e=Math.floor(n/i),n%=i,a=Math.floor(n/r),n%=r,o=Math.floor(n/s),[t(e),t(a),t(o)].join(":")}var a=function(a,o,t){var i=a.counttime,r=n(function(){return 0==i?(n.cancel(r),a.countDeadCall({timeid:a.timeid}),!1):(i-=1,void o.html(e(i)))},1e3)};return{template:"<span></span>",scope:{counttime:"@",timeid:"@",countDeadCall:"&"},link:a,replace:!0}}]),angular.module("xiaomaiApp").controller("buy.activeCtrl",["$scope","$state","xiaomaiService","buyProcessManager","xiaomaiCacheManager","xiaomaiMessageNotify","parseUrlParams",function(n,e,a,o,t,i,r){var s,c,l,d=function(){return a.fetchOne("activeBanner",{collegeId:s,activityId:c})},u=function(){return a.fetchOne("activeGoods",{collegeId:s,activityId:c,currentPage:l,recordPerPage:10})};s=e.params.collegeId,c=e.params.activityId,l=e.params.page||1,n.isloading=!0,u().then(function(e){n.activityShowName=e.activityShowName,n.goods=e.goods,n.paginationInfo=e.paginationInfo,n.haserror=n.goods.length?!1:!0},function(){n.haserror=!0})["finally"](function(){n.isloading=!1;var e=n.paginationInfo.currentPage!=n.paginationInfo.totalPage;i.pub("activeheightstatus","up","ready","",e?"请求下一页数据":"")});var g=i.sub("activeiscrollupdate",function(e){"down"==e&&n.paginationInfo.currentPage!=n.paginationInfo.totalPage&&(i.pub("activeheightstatus","down","pending","","正在请求数据"),v().then(function(e){var a=n.paginationInfo.currentPage!=n.paginationInfo.totalPage;i.pub("activeheightstatus","down","ready","",a?"请求下一页数据":"")}))});n.$on("$destroy",function(){i.removeOne("activeiscrollupdate",g)}),d().then(function(e){return n.banners=e.banners,e}),n.showShareModel=function(){i.pub("shareModelManager","show"),i.pub("maskManager","show")},n.goback=function(){e.go("root.buy.nav.all")};var p=function(n){var e={};return n.match(/[\?&]m=([^\?&]+)/)?(e.name="root.buy.nav.category",e.params={categoryId:n.match(/[\?&]id=([^\?&]+)/)[1],collegeId:s}):n.match(/skActivity/)?(e.name="root.buy.skactive",e.params={collegeId:s,activityId:n.match(/[\?&]activityId=([^\?&]+)/)[1]}):n.match(/activity/)?(e.name="root.buy.skactive",e.params={collegeId:s,activityId:n.match(/[\?&]activityId=([^\?&]+)/)[1]}):e.path=n,e};n.gotoActive=function(n){var a=p(n.hrefUrl);return a.hasOwnProperty("path")?window.location.href=a.path:e.go(a.name,a.params),!1},n.gotoDetail=function(n){return i.pub("detailGuiManager","show",n.activityGoodsId,n.sourceType),!1},n.buyHandler=function(e,a){return 3==e.goodsType?(n.gotoDetail(e),!1):(n.goods[a].isPaying=!0,void o({distributeType:e.skuList[0].distributeType,goodsId:e.activityGoodsId,sourceType:e.sourceType,skuId:e.skuList[0].activitySkuId,price:e.skuList[0].activityPrice,propertyIds:""},"plus",Math.min(e.maxNum,e.skuList[0].stock)).then(function(){},function(n){return alert(n),!1})["finally"](function(){n.goods[a].isPaying=!1}))};var v=function(){return a.fetchOne("activeGoods",{collegeId:s,activityId:c,recordPerPage:10,currentPage:n.paginationInfo.currentPage+1}).then(function(e){return n.paginationInfo=e.paginationInfo,n.goods=n.goods.concat(e.goods),e})}}]),angular.module("xiaomaiApp").controller("nav.activeCtrl",["$scope","$state","xiaomaiService","buyProcessManager","xiaomaiCacheManager","xiaomaiMessageNotify","siblingsNav",function(n,e,a,o,t,i,r){var s,c,l,d=function(){return a.fetchOne("activeBanner",{collegeId:s,activityId:c})},u=function(){return a.fetchOne("activeGoods",{collegeId:s,activityId:c,currentPage:l,recordPerPage:10})};s=e.params.collegeId,c=e.params.activityId,l=e.params.page||1,n.isloading=!0;u().then(function(e){n.haserror=e.goods.length?!1:!0,n.goods=e.goods,n.paginationInfo=e.paginationInfo},function(){n.haserror=!0})["finally"](function(){n.isloading=!1;var e=n.paginationInfo.currentPage==n.paginationInfo.totalPage,a=e?"":"请求下一页数据";i.pub("navmainheightstatus","up","ready","",a)}),d().then(function(e){return n.banners=e.banners,e}),n.gotoDetail=function(n){return i.pub("detailGuiManager","show",n.activityGoodsId,n.sourceType),!1};var g=i.sub("navmainscrollupdate",function(e){return"up"==e?!1:n.paginationInfo.currentPage==n.paginationInfo.totalPage?!1:(i.pub("navmainheightstatus","down","pending","正在请求数据..."),void p().then(function(e){var a=n.paginationInfo.currentPage==n.paginationInfo.totalPage,o=a?"":"请求下一页数据";i.pub("navmainheightstatus","down","ready","",o)}))}),p=function(){return a.fetchOne("activeGoods",{collegeId:s,activityId:c,recordPerPage:10,currentPage:n.paginationInfo.currentPage+1}).then(function(e){return n.paginationInfo=e.paginationInfo,n.goods=n.goods.concat(e.goods),e})};n.$on("$destroy",function(){i.removeOne("navmainscrollupdate",g)}),n.buyHandler=function(e,a){return 3==e.goodsType?(n.gotoDetail(e),!1):(n.goods[a].isPaying=!1,void o({distributeType:e.skuList[0].distributeType,goodsId:e.activityGoodsId,sourceType:e.sourceType,skuId:e.skuList[0].activitySkuId,price:e.skuList[0].activityPrice,propertyIds:""},"plus",Math.min(e.maxNum,e.skuList[0].stock)).then(function(){},function(n){return alert(n),!1})["finally"](function(){n.goods[a].isPaying=!0}))},n.pagination=function(n){}}]),angular.module("xiaomaiApp").controller("nav.allCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiMessageNotify","xiaomaiCacheManager","siblingsNav",function(n,e,a,o,t,i,r){n.activities=[];var s;n.isloading=!0,o.get().then(function(n){return s=n.collegeId,a.fetchOne("activities",{collegeId:s})}).then(function(e){n.haserror=!1,n.activities=e.activities},function(e){n.haserror=!0})["finally"](function(){n.isloading=!1,t.pub("navmainheightstatus","up","ready","","")}),n.$on("$destory",function(){i.writeCache("activities",{activities:n.activities})}),n["goto"]=function(n){if("1"==n.isLinkUrl)return window.location.href=n.linkUrl,!1;var a="";switch(n.activityType){case 1:a="root.buy.active";break;default:a="root.buy.skactive"}e.go(a,{collegeId:s,activityId:n.activityId})}}]),angular.module("xiaomaiApp").controller("buyCtrl",["$state","$scope","schoolManager","$q","xiaomaiMessageNotify",function(n,e,a,o,t){e.$on("$stateChangeSuccess",function(e,o,t){a.get().then(function(e){"root.buy"==o.name&&n.go("root.buy.nav.all")},function(){n.go("root.locate")})}),e.closeMask=function(){t.pub("cartGuiManager","hide"),t.pub("detailGuiManager","hide"),t.pub("shareModelManager","hide")},e.closeShare=function(){t.pub("shareModelManager","hide"),"hide"==i&&"hide"==r&&t.pub("maskManager","hide")};var i,r,s=t.sub("detailGuiManager",function(n){i=n}),c=t.sub("cartGuiManager",function(n){r=n}),l=t.sub("shareModelManager",function(n){e.shareIsShow="show"==n?!0:!1});e.$on("$destroy",function(){t.removeOne("cartGuiManager",c),t.removeOne("detailGuiManager",s),t.removeOne("shareModelManager",l)}),e.$on("$stateChangeStart",function(n,e,a,o,s){("show"==i||"show"==r)&&(t.pub("detailGuiManager","hide"),t.pub("cartGuiManager","hide"),n.preventDefault())})}]),angular.module("xiaomaiApp").controller("buy.detailCtrl",["$scope","$state","xiaomaiService","getSkuInfo","skuListToObject","buyProcessManager","xiaomaiMessageNotify","cartManager",function(n,e,a,o,t,i,r,s){var c,l;n.numInCart=0;var d=(r.sub("detailGuiManager",function(e,a,o){"show"==e?(c=a,l=o,d(c,l).then(function(e){n.good=e,3==n.good.goodsType?(n.skuInfo=!1,n.checkedProperties={},n.skuObject=u(n.good.skuList)):(n.skuInfo=n.good.skuList[0],s.getnumInCart(n.skuInfo.skuId).then(function(e){n.numInCart=e})),n.showdetail=!0})["finally"](function(){r.pub("detailgoodheightupdate","up","ready")})):n.showdetail=!1,r.pub("maskManager",e)}),function(n,e){return a.fetchOne("goodDetail",{goodsId:n,sourceType:e})}),u=function(n){return t(n)};n.complexCheckProperty=function(e,a){n.checkedProperties[e]=a;var t=o(n.checkedProperties,n.skuObject);if(n.skuInfo=0==t?!1:t,n.skuInfo){var i=t.activitySkuId;s.getnumInCart(i).then(function(e){n.numInCart=e})}else n.numInCart=0},n.showShareModel=function(){r.pub("shareModelManager","show")},n.buyHandler=function(e,a){var o=[];if(!n.skuInfo)return alert("请选择商品规格"),!1;angular.forEach(n.checkedProperties,function(n){o.push(n)}),o=o.join("_");var t=2==l?{goodsId:n.good.activityGoodsId,sourceType:2,skuId:n.skuInfo.activitySkuId,distributeType:n.skuInfo.distributeType,price:n.skuInfo.activityPrice,propertyIds:""}:{goodsId:c,sourceType:l,skuId:n.skuInfo.skuId,distributeType:n.skuInfo.distributeType,price:n.skuInfo.wapPrice,propertyIds:o};n.good.isPaying=!0,i(t,e,Math.min(n.good.maxNum,n.skuInfo.stock),n.numInCart).then(function(e){n.numInCart=e,2==n.good.soruceType&&(n.good.killed=!0,alert("抢购成功,赶紧去下单吧!"))},function(n){return alert(n),!1}).then(function(){n.good.isPaying=!1})},n.timecountdown=function(e){0===n.good.killStarted?(n.good.killStarted=1,n.good.beginTime=-1):1===n.good.killStarted&&(n.good.killStarted=2,n.good.buyLeftTime=-1)},n.closeDetail=function(){r.pub("detailGuiManager","hide")}}]),angular.module("xiaomaiApp").controller("buy.cartThumbCtrl",["$state","$scope","xiaomaiService","cartManager","$timeout","xiaomaiMessageNotify","env",function(n,e,a,o,t,i,r){o.query(function(n){e.totalCount=n.totalCount,e.totalPrice=n.totalPrice;var a=o.readCartCache();e.hasChange=a.totalCount&&a.totalCount==e.totalCount?!1:!0,e.hasChange&&t(function(){e.hasChange=!1},200)}),i.sub("cartGuiManager",function(n){e.isShowCart="show"==n}),i.sub("detailGuiManager",function(n){e.isShowDetail="show"==n}),e.goSettlement=function(){var n="online"==r?"http://h5.imxiaomai.com":"http://wap.tmall.imxiaomai.com";window.location.href=n+"/order/create"},e.gotoDetail=function(){return e.totalCount&&0!=e.totalCount?(i.pub("detailGuiManager","hide"),void i.pub("cartGuiManager","show")):!1},e.$on("$destroy",function(){o.store(!1)})}]),angular.module("xiaomaiApp").controller("buy.cartDetailCtrl",["$state","$scope","xiaomaiService","cookie_openid","buyProcessManager","xiaomaiMessageNotify","cartManager",function(n,e,a,o,t,i,r){var s=i.sub("cartGuiManager",function(n){"show"==n&&c().then(function(n){return e.goods=n.goods,e.ldcFreight=n.ldcFreight,e.haserror=!1,n},function(){return e.haserror=!0,l()}).then(function(n){e.coupons=n.couponInfo})["finally"](function(){i.pub("shopcartdetailheightupdate","up","ready")}),e.showcart="show"==n?!0:!1,i.pub("maskManager",n)});e.$on("destory",function(){i.removeOne("cartGuiManager",s)}),e.continueShop=function(){i.pub("cartGuiManager","hide")},e.goHomepage=function(){n.go("root.buy.nav.all",{showCart:!1})};var c=function(){return r.queryCartDetail()},l=function(){return a.fetchOne("mycoupon",{openId:o})};e.buyHandler=function(n,a){var o=e.goods[a],i=o.sourceType,r=o.skuList[0],s=2==i?{goodsId:o.activityGoodsId,sourceType:2,skuId:r.activitySkuId,distributeType:r.distributeType,price:r.activityPrice,propertyIds:""}:{goodsId:o.goodsId,sourceType:o.sourceType,distributeType:r.distributeType,skuId:r.skuId,price:r.wapPrice,propertyIds:""},o=e.goods[a];e.goods[a].isPaying=!0,t(s,n,o.maxNum,o.skuList[0].numInCart).then(function(n){o.skuList[0].numInCart=n,0==o.skuList[0].numInCart&&e.goods.splice(a,1)},function(n){alert(n)}).then(function(){e.goods[a].isPaying=!1})}}]),angular.module("xiaomaiApp").controller("nav.categoryCtrl",["$state","xiaomaiService","$scope","xiaomaiCacheManager","buyProcessManager","xiaomaiMessageNotify","siblingsNav","$timeout",function(n,e,a,o,t,i,r,s){var c,l;a.$on("$stateChangeSuccess",function(n,e,a){c=a.collegeId,l=a.categoryId,d()});a.isloading=!0;var d=function(){e.fetchOne("goods",{collegeId:c,categoryId:l,recordPerPage:10}).then(function(n){a.goods=n.goods,a.paginationInfo=n.paginationInfo,a.haserror=!1},function(n){a.haserror=!0,a.errortip=n})["finally"](function(){a.isloading=!1;var n=a.paginationInfo.currentPage==a.paginationInfo.totalPage,e=n?"":"请求下一页数据";i.pub("navmainheightstatus","up","ready","",e)},function(n){a.errorip=n,a.haserror=!0})},u=i.sub("navmainscrollupdate",function(n){return"up"==n?!1:a.paginationInfo.currentPage==a.paginationInfo.totalPage?!1:(i.pub("navmainheightstatus","down","pending","正在请求数据..."),void g().then(function(n){var e=a.paginationInfo.currentPage==a.paginationInfo.totalPage,o=e?"":"请求下一页数据";i.pub("navmainheightstatus","down","ready","",o)}))}),g=function(){return e.fetchOne("goods",{collegeId:c,categoryId:l,recordPerPage:10,currentPage:a.paginationInfo.currentPage+1}).then(function(n){return a.paginationInfo=n.paginationInfo,a.goods=a.goods.concat(n.goods),n})};a.$on("$destroy",function(){i.removeOne("navmainscrollupdate",u)}),a.gotoDetail=function(n){return i.pub("detailGuiManager","show",n.goodsId,n.sourceType),!1},a.buyHandler=function(n,e){return 3==n.goodsType?(a.gotoDetail(n),!1):(a.goods[e].isPaying=!0,void t({goodsId:n.goodsId,sourceType:n.sourceType,distributeType:n.skuList[0].distributeType,skuId:n.skuList[0].skuId,price:n.skuList[0].wapPrice,propertyIds:""},"plus",Math.min(n.maxNum,n.skuList[0].stock)).then(function(n){},function(n){alert(n)})["finally"](function(){a.goods[e].isPaying=!1}))}}]),angular.module("xiaomaiApp").controller("collegesCtrl",["$state","$scope","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify",function(n,e,a,o,t,i){e.countrylist=[],e.$on("$stateChangeSuccess",function(n,e,a){var o=a.cityid;r(o)}),e.isloading=!0;var r=function(n){a.fetchOne("collegelist",{cityId:n}).then(function(n){e.haserror=n.cities.length?!1:!0,e.countrylist=n.cities},function(n){e.haserror=!0})["finally"](function(){i.pub("collegesheightupdate","up","ready","",""),e.isloading=!1})};e.checkCollege=function(e){o.set(e).then(function(){return t.clean("navgatorlist"),!0}).then(function(){n.go("root.buy.nav.all")})},e.goback=function(){n.go("root.locate")}}]),angular.module("xiaomaiApp").controller("buy.couponCtrl",["$state","$scope","xiaomaiService",function(n,e,a){a.fetchOne("mycoupon",{}).then(function(n){})}]),angular.module("xiaomaiApp").controller("feedbackCtrl",["$scope","$state","xiaomaiService",function(n,e,a){n.goBack=function(){e.go("root.buy.nav.all")},n.feedback="",n.mobile="";var o=/^(\+86)?1[3|4|5|8][0-9]\d{4,8}$/g;n.submit=function(){var t=n.feedback,i=n.mobile;return t=t.trim&&t.trim(),t&&t.length?i.length&&!o.test(i)?(alert("手机号有误,请确认"),!1):void a.save("feedback",{mobile:i,feedback:t}).then(function(){alert("提交成功!谢谢!"),e.go("root.buy.nav.all")},function(n){alert("提交失败,请重新尝试!\n失败原因:"+n)}):(alert("请输入您的建议或意见"),!1)}}]),angular.module("xiaomaiApp").controller("positionCtrl",["$scope","locationManager","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify",function(n,e,a,o,t,i,r){n.locationResult=[],n.isLocating=!0,e().then(function(n){return o.fetchOne("locate",{latitude:n.lat,longitude:n.lng})}).then(function(e){n.locationResult=e.colleges},function(e){n.localFail=!0})["finally"](function(){n.isLocating=!1}),n.citylist=[],n.isloading=!0,o.fetchOne("citylist",{},!0).then(function(e){n.citylist=e.cities,n.haserror=!1},function(){n.haserror=!0})["finally"](function(){n.isloading=!1,r.pub("locateheightupdate","up","ready","","")}),n.showCollegeList=function(n){a.go("root.colleges",{cityid:n.cityId})},n.$on("$stateChangeSuccess",function(e,a,o){n.curcityid=o.cityid}),n.checkCollege=function(n){t.set(n).then(function(){return i.clean("navgatorlist"),!0}).then(function(){a.go("root.buy.nav.all")})},n.goback=function(){a.go("root.buy.nav.all")}}]),angular.module("xiaomaiApp").controller("navCtrl",["$scope","$state",function(n,e){}]),angular.module("xiaomaiApp").controller("nav.headCtrl",["$scope","$state","schoolManager",function(n,e,a){n.schoolname="未选择所在学校",a.get().then(function(e){n.schoolname=e.collegeName}),n.gotoLocate=function(){e.go("root.locate")},n.gotoFeedback=function(){e.go("root.feedback")}}]),angular.module("xiaomaiApp").controller("nav.listCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify",function(n,e,a,o,t,i){n.navs=[],o.get().then(function(n){return a.fetchOne("navgatorlist",{collegeId:n.collegeId})}).then(function(e){n.navs=e.navigateItems,i.pub("navheightupdate","up","ready","",""),t.writeCache("navgatorlist",e)}),n.paths={0:"root.buy.nav.all",1:"root.buy.nav.recommend",2:"root.buy.nav.active",3:"root.buy.nav.category"},n.navChecked=function(e){var a=!1;switch(n.curpath){case"all":a=0==e.displayType;break;case"recommend":a=1==e.displayType;break;case"active":a=n.activityId==e.activityId;break;case"skactive":a=n.activityId==e.activityId;break;case"category":a=n.curcategoryId==e.categoryId}return a},n.$on("$stateChangeSuccess",function(e,a,o){n.type=o.type;var t=/nav\.(\w+)/,i=a.name.match(t);n.curcategoryId=o.categoryId,n.activityId=o.activityId,i&&i.length&&(n.curpath=i[1])}),n["goto"]=function(a){o.get().then(function(o){var t,i=o.collegeId,r=a.displayType;a.activityType;t=n.paths[r],e.go(t,{categoryId:a.categoryId,activityId:a.activityId,collegeId:i,showDetail:!1,showCart:!1})})}}]),angular.module("xiaomaiApp").controller("nav.recommendCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","buyProcessManager","siblingsNav",function(n,e,a,o,t,i,r,s){var c;n.isloading=!0;o.get().then(function(n){return c=n.collegeId,a.fetchOne("categoryGoods",{collegeId:c})}).then(function(e){n.categorys=e,n.haserror=!1},function(){n.haserror=!0})["finally"](function(e){n.isloading=!1,i.pub("navmainheightstatus","up","ready","","")}),n.$on("$destroy",function(){t.writeCache("categoryGoods",n.categorys)}),n.gotocategory=function(n){e.go("root.buy.nav.category",{collegeId:c,categoryId:n.category.categoryId})},n.gotoDetail=function(n){i.pub("detailGuiManager","show",n.goodsId,n.sourceType)},n.buyHandler=function(e,a,o){return 3==e.goodsType?(n.gotoDetail(e),!1):(n.categorys[o].goods[a].isPaying=!0,void r({goodsId:e.bgGoodsId,sourceType:e.sourceType,distributeType:e.skuList[0].distributeType,skuId:e.skuList[0].skuId,price:e.skuList[0].wapPrice,propertyIds:""},"plus",Math.min(e.maxNum,e.skuList[0].stock)).then(function(){},function(n){alert(n)})["finally"](function(){n.categorys[o].goods[a].isPaying=!1}))}}]),angular.module("xiaomaiApp").controller("buy.skactiveCtrl",["$scope","$state","xiaomaiService","buyProcessManager","xiaomaiCacheManager","xiaomaiMessageNotify","parseUrlParams",function(n,e,a,o,t,i,r){var s,c,l=1,d=function(){return a.fetchOne("activeBanner",{collegeId:s,activityId:c})};n.goods=[];var u=function(){return a.fetchOne("activeGoods",{collegeId:s,activityId:c,currentPage:l,recordPerPage:10})},g=function(){return a.fetchOne("activeGoods",{collegeId:s,activityId:c,currentPage:n.paginationInfo.currentPage+1,recordPerPage:10}).then(function(e){return n.paginationInfo=e.paginationInfo,n.goods=n.goods.concat(e.goods),e})};s=e.params.collegeId,c=e.params.activityId,l=e.params.page||1,n.isloading=!0,u().then(function(e){n.activityShowName=e.activityShowName,n.goods=e.goods,n.paginationInfo=e.paginationInfo,n.haserror=n.goods.length?!1:!0},function(){n.haserror=!0})["finally"](function(){n.isloading=!1;var e=n.paginationInfo.currentPage!=n.paginationInfo.totalPage;i.pub("skactiveheightstatus","up","ready","",e?"请求下一页数据":"没有更多数据了")}),d().then(function(e){return n.banners=e.banners,e});var p=i.sub("skactiveiscrollupdate",function(e){"down"==e&&n.paginationInfo.currentPage!=n.paginationInfo.totalPage&&(i.pub("skactiveheightstatus","down","pending","","正在请求数据"),g().then(function(e){var a=n.paginationInfo.currentPage!=n.paginationInfo.totalPage;i.pub("skactiveheightstatus","up","ready","",a?"请求下一页数据":"")}))});n.$on("$destroy",function(){i.removeOne("skactiveiscrollupdate",p)}),n.goback=function(){e.go("root.buy.nav.all")};var v=function(n){var e={};return n.match(/[\?&]m=([^\?&]+)/)?(e.name="root.buy.nav.category",e.params={categoryId:n.match(/[\?&]id=([^\?&]+)/)[1],collegeId:s}):n.match(/skActivity/)?(e.name="root.buy.skactive",e.params={collegeId:s,activityId:n.match(/[\?&]activityId=([^\?&]+)/)[1]}):n.match(/activity/)?(e.name="root.buy.skactive",e.params={collegeId:s,activityId:n.match(/[\?&]activityId=([^\?&]+)/)[1]}):e.path=n,e};n.gotoActive=function(n){var a=v(n.hrefUrl);return a.hasOwnProperty("path")?window.location.href=a.path:e.go(a.name,a.params),!1},n.gotoDetail=function(n){return i.pub("detailGuiManager","show",n.activityGoodsId,n.sourceType),!1},n.buyHandler=function(e,a){n.goods[a].isPaying=!0,o({goodsId:e.activityGoodsId,sourceType:2,distributeType:e.skuList[0].distributeType,skuId:e.skuList[0].activitySkuId,price:e.skuList[0].activityPrice,propertyIds:""},"plus",Math.min(e.maxNum,e.skuList[0].stock)).then(function(){alert("赶快去下单吧\n否则可能会被其他人抢走了哦"),n.goods[a].killed=!0},function(n){return alert(n),!1})["finally"](function(){n.goods[a].isPaying=!1})},n.timecountdown=function(e){var a;angular.forEach(n.goodsList,function(n,o){return n.activityBgGoodsId===Number(e)?(a=o,!1):void 0}),0===n.goods[a].killStarted?(n.goods[a].killStarted=1,n.goods[a].beginTime=-1):1===n.goodsList[a].killStarted&&(n.goods[a].killStarted=2,n.goods[a].buyLeftTime=-1)}}]);