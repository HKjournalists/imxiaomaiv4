angular.module("xiaomaiApp",window.__SYS_CONF.dependent_modules),angular.module("xiaomaiApp").config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("root",{url:"/",templateUrl:"../assets/views/root/root.html"}).state("root.buy",{url:"buy/",controller:"buyCtrl",templateUrl:"../assets/views/buy/buy.html"}).state("root.buy.nav",{url:"nav/",templateUrl:"../assets/views/nav/nav.html"}).state("root.buy.nav.all",{url:"all/",templateUrl:"../assets/views/all/all.html",controller:"nav.allCtrl"}).state("root.buy.nav.recommend",{url:"recommend/",controller:"nav.recommendCtrl",templateUrl:"../assets/views/recommend/recommend.html"}).state("root.buy.nav.active",{url:"active/?collegeId&activityId",controller:"nav.activeCtrl",templateUrl:"../assets/views/active/nav.active.html"}).state("root.buy.active",{url:"active/?collegeId&activityId&refer",controller:"buy.activeCtrl",templateUrl:"../assets/views/active/active.html"}).state("root.buy.nav.category",{url:"category/?collegeId&categoryId",controller:"nav.categoryCtrl",templateUrl:"../assets/views/category/category.html"}).state("root.locate",{url:"locate/",controller:"positionCtrl",templateUrl:"../assets/views/locate/locate.html"}).state("root.colleges",{url:"colleges/?cityid",controller:"collegesCtrl",templateUrl:"../assets/views/colleges/colleges.html"}).state("root.buy.sharedetail",{url:"sharedetail/?goodId&sourceType&collegeId",controller:"sharedetailCtrl",templateUrl:"../assets/views/sharedetail/sharedetail.html"}).state("root.buy.coupon",{url:"coupon/",controller:"buy.couponCtrl",templateUrl:"../assets/views/coupon/coupon.html"}).state("root.feedback",{url:"feedback",controller:"feedbackCtrl",templateUrl:"../assets/views/feedback/feedback.html"}).state("root.search",{url:"search/",controller:"searchCtrl",templateUrl:"../assets/views/search/search.html"}).state("root.buy.searchresult",{url:"searchresult/?key&page",controller:"searchresultCtrl",templateUrl:"../assets/views/search/searchresult.html"}).state("root.notfound",{url:"404/",templateUrl:"../assets/views/notfound/notfound.html"})}]),angular.module("xiaomaiApp").run(["$state","$rootScope","$timeout",function(e,o,a){var n=a(function(){e.go("root.buy.nav.all")},50),t=o.$on("$stateChangeStart",function(e,o,i){a.cancel(n),t()})}]),document.addEventListener("touchmove",function(e){e.preventDefault()},!1),angular.module("xiaomaiApp").filter("xiaomaiprice",function(){return function(e){return(e/100).toFixed(2)}}),angular.module("xiaomaiApp").factory("xiaomaimodelManage",function(){var e={navgatorlist:{url:"/wap/navigate/index",type:"GET"},locate:{url:"/wap/college/locate",type:"GET"},citylist:{url:"/wap/geography/cities",type:"GET"},collegelist:{url:"/wap/geography/colleges",type:"GET"},getSchool:{url:"/wap/college/detail",type:"GET"},saveSchool:{url:"/wap/college/detail",type:"POST"},activities:{url:"/wap/college/activities",type:"GET"},activeGoods:{url:"/wap/activity/goods",type:"GET"},activeBanner:{url:"/wap/activity/banners",type:"GET"},categoryGoods:{url:"/wap/index/categoryGoods",type:"GET"},categoryBanners:{type:"GET",url:"/wap/category/banners"},goods:{url:"/wap/category/goods",type:"GET"},goodDetail:{url:"/wap/goods/detail",type:"GET"},removeCart:{url:"/wap/cart/remove",type:"POST"},whitelist:{type:"GET",url:"/wap/college/whitelist"},addCart:{url:"/wap/cart/add",type:"POST"},queryCart:{url:"/wap/cart/sync",type:"GET"},queryCartDetail:{url:"/wap/cart/get",type:"GET"},mycoupon:{url:"/couponwap/myCouponList",type:"GET"},getWxConfig:{url:"/wap/getWxConfig",type:"GET"},feedback:{url:"/wap/feedback/detail",type:"POST"},log:{url:"http://logger.imxiaomai.com/client/event",type:"GET"},searchresult:{url:"/wap/goods/search",type:"GET"},searchsuggest:{url:"/wap/goods/suggest",type:"GET"}},o=function(){var o=Array.prototype.slice.call(arguments,0),a=o[0],n=o[1]||"GET";return e.hasOwnProperty(a)&&e[a].type===n?e[a].url:!1};return o}),angular.module("xiaomaiApp").factory("urlInterceptor",["env",function(e){var o=function(o){return"develop"!==e?o:"/api"+o+".json"};return o}]),angular.module("xiaomaiApp").factory("xiaomaiService",["env","$q","urlInterceptor","xiaomaimodelManage","$http","xiaomaiCacheManager","getDataType","httpRequstParam","$timeout",function(e,o,a,n,t,i,r,s,c){var l=function(e,o){var a=n(e,o);return a},d=function(e){return 0==e.code&&e.data&&("number"!=r(e.data)||e.data.length)&&("object"!=r(e.data)||Object.keys(e.data).length)?e.data:!1},u=function(){return o.defer()},g=function(e){var o,n=u(),s=Array.prototype.slice.call(arguments,0),e=s[0],c={};if("object"==r(s[1])&&(c=s[1]),o=l(e,"GET"),o=a(o),!o)return n.reject("接口错误或接口请求方式错误"),n.promise;var g=i.readCache(e,c);return g?(n.resolve(g),n.promise):(t({url:o,method:"GET",params:angular.extend({},c)}).success(function(e){d(e)===!1?n.reject(e.msg):n.resolve(e.hasOwnProperty("data")?e.data:e)}).error(function(e){n.reject("接口请求错误")}),n.promise)},p=function(){},m=function(){},v=function(o,n){var i=u();if(url=l(o,"POST"),url=a(url),!url)return i.reject("接口错误或接口请求方式错误"),i.promise;var r="develop"==e?{method:"GET",params:n}:{method:"POST",data:s(n)};return t(angular.extend(r,{url:url,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})).success(function(e){0==e.code?i.resolve(e.data):i.reject(e.msg)}).error(function(){i.reject("接口异常")}),i.promise};return{fetchOne:g,fetchAll:p,fetchOrder:m,save:v}}]),angular.module("xiaomaiApp").factory("httpRequstParam",[function(){var e=function(o){var a,n,t,i,r,s,c,l="";for(a in o)if(n=o[a],n instanceof Array)for(c=0;c<n.length;++c)r=n[c],t=a+"["+c+"]",s={},s[t]=r,l+=e(s)+"&";else if(n instanceof Object)for(i in n)r=n[i],null!=r&&(t=a+"."+i,s={},s[t]=r,l+=e(s)+"&");else void 0!==n&&(l+=encodeURIComponent(a)+"="+encodeURIComponent(n)+"&");return l.length?l.substr(0,l.length-1):l};return e}]),angular.module("xiaomaiApp").factory("xiaomaiQuicksort",[function(){var e=function(o){if(o.length<=1)return o;var a=Array.prototype.slice.call(arguments,0),o=a[0],n=a[1]||"number",t=a[2],i=Math.ceil(o.length/2),r="number"==n?o[i]:o[i][t],s=[],c=[];return $.each(o,function(e,o){var a="number"===n?o:o[t];return e==i?!0:void(r>=a?s.push(o):c.push(o))}),e(s).concat([o[i]]).concat(e(c))};return e}]),angular.module("xiaomaiApp").factory("xiaomaiCacheManager",["xiaomaiQuicksort",function(e){var o=[],a=20,n=function(e,a){var n=t(e);if(n===!1)return!1;if(a&&angular.isObject(a)&&angular.isObject(o[n].params)){var i=!0;if(angular.forEach(a,function(e,a){e!=o[n].params[a]&&(i=!1)}),0==i)return!1}return angular.extend({},o[n].result)},t=function(e){if(!o.length)return!1;var a=-1;return angular.forEach(o,function(o,n){return o.name===e?(a=n,!1):void 0}),-1===a?!1:a},i=function(e,n,i){var r=t(e);if(r!==!1){o.splice(r,1)[0];return o.push({name:e,result:n,params:i}),!1}o.length==a&&o.shift(),o.push({name:e,result:n,params:i})},r=function(e){var a=t(e);a!==!1&&o.splice(a,1)};return{readCache:n,writeCache:i,clean:r}}]),angular.module("xiaomaiApp").factory("skuListToObject",function(){return function(e){var o={};return angular.forEach(e,function(e,a){var n=[];angular.forEach(e.skuPropertyList,function(e,o){n.push(e.propertyNameId+"="+e.propertyValueId)}),o[n.join("&")]=e}),o}}),angular.module("xiaomaiApp").factory("cartManager",["$q","xiaomaiService","xiaomaiCacheManager",function(e,o,a){var n,t=function(e){a.writeCache("queryCart",e),a.clean("queryCartDetail"),n&&n(e)},i=function(){return e.defer()},r=function(e){var a=i();return o.save("addCart",e).then(function(e){t(e),a.resolve(e)},function(e){a.reject(e)}),a.promise},s=function(e){var a=i();return o.save("removeCart",e).then(function(e){t(e),a.resolve(e)},function(e){a.reject(e)}),a.promise},c=function(e){n=e,o.fetchOne("queryCart").then(function(e){n(e),a.writeCache("queryCart",e)},function(e){n("error")})},l=function(e){e&&angular.isObject(e)?a.writeCache("queryCart",e):a.clean("queryCart")},d=function(){return a.readCache("queryCart")},u=function(){},g=function(){var n=e.defer();return o.fetchOne("queryCartDetail").then(function(e){n.resolve(e),a.writeCache("queryCartDetail",e)}),n.promise},p=function(o,a){var n=[],t=e.defer();return g().then(function(e){return n=e,n.goods}).then(function(e){var n=-1;angular.forEach(e,function(e,t){var i=e.skuList[0];2==a&&i.activitySkuId==o?n=t:1==a&&i.skuId==o&&(n=t)}),t.resolve(-1==n?0:e[n].skuList[0].numInCart)},function(){t.reject(!1)}),t.promise};return{getnumInCart:p,add:r,remove:s,query:c,clear:u,store:l,readCartCache:d,queryCartDetail:g}}]),angular.module("xiaomaiApp").factory("getSkuInfo",[function(){var e=/([^&=]+)=([^&=]+)/;return function(o,a){var n=!1;return angular.forEach(a,function(a,t){var i=!0;angular.forEach(t.split("&"),function(a){if(!a.match(e)||!a.match(e).length)return i=!1,!1;var n=a.match(e),t=n[1],r=n[2];return o.hasOwnProperty(t)?o[t]!=r?(i=!1,!1):void 0:(i=!1,!1)}),1==i&&(n=a)}),n}}]),angular.module("xiaomaiApp").factory("buyProcessManager",["$q","cartManager",function(e,o){var a=!1;return function(){var n=e.defer(),t=Array.prototype.slice.call(arguments,0),i=t[0]||{},r=t[1],s=t[2],c=t[3],l=i.skuId,d=i.sourceType,u="plus"==r?"add":"remove";if(a)return n.reject("正在添加到购物车,请稍等"),n.promise;if(t.length<3)return n.reject("参数缺失!"),n.promise;if("minus"==r&&0>=c)return n.reject("该商品已经不存在"),n.promise;if(angular.isNumber(c)){if("plus"==r&&c>=s)return n.reject("该商品购买数量超上限了哦~"),n.promise;o[u](i).then(function(){n.resolve("plus"==r?c+1:c-1)},function(e){n.reject(e)})}else{var g=void 0;o.getnumInCart(l,d).then(function(e){return angular.isNumber(e)&&s>e?(c=e,o[u](i)):void n.reject("该商品购买数量超上限了哦")}).then(function(e){g="plus"==r?g+1:g-1,n.resolve(c)},function(){n.reject("操作失败")})}return n.promise}}]),angular.module("xiaomaiApp").factory("env",["$window",function(e){var o=/h5\.imxiaomai\.com/,a=/localhost|127\.0\.0\.1|172\.16\.110\.188/,n=e.location.host;return o.test(n)?"online":a.test(n)?"develop":"test"}]),angular.module("xiaomaiApp").factory("systemInfo",["$window",function(e){var o,a,n,t,i=e.navigator.userAgent,r=/(android)\s+([\d\.]+)/i,s=/(iphone|ipad).+(os\s[\d_]+)/i,c=/micromessenger\/[\d\.]+/i;return i.match(r)&&i.match(r).length?(t=i.match(r),o=t[1],a=i.match(r)[2]):i.match(s)&&i.match(s).length?(t=i.match(s),o=t[1],a=t[2]):(o="unknown",a="unknown"),n=i.match(c)&&i.match(c).length?i.match(c)[0]:"other",{platform:o,version:a,browser:n}}]),angular.module("xiaomaiApp").factory("getDataType",[function(){return function(e){var o=Object.prototype.toString.call(e),a=/\s(\w+)/;return o.match(a)[1].toLowerCase()}}]),angular.module("xiaomaiApp").factory("parseUrlParams",[function(){return function(e,o){var a=new RegExp("[\\?&]"+o+"=([^\\?&]+)"),n=e.match(a);return n&&n.length?n[1]:!1}}]),angular.module("xiaomaiApp").factory("getRouterTypeFromUrl",function(){return function(e,o,a){var n={};return e.match(/[\?&]m=([^\?&]+)/)?(n.name="root.buy.nav.category",n.params={categoryId:e.match(/[\?&]id=([^\?&]+)/)[1],collegeId:o,refer:a}):e.match(/skActivity/)?(n.name="root.buy.active",n.params={collegeId:o,activityId:e.match(/[\?&]activityId=([^\?&]+)/)[1],refer:a}):e.match(/activity/)?(n.name="root.buy.active",n.params={collegeId:o,activityId:e.match(/[\?&]activityId=([^\?&]+)/)[1],refer:a}):n.path=e,n}}),angular.module("xiaomaiApp").factory("safeApply",["$rootScope",function(e){return function(o){var a=e.$$phase;"$apply"==a||"$digest"==a?angular.isFunction(o)&&o():e.$apply(o)}}]),angular.module("xiaomaiApp").factory("quickGetImgHeight",["$q",function(e){return function(o){var a=e.defer(),n=function(){},t=document.createElement("img");t.src=o;var i,r,s=!1;return t.addEventListener("load",function(){return s?!1:(s=!0,void a.resolve({width:t.width,height:t.height}))}),t.addEventListener("error",function(){return s?!1:(s=!0,void a.resolve({width:t.width,height:t.height}))}),i=setInterval(function(){return 0!=t.height&&t.height==r?(clearInterval(i),s=!0,a.resolve({width:t.width,height:t.height}),!1):(r=t.height,void n(t.width,n.height))},50),a.promise}}]),angular.module("xiaomaiApp").factory("cookieManager",["ipCookie",function(e){}]),angular.module("xiaomaiApp").factory("cookie_openid",["env","ipCookie",function(e,o){return"develop"!=e?o("xiaomai_open_id")||"":"oTS2xjtXWVPcdQd9OPI11jjBheco"}]),angular.module("xiaomaiApp").factory("searchcookieManager",["ipCookie",function(e){var o="xiaomaiusersearchrecord",a=e(o)||[],n=function(n){a.length?e(o,a):e.remove(o)},t=function(){return a},i=function(e){if(!a.length)return!1;var o=-1;return angular.forEach(a,function(a,n){return a.name===e?(o=n,!1):void 0}),-1===o?!1:o},r=function(e){if(i(e)!==!1){var o=a.splice(i(e),1)[0];return o.name=e,a.unshift(o),n(),!1}a.length>=10&&a.pop(),a.unshift({name:e}),n()},s=function(){a=[],n()};return{getCookies:t,writeCookie:r,cleanCookies:s}}]),angular.module("xiaomaiApp").directive("maskGui",["xiaomaiMessageNotify",function(e){var o=function(o,a,n){e.sub("maskManager",function(e){a.css({display:"show"==e?"block":"none"})})};return{link:o}}]),angular.module("xiaomaiApp").factory("xiaomaiLog",["xiaomaiService","cookie_openid","xiaomaiLogDate","systemInfo","schoolManager","$http",function(e,o,a,n,t,i){var r=function(e,t){var r=/(\w+)\+?(\d+)?\+?(dataid\d+)?\+?(tag\d+)?\+?(category\d+)?\+?(good\d+)?/,s=e.match(r),c=s[1],l=s[2],d=s[3],u=s[4],g=s[5],p=s[6],m=[a(),c,n.browser].join("^")+"~"+t+"~"+o+"~"+(l||"")+"~~^"+[d?d.replace("dataid",""):"data",u?u.replace("tag",""):"tag",g?g.replace("category",""):"",p?p.replace("good",""):""].join("~")+"~^";i.jsonp("http://logger.imxiaomai.com/client/event?callback=JSON_CALLBACK&data="+m)};return function(e,o){var a=Array.prototype.slice.call(arguments,0);1==a.length?t.get().then(function(o){r(e,o.collegeId)}):2==a.length&&r(e,o)}}]),angular.module("xiaomaiApp").factory("xiaomaiLogDate",[function(){return function(){var e=new Date,o=e.toString(),a=e.getFullYear(),n=e.getMonth()+1,t=e.getDate(),i=/(\d{2}):(\d{2}):(\d{2})/,r=o.match(i);return n=10>n?"0"+n:n,t=10>t?"0"+t:t,[a,n,t].concat(r.slice(1)).join("")}}]),angular.module("xiaomaiApp").factory("xiaomaiMessageNotify",["xiaomaiCacheManager","$window",function(e,o){var a={},n=function(e,o){var n=a.hasOwnProperty(e)?a[e]:{},t=(""+Math.random()).replace(/\./,"");return n[t]=o,a[e]=n,t},t=function(e){var n=a[e];if(!angular.isObject(n)||!Object.keys(n).length)return!1;var t=Array.prototype.slice.call(arguments,1);angular.forEach(n,function(e){angular.isFunction(e)&&e.apply(o,t)})},i=function(e,o){var n=a[e];angular.isObject(n)&&n.hasOwnProperty(o)&&delete n[o]},r=function(e){delete a[e]};return{pub:t,sub:n,removeOne:i,remove:r}}]),angular.module("xiaomaiApp").factory("schoolManager",["$q","xiaomaiService","env","xiaomaiCacheManager",function(e,o,a,n){var t=[],i=!1,r=function(){if(i=!1,!t.length)return!1;var e=t.shift();c(e)},s=function(e){var o=window.location.search,a=/[\?&]xiaomai_schoolid=([^\?&#]+)/,n=angular.isArray(o.match(a))?Number(o.match(a)[1]):99999;return 3270!==n&&3270===e?(window.location.href="/page/newv4/index.html?xiaomai_schoolid=3270",!0):3270===n&&3270!==e?(window.location.href="/page/newv4/index.html",!0):!1},c=function(e){i=!0;var a;o.fetchOne("getSchool").then(function(o){return s(o.collegeId)?!1:(n.writeCache("getSchool",o),a=o,e.resolve(a),void r())},function(){e.reject(),r()})},l=function(){var o=e.defer();return i?t.push(o):c(o),o.promise},d=function(a){var t=e.defer(),i=a;return o.save("saveSchool",{collegeId:a.collegeId}).then(function(e){if(e.hasOwnProperty("collegeId")){if(s(e.collegeId))return!1;n.writeCache("getSchool",e),t.resolve(i)}else t.reject(msg)},function(e){t.reject(e)}),t.promise};return{get:l,set:d}}]),angular.module("xiaomaiApp").factory("siblingsNav",["$q","xiaomaiService",function(e,o){var a=function(e,o,a,n){var t=-1;switch(a){case 0:angular.forEach(e,function(e,o){return 0==e.displayType?(t=o,!1):void 0});break;case 1:angular.forEach(e,function(e,o){return 1==e.displayType?(t=o,!1):void 0});break;case 2:angular.forEach(e,function(e,o){return 2==e.displayType&&e.activityId==n?(t=o,!1):void 0});break;case 3:angular.forEach(e,function(e,o){return 3==e.displayType&&e.categoryId==n?(t=o,!1):void 0})}return"up"==o?-1==t?!1:t-1:"down"==o?t==e.length-1?!1:t+1:void 0},n=function(e,o){var a={0:"root.buy.nav.all",1:"root.buy.nav.recommend",2:"root.buy.nav.active",3:"root.buy.nav.category"};return{text:e.navigateName,name:a[e.displayType],params:{collegeId:o,categoryId:e.categoryId,activityId:e.activityId}}};return function(t,i,r,s){var c=e.defer();return o.fetchOne("navgatorlist",{collegeId:i}).then(function(e){var o=e.navigateItems,l=a(o,t,r,s);angular.isNumber(l)?c.resolve(n(o[l],i)):c.reject()}),c.promise}}]),angular.module("xiaomaiApp").factory("registerWx",["$q","xiaomaiService","env",function(e,o,a){var n=e.defer(),t=["onMenuShareTimeline","onMenuShareAppMessage","getNetworkType","getLocation","openLocation"],i=function(e){wx.config({debug:!1,appId:e.appId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:t}),wx.ready(function(){n.resolve()}),wx.error(function(e){n.reject(JSON.stringify(e))})};return o.fetchOne("getWxConfig",{url:encodeURIComponent([location.protocol,"//",location.host,location.pathname,location.search].join(""))}).then(function(e){i(e)}),n.promise}]),angular.module("xiaomaiApp").factory("locationManager",["$q","$timeout","env","registerWx",function(e,o,a,n){var t=function(){var a=e.defer(),t=o(function(){a.reject("网络超时")},3e3);return n.then(function(){wx.getLocation({type:"wgs84",success:function(e){var n=e.latitude,i=e.longitude;o.cancel(t),a.resolve({lat:n,lng:i})}})},function(e){a.reject(e)}),a.promise};return t}]),angular.module("xiaomaiApp").factory("networkType",["$q","registerWx",function(e,o){return xiaomaiApp}]),angular.module("xiaomaiApp").factory("wxshare",["$q","registerWx",function(e,o){return function(e){o.then(function(){wx.onMenuShareTimeline(e),wx.onMenuShareAppMessage(e)})}}]),angular.module("xiaomaiApp").run(["$templateCache",function(e){e.put("../assets/views/active/active.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-fanhui lefticon" ng-click="goback();"></div>\n  <div class="location-info middlearea">{{activityShowName}}</div>\n  <div class="iconfont active-share icon-fenxiang icon-locate-right righticon" ng-click="showShareModel();"></div>\n</div>\n\n<div class="activeWrap" down-tip-cls="{{\'navmain-downtip\'}}" xiaomai-iscroll subname="{{\'activeheightstatus\'}}" pubname="{{\'activeiscrollupdate\'}}">\n  <div>\n    <div class="banner">\n      <ks-swiper-container on-ready="onReadySwiper(swiper)" swiper="swiper">\n        <ks-swiper-slide class="swiper-slide" ng-repeat="banner in banners">\n          <div class="activeGoodBanner" ng-click="gotoActive(banner);" ng-style="{\'background-image\':\'url(\'+banner.imageUrl+\')\'}"></div>\n        </ks-swiper-slide>\n      </ks-swiper-container>\n    </div>\n    <div  class="errortip" ng-if="haserror" class="">活动已经结束,去其他活动看看吧</div>\n    <div class="loading" ng-if="isloading">正在加载活动商品列表...</div>\n    <ul ng-class="{\'skactiveGoodList\':goods[0].isSeckill==1,\'activeGoodList\':goods[0].isSeckill!=1}">\n      <li ng-repeat="good in goods">\n        <div class="goodItem"  ng-if="good.isSeckill!=1" >\n          <div xiaomai-good-list-item goods="good" detail-source-event="active+{{activityId}}" click-event="m_b_31singleactivityadd+{{activityId}}" source-event="m_r_31cartfromactive+{{activityId}}"  column="{{true}}" ></div>\n        </div>\n        <div ng-if="good.isSeckill==1" xiaomai-good-list-item-sk goods="good"></div>\n      </li>\n    </ul>\n  </div>\n</div>\n'),e.put("../assets/views/active/nav.active.html",'<div class="errortip" ng-if="haserror">\n  活动已经结束 去其他活动看看吧\n</div>\n<div class="loading" ng-if="isloading">\n  正在加载......\n</div>\n<div class="GoodsCont">\n  <div class="GoodCont" ng-click="gotoDetail($event,good);" ng-repeat="good in goods">\n    <div xiaomai-good-list-item goods="good" detail-source-event="active+{{activityId}}" click-event="m_b_31homepagetabactivityadd+{{activityId}}" source-event="m_r_31cartfromactive+{{activityId}}"></div>\n  </div>\n</div>\n'),e.put("../assets/views/all/all.html",'<ul class="category-active-list" style="">\n  <li class="loading" ng-if="isloading">正在加载......</li>\n  <li class="errortip" ng-if="haserror">暂无活动</li>\n  <li ng-repeat="item in activities" class="tag-active" ng-click="goto(item);" ng-style="{\'background-image\':\'url(\'+item.wapImageUrl+\')\'}"></li>\n</ul>\n'),e.put("../assets/views/buy/buy.html",'<div ui-view></div>\n<!-- 购物车x-->\n<div class="pub-footer" ng-controller="buy.cartThumbCtrl">\n  <div class="cartThumb" ng-class="{showcart:isShowCart,showdetail:isShowDetail}">\n    <div class="shopcarticons">\n      <span class="iconfont icon-cart icon-gouwuche" ng-click="gotoDetail();"></span>\n      <span class="totalCount" ng-class="{big:hasChange}" ng-show="totalCount && totalCount!=0">{{totalCount}}</span>\n    </div>\n\n    <p class="totalPrice" ng-show="totalCount && totalCount!=0">共计<em>&yen;</em>\n      <span>{{totalPrice|xiaomaiprice}}</span></p>\n    <div class="gotoPay" ng-click="goSettlement();" ng-show="totalCount && totalCount!=0">选好了</div>\n    <p class="emptyTip" ng-show="!totalCount || totalCount==0">购物车是空的,快快选购吧~</p>\n  </div>\n  <div class="cartDetail" ng-class="{\'cartDetail-show\':showcart}" ng-controller="buy.cartDetailCtrl">\n    <span class="goback" ng-click="continueShop($event);">继续购物<i class=" iconfont icon-yfmore"></i>\n    </span>\n    <div class="cartDetailWrap" subname="{{\'shopcartdetailheightupdate\'}}" xiaomai-iscroll>\n      <div>\n        <div class="haserror" ng-if="isloading">正在购物车信息......</div>\n        <div class="haserror" ng-click="goHomepage();" ng-if="haserror">购物车空了 赶快去<span>购物吧</span></div>\n        <div class="good-info" ng-repeat="good in goods">\n          <div class="goodWrap">\n            <p class="good-title">{{good.sourceType==2?good.activityGoodsName:good.bgGoodsName}}</p>\n            <p class="good-price">&yen;{{good.sourceType==2?good.skuList[0].activityPrice:good.skuList[0].wapPrice|xiaomaiprice}}</p>\n            <lable class="label" ng-class="{ldc:$index==0,rdc:$index==1}" ng-repeat="distribute in good.distributeTypeDisplay track by $index" ng-show="distribute.length">{{distribute}}</lable>\n          </div>\n          <div class="iconWrap">\n            <i class="iconfont icon-jianqugouwuche" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'minus\',$index);"></i>\n            <span class="good-count">{{good.skuList[0].numInCart}}</span>\n            <i class="iconfont icon-tianjiagouwuche" ng-class="{paying:goo.isPaying}" ng-click="buyHandler($event,\'plus\',$index);"></i>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="cartDetail-tip">\n      <p class="cartDetail-tip-freight" ng-if="ldcFreight.sub && ldcFreight.sub!=0">29分钟达产品满{{ldcFreight.total|xiaomaiprice}}减{{ldcFreight.sub|xiaomaiprice}}</p>\n      <p class="cartDetail-tip-coupon" ng-click="gotoCoupon();" ng-if="coupons.length">{{coupons.length}}张可用优惠劵<i class="couponMore iconfont icon-YF_more"></i>\n      </p>\n      <p class="cartDetail-tip-coupon" ng-if="!coupons.length">暂无可用优惠劵</p>\n    </div>\n  </div>\n</div>\n<!--遮罩-->\n<div class="mask" mask-gui ng-click="closeMask($event);"></div>\n<div class="shareModel"  ng-click="closeShare($event);" ng-if="shareIsShow"></div>\n\n<!--商品详情-->\n<div class="goodDetail" ng-class="{\'goodDetail-show\':showdetail}" ng-controller="buy.detailCtrl">\n  <div class="detailCont">\n    <div class="goodIconWrap">\n      <div class="iconfont icon-fenxiang" ng-click="showShareModel($event);"></div>\n      <div class="iconfont icon-unfold" ng-click="closeDetail($event);"></div>\n    </div>\n\n    <div class="goodDetailWrap" subname="{{\'detailgoodheightupdate\'}}" xiaomai-iscroll>\n        <div image-loaded-call="imageLoadedCall();" good-detail goods-id="goodsId" source-type="sourceType" load-success="openDetailPop();"></div>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/colleges/colleges.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-fanhui lefticon" ng-click="goback();"></div>\n  <div class="middlearea">选择学校</div>\n</div>\n<div class="colleges_content" xiaomai-iscroll subname="{{\'collegesheightupdate\'}}">\n  <ul class="countrylist">\n    <li class="loading" ng-if="isloading">学校信息正在加载....</li>\n    <li class="errortip" ng-if="haserror">该城市还没有相关学校</li>\n    <li ng-repeat="country in countrylist" >\n      <p class="countryname">{{country.cityName}}</p>\n      <div ng-class="{holiday:college.isOpen!=1}" class="" ng-click="checkCollege(college)" ng-click="checkCollege(college);" ng-repeat="college in country.colleges">{{college.collegeName}}</div>\n    </li>\n  </ul>\n</div>\n'),e.put("../assets/views/category/category.html",'<div class="GoodsCont">\n\n  <div class="errortip" ng-if="haserror">{{errortip}}</div>\n  <div  ng-if="isloading" class="loading">\n      正在加载\n  </div>\n  <div class="banner">\n    <ks-swiper-container swiper="swiper">\n      <ks-swiper-slide class="swiper-slide" ng-repeat="banner in banners">\n        <div class="categoryBanners" ng-click="gotoActive(banner);" ng-style="{\'background-image\':\'url(\'+banner.imageUrl+\')\'}"></div>\n      </ks-swiper-slide>\n    </ks-swiper-container>\n  </div>\n  <div class="GoodCont" ng-repeat="good in goods">\n    <div class="recommendCateGood"  xiaomai-good-list-item goods="good" detail-source-event="category+{{categoryId}}" click-event="m_b_31homepagetabcategoryadd+{{categoryId}}" source-event="m_r_31cartfromcategory+{{categoryId}}"></div>\n  </div>\n</div>\n'),e.put("../assets/views/coupon/coupon.html",""),e.put("../assets/views/feedback/feedback.html",'<div class="feedback-wrap">\n  <div class="pub-header">\n    <div back-icon class="iconfont icon-fanhui lefticon" back-icon ng-click="goBack();"></div>\n    <div class="middlearea">意见反馈</div>\n  </div>\n  <div class="feedback-main">\n    <div class="textareaCont">\n      <textarea class="feedback-cont" ng-model="feedback" placeholder="您的意见或建议是我们不断前进的巨大动力"></textarea>\n    </div>\n    <input placeholder="请留下您的联系方式(可选)" type="number" ng-model="mobile"/>\n    <div ng-click="submit();" class="icon-right submitBtn">提交</div>\n  </div>\n</div>\n'),e.put("../assets/views/goodListItem/goodListItem.html",'<div ng-class="{\'goodlistItem-column\':column&&column==\'true\',\'goodlistitem-row\':column!=\'true\'}"  ng-click="gotoDetail($event,goods);">\n  <div class="imgCont" ng-style=\'{"background-image":"url("+goods.imageUrl+")"}\'></div>\n  <div class="details">\n    <p class="goodname">{{goods.sourceType==2?goods.activityGoodsName:goods.bgGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n    <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in goods.distributeTypeDisplay track by $index" ng-show="label.length">{{label}}</label>\n    <p class="priceCont">\n<!-- 单品或者组合最高价-->\n      <span class="new-price" ng-if="goods.goodsType!=3">\n        &yen;<i>{{goods.sourceType==2?goods.skuList[0].activityPrice:goods.skuList[0].wapPrice|xiaomaiprice}}</i>\n      </span>\n      <span class="old-price" ng-if="goods.goodsType!=3">\n        &yen;{{goods.skuList[0].originPrice|xiaomaiprice}}\n      </span>\n<!-- 聚合 -->\n      <span class="aggregate-price" ng-if="goods.goodsType==3">\n        &yen;{{goods.minWapPrice|xiaomaiprice}} ~ &yen;{{goods.maxWapPrice|xiaomaiprice}}\n      </span>\n    </p>\n    <p class="buy-icon iconfont icon-tianjiagouwuche" ng-class="{paying:goods.isPaying}" ng-click="buyHandler($event,good);" ng-if="goods.goodsStatusDisplay==2"></p>\n    <p class="iconfont icon-buhuozhong sold-out" ng-if="goods.goodsStatusDisplay==3"></p>\n    <p class="iconfont icon-dayangle close-time" ng-if="goods.goodsStatusDisplay==5"></p>\n  </div>\n</div>\n'),e.put("../assets/views/goodListItem/goodListItemSk.html",'<div class="goodItem goodlistitem-row" ng-click="gotoDetail($event);">\n  <div class="imgCont" ng-style=\'{"background-image":"url("+goods.imageUrl+")"}\'>\n<!--如果活动未开始-->\n    <p class="countdown" ng-if="goods.killStarted==0">\n      距开始\n      <span count-dead-call="timecountdown(timeid);" countdown counttime="{{goods.timeBeforeStart}}" timeid="{{goods.activityBgGoodsId}}"></span>\n    </p>\n    <!-- 活动已开始且没有被抢空-->\n    <p class="countdown" ng-if="goods.killStarted==1 && !goods.killed && goods.goodsStatusDisplay==2">\n      距结束\n      <span count-dead-call="timecountdown();" countdown counttime="{{goods.buyLeftTime}}"></span>\n    </p>\n  </div>\n  <div class="details">\n    <p class="goodname">{{goods.activityGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n    <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in goods.distributeTypeDisplay track by $index" ng-show="label.length">{{label}}</label>\n    <p class="priceCont">\n<!-- 单品或者组合最高价-->\n      <span class="new-price">\n        &yen;<i>{{goods.skuList[0].activityPrice|xiaomaiprice}}</i>\n      </span>\n      <span class="old-price">\n        &yen;{{goods.skuList[0].originPrice|xiaomaiprice}}</span>\n    </p>\n<!-- 未开始-->\n    <p class="skicon sk-snap iconfont icon-qianggou disabled" ng-if="goods.killStarted==0"></p>\n<!-- 已结束-->\n    <p class="skicon cantsnap iconfont icon-yijieshu" ng-if="goods.killStarted==2"></p>\n<!-- 已经售空-->\n    <p class="skicon cantsnap sold-out iconfont icon-buhuozhong" ng-if="goods.killStarted==1 && goods.goodsStatusDisplay==3"></p>\n<!-- 已经抢过了 -->\n    <p class="skicon cantsnap sk-geted iconfont icon-yiqianggou" ng-if="goods.killStarted==1 && goods.killed"></p>\n<!-- 抢购开始 & 没抢购过 & 商品上架状态 -->\n    <p class="skicon sk-snap iconfont icon-qianggou" ng-class="{paying:goods.isPaying}" ng-click="buyHandler($event,good,$index);" ng-if="goods.killStarted==1 && !goods.killed && goods.goodsStatusDisplay==2"></p>\n<!--打烊了-->\n    <p class="skicon cantsnap sk-snap iconfont icon-dayangle" ng-if="goods.killStarted==1 && goods.goodsStatusDisplay==5"></p>\n  </div>\n</div>\n'),e.put("../assets/views/gooddetail/gooddetail.html",'<!-- 聚合类商品选中了最小单元-->\n<div class="imgCont" ng-if="skuInfo&&good.goodsType==3" ng-style="{\'background-image\':\'url(\'+(skuInfo&&skuInfo.imageUrl?skuInfo.imageUrl:good.imageUrl)+\')\'}"></div>\n<!--非聚合类商品或者聚合类商品没有选中最小单元-->\n\n<div class="imgCont" ng-if="(!skuInfo || good.goodsType!=3) && good.goodsImageList.length==1" ng-style="{\'background-image\':\'url(\'+good.goodsImageList[0].imageUrl+\')\'}"></div>\n\n<div class="gooddetail-swiper" ng-if="(!skuInfo || good.goodsType!=3) && good.goodsImageList.length>1">\n  <div class="gooddetail-swiper-nums">\n    <i class="gooddetail-swiper-num" ng-class="{active:swiperIndex==$index}" ng-repeat="goodsImage in good.goodsImageList"></i>\n  </div>\n  <div class="gooddetail-swiper-prev-btn iconfont icon-fanhui" ng-class="{disabled:swiperIndex==0}" ng-click="swiperSlider($event,\'prev\')">\n  </div>\n  <div class="gooddetail-swiper-next-btn iconfont icon-yfmore" ng-class="{disabled:swiperIndex==good.goodsImageList.length-1}" ng-click="swiperSlider($event,\'next\')">\n\n  </div>\n  <ks-swiper-container on-ready="onReadySwiper(swiper)" swiper="swiper" initial-slide="0">\n    <ks-swiper-slide class="swiper-slide" ng-repeat="goodsImage in good.goodsImageList">\n      <div class="gooddetail-swiper-item" style="background-image:url({{goodsImage.imageUrl}});"></div>\n    </ks-swiper-slide>\n  </ks-swiper-container>\n</div>\n\n<div class="good-normal-info">\n  <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay track by $index" ng-show="label.length">{{label}}</label>\n<!--产品名称-->\n  <p class="title">{{good.sourceType==2?good.activityGoodsName:good.bgGoodsName}}</p>\n<!--产品价格-->\n  <p class="priceCont" ng-if="skuInfo">\n    <span class="new-price">&yen;<i>{{good.sourceType==2?skuInfo.activityPrice:skuInfo.wapPrice|xiaomaiprice}}</i></span>\n    <span class="old-price">&yen;{{skuInfo.originPrice|xiaomaiprice}}</span>\n  </p>\n  <p class="priceCont" ng-if="!skuInfo">\n    <span class="aggregate-price">&yen;{{good.minWapPrice|xiaomaiprice}}</span>\n    <span class="f14 aggregate-price">\n      ~&yen;{{good.maxWapPrice|xiaomaiprice}}\n    </span>\n  </p>\n<!--普通类活动-->\n  <div ng-if="good.isSeckill!=1">\n<!--如果没有货 显示补货中-->\n    <p class="skicon cantsnap sk-snap iconfont icon-buhuozhong" ng-if="good.goodsStatusDisplay==3"></p>\n    <!--下架-->\n    <p class="skicon cantsnap sk-snap iconfont icon-buhuozhong" ng-if="good.goodsStatusDisplay==4"></p>\n    <p class="skicon cantsnap sk-snap iconfont icon-dayangle" ng-if="good.goodsStatusDisplay==5"></p>\n<!--进行数量选择-->\n    <p class="buy-handler-cont " ng-if="good.goodsStatusDisplay==2">\n      <span class="buy-handler iconfont icon-jianqugouwuche" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'minus\');" ng-hide="!skuInfo||!numInCart||numInCart==0"></span>\n<!--当前已经购买的数量 -->\n      <span class="buy-result">{{numInCart}}</span>\n      <span class="buy-handler iconfont icon-tianjiagouwuche buy-icon" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'plus\');"></span>\n    </p>\n  </div>\n<!--秒杀类产品-->\n  <div ng-if="good.isSeckill==1">\n<!--倒计时-->\n    <p class="countdown" ng-if="good.killStarted==0">\n      距开始\n      <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.timeBeforeStart}}" timeid="{{good.activityBgGoodsId}}"></span>\n    </p>\n<!-- 活动已开始同时没有被抢空-->\n    <p class="countdown" ng-if="good.killStarted==1 && good.goodsStatusDisplay!=3 &&!good.killed">\n      距结束\n      <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.buyLeftTime}}" timeid="{{good.activityBgGoodsId}}"></span>\n    </p>\n    <p class="skicon sk-snap iconfont icon-qianggou disabled" ng-if="good.killStarted==0"></p>\n<!-- 已结束-->\n    <p class="skicon cantsnap iconfont icon-yijieshu" ng-if="good.killStarted==2"></p>\n<!-- 已经售空-->\n    <p class="skicon cantsnap sold-out iconfont icon-buhuozhong" ng-if="good.killStarted==1 && good.goodsStatusDisplay==3"></p>\n    <p class="skicon cantsnap sold-out iconfont icon-buhuozhong" ng-if="good.killStarted==1 && good.goodsStatusDisplay==4"></p>\n\n<!-- 已经抢过了 -->\n    <p class="skicon cantsnap sk-geted iconfont icon-yiqianggou" ng-if="good.killStarted==1 && good.killed"></p>\n<!-- 抢购开始 & 没抢购过 & 商品上架状态 -->\n    <p class="skicon sk-snap iconfont icon-qianggou" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'plus\',true);" ng-if="good.killStarted==1 && !good.killed && good.goodsStatusDisplay==2"></p>\n<!--打烊了-->\n    <p class="skicon cantsnap sk-snap iconfont icon-dayangle" ng-if="good.killStarted==1 && good.goodsStatusDisplay==5"></p>\n  </div>\n</div>\n\n<!-- 如果是第三方卖家-->\n<p class="thirdsellertip" ng-if="good.storageName&&good.storageName.length">本商品由<span>{{good.storageName}}</span>提供服务</p>\n\n<!--如果是聚合类产品-->\n<div class="complex-properties" ng-if="good.goodsType==3">\n  <div class="complex-property" ng-repeat="goodProperty in good.skuGoodsPropertyList">\n    <p class="complex-property-name">{{goodProperty.propertyName}}</p>\n    <div class="complex-property-values">\n      <span ng-class="{disabled:valueItem.disabled,checked:checkedProperties[goodProperty.propertyNameId]==valueItem.propertyValueId}" ng-click="complexCheckProperty($event,goodProperty.propertyNameId,valueItem)" ng-repeat="valueItem in goodProperty.propertyValues">{{valueItem.propertyValue}}</span>\n    </div>\n  </div>\n</div>\n\n<!-- 产品描述-->\n<div class="detail-info" ng-if="good.saleSpec && good.saleSpec.length">\n  <div class="detail-info-key">产品规格:</div>\n  <div class="detail-info-main">{{good.saleSpec}}/{{good.unit}}</div>\n</div>\n<div class="detail-info" ng-if="good.originPlace && good.originPlace.length">\n  <div class="detail-info-key">产地:</div>\n  <div class="detail-info-main">{{good.originPlace}}</div>\n</div>\n<div class="detail-info" ng-if="good.packageSpec && good.packageSpec.length">\n  <div class="detail-info-key">产品包装:</div>\n  <div class="detail-info-main">{{good.packageSpec}}</div>\n</div>\n<div class="detail-info" ng-if="good.brand && good.brand.length">\n  <div class="detail-info-key">品牌:</div>\n  <div class="detail-info-main">{{good.brand}}</div>\n</div>\n<div class="detail-info" ng-if="good.shelfLife && good.shelfLife.length">\n  <div class="detail-info-key">保质期:</div>\n  <div class="detail-info-main">{{good.shelfLife}}</div>\n</div>\n<div class="detail-desc" ng-if="good.goodsDesc && good.goodsDesc.length">{{good.goodsDesc}}</div>\n<div class="detail-desc" ng-if="good.activityGoodsDesc && good.activityGoodsDesc.length">{{good.activityGoodsDesc}}</div>\n\n<!-- 图文详情-->\n<div class="detail-graphics" ng-if="good.goodsDetailImageList && good.goodsDetailImageList.length">\n  <img ng-src="{{goodsDetailImage.imageUrl}}" class="detail-graphic" ng-repeat="goodsDetailImage in good.goodsDetailImageList track by $index"/>\n</div>\n'),
e.put("../assets/views/locate/locate.html",'<div class="pub-header">\n  <div class="iconfont icon-fanhui lefticon" ng-click="goback();"></div>\n  <div class="middlearea">选择学校</div>\n</div>\n<div class="colleges_content" xiaomai-iscroll subname="{{\'locateheightupdate\'}}">\n  <div class="">\n    <p class="title">定位学校</p>\n    <div class="localColleges">\n      <p class="locateerrortip" ng-if="islocating">正在进行定位</p>\n      <p class="locateerrortip" ng-if="haserror">小麦迷路了,手动选择一下吧</p>\n      <p class="locateCollege" ng-class="{holiday:item.isOpen!=1}" ng-click="checkCollege($event,item,$index)" ng-repeat="item in locationResult">{{item.collegeName}}</p>\n    </div>\n    <p class="title">手动选择</p>\n    <div class="allSchools">\n      <ul class="citylist">\n        <li ng-class="{checked:item.cityId==curcityid}" ng-click="showCollegeList(item);" ng-repeat="item in citylist">\n          {{item.cityName}}\n          <i class="iconfont icon-yfmore"></i>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/nav/nav.html",'<div class="pub-header" ng-controller="nav.headCtrl">\n  <div class="lefticon iconfont icon-fankui" ng-click="gotoFeedback();"></div>\n  <div class="location-info icon-school middlearea" ng-click="gotoLocate();">\n    <i class="locate icon-locate iconfont"></i>\n    {{schoolname}}\n    <i class="changeLocate"></i>\n  </div>\n  <div class="iconfont icon-sousuo righticon" ng-click="gotoSearch();"></div>\n</div>\n<div class="list-main main-both">\n  <div class="list-category" subname="{{\'navheightupdate\'}}" xiaomai-iscroll>\n    <ul ng-controller="nav.listCtrl">\n      <li class="nav nav-super nav-mark-{{nav.labelType}}" ng-class="{\'nav-checked\':navChecked(nav)}" ng-click="goto($event,nav);" ng-if="nav.displayType!=3" ng-repeat="nav in navs">{{nav.navigateName}}</li>\n      <li class="nav nav-parent" ng-init="isShowSub=true;">\n        <p class="arrow-down" ng-class="{\'arrow-up\':!isShowSub}" ng-click="isShowSub=!isShowSub;motherNavLog($event);">商品分类</p>\n        <ul ng-show="isShowSub">\n          <li class="nav-sub nav-mark-{{subnav.labelType}}" class="nav-sub" ng-class="{\'nav-checked\':subnav.categoryId==curcategoryId}" ng-click="goto($event,subnav);" ng-if="subnav.displayType==3" ng-repeat="subnav in navs">{{subnav.navigateName}}</li>\n        </ul>\n      </li>\n    </ul>\n  </div>\n  <div class="list-product" down-tip-cls="{{\'navmain-downtip\'}}" pubname="{{\'navmainscrollupdate\'}}" subname="{{\'navmainheightstatus\'}}" up-tip-cls="{{\'navmain-uptip\'}}" xiaomai-iscroll>\n    <div ui-view></div>\n  </div>\n</div>\n'),e.put("../assets/views/notfound/notfound.html",""),e.put("../assets/views/recommend/recommend.html",'<div class="recommendCategoryCont">\n  <div class="errortip" ng-if="haserror">\n    暂无推荐商品,去类目看看吧\n  </div>\n  <div class="loading" ng-if="isloading">\n    正在加载......\n  </div>\n  <div class="" ng-repeat="item in categorys track by $index">\n    <div class="recommendCateTitle">\n      <h3>{{item.category.categoryName}}</h3>\n      <span class="iconfont icon-yfmore" ng-click="gotocategory(item);"></span>\n    </div>\n    <div class="recommendCateColumn">\n      <div ng-repeat="goods in item.goods track by $index">\n        <div xiaomai-good-list-item goods="goods" detail-source-event="recommend" click-event="m_b_31homepagetabrecadd+dataid{{goods.goodsId}}+category{{$parent.$index+1}}+good{{$index+1}}" source-event="m_r_31cartfromrecommend+dataid{{goods.goodsId}}+category{{$parent.$index+1}}+good{{$index+1}}"></div>\n      </div>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/root/root.html","<div ui-view></div>\n"),e.put("../assets/views/search/search.html",'<div class="pub-header search-handler">\n  <div class="lefticon iconfont icon-fanhui" ng-click="goback();"></div>\n  <div class="middlearea">\n    <input autofocus tabindex="1" ng-change="updateSearchKey($event)" maxlength="20" ng-keypress="updatesearch($event,searchkey);" class="searchtext" ng-model="searchkey" type="text"/>\n  </div>\n  <div class="righticon searchbtn" ng-class="{disabled:!searchkey || searchkey.length==0}" ng-click="gotosearch($event,searchkey);">搜索</div>\n</div>\n<div class="searchhistory" ng-controller="searchrecordCtrl" ng-show="showCookie">\n    <p class="searchhistory-tip">搜索历史</p>\n    <ul class="searchhistory-list" ng-show="cookies.length">\n      <li ng-click="goresult($event,cookie.name);"  ng-repeat="cookie in cookies track by $index">{{cookie.name}}</li>\n    </ul>\n    <p class="searchhistory-norecord" ng-show="!cookies.length">暂无搜索记录</p>\n    <p class="searchhistory-clean" ng-show="cookies.length" ng-click="cleancookie($event);">清除历史</p>\n</div>\n<!--搜索提示列表-->\n<div ng-controller="searchsuggestCtrl" ng-show="showSuggest" class=searchsuggests>\n  <ul class="searchtiplist">\n      <li  ng-repeat="suggest in suggests" ng-click="goresult($event,suggest);">{{suggest}}</li>\n  </ul>\n  <p class="searchsuggest-loading" ng-if="isloading">正在请求数据</p>\n</div>\n'),e.put("../assets/views/search/searchresult.html",'<div class="pub-header search-handler">\n  <div class="lefticon iconfont icon-fanhui" ng-click="gohomepage($event);"></div>\n  <div class="middlearea">\n    <p class="searchtext" ng-click="gotosearch($event,searchkey)">{{searchkey}}</p>\n    <i class="iconfont icon-guanbi1 delsearchkey" ng-click="gotosearch($event);"></i>\n  </div>\n  <div class="righticon searchbtn" ng-click="gotosearch($event);">取消</div>\n</div>\n<div class="search-result-cont" down-tip-cls="{{\'navmain-downtip\'}}" pubname="{{\'searchresultscrollupdate\'}}" subname="{{\'searchresultheightupdate\'}}" up-tip-cls="{{\'navmain-uptip\'}}" xiaomai-iscroll>\n    <div class="loadingAnimation" ng-if="loading"></div>\n    <div class="loadText" ng-if="isloading">小麦麦正在努力搜索中...</div>\n    <div class="haserror errorip" ng-if="haserror">小麦没有找到与"{{searchkey}}"相关的商品<br/>试试搜索其他商品吧~~</div>\n    <ul>\n        <li ng-repeat="good in goods track by $index" ng-if="good">\n          <div xiaomai-good-list-item goods="good" detail-source-event="search" click-event="m_b_31searchadd" source-event="m_r_31cartfromsearch"></div>\n        </li>\n    </ul>\n</div>\n'),e.put("../assets/views/sharedetail/sharedetail.html",'<div class="shareGoodDetail">\n  <div class="goodDetailWrap detailCont" subname="{{\'sharedetailheightupdate\'}}" xiaomai-iscroll>\n    <div>\n      <div good-detail goods-id="goodsId" image-loaded-call="imageLoadedCall();" source-type="sourceType" load-success="loadDetailSuccess();"></div>\n    </div>\n  </div>\n</div>\n')}]),angular.module("xiaomaiApp").directive("xiaomaiIscroll",["xiaomaiMessageNotify","$timeout","$state",function(e,o,a){var n=function(a,n,t){var i,r=document.createElement("p");r.className+=" "+a.upTipCls;var s=document.createElement("p");s.className+=" "+a.downTipCls;var c=new IScroll(n[0],{click:!0,tap:!0,probeType:2}),l=function(e,o){var a=n.children()[0];r.textContent=e,s.textContent=o,r.className=r.className.replace("pending","").trim(),s.className=s.className.replace("pending","").trim(),a.firstChild!=r&&a.insertBefore(r,a.firstChild),a.lastChild!=s&&a.appendChild(s)};a.scrollstatus="ready",c.on("scrollStart",function(){});var d,u,g=setTimeout(function(){var e=n.children()[0];u=e.offsetHeight-n[0].offsetHeight,c&&c.refresh()},1e3);c.on("scroll",function(){return"ready"!==a.scrollstatus?!1:void(this.y>40?(d&&clearTimeout(d),d=setTimeout(function(){e.pub(a.pubname,"up"),a.scrollstatus="pending"},10)):Math.abs(this.y)>u+15&&(d&&clearTimeout(d),d=setTimeout(function(){e.pub(a.pubname,"down"),a.scrollstatus="pending"},10)))}),a.subname&&e.sub(a.subname,function(o,t,i,d){var p=n.children()[0];"up"==o?"ready"==t?(a.scrollstatus="ready",r.className=r.className.replace(/\s?pending\s?/,""),g&&clearTimeout(g),g=null,setTimeout(function(){c&&c.refresh(),u=p.offsetHeight-n[0].offsetHeight,c.scrollTo(0,0),l(i,d)},50)):(a.scrollstatus="pending",r.className=r.className+" pending",r.textContent=i):"down"==o&&("ready"==t?(a.scrollstatus="ready",g&&clearTimeout(g),g=null,s.className=s.className.replace(/\s?pending\s?/,""),setTimeout(function(){c&&c.refresh(),u=p.offsetHeight-n[0].offsetHeight,l(i,d),e.pub("navmainscrollupdate","down")},500)):(a.scrollstatus="pending",s.className=s.className+" pending",s.textContent=i))}),a.$on("$destroy",function(){c&&c.destroy(),o.cancel(i),c=null,e.remove(a.subname)})};return{scope:{pubname:"@",subname:"@",options:"@",upTipCls:"@",downTipCls:"@"},link:n}}]),angular.module("xiaomaiApp").directive("countdown",["$interval",function(e){function o(e){var o,a,n,t=function(e){return 10>e?"0"+e:e},i=3600,r=60,s=1;return e=Number(e),o=Math.floor(e/i),e%=i,a=Math.floor(e/r),e%=r,n=Math.floor(e/s),[t(o),t(a),t(n)].join(":")}var a=function(a,n,t){var i=a.counttime,r=e(function(){return 0==i?(e.cancel(r),a.countDeadCall(),!1):(i-=1,void n.html(o(i)))},1e3)};return{template:"<span></span>",scope:{counttime:"@",countDeadCall:"&"},link:a,replace:!0}}]),angular.module("xiaomaiApp").controller("nav.allCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiMessageNotify","xiaomaiCacheManager","xiaomaiLog",function(e,o,a,n,t,i,r){r("m_p_31tabhome"),e.activities=[];var s;e.isloading=!0,n.get().then(function(e){return s=e.collegeId,a.fetchOne("activities",{collegeId:s})}).then(function(o){e.haserror=!1,angular.forEach(o.activities,function(e){e.hasOwnProperty("wapImageUrl")&&(e.wapImageUrl=e.wapImageUrl+"&imageView2/0/w/400/q/100")}),e.activities=o.activities},function(o){e.haserror=!0})["finally"](function(){e.isloading=!1,t.pub("navmainheightstatus","up","ready","","")}),e.$on("$destroy",function(){i.writeCache("activities",{activities:e.activities},{collegeId:s})}),e["goto"]=function(e){return"1"==e.isLinkUrl?(window.location.href=e.linkUrl,!1):void o.go("root.buy.active",{collegeId:s,activityId:e.activityId,refer:"homepage"})}}]),angular.module("xiaomaiApp").controller("buy.activeCtrl",["$scope","$state","xiaomaiService","buyProcessManager","xiaomaiCacheManager","xiaomaiMessageNotify","wxshare","getRouterTypeFromUrl","xiaomaiLog",function(e,o,a,n,t,i,r,s,c){var l,d,u,g=function(){return a.fetchOne("activeBanner",{collegeId:l,activityId:d})},p=function(){r({title:"小麦特供-"+e.activityShowName,imgUrl:"http://xiaomai-p2p.qiniudn.com/2b7ef2e2c2ce364303283bf49131a40f",desc:"小麦特供,便宜有好货,赶快点进来看看吧!"})},m=function(){return a.fetchOne("activeGoods",{collegeId:l,activityId:d,currentPage:u,recordPerPage:10})};l=o.params.collegeId,d=o.params.activityId,u=o.params.page||1,e.activityId=d,c("m_p_31singleactivity+"+d),c("m_r_31activefrom"+o.params.refer),e.isloading=!0,m().then(function(o){e.activityShowName=o.activityShowName,e.goods=o.goods,e.paginationInfo=o.paginationInfo,e.haserror=e.goods.length?!1:!0},function(){e.haserror=!0})["finally"](function(){e.isloading=!1;var o=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("activeheightstatus","up","ready","",o?"请求下一页数据":""),p()});var v=i.sub("detailGuiManager",function(e){"hide"==e&&setTimeout(function(){p()},100)}),f=i.sub("activeiscrollupdate",function(o){"down"==o&&e.paginationInfo.currentPage!=e.paginationInfo.totalPage&&(i.pub("activeheightstatus","down","pending","","正在请求数据"),!h&&y().then(function(o){var a=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("activeheightstatus","down","ready","",a?"请求下一页数据":"")}))});e.$on("$destroy",function(){i.removeOne("activeiscrollupdate",f),i.removeOne("detailGuiManager",v)}),g().then(function(o){return angular.forEach(o.banners,function(e){e.imageUrl+="&imageView2/0/w/600"}),e.banners=o.banners,o}),e.showShareModel=function(){i.pub("shareModelManager","show"),i.pub("maskManager","show")},e.goback=function(){o.go("root.buy.nav.all")},e.gotoActive=function(e){var a=s(e.hrefUrl,l,"activebanner+"+d);return a.hasOwnProperty("path")?window.location.href=a.path:o.go(a.name,a.params),!1},e.gotoDetail=function(e,o){return i.pub("detailGuiManager","show",o.activityGoodsId,o.sourceType,"active"+d),!1};var h=!1,y=function(){return h?!1:(h=!0,a.fetchOne("activeGoods",{collegeId:l,activityId:d,recordPerPage:10,currentPage:e.paginationInfo.currentPage+1}).then(function(o){return h=!1,e.paginationInfo=o.paginationInfo,e.goods=e.goods.concat(o.goods),o}))}}]),angular.module("xiaomaiApp").controller("nav.activeCtrl",["$scope","$state","xiaomaiService","buyProcessManager","xiaomaiCacheManager","xiaomaiMessageNotify","getRouterTypeFromUrl","xiaomaiLog",function(e,o,a,n,t,i,r,s){var c,l,d,u=function(){return a.fetchOne("activeBanner",{collegeId:c,activityId:l})},g=function(){return a.fetchOne("activeGoods",{collegeId:c,activityId:l,currentPage:d,recordPerPage:10})};c=o.params.collegeId,l=o.params.activityId,d=o.params.page||1,e.activityId=l,s("m_p_31tabactivity"+l),e.isloading=!0;g().then(function(o){e.haserror=o.goods.length?!1:!0,e.goods=o.goods,e.paginationInfo=o.paginationInfo},function(){e.haserror=!0})["finally"](function(){e.isloading=!1;var o=e.paginationInfo.currentPage==e.paginationInfo.totalPage,a=o?"":"请求下一页数据";i.pub("navmainheightstatus","up","ready","",a)}),u().then(function(o){return e.banners=o.banners,o}),e.gotoDetail=function(e,o){return i.pub("detailGuiManager","show",o.activityGoodsId,o.sourceType,"active"+l),!1};var p=i.sub("navmainscrollupdate",function(o){return"up"==o?!1:e.paginationInfo.currentPage==e.paginationInfo.totalPage?!1:(i.pub("navmainheightstatus","down","pending","正在请求数据..."),void(!m&&v().then(function(o){var a=e.paginationInfo.currentPage==e.paginationInfo.totalPage,n=a?"":"请求下一页数据";i.pub("navmainheightstatus","down","ready","",n)})))}),m=!1,v=function(){return m?!1:(m=!0,a.fetchOne("activeGoods",{collegeId:c,activityId:l,recordPerPage:10,currentPage:e.paginationInfo.currentPage+1}).then(function(o){return m=!1,e.paginationInfo=o.paginationInfo,e.goods=e.goods.concat(o.goods),o}))};e.$on("$destroy",function(){i.removeOne("navmainscrollupdate",p)})}]),angular.module("xiaomaiApp").controller("nav.categoryCtrl",["$state","xiaomaiService","$scope","xiaomaiCacheManager","buyProcessManager","xiaomaiMessageNotify","getRouterTypeFromUrl","xiaomaiLog",function(e,o,a,n,t,i,r,s){var c,l;a.$on("$stateChangeSuccess",function(e,o,n){c=n.collegeId,l=n.categoryId,a.categoryId=l,d(),u(),s("m_p_31tabcategory"+l)});a.isloading=!0;var d=function(){o.fetchOne("goods",{collegeId:c,categoryId:l,recordPerPage:10}).then(function(e){a.goods=e.goods,a.paginationInfo=e.paginationInfo,a.haserror=!1},function(e){a.haserror=!0,a.errortip=e})["finally"](function(){a.isloading=!1;var e=a.paginationInfo.currentPage==a.paginationInfo.totalPage,o=e?"":"请求下一页数据";i.pub("navmainheightstatus","up","ready","",o)},function(e){a.errorip=e,a.haserror=!0})},u=function(){o.fetchOne("categoryBanners",{categoryId:l,collegeId:c}).then(function(e){angular.forEach(e.banners,function(e){e.imageUrl+="&imageView2/0/w/600"}),a.banners=e.banners})};a.gotoActive=function(o){var a=r(o.hrefUrl,c,"categorybanner+"+l);return a.hasOwnProperty("path")?window.location.href=a.path:e.go(a.name,a.params),!1};var g=i.sub("navmainscrollupdate",function(e){return"up"==e?!1:a.paginationInfo.currentPage==a.paginationInfo.totalPage?!1:(i.pub("navmainheightstatus","down","pending","正在请求数据..."),void(!p&&m().then(function(e){var o=a.paginationInfo.currentPage==a.paginationInfo.totalPage,n=o?"":"请求下一页数据";i.pub("navmainheightstatus","down","ready","",n)})))}),p=!1,m=function(){return p?!1:(p=!0,o.fetchOne("goods",{collegeId:c,categoryId:l,recordPerPage:10,currentPage:a.paginationInfo.currentPage+1}).then(function(e){return p=!1,a.paginationInfo=e.paginationInfo,a.goods=a.goods.concat(e.goods),e}))};a.$on("$destroy",function(){i.removeOne("navmainscrollupdate",g)})}]),angular.module("xiaomaiApp").controller("buyCtrl",["$state","$scope","schoolManager","$q","xiaomaiMessageNotify",function(e,o,a,n,t){o.$on("$stateChangeSuccess",function(o,n,t){a.get().then(function(o){"root.buy"==n.name&&e.go("root.buy.nav.all")},function(){alert("无法获取学校信息,将跳转到选择学校页~"),e.go("root.locate")})}),o.closeMask=function(e){t.pub("cartGuiManager","hide"),t.pub("detailGuiManager","hide"),t.pub("shareModelManager","hide"),e.preventDefault()},o.closeShare=function(e){t.pub("shareModelManager","hide"),"show"!=i&&"show"!=r&&t.pub("maskManager","hide"),e.preventDefault(),e.stopPropagation()};var i,r,s=t.sub("detailGuiManager",function(e){i=e}),c=t.sub("cartGuiManager",function(e){r=e}),l=t.sub("shareModelManager",function(e){o.shareIsShow="show"==e?!0:!1});o.$on("$destroy",function(){t.removeOne("cartGuiManager",c),t.removeOne("detailGuiManager",s),t.removeOne("shareModelManager",l)}),o.$on("$stateChangeStart",function(e,o,a,n,s){("show"==i||"show"==r)&&(t.pub("detailGuiManager","hide"),t.pub("cartGuiManager","hide"),e.preventDefault())})}]),angular.module("xiaomaiApp").controller("buy.detailCtrl",["$scope","$state","xiaomaiMessageNotify","xiaomaiLog",function(e,o,a,n){e.numInCart=0;var t=a.sub("detailGuiManager",function(o,t,i,r){"show"==o?(n("m_r_31detailfrom"+r),n("m_p_31productdetailinfo"),e.goodsId=t,e.sourceType=i):(e.goodsId="",e.sourceType="",e.showdetail=!1,a.pub("maskManager","hide"))});e.openDetailPop=function(){e.showdetail=!0,a.pub("maskManager","show"),setTimeout(function(){a.pub("detailgoodheightupdate","up","ready","","")},600)},e.$on("$destroy",function(){a.removeOne("detailGuiManager",t)}),e.showShareModel=function(){a.pub("shareModelManager","show"),n("m_b_31productdetailinfoshare")},e.closeDetail=function(e){a.pub("detailGuiManager","hide"),e.preventDefault(),n("m_b_31productdetailinfoclose")},e.imageLoadedCall=function(){a.pub("detailgoodheightupdate","up","ready","","")}}]),angular.module("xiaomaiApp").controller("buy.cartThumbCtrl",["$state","$scope","xiaomaiService","cartManager","$timeout","xiaomaiMessageNotify","xiaomaiLog",function(e,o,a,n,t,i,r){n.query(function(e){o.totalCount=e.totalCount,o.totalPrice=e.totalPrice;var a=n.readCartCache();o.hasChange=a.totalCount&&a.totalCount==o.totalCount?!1:!0,o.hasChange&&t(function(){o.hasChange=!1},200)}),i.sub("cartGuiManager",function(e){o.isShowCart="show"==e}),i.sub("detailGuiManager",function(e){o.isShowDetail="show"==e}),o.goSettlement=function(){r("m_b_31shoppingsettle");var o=e.current.name,a=/root\.buy(\.nav)?\.(\w+)/,n="";switch(o.match(a)[2]){case"all":n="homepage";break;case"recommend":n="recommend";break;case"category":n="category&categoryId="+e.params.categoryId;break;case"active":n="active&activityId="+e.params.activityId;break;default:n=o.match(a)[2]}var t=window.location.protocol+"//"+window.location.host;window.location.href=t+"/order/create?r="+n},o.gotoDetail=function(){return o.totalCount&&0!=o.totalCount?(i.pub("detailGuiManager","hide"),void i.pub("cartGuiManager","show")):!1},o.$on("$destroy",function(){n.store(!1)})}]),angular.module("xiaomaiApp").controller("buy.cartDetailCtrl",["$state","$scope","xiaomaiService","cookie_openid","buyProcessManager","xiaomaiMessageNotify","cartManager","env","xiaomaiCacheManager","xiaomaiLog",function(e,o,a,n,t,i,r,s,c,l){var d=i.sub("cartGuiManager",function(e){"show"==e&&(l("m_p_31shoppingcart"),o.isloading=!0,u().then(function(e){return o.goods=e.goods,o.ldcFreight=e.ldcFreight,o.haserror=!1,g()},function(){o.haserror=!0}).then(function(e){c.writeCache("mycoupon",e);var a=[];angular.forEach(e.couponInfo,function(e){0===e.status&&a.push(a)}),o.coupons=a})["finally"](function(){o.isloading=!1,setTimeout(function(){i.pub("shopcartdetailheightupdate","up","ready","","")},600)})),o.showcart="show"==e?!0:!1,i.pub("maskManager",e)});o.$on("destory",function(){i.removeOne("cartGuiManager",d)}),o.gotoCoupon=function(){l("m_b_31shoppingcartcoupons");var e="online"==s?"http://h5.imxiaomai.com":"http://wap.tmall.imxiaomai.com";return window.location.href=e+"/couponwap/myCouponList/webwiew",!1},o.continueShop=function(e){i.pub("cartGuiManager","hide"),e.preventDefault(),l("m_b_31shoppingcartclose")},o.goHomepage=function(){e.go("root.buy.nav.all",{showCart:!1})};var u=function(){return r.queryCartDetail()},g=function(){return a.fetchOne("mycoupon",{openId:n,type:1})};o.buyHandler=function(e,a,n){l("plus"==a?"m_b_31shoppingcartadd":"m_b_31shoppingcartless");var r=o.goods[n],s=r.sourceType,c=r.skuList[0],d=2==s?{goodsId:r.activityGoodsId,sourceType:2,skuId:c.activitySkuId,distributeType:c.distributeType,price:c.activityPrice,propertyIds:c.skuPropertyValueIdList||""}:{goodsId:r.goodsId,sourceType:r.sourceType,distributeType:c.distributeType,skuId:c.skuId,price:c.wapPrice,propertyIds:c.skuPropertyValueIdList||""},r=o.goods[n];o.goods[n].isPaying=!0,t(d,a,Math.min(r.maxNum,r.skuList[0].stock),r.skuList[0].numInCart).then(function(e){"plus"==a&&l("m_r_31cartfromcart"),r.skuList[0].numInCart=e,0==r.skuList[0].numInCart&&(o.goods.splice(n,1),i.pub("shopcartdetailheightupdate","up","ready","",""))},function(e){alert(e)})["finally"](function(){o.goods[n]&&(o.goods[n].isPaying=!1)}),e.stopPropagation(),e.preventDefault()}}]),angular.module("xiaomaiApp").controller("collegesCtrl",["$state","$scope","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","xiaomaiLog",function(e,o,a,n,t,i,r){o.countrylist=[],o.$on("$stateChangeSuccess",function(e,o,a){var n=a.cityid;s(n)}),o.isloading=!0;var s=function(e){a.fetchOne("collegelist",{cityId:e}).then(function(e){o.haserror=e.cities.length?!1:!0,o.countrylist=e.cities},function(e){o.haserror=!0})["finally"](function(){i.pub("collegesheightupdate","up","ready","",""),o.isloading=!1})};o.checkCollege=function(o){r("m_b_31manuallyselectsch",o.collegeId),n.set(o).then(function(){return t.clean("navgatorlist"),!0}).then(function(){e.go("root.buy.nav.all")})},o.goback=function(){e.go("root.locate")}}]),angular.module("xiaomaiApp").controller("buy.couponCtrl",["$state","$scope","xiaomaiService",function(e,o,a){a.fetchOne("mycoupon",{}).then(function(e){})}]),angular.module("xiaomaiApp").controller("feedbackCtrl",["$scope","$state","xiaomaiService","xiaomaiLog",function(e,o,a,n){e.goBack=function(){o.go("root.buy.nav.all")},n("m_p_31feedback"),e.feedback="",e.mobile="";var t=/^(\+86)?1[3|4|5|8][0-9]\d{4,8}$/g;e.submit=function(){n("m_b_31feedbacksubmit");var i=e.feedback,r=""+e.mobile;return i=i.trim&&i.trim(),i&&i.length?r.length&&!t.test(r)?(alert("手机号有误,请确认"),!1):void a.save("feedback",{mobile:r,feedback:i}).then(function(){alert("提交成功!谢谢!"),o.go("root.buy.nav.all")},function(e){alert("提交失败,请重新尝试!\n失败原因:"+e)}):(alert("请输入您的建议或意见"),!1)}}]),angular.module("xiaomaiApp").directive("xiaomaiGoodListItem",["xiaomaiMessageNotify","xiaomaiLog","buyProcessManager",function(e,o,a){var n=function(n,t,i){var r=i.clickEvent,s=i.sourceEvent,c=i.detailSourceEvent;n.gotoDetail=function(o,a){var n=2==a.sourceType?a.activityGoodsId:a.goodsId;e.pub("detailGuiManager","show",n,a.sourceType,c),o.preventDefault(),o.stopPropagation()},n.buyHandler=function(e){if(o(r),3==n.goods.goodsType)return n.gotoDetail(e,n.goods),e.stopPropagation(),!1;n.goods.isPaying=!0;var t=2==n.goods.sourceType?{goodsId:n.goods.activityGoodsId,sourceType:2,skuId:n.goods.skuList[0].activitySkuId,distributeType:n.goods.skuList[0].distributeType,price:n.goods.skuList[0].activityPrice,propertyIds:""}:{goodsId:n.goods.goodsId,sourceType:n.goods.sourceType,skuId:n.goods.skuList[0].skuId,distributeType:n.goods.skuList[0].distributeType,price:n.goods.skuList[0].wapPrice,propertyIds:""},i=Math.min(n.goods.maxNum,n.goods.skuList[0].stock);a(t,"plus",i).then(function(){o(s)},function(e){alert(e)})["finally"](function(){n.goods.isPaying=!1}),e.stopPropagation()}};return{link:n,scope:{goods:"=",column:"@"},templateUrl:"../assets/views/goodListItem/goodListItem.html",replace:!0}}]),angular.module("xiaomaiApp").directive("xiaomaiGoodListItemSk",["xiaomaiMessageNotify","xiaomaiLog","buyProcessManager","cartManager",function(e,o,a,n){var t=function(t,i,r){t.gotoDetail=function(o){e.pub("detailGuiManager","show",t.goods.activityGoodsId,t.goods.sourceType,"active+"+t.goods.activityId),o.preventDefault(),o.stopPropagation()};var s=t.$watch("goods",function(){return t.goods&&angular.isObject(t.goods)?(s(),void n.getnumInCart(t.goods.skuList[0].activitySkuId,t.goods.sourceType).then(function(e){1==e&&(t.goods.killed=!0)})):!1});t.buyHandler=function(e){e.preventDefault(),e.stopPropagation(),o("m_b_31singleactivitypanicbuy+"+t.goods.activityId);var n=t.goods,i=n.activityId;t.goods.isPaying=!0,a({goodsId:n.activityGoodsId,sourceType:2,distributeType:n.skuList[0].distributeType,skuId:n.skuList[0].activitySkuId,price:n.skuList[0].activityPrice,propertyIds:""},"plus",Math.min(n.maxNum,n.skuList[0].stock)).then(function(){o("m_r_31cartfromactive+"+i),alert("赶快去下单吧\n否则可能会被其他人抢走了哦"),t.goods.killed=!0},function(e){return alert(e),!1})["finally"](function(){t.goods.isPaying=!1})},t.timecountdown=function(){0===t.goods.killStarted?(t.goods.killStarted=1,t.goods.beginTime=-1):1===t.goods.killStarted&&(t.goods.killStarted=2,t.goods.buyLeftTime=-1)}};return{link:t,scope:{goods:"="},templateUrl:"../assets/views/goodListItem/goodListItemSk.html",replace:!0}}]),angular.module("xiaomaiApp").directive("goodDetail",["$state","$q","$timeout","xiaomaiService","getSkuInfo","skuListToObject","buyProcessManager","cartManager","wxshare","xiaomaiLog","quickGetImgHeight","schoolManager","safeApply",function(e,o,a,n,t,i,r,s,c,l,d,u,g){var p=function(e,a,p){e.swiper={},e.swiperIndex=0,e.onReadySwiper=function(o){o.update(!0),e.swiperIndex=0,e.swiperSlider=function(e,a){e.preventDefault(),e.stopPropagation(),o["prev"==a?"slidePrev":"slideNext"]()},o.on("slideChangeStart",function(o){var a=Array.prototype.slice.call(arguments)[0];g(function(){e.swiperIndex=a.activeIndex}),l("m_b_32productdetailinfomultipic")})};var m,v=e.$watch("goodsId+sourceType",function(){return/\d+/.test(e.goodsId)&&/\d+/.test(e.sourceType)?void f(e.goodsId,e.sourceType):!1}),f=function(o,a){u.get().then(function(e){return m=e.collegeId,n.fetchOne("goodDetail",{goodsId:o,sourceType:a})}).then(function(o){if(angular.isArray(o.goodsDetailImageList)&&angular.forEach(o.goodsDetailImageList,function(e){e.imageUrl+="&imageView2/0/w/410/q/100"}),e.good=o,y(),e.good.hasOwnProperty("goodsDetailImageList")&&h(),3==e.good.goodsType)return e.skuInfo=!1,e.checkedProperties={},e.skuObject=b(e.good.skuList),e.numInCart=0,!1;e.skuInfo=e.good.skuList[0];var a=1==e.good.sourceType?e.skuInfo.skuId:e.skuInfo.activitySkuId;return s.getnumInCart(a,e.good.sourceType)}).then(function(o){return angular.isNumber(o)&&(e.numInCart=o,1==o&&(e.good.killed=!0)),!1})["finally"](function(){angular.isFunction(e.loadSuccess)&&e.loadSuccess()})},h=function(){var a=(e.good.goodsDetailImageList&&e.good.goodsDetailImageList.length,[]);angular.forEach(e.good.goodsDetailImageList,function(e){a.push(d(e.imageUrl))}),o.all(a).then(function(){e.imageLoadedCall&&e.imageLoadedCall()})},y=function(){var o="小麦特供-"+(2==e.good.sourceType?e.good.activityGoodsName:e.good.bgGoodsName),a="小麦特供,便宜有好货,赶快点进来看看吧!",n=["http://",window.location.host,window.location.pathname,window.location.search,"#/buy/sharedetail/","?goodId=",e.goodsId,"&sourceType=",e.sourceType,"&collegeId=",m].join(""),t=e.good.iconImageUrl,i=function(){},r=function(){};c({title:o,link:n,desc:a,imgUrl:t,success:i,cancel:r})},b=function(e){return i(e)},k=function(o){var a=[];angular.forEach(e.skuObject,function(o,n){var t=!0;angular.forEach(e.checkedProperties,function(e,o){var a=new RegExp(o+"="+e);return a.test(n)?void 0:(t=!1,!1)}),1==t&&a.push(n)});var n=e.good.skuGoodsPropertyList;angular.forEach(n,function(e){angular.forEach(e.propertyValues,function(o,n){var t=e.propertyNameId+"="+o.propertyValueId;-1!=a.join("&").indexOf(t)?o.disabled=!1:o.disabled=!0})}),e.good.skuGoodsPropertyList=n};e.complexCheckProperty=function(o,a,n){if(o.preventDefault(),o.stopPropagation(),n.disabled)return!1;var i=n.propertyValueId;e.checkedProperties[a]===i?delete e.checkedProperties[a]:e.checkedProperties[a]=i,k(a);var r=t(e.checkedProperties,e.skuObject);if(e.skuInfo=0==r?!1:r,e.skuInfo){var c=1==e.good.sourceType?e.skuInfo.skuId:e.skuInfo.activitySkuId;s.getnumInCart(c,e.good.sourceType).then(function(o){e.numInCart=o})}else e.numInCart=0},e.buyHandler=function(o,a){o.preventDefault(),o.stopPropagation();var n=1==e.good.isSeckill?"m_b_31productdetailinfopanicbuy":"plus"==a?"m_b_31productdetailinfoadd":"m_b_31productdetailinfoless";l(n);var t=[];if(!e.skuInfo)return alert("请选择商品规格"),!1;angular.forEach(e.checkedProperties,function(e){t.push(e)}),t=t.join("_");var i=2==e.sourceType?{goodsId:e.good.activityGoodsId,sourceType:e.sourceType,skuId:e.skuInfo.activitySkuId,distributeType:e.skuInfo.distributeType,price:e.skuInfo.activityPrice,propertyIds:t}:{goodsId:e.good.goodsId,sourceType:e.sourceType,skuId:e.skuInfo.skuId,distributeType:e.skuInfo.distributeType,price:e.skuInfo.wapPrice,propertyIds:t};e.good.isPaying=!0,r(i,a,Math.min(e.good.maxNum,e.skuInfo.stock),e.numInCart).then(function(o){e.numInCart=o,"plus"==a&&l("m_r_31cartfromdetail"),1==e.good.isSeckill&&(e.good.killed=!0,alert("抢购成功,赶紧去下单吧!"))},function(e){return alert(e),!1})["finally"](function(){e.good.isPaying=!1})},e.timecountdown=function(){0===e.good.killStarted?(e.good.killStarted=1,e.good.beginTime=-1):1===e.good.killStarted&&(e.good.killStarted=2,e.good.buyLeftTime=-1)},e.$on("$destroy",function(){v()})};return{link:p,templateUrl:"../assets/views/gooddetail/gooddetail.html",repalce:!0,scope:{goodsId:"=",sourceType:"=",loadSuccess:"&",imageLoadedCall:"&"}}}]),angular.module("xiaomaiApp").controller("positionCtrl",["$scope","locationManager","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","xiaomaiLog",function(e,o,a,n,t,i,r,s){e.locationResult=[],s("m_p_31selectsch"),i.readCache("locate")?e.locationResult=i.readCache("locate").colleges:(e.islocating=!0,o().then(function(e){return n.fetchOne("locate",{latitude:e.lat,longitude:e.lng})}).then(function(o){e.haserror=!1,e.locationResult=o.colleges,i.writeCache("locate",o)},function(o){s("m_b_31manuallyselectcity",""),e.haserror=!0})["finally"](function(){e.islocating=!1})),e.citylist=[],e.isloading=!0,n.fetchOne("citylist",{},!0).then(function(o){e.citylist=o.cities,i.writeCache("citylist",o),e.haserror=!1},function(){e.haserror=!0})["finally"](function(){e.isloading=!1,r.pub("locateheightupdate","up","ready","","")}),e.showCollegeList=function(e){s("m_b_31manuallyselectcity",""),a.go("root.colleges",{cityid:e.cityId})},e.$on("$stateChangeSuccess",function(o,a,n){e.curcityid=n.cityid}),e.checkCollege=function(e,o,n){s(0==n?"m_b_31autoselectsch1":"m_b_31autoselectsch2",o.collegeId),t.set(o).then(function(){return i.clean("navgatorlist"),!0}).then(function(){a.go("root.buy.nav.all")}),e.preventDefault(),e.stopPropagation()},e.goback=function(){a.go("root.buy.nav.all")}}]),angular.module("xiaomaiApp").controller("navCtrl",["$scope","$state",function(e,o){}]),angular.module("xiaomaiApp").controller("nav.headCtrl",["$scope","$state","schoolManager","xiaomaiLog","xiaomaiService",function(e,o,a,n,t){a.get().then(function(o){e.schoolname=o.collegeName}),e.gotoLocate=function(){n("m_b_31homepageswitchsch"),o.go("root.locate")},e.gotoFeedback=function(){n("m_b_31homepagefeedback"),o.go("root.feedback")},e.gotoSearch=function(){n("m_b_31homepagesearch"),o.go("root.search")}}]),angular.module("xiaomaiApp").controller("nav.listCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","xiaomaiLog",function(e,o,a,n,t,i,r){e.navs=[],r("m_p_31homepage");var s;n.get().then(function(e){return s=e.collegeId,a.fetchOne("navgatorlist",{collegeId:e.collegeId})}).then(function(o){e.navs=o.navigateItems,i.pub("navheightupdate","up","ready","",""),t.writeCache("navgatorlist",o,{collegeId:s})}),e.paths={0:"root.buy.nav.all",1:"root.buy.nav.recommend",2:"root.buy.nav.active",3:"root.buy.nav.category"},e.navChecked=function(o){var a=!1;switch(e.curpath){case"all":a=0==o.displayType;break;case"recommend":a=1==o.displayType;break;case"active":a=e.activityId==o.activityId;break;case"category":a=e.curcategoryId==o.categoryId}return a},
e.$on("$stateChangeSuccess",function(o,a,n){e.type=n.type;var t=/nav\.(\w+)/,i=a.name.match(t);e.curcategoryId=n.categoryId,e.activityId=n.activityId,i&&i.length&&(e.curpath=i[1])});var c=function(e){var o={0:"m_b_31homepagetabhome",1:"m_b_31homepagetabrec",2:"m_b_31homepagetabactivity+"+e.activityId,3:"m_b_31homepagetabcategory+"+e.categoryId};r(o[e.displayType])};e.motherNavLog=function(e){r("m_b_31homepagetabmothernavi"),e.preventDefault(),e.stopPropagation()},e["goto"]=function(a,t){n.get().then(function(a){var n,i=a.collegeId,r=t.displayType;t.activityType;c(t),n=e.paths[r],o.go(n,{categoryId:t.categoryId,activityId:t.activityId,collegeId:i,showDetail:!1,showCart:!1})}),a.preventDefault(),a.stopPropagation()}}]),angular.module("xiaomaiApp").controller("nav.recommendCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","buyProcessManager","xiaomaiLog",function(e,o,a,n,t,i,r,s){s("m_p_31tabrecommendation");var c;e.isloading=!0;n.get().then(function(e){return c=e.collegeId,a.fetchOne("categoryGoods",{collegeId:c})}).then(function(o){e.categorys=o,e.haserror=!1},function(){e.haserror=!0})["finally"](function(o){e.isloading=!1,i.pub("navmainheightstatus","up","ready","","")}),e.$on("$destroy",function(){t.writeCache("categoryGoods",e.categorys,{collegeId:c})}),e.gotocategory=function(e){o.go("root.buy.nav.category",{collegeId:c,categoryId:e.category.categoryId}),s("m_b_31homepagetabrecmore")}}]),angular.module("xiaomaiApp").controller("searchCtrl",["$scope","$state","xiaomaiMessageNotify","searchcookieManager","xiaomaiMessageNotify","$timeout","searchcookieManager","xiaomaiLog",function(e,o,a,n,a,t,n,i){var r,s;i("m_p_32search"),e.$on("$stateChangeSuccess",function(e,o,a,n,t){r=n.name||"root.buy.nav.all",s=t}),e.searchkey=o.params.key||"",e.goback=function(){i("m_b_32searchback"),o.go(r,s)},e.updatesearch=function(e,a){13==e.keyCode&&a&&a.length&&(o.go("root.buy.searchresult",{key:encodeURIComponent(a),page:1}),n.writeCookie(a),e.preventDefault(),e.stopPropagation())},e.gotosearch=function(e,a){return e.preventDefault(),e.stopPropagation(),i("m_b_32searchsearch"),a&&a.length?(o.go("root.buy.searchresult",{key:encodeURIComponent(a),page:1}),void n.writeCookie(a)):!1};var c,l=/^\s+|\s+$/g;e.updateSearchKey=function(o){c&&t.cancel(c),c=null,c=t(function(){a.pub("searchkeyupdate",e.searchkey.replace(l,""))},100)}}]),angular.module("xiaomaiApp").controller("searchrecordCtrl",["$scope","$state","searchcookieManager","xiaomaiMessageNotify","searchcookieManager","xiaomaiLog",function(e,o,a,n,a,t){e.showCookie=!0;var i=n.sub("searchkeyupdate",function(o){e.showCookie=o.length?!1:!0});e.cookies=a.getCookies(),e.goresult=function(e,n){t("m_b_32searchhistory"),a.writeCookie(n),o.go("root.buy.searchresult",{key:encodeURIComponent(n),page:1}),e.preventDefault(),e.stopPropagation()},e.$on("$destroy",function(){n.removeOne("searchkeyupdate",i)}),e.cleancookie=function(o){o.preventDefault(),o.stopPropagation(),t("m_b_32searchcleanhistory"),confirm("确定要清除搜索历史吗?")&&(a.cleanCookies(),e.cookies=[],t("m_b_32searchcleanbutton"))}}]),angular.module("xiaomaiApp").controller("searchsuggestCtrl",["$scope","$state","searchcookieManager","xiaomaiMessageNotify","xiaomaiService","xiaomaiLog",function(e,o,a,n,t,i){e.showSuggest=!1;var r=n.sub("searchkeyupdate",function(o){e.showSuggest=o.length?!0:!1,o.length?s(o):e.suggests=[],e.keywords=o});e.$on("$destroy",function(){n.removeOne("searchkeyupdate",r)});var s=function(o){e.isloading=!0,t.fetchOne("searchsuggest",{keywords:o}).then(function(o){e.suggests=o.suggestGoods,e.haserror=e.suggests&&e.suggests.length?!1:!0},function(){e.suggests=[],e.haserror=!0})["finally"](function(){e.isloading=!1})};e.goresult=function(e,n){i("m_b_32searchsuggestion"),a.writeCookie(n),o.go("root.buy.searchresult",{key:encodeURIComponent(n),page:1}),e.preventDefault(),e.stopPropagation()}}]),angular.module("xiaomaiApp").controller("searchresultCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiMessageNotify","xiaomaiLog",function(e,o,a,n,t,i){i("m_p_31searchresult"),e.$on("$stateChangeSuccess",function(o,a,n){e.searchkey=decodeURIComponent(n.key),e.isloading=!0,s(e.searchkey)}),e.gohomepage=function(e){o.go("root.buy.nav.all"),e.preventDefault(),e.stopPropagation()},e.gotosearch=function(e,a){o.go("root.search",{key:a}),e.preventDefault(),e.stopPropagation()};var r,s=function(o){e.isloading=!0,n.get().then(function(e){return r=e.collegeId,a.fetchOne("searchresult",{collegeId:r,keywords:o,currentPage:1})}).then(function(o){e.goods=o.goods,e.paginationInfo=o.paginationInfo,e.haserror=!e.goods||!e.goods.length},function(){e.haserror=!0})["finally"](function(){e.isloading=!1;var o=e.goods&&e.goods.length&&e.paginationInfo.currentPage!=e.paginationInfo.totalPage;t.pub("searchresultheightupdate","up","ready","",o?"请求下一页数据":"")})},c=t.sub("searchresultscrollupdate",function(o){var a=e.goods&&e.goods.length&&e.paginationInfo.currentPage!=e.paginationInfo.totalPage;"down"==o&&a&&e.paginationInfo.currentPage!=e.paginationInfo.totalPage&&(t.pub("searchresultheightupdate","down","pending","正在请求数据..."),!l&&d().then(function(o){var a=e.paginationInfo.currentPage==e.paginationInfo.totalPage,n=a?"":"请求下一页数据";t.pub("searchresultheightupdate","down","ready","",n)}))}),l=!1,d=function(){return l?!1:(l=!0,a.fetchOne("searchresult",{collegeId:r,keywords:e.searchkey,currentPage:e.paginationInfo.currentPage+1}).then(function(o){return l=!1,e.paginationInfo=o.paginationInfo,e.goods=e.goods.concat(o.goods),o}))};e.$on("$destroy",function(){t.removeOne("searchresultheightupdate",c)})}]),angular.module("xiaomaiApp").controller("sharedetailCtrl",["$scope","$state","schoolManager","xiaomaiMessageNotify",function(e,o,a,n){e.numInCart=0,e.$on("$stateChangeSuccess",function(o,a,n){e.goodsId=n.goodId,e.sourceType=n.sourceType,e.collegeId=n.collegeId}),a.get().then(function(a){a.collegeId!=e.collegeId&&(alert("您选择的学校门店中找不到该商品,将跳转到首页~"),o.go("root.buy.nav.all"))}),e.loadDetailSuccess=function(){n.pub("sharedetailheightupdate","up","ready","","")},e.imageLoadedCall=function(){n.pub("sharedetailheightupdate","up","ready","","")}}]);