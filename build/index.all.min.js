angular.module("xiaomaiApp",window.__SYS_CONF.dependent_modules),angular.module("xiaomaiApp").config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("root",{url:"/",templateUrl:"../assets/views/root/root.html"}).state("root.buy",{url:"buy/",controller:"buyCtrl",templateUrl:"../assets/views/buy/buy.html"}).state("root.buy.nav",{url:"nav/",templateUrl:"../assets/views/nav/nav.html"}).state("root.buy.nav.all",{url:"all/",templateUrl:"../assets/views/all/all.html",controller:"nav.allCtrl"}).state("root.buy.nav.recommend",{url:"recommend/",controller:"nav.recommendCtrl",templateUrl:"../assets/views/recommend/recommend.html"}).state("root.buy.nav.active",{url:"active/?collegeId&activityId",controller:"nav.activeCtrl",templateUrl:"../assets/views/active/nav.active.html"}).state("root.buy.active",{url:"active/?collegeId&activityId",controller:"buy.activeCtrl",templateUrl:"../assets/views/active/active.html"}).state("root.buy.skactive",{url:"skactive/?collegeId&activityId",controller:"buy.skactiveCtrl",templateUrl:"../assets/views/skactive/skactive.html"}).state("root.buy.nav.category",{url:"category/?collegeId&categoryId",controller:"nav.categoryCtrl",templateUrl:"../assets/views/category/category.html"}).state("root.locate",{url:"locate/",controller:"positionCtrl",templateUrl:"../assets/views/locate/locate.html"}).state("root.colleges",{url:"colleges/?cityid",controller:"collegesCtrl",templateUrl:"../assets/views/colleges/colleges.html"}).state("root.buy.sharedetail",{url:"sharedetail/?goodId&sourceType",controller:"sharedetailCtrl",templateUrl:"../assets/views/sharedetail/sharedetail.html"}).state("root.buy.coupon",{url:"coupon/",controller:"buy.couponCtrl",templateUrl:"../assets/views/coupon/coupon.html"}).state("root.feedback",{url:"feedback",controller:"feedbackCtrl",templateUrl:"../assets/views/feedback/feedback.html"}).state("root.notfound",{url:"404/",templateUrl:"../assets/views/notfound/notfound.html"})}]),angular.module("xiaomaiApp").run(["$state","$rootScope","$timeout",function(e,o,n){var a=n(function(){e.go("root.buy.nav.all")},50);o.$on("$stateChangeStart",function(e,o,t){n.cancel(a)})}]),document.addEventListener("touchmove",function(e){e.preventDefault()},!1),angular.module("xiaomaiApp").filter("xiaomaiprice",function(){return function(e){return(e/100).toFixed(2)}}),angular.module("xiaomaiApp").factory("xiaomaimodelManage",function(){var e={navgatorlist:{url:"/wap/navigate/index",type:"GET"},locate:{url:"/wap/college/locate",type:"GET"},citylist:{url:"/wap/geography/cities",type:"GET"},collegelist:{url:"/wap/geography/colleges",type:"GET"},getSchool:{url:"/wap/college/detail",type:"GET"},saveSchool:{url:"/wap/college/detail",type:"POST"},activities:{url:"/wap/college/activities",type:"GET"},activeGoods:{url:"/wap/activity/goods",type:"GET"},activeBanner:{url:"/wap/activity/banners",type:"GET"},categoryGoods:{url:"/wap/index/categoryGoods",type:"GET"},categoryBanners:{type:"GET",url:"/wap/category/banners"},goods:{url:"/wap/category/goods",type:"GET"},goodDetail:{url:"/wap/goods/detail",type:"GET"},removeCart:{url:"/wap/cart/remove",type:"POST"},whitelist:{type:"GET",url:"/wap/college/whitelist"},addCart:{url:"/wap/cart/add",type:"POST"},queryCart:{url:"/wap/cart/sync",type:"GET"},queryCartDetail:{url:"/wap/cart/get",type:"GET"},mycoupon:{url:"/couponwap/myCouponList",type:"GET"},getWxConfig:{url:"/wap/getWxConfig",type:"GET"},feedback:{url:"/wap/feedback/detail",type:"POST"},log:{url:"/wap/log",type:"POST"}},o=function(){var o=Array.prototype.slice.call(arguments,0),n=o[0],a=o[1]||"GET";return e.hasOwnProperty(n)&&e[n].type===a?e[n].url:!1};return o}),angular.module("xiaomaiApp").factory("urlInterceptor",["env",function(e){var o=function(o){return"develop"!==e?o:"/api"+o+".json"};return o}]),angular.module("xiaomaiApp").factory("xiaomaiService",["env","$q","urlInterceptor","xiaomaimodelManage","$http","xiaomaiCacheManager","getDataType","httpRequstParam","$timeout",function(e,o,n,a,t,i,r,s,c){var l=function(e,o){var n=a(e,o);return n},d=function(e){return 0==e.code&&e.data&&("number"!=r(e.data)||e.data.length)&&("object"!=r(e.data)||Object.keys(e.data).length)?e.data:!1},u=function(){return o.defer()},g=function(e){var o,a=u(),s=Array.prototype.slice.call(arguments,0),e=s[0],c={};return"object"==r(s[1])&&(c=s[1]),o=l(e,"GET"),(o=n(o))?i.readCache(e)?(a.resolve(i.readCache(e)),a.promise):(t({url:o,method:"GET",params:angular.extend({v:Math.random().toString().replace(/\./,"")},c)}).success(function(e){d(e)===!1?a.reject(e.msg):a.resolve(e.hasOwnProperty("data")?e.data:e)}).error(function(e){a.reject("接口请求错误")}),a.promise):(a.reject("接口错误或接口请求方式错误"),a.promise)},p=function(){},m=function(){},v=function(o,a){var i=u();if(url=l(o,"POST"),url=n(url),!url)return i.reject("接口错误或接口请求方式错误"),i.promise;var r="develop"==e?{method:"GET",params:a}:{method:"POST",data:s(a)};return t(angular.extend(r,{url:url,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})).success(function(e){0==e.code?i.resolve(e.data):i.reject(e.msg)}).error(function(){i.reject("接口异常")}),i.promise};return{fetchOne:g,fetchAll:p,fetchOrder:m,save:v}}]),angular.module("xiaomaiApp").factory("httpRequstParam",[function(){var e=function(o){var n,a,t,i,r,s,c,l="";for(n in o)if(a=o[n],a instanceof Array)for(c=0;c<a.length;++c)r=a[c],t=n+"["+c+"]",s={},s[t]=r,l+=e(s)+"&";else if(a instanceof Object)for(i in a)r=a[i],null!=r&&(t=n+"."+i,s={},s[t]=r,l+=e(s)+"&");else void 0!==a&&(l+=encodeURIComponent(n)+"="+encodeURIComponent(a)+"&");return l.length?l.substr(0,l.length-1):l};return e}]),angular.module("xiaomaiApp").factory("xiaomaiQuicksort",[function(){var e=function(o){if(o.length<=1)return o;var n=Array.prototype.slice.call(arguments,0),o=n[0],a=n[1]||"number",t=n[2],i=Math.ceil(o.length/2),r="number"==a?o[i]:o[i][t],s=[],c=[];return $.each(o,function(e,o){var n="number"===a?o:o[t];return e==i?!0:void(r>=n?s.push(o):c.push(o))}),e(s).concat([o[i]]).concat(e(c))};return e}]),angular.module("xiaomaiApp").factory("xiaomaiCacheManager",["xiaomaiQuicksort",function(e){var o=[],n=20,a=function(e){var n=t(e);return n===!1?!1:(o[n].timestamp=+new Date,angular.extend({},o[n].result))},t=function(e){if(!o.length)return!1;var n=-1;return angular.forEach(o,function(o,a){return o.name===e?(n=a,!1):void 0}),-1===n?!1:n},i=function(a,i){var r=t(a);return r!==!1?(o[r]={name:a,result:i,timestamp:+new Date},!1):(o.length==n&&(o=e(o,"object",timestamp),o.shift()),void o.push({name:a,result:i,timestamp:+new Date}))},r=function(e){var n=t(e);n!==!1&&o.splice(n,1)};return{readCache:a,writeCache:i,clean:r}}]),angular.module("xiaomaiApp").factory("skuListToObject",function(){return function(e){var o={};return angular.forEach(e,function(e,n){var a=[];angular.forEach(e.skuPropertyList,function(e,o){a.push(e.propertyNameId+"="+e.propertyValueId)}),o[a.join("&")]=e}),o}}),angular.module("xiaomaiApp").factory("cartManager",["$q","xiaomaiService","xiaomaiCacheManager",function(e,o,n){var a,t=function(e){n.writeCache("queryCart",e),n.clean("queryCartDetail"),a&&a(e)},i=function(){return e.defer()},r=function(e){var n=i();return o.save("addCart",e).then(function(e){t(e),n.resolve(e)},function(e){n.reject(e)}),n.promise},s=function(e){var n=i();return o.save("removeCart",e).then(function(e){t(e),n.resolve(e)},function(e){n.reject(e)}),n.promise},c=function(e){a=e,o.fetchOne("queryCart").then(function(e){a(e),n.writeCache("queryCart",e)},function(e){a("error")})},l=function(e){e&&angular.isObject(e)?n.writeCache("queryCart",e):n.clean("queryCart")},d=function(){return n.readCache("queryCart")},u=function(){},g=function(){var a=e.defer();return o.fetchOne("queryCartDetail").then(function(e){a.resolve(e),n.writeCache("queryCartDetail",e)}),a.promise},p=function(o,n){var a=[],t=e.defer();return g().then(function(e){return a=e,a.goods}).then(function(e){var a=-1;angular.forEach(e,function(e,t){var i=e.skuList[0];2==n&&i.activitySkuId==o?a=t:1==n&&i.skuId==o&&(a=t)}),t.resolve(-1==a?0:e[a].skuList[0].numInCart)},function(){t.reject(!1)}),t.promise};return{getnumInCart:p,add:r,remove:s,query:c,clear:u,store:l,readCartCache:d,queryCartDetail:g}}]),angular.module("xiaomaiApp").factory("getSkuInfo",[function(){var e=/([^&=]+)=([^&=]+)/;return function(o,n){var a=!1;return angular.forEach(n,function(n,t){var i=!0;angular.forEach(t.split("&"),function(n){if(!n.match(e)||!n.match(e).length)return i=!1,!1;var a=n.match(e),t=a[1],r=a[2];return o.hasOwnProperty(t)?o[t]!=r?(i=!1,!1):void 0:(i=!1,!1)}),1==i&&(a=n)}),a}}]),angular.module("xiaomaiApp").factory("buyProcessManager",["$q","cartManager",function(e,o){var n=!1;return function(){var a=e.defer(),t=Array.prototype.slice.call(arguments,0),i=t[0]||{},r=t[1],s=t[2],c=t[3],l=i.skuId,d=i.sourceType,u="plus"==r?"add":"remove";if(n)return a.reject("正在添加到购物车,请稍等"),a.promise;if(t.length<3)return a.reject("参数缺失!"),a.promise;if("minus"==r&&0>=c)return a.reject("该商品已经不存在"),a.promise;if(angular.isNumber(c)){if("plus"==r&&c>=s)return a.reject("该商品购买数量超上限了哦~"),a.promise;o[u](i).then(function(){a.resolve("plus"==r?c+1:c-1)},function(e){a.reject(e)})}else{var g=void 0;o.getnumInCart(l,d).then(function(e){return angular.isNumber(e)&&s>e?(c=e,o[u](i)):void a.reject("该商品购买数量超上限了哦")}).then(function(e){g="plus"==r?g+1:g-1,a.resolve(c)},function(){a.reject("操作失败")})}return a.promise}}]),angular.module("xiaomaiApp").factory("env",["$window",function(e){var o=/h5\.imxiaomai\.com/,n=/(wap\.tmall\.imxiaomai\.com)|(qa\.wap\.test\.imxiaomai\.com)/,a=e.location.host;return o.test(a)?"online":n.test(a)?"test":"develop"}]),angular.module("xiaomaiApp").factory("systemInfo",["$window",function(e){var o,n,a,t,i=e.navigator.userAgent,r=/(android)\s+([\d\.]+)/i,s=/(iphone|ipad).+(os\s[\d_]+)/i,c=/micromessenger\/[\d\.]+/i;return i.match(r)&&i.match(r).length?(t=i.match(r),o=t[1],n=i.match(r)[2]):i.match(s)&&i.match(r).length?(t=i.match(s),o=t[1],n=t[2]):(o="unknown",n="unknown"),a=i.match(c)&&i.match(c).length?i.match(c)[0]:"other",{platform:o,version:n,browser:a}}]),angular.module("xiaomaiApp").factory("getDataType",[function(){return function(e){var o=Object.prototype.toString.call(e),n=/\s(\w+)/;return o.match(n)[1].toLowerCase()}}]),angular.module("xiaomaiApp").factory("parseUrlParams",[function(){return function(e,o){var n=new RegExp("[\\?&]"+o+"=([^\\?&]+)"),a=e.match(n);return a&&a.length?a[1]:!1}}]),angular.module("xiaomaiApp").factory("getRouterTypeFromUrl",function(){return function(e,o,n){var a={};return e.match(/[\?&]m=([^\?&]+)/)?(a.name="root.buy.nav.category",a.params={categoryId:e.match(/[\?&]id=([^\?&]+)/)[1],collegeId:o,refer:n}):e.match(/skActivity/)?(a.name="root.buy.skactive",a.params={collegeId:o,activityId:e.match(/[\?&]activityId=([^\?&]+)/)[1],refer:n}):e.match(/activity/)?(a.name="root.buy.skactive",a.params={collegeId:o,activityId:e.match(/[\?&]activityId=([^\?&]+)/)[1],refer:n}):a.path=e,a}}),angular.module("xiaomaiApp").factory("cookieManager",["ipCookie",function(e){}]),angular.module("xiaomaiApp").factory("cookie_openid",["env","ipCookie",function(e,o){return"develop"!=e?o("xiaomai_open_id")||"":"oTS2xjtXWVPcdQd9OPI11jjBheco"}]),angular.module("xiaomaiApp").directive("maskGui",["xiaomaiMessageNotify",function(e){var o=function(o,n,a){e.sub("maskManager",function(e){n.css({display:"show"==e?"block":"none"})})};return{link:o}}]),angular.module("xiaomaiApp").factory("xiaomaiLog",["xiaomaiService","cookie_openid","xiaomaiLogDate","systemInfo","schoolManager",function(e,o,n,a,t){var i=function(t,i){var r=[n(),t,a.browser].join("^")+"~"+i+"~"+o+"~~~^data~tag~~~^";e.save("log",{data:r})};return function(e,o){var n=Array.prototype.slice.call(arguments,0);1==n.length?t.get().then(function(o){i(e,o.collegeId)}):2==n.length&&i(e,o)}}]),angular.module("xiaomaiApp").factory("xiaomaiTimeLineLog",["xiaomaiLog",function(e){}]),angular.module("xiaomaiApp").factory("xiaomaiLogDate",[function(){return function(){var e=new Date,o=e.toString(),n=e.getFullYear(),a=e.getMonth()+1,t=e.getDate(),i=/(\d{2}):(\d{2}):(\d{2})/,r=o.match(i);return a=10>a?"0"+a:a,t=10>t?"0"+t:t,[n,a,t].concat(r.slice(1)).join("")}}]),angular.module("xiaomaiApp").factory("xiaomaiMessageNotify",["xiaomaiCacheManager","$window",function(e,o){var n={},a=function(e,o){var a=n.hasOwnProperty(e)?n[e]:{},t=(""+Math.random()).replace(/\./,"");return a[t]=o,n[e]=a,t},t=function(e){var a=n[e];if(!angular.isObject(a)||!Object.keys(a).length)return!1;var t=Array.prototype.slice.call(arguments,1);angular.forEach(a,function(e){angular.isFunction(e)&&e.apply(o,t)})},i=function(e,o){var a=n[e];angular.isObject(a)&&a.hasOwnProperty(o)&&delete a[o]},r=function(e){delete n[e]};return{pub:t,sub:a,removeOne:i,remove:r}}]),angular.module("xiaomaiApp").factory("schoolManager",["$q","xiaomaiService","env","xiaomaiCacheManager",function(e,o,n,a){var t=[],i=!1,r=function(){if(i=!1,!t.length)return!1;var e=t.shift();s(e)},s=function(e){i=!0;var n;o.fetchOne("getSchool").then(function(e){return a.writeCache("getSchool",e),n=e,o.fetchOne("whitelist")}).then(function(o){var t=new RegExp(",?("+n.collegeId+"),?");a.writeCache("whitelist",o),t.test(o.collegeWhiteList)?(e.resolve(n),r()):window.location.href="http://"+window.location.host})},c=function(){var o=e.defer();return i?t.push(o):s(o),o.promise},l=function(n){var t=e.defer(),i=n;return o.save("saveSchool",{collegeId:n.collegeId}).then(function(e){return a.writeCache("getSchool",e),o.fetchOne("whitelist")}).then(function(e){var o=new RegExp(",?("+i.collegeId+"),?");return a.writeCache("whitelist",e),o.test(e.collegeWhiteList)?t.resolve(i):window.location.href="http://"+window.location.host,!1},function(e){t.reject(e)}),t.promise};return{get:c,set:l}}]),angular.module("xiaomaiApp").factory("siblingsNav",["$q","xiaomaiService",function(e,o){var n=function(e,o,n,a){var t=-1;switch(n){case 0:angular.forEach(e,function(e,o){return 0==e.displayType?(t=o,!1):void 0});break;case 1:angular.forEach(e,function(e,o){return 1==e.displayType?(t=o,!1):void 0});break;case 2:angular.forEach(e,function(e,o){return 2==e.displayType&&e.activityId==a?(t=o,!1):void 0});break;case 3:angular.forEach(e,function(e,o){return 3==e.displayType&&e.categoryId==a?(t=o,!1):void 0})}return"up"==o?-1==t?!1:t-1:"down"==o?t==e.length-1?!1:t+1:void 0},a=function(e,o){var n={0:"root.buy.nav.all",1:"root.buy.nav.recommend",2:"root.buy.nav.active",3:"root.buy.nav.category"};return{text:e.navigateName,name:n[e.displayType],params:{collegeId:o,categoryId:e.categoryId,activityId:e.activityId}}};return function(t,i,r,s){var c=e.defer();return o.fetchOne("navgatorlist",{collegeId:i}).then(function(e){var o=e.navigateItems,l=n(o,t,r,s);angular.isNumber(l)?c.resolve(a(o[l],i)):c.reject()}),c.promise}}]),angular.module("xiaomaiApp").factory("registerWx",["$q","xiaomaiService","env",function(e,o,n){var a=e.defer(),t=["onMenuShareTimeline","onMenuShareAppMessage","getNetworkType","getLocation","openLocation"],i=function(e){wx.config({debug:!1,appId:e.appId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:t}),wx.ready(function(){a.resolve()}),wx.error(function(e){a.reject(JSON.stringify(e))})};return o.fetchOne("getWxConfig",{url:encodeURIComponent([location.protocol,"//",location.host,location.pathname,location.search].join(""))}).then(function(e){i(e)}),a.promise}]),angular.module("xiaomaiApp").factory("locationManager",["$q","$timeout","env","registerWx",function(e,o,n,a){var t=function(){var n=e.defer(),t=o(function(){n.reject("网络超时")},2e3);return a.then(function(){wx.getLocation({type:"wgs84",success:function(e){var a=e.latitude,i=e.longitude;o.cancel(t),n.resolve({lat:a,lng:i})}})},function(e){n.reject(e)}),n.promise};return t}]),angular.module("xiaomaiApp").factory("networkType",["$q","registerWx",function(e,o){return xiaomaiApp}]),angular.module("xiaomaiApp").factory("wxshare",["$q","registerWx",function(e,o){return function(e){o.then(function(){wx.onMenuShareTimeline(e),wx.onMenuShareAppMessage(e)})}}]),angular.module("xiaomaiApp").run(["$templateCache",function(e){e.put("../assets/views/active/active.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-back" ng-click="goback();"></div>\n  <div class="location-info">{{activityShowName}}</div>\n  <div class="iconfont   icon-share icon-locate-right" ng-click="showShareModel();"></div>\n</div>\n\n<div class="activeWrap" down-tip-cls="{{\'skactive-downtip\'}}" xiaomai-iscroll subname="{{\'activeheightstatus\'}}" pubname="{{\'activeiscrollupdate\'}}">\n  <div>\n    <div class="banner">\n      <ks-swiper-container on-ready="onReadySwiper(swiper)" swiper="swiper">\n        <ks-swiper-slide class="swiper-slide" ng-repeat="banner in banners">\n          <div class="activeGoodBanner" ng-click="gotoActive(banner);" ng-style="{\'background-image\':\'url(\'+banner.imageUrl+\')\'}"></div>\n        </ks-swiper-slide>\n      </ks-swiper-container>\n    </div>\n    <ul class="activeGoodList">\n      <li class="errortip" ng-if="haserror">\n        活动已经结束,去其他活动看看吧\n      </li>\n      <li class="loading" ng-if="isloading">\n        正在加载活动商品列表...\n      </li>\n      <li ng-repeat="good in goods">\n        <div class="goodItem" ng-click="gotoDetail($event,good);">\n          <div class="imgCont" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'>\n            <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n          </div>\n          <div class="details">\n<!-- 输出标签29分钟达/次日达 -->\n            <p class="goodname">{{good.activityGoodsName}}</p>\n            <p class="priceCont">\n<!-- 单品或者组合最高价-->\n              <span class="new-price" ng-if="good.goodsType==1||good.goodsType==2">\n                &yen;<i>{{good.skuList[0].activityPrice|xiaomaiprice}}</i>\n              </span>\n              <span class="old-price" ng-if="good.goodsType==1||good.goodsType==2">\n                &yen;{{good.skuList[0].originPrice|xiaomaiprice}}</span>\n<!-- 聚合 -->\n              <span class="aggregate-price" ng-if="good.goodsType==3">\n                &yen;{{good.minWapPrice|xiaomaiprice}} ~ &yen;{{good.maxWapPrice|xiaomaiprice}}\n              </span>\n            </p>\n            <p class="buy-icon iconfont icon-plus" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,good,$index);" ng-if="good.goodsStatusDisplay!=3"></p>\n            <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n'),e.put("../assets/views/active/nav.active.html",'<div class="errortip" ng-if="haserror">\n  活动已经结束 去其他类目看看吧\n</div>\n<div class="loading" ng-if="isloading">\n  正在加载......\n</div>\n<div class="GoodsCont">\n  <div class="GoodCont" ng-click="gotoDetail($event,good);" ng-repeat="good in goods">\n    <div class="imgCont" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'></div>\n    <div class="details">\n      <p class="goodname">{{good.activityGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n      <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n      <p class="priceCont">\n<!-- 单品或者组合最高价-->\n        <span class="new-price" ng-if="good.goodsType==1||good.goodsType==2">\n          &yen;<i>{{good.skuList[0].activityPrice|xiaomaiprice}}</i>\n        </span>\n        <span class="old-price" ng-if="good.goodsType==1||good.goodsType==2">\n          &yen;{{good.skuList[0].originPrice|xiaomaiprice}}</span>\n<!-- 聚合 -->\n        <span class="aggregate-price" ng-if="good.goodsType==3">\n          &yen;{{good.minWapPrice|xiaomaiprice}} ~ &yen;{{good.maxWapPrice|xiaomaiprice}}\n        </span>\n      </p>\n      <p class="buy-icon iconfont icon-plus" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,good,$index);" ng-if="good.goodsStatusDisplay!=3"></p>\n      <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/all/all.html",'<ul class="category-active-list" style="">\n  <li class="loading" ng-if="isloading">loading...</li>\n  <li class="errortip" ng-if="haserror">错误提示....</li>\n  <li ng-repeat="item in activities" class="tag-active" ng-click="goto(item);" ng-style="{\'background-image\':\'url(\'+item.wapImageUrl+\')\'}"></li>\n</ul>\n'),e.put("../assets/views/buy/buy.html",'<div ui-view></div>\n<!-- 购物车x-->\n<div class="pub-footer" ng-controller="buy.cartThumbCtrl">\n  <div class="cartThumb" ng-class="{showcart:isShowCart,showdetail:isShowDetail}">\n    <span class="iconfont icon-cart" ng-click="gotoDetail();">\n      <span class="totalCount" ng-class="{big:hasChange}" ng-show="totalCount && totalCount!=0">{{totalCount}}</span>\n    </span>\n    <p class="totalPrice" ng-show="totalCount && totalCount!=0">共计<em>&yen;</em>\n      <span>{{totalPrice|xiaomaiprice}}</span></p>\n    <div class="gotoPay" ng-show="totalCount && totalCount!=0" ng-click="goSettlement();">选好了</div>\n    <p class="emptyTip" ng-show="!totalCount || totalCount==0">购物车是空的,快快选购吧~</p>\n  </div>\n  <div class="cartDetail" ng-class="{\'cartDetail-show\':showcart}" ng-controller="buy.cartDetailCtrl">\n    <span class="goback" ng-click="continueShop($event);">继续购物<i class=" iconfont icon-YF_more"></i>\n    </span>\n    <div class="cartDetailWrap" subname="{{\'shopcartdetailheightupdate\'}}" xiaomai-iscroll>\n      <div>\n        <div class="haserror" ng-click="goHomepage();" ng-if="haserror">购物车空了 赶快去<span>购物吧</span></div>\n        <div class="good-info" ng-repeat="good in goods">\n          <div class="goodWrap">\n            <p class="good-title">{{good.sourceType==2?good.activityGoodsName:good.bgGoodsName}}</p>\n            <p class="good-price">&yen;{{good.minWapPrice|xiaomaiprice}}</p>\n            <lable class="label" ng-class="{ldc:$index==0,rdc:$index==1}" ng-repeat="distribute in good.distributeTypeDisplay" ng-show="distribute.length">{{distribute}}</lable>\n          </div>\n          <div class="iconWrap">\n            <i class="iconfont icon-minus" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'minus\',$index);"></i>\n            <span class="good-count">{{good.skuList[0].numInCart}}</span>\n            <i class="iconfont icon-plus" ng-class="{paying:goo.isPaying}" ng-click="buyHandler($event,\'plus\',$index);"></i>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="cartDetail-tip">\n      <p class="cartDetail-tip-freight" ng-if="ldcFreight.sub && ldcFreight.sub!=0">29分钟达产品满{{ldcFreight.total|xiaomaiprice}}减{{ldcFreight.sub|xiaomaiprice}}</p>\n      <p ng-click="gotoCoupon();" class="cartDetail-tip-coupon" ng-if="coupons.length">{{coupons.length}}张可用优惠劵<i class="couponMore iconfont icon-YF_more"></i>\n      </p>\n      <p class="cartDetail-tip-coupon" ng-if="!coupons.length">暂无可用优惠劵</p>\n    </div>\n  </div>\n</div>\n<!--遮罩-->\n<div class="mask" mask-gui ng-click="closeMask($event);"></div>\n<div class="shareModel" ng-if="shareIsShow" ng-click="closeShare($event);"></div>\n\n\n\n<!--商品详情-->\n<div class="goodDetail" ng-class="{\'goodDetail-show\':showdetail}" ng-controller="buy.detailCtrl">\n  <div class="detailCont">\n    <div class="goodIconWrap">\n      <div class="iconfont icon-share" ng-click="showShareModel($event);"></div>\n      <div class="iconfont icon-unfold" ng-click="closeDetail($event);"></div>\n    </div>\n    <div class="goodDetailWrap" subname="{{\'detailgoodheightupdate\'}}" xiaomai-iscroll>\n      <div>\n        <div class="imgCont" ng-style="{\'background-image\':\'url(\'+(skuInfo&&skuInfo.imageUrl?skuInfo.imageUrl:good.imageUrl)+\')\'}">\n<!--到达类型-->\n          <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n        </div>\n        <div class="good-normal-info">\n<!--产品名称-->\n          <p class="title">{{good.sourceType==2?good.activityGoodsName:good.bgGoodsName}}</p>\n<!--产品价格-->\n\n          <p class="priceCont" ng-if="skuInfo">\n            <span class="new-price">&yen;<i>{{good.sourceType==2?skuInfo.activityPrice:skuInfo.wapPrice|xiaomaiprice}}</i></span>\n            <span class="old-price">&yen;{{skuInfo.originPrice|xiaomaiprice}}</span>\n          </p>\n          <p class="priceCont" ng-if="!skuInfo">\n            <span class="aggregate-price">&yen;{{good.minWapPrice|xiaomaiprice}}</span>\n            <span class="f14 aggregate-price">\n            ~&yen;{{good.maxWapPrice|xiaomaiprice}}\n            </span>\n          </p>\n<!--普通类活动-->\n          <div ng-if="good.isSeckill!=1">\n<!--如果没有货 显示补货中-->\n            <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n<!--进行数量选择-->\n            <p class="buy-handler-cont " ng-if="good.goodsStatusDisplay!=3">\n              <span class="buy-handler iconfont icon-minus" ng-class="{paying:good.isPaying}" ng-hide="!skuInfo||!numInCart||numInCart<1" ng-click="buyHandler($event,\'minus\');"></span>\n<!--当前已经购买的数量 -->\n              <span class="buy-result">{{numInCart}}</span>\n              <span class="buy-handler iconfont icon-plus buy-icon" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'plus\');"></span>\n            </p>\n          </div>\n<!--秒杀类产品-->\n          <div ng-if="good.isSeckill==1">\n<!--倒计时-->\n            <p class="countdown" ng-if="good.killStarted==0">\n              距开始\n              <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.timeBeforeStart}}" timeid="{{good.activityBgGoodsId}}"></span>\n            </p>\n<!-- 活动已开始同时没有被抢空-->\n            <p class="countdown" ng-if="good.killStarted==1 && good.goodsStatusDisplay!=3">\n              距结束\n              <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.buyLeftTime}}" timeid="{{good.activityBgGoodsId}}"></span>\n            </p>\n<!-- 未开始-->\n            <p class="sold-out" ng-if="good.killStarted==0">未开始</p>\n<!-- 已结束-->\n            <p class="sk-end" ng-if="good.killStarted==2">已结束</p>\n<!-- 已经售空-->\n            <p class="sold-out" ng-if="good.killStarted==1 && good.goodsStatusDisplay==3">抢光了</p>\n<!-- 已经抢过了 -->\n            <p class="sold-geted" ng-if="good.killStarted==1 && good.killed">已抢购</p>\n<!-- 抢购开始 & 没抢购过 & 商品上架状态 -->\n            <p class="sk-icon" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'plus\',true)" ng-if="good.killStarted==1 && !good.killed && good.goodsStatusDisplay==2">抢</p>\n          </div>\n        </div>\n<!--如果是聚合类产品-->\n        <div class="complex-properties" ng-if="good.goodsType==3">\n          <div class="complex-property" ng-repeat="goodProperty in good.skuGoodsPropertyList">\n            <p class="complex-property-name">{{goodProperty.propertyName}}</p>\n            <div class="complex-property-values">\n              <span ng-class="{checked:checkedProperties[goodProperty.propertyNameId]==valueItem.propertyValueId}" ng-click="complexCheckProperty(goodProperty.propertyNameId,valueItem.propertyValueId)" ng-repeat="valueItem in goodProperty.propertyValues">{{valueItem.propertyValue}}</span>\n            </div>\n          </div>\n        </div>\n<!-- 产品描述-->\n        <div class="detail-desc" ng-if="good.goodsDesc && good.goodsDesc.length">\n          <div class="detail-desc-key">产品描述:</div>\n          <div class="detail-desc-main">{{good.goodsDesc}}</div>\n        </div>\n        <div class="detail-desc" ng-if="good.saleSpec && good.saleSpec.length">\n          <div class="detail-desc-key">产品规格:</div>\n          <div class="detail-desc-main">{{good.saleSpec}}/{{good.unit}}</div>\n        </div>\n        <div class="detail-desc" ng-if="good.originPlace && good.originPlace.length">\n          <div class="detail-desc-key">产地:</div>\n          <div class="detail-desc-main">{{good.originPlace}}</div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/category/category.html",'<div class="GoodsCont">\n\n  <div class="errortip" ng-if="haserror">{{errortip}}</div>\n  <div  ng-if="isloading" class="loading">\n      正在加载\n  </div>\n  <div class="banner">\n    <ks-swiper-container swiper="swiper">\n      <ks-swiper-slide class="swiper-slide" ng-repeat="banner in banners">\n        <div class="categoryBanners" ng-click="gotoActive(banner);" ng-style="{\'background-image\':\'url(\'+banner.imageUrl+\')\'}"></div>\n      </ks-swiper-slide>\n    </ks-swiper-container>\n  </div>\n  <div class="GoodCont" ng-repeat="good in goods" ng-click="gotoDetail($event,good);">\n    <div class="imgCont" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'></div>\n    <div class="details">\n      <p class="goodname">{{good.bgGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n      <label class="label" ng-class="{\'ldc\':$index===0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.trim().length">{{label}}</label>\n      <p class="priceCont">\n<!-- 单品或者组合最高价-->\n        <span class="new-price" ng-if="good.goodsType!=3">\n          &yen;<i>{{good.skuList[0].wapPrice|xiaomaiprice}}</i>\n        </span>\n        <span class="old-price" ng-if="good.goodsType!=3">\n          &yen;{{good.skuList[0].originPrice|xiaomaiprice}}\n        </span>\n<!-- 聚合 -->\n        <span class="aggregate-price" ng-if="good.goodsType==3">\n          &yen;{{good.minWapPrice|xiaomaiprice}} ~ &yen;{{good.maxWapPrice|xiaomaiprice}}\n        </span>\n      </p>\n      <p ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,good,$index);" class="buy-icon iconfont icon-plus" ng-if="good.goodsStatusDisplay!=3"></p>\n      <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/colleges/colleges.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-back" ng-click="goback();"></div>\n  <div class="location-info">选择学校</div>\n  <div class="iconfont icon-locate-right"></div>\n</div>\n<div class="colleges_content" xiaomai-iscroll subname="{{\'collegesheightupdate\'}}">\n  <ul class="countrylist">\n    <li class="loading" ng-if="isloading">学校信息正在加载....</li>\n    <li class="errortip" ng-if="haserror">该城市还没有相关学校</li>\n    <li ng-repeat="country in countrylist" >\n      <p class="countryname">{{country.cityName}}</p>\n      <div ng-class="{holiday:college.isOpen!=1}" class="" ng-click="checkCollege(college)" ng-click="checkCollege(college);" ng-repeat="college in country.colleges">{{college.collegeName}}</div>\n    </li>\n  </ul>\n</div>\n'),e.put("../assets/views/coupon/coupon.html",""),e.put("../assets/views/feedback/feedback.html",'<div class="feedback-wrap">\n  <div class="feedback-head">\n    <div back-icon class="iconfont icon-back icon-left" back-icon ng-click="goBack();"></div>\n    <div class="icon-middle">意见反馈</div>\n  </div>\n  <div class="feedback-main">\n    <div class="textareaCont">\n      <textarea class="feedback-cont" ng-model="feedback" placeholder="您的意见或建议是我们不断前进的巨大动力"></textarea>\n    </div>\n    <input placeholder="请留下您的联系方式(可选)" type="number" ng-model="mobile"/>\n    <div ng-click="submit();" class="icon-right submitBtn">提交</div>\n  </div>\n</div>\n'),e.put("../assets/views/locate/locate.html",'<div class="pub-header">\n  <div class="iconfont icon-back" ng-click="goback();"></div>\n  <div class="location-info">选择学校</div>\n\n  <div class="iconfont icon-locate-right"></div>\n</div>\n<div class="colleges_content" xiaomai-iscroll subname="{{\'locateheightupdate\'}}">\n  <div class="">\n    <p class="title">定位学校</p>\n    <div class="localColleges" ng-class="{locating:isLocating}">\n      <p class="" ng-if="isloading"></p>\n      <p class="locateerrortip" ng-if="haserror">小麦迷路了,手动选择一下吧</p>\n      <p class="locateCollege" ng-class="{holiday:item.isOpen!=1}" ng-click="checkCollege(item,$index)" ng-repeat="item in locationResult">{{item.collegeName}}</p>\n    </div>\n    <p class="title">手动选择</p>\n    <div class="allSchools">\n      <ul class="citylist iconfont">\n        <li ng-class="{checked:item.cityId==curcityid}" ng-click="showCollegeList(item);" ng-repeat="item in citylist">{{item.cityName}}</li>\n      </ul>\n    </div>\n  </div>\n</div>\n'),
e.put("../assets/views/nav/nav.html",'<div class="pub-header" ng-controller="nav.headCtrl">\n  <div class="iconfont icon-feedback" ng-click="gotoFeedback();"></div>\n  <div class="location-info iconfont icon-school" ng-click="gotoLocate();">\n    <i class="locate iconfont"></i>\n    {{schoolname}}\n    <i class="changeLocate"></i>\n  </div>\n  <div class="iconfont icon-user" style="display:none;"></div>\n</div>\n<div class="list-main main-both">\n  <div class="list-category" subname="{{\'navheightupdate\'}}" xiaomai-iscroll>\n    <ul ng-controller="nav.listCtrl">\n      <li class="nav nav-super nav-mark-{{nav.labelType}}" ng-class="{\'nav-checked\':navChecked(nav)}" ng-click="goto($event,nav);" ng-if="nav.displayType!=3" ng-repeat="nav in navs">{{nav.navigateName}}</li>\n      <li class="nav nav-parent" ng-init="isShowSub=true;">\n        <p class="arrow-down" ng-class="{\'arrow-up\':!isShowSub}" ng-click="isShowSub=!isShowSub;motherNavLog($event);">聚类导航</p>\n        <ul ng-show="isShowSub">\n          <li class="nav-sub nav-mark-{{subnav.labelType}}" class="nav-sub" ng-class="{\'nav-checked\':subnav.categoryId==curcategoryId}" ng-click="goto($event,subnav);" ng-if="subnav.displayType==3" ng-repeat="subnav in navs">{{subnav.navigateName}}</li>\n        </ul>\n      </li>\n    </ul>\n  </div>\n  <div class="list-product" down-tip-cls="{{\'navmain-downtip\'}}" pubname="{{\'navmainscrollupdate\'}}" subname="{{\'navmainheightstatus\'}}" up-tip-cls="{{\'navmain-uptip\'}}" xiaomai-iscroll>\n    <div ui-view></div>\n  </div>\n</div>\n'),e.put("../assets/views/notfound/notfound.html",""),e.put("../assets/views/recommend/recommend.html",'<div class="recommendCategoryCont">\n  <div class="errortip" ng-if="haserror">\n    错误提示....\n  </div>\n  <div class="loading" ng-if="isloading">\n    loading...\n  </div>\n  <div class="" ng-repeat="item in categorys">\n    <div class="recommendCateTitle">\n      <h3>{{item.category.categoryName}}</h3>\n      <span class="iconfont icon-unfold" ng-click="gotocategory(item);"></span>\n    </div>\n    <div class="recommendCateColumn">\n      <div class="recommendCateGood" ng-repeat="good in item.goods" ng-click="gotoDetail($event,good);">\n        <div class="imgCont" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'></div>\n        <div class="details">\n          <p class="goodname">{{good.bgGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n          <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n          <p class="priceCont">\n<!-- 单品或者组合最高价-->\n            <span class="new-price" ng-if="good.goodsType==1||good.goodsType==2">\n              &yen;<i>{{good.skuList[0].wapPrice|xiaomaiprice}}</i>\n            </span>\n            <span class="old-price" ng-if="good.goodsType==1||good.goodsType==2">\n              &yen;{{good.skuList[0].originPrice|xiaomaiprice}}</span>\n<!-- 聚合 -->\n            <span class="aggregate-price" ng-if="good.goodsType==3">\n              &yen;{{good.minWapPrice|xiaomaiprice}} ~ &yen;{{good.maxWapPrice|xiaomaiprice}}\n            </span>\n          </p>\n          <p class="buy-icon iconfont icon-plus" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,good ,$index,$parent.$parent.$index);" ng-if="good.goodsStatusDisplay!=3"></p>\n          <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/root/root.html","<div ui-view></div>\n"),e.put("../assets/views/sharedetail/sharedetail.html",'<style media="screen">\n.shareGoodDetail .goodDetailWrap{\n  position:fixed;\n  left:0;\n  right:0;\n  top:0;\n  bottom:4.5rem;\n}\n\n</style>\n<div class="shareGoodDetail">\n  <div class="goodDetailWrap detailCont" subname="{{\'sharedetailheightupdate\'}}" xiaomai-iscroll>\n    <div>\n      <div class="imgCont" ng-style="{\'background-image\':\'url(\'+(skuInfo&&skuInfo.imageUrl?skuInfo.imageUrl:good.imageUrl)+\')\'}">\n<!--到达类型-->\n        <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n      </div>\n      <div class="good-normal-info">\n<!--产品名称-->\n        <p class="title">{{good.sourceType==2?good.activityGoodsName:good.bgGoodsName}}</p>\n<!--产品价格-->\n        <p class="priceCont" ng-if="skuInfo">\n          <span class="new-price">&yen;<i>{{good.sourceType==2?skuInfo.activityPrice:skuInfo.wapPrice|xiaomaiprice}}</i></span>\n          <span class="old-price">&yen;{{skuInfo.originPrice|xiaomaiprice}}</span>\n        </p>\n        <p class="priceCont" ng-if="!skuInfo">\n          <span class="aggregate-price">&yen;{{good.minWapPrice|xiaomaiprice}}</span>\n          <span class="f14 aggregate-price">\n            ~&yen;{{good.maxWapPrice|xiaomaiprice}}\n          </span>\n        </p>\n<!--普通类活动-->\n        <div ng-if="good.isSeckill!=1">\n<!--如果没有货 显示补货中-->\n          <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n<!--进行数量选择-->\n          <p class="buy-handler-cont " ng-if="good.goodsStatusDisplay!=3">\n            <span class="buy-handler iconfont icon-minus" ng-click="buyHandler($event,\'minus\');" ng-class="{paying:good.isPaying}" ng-hide="!skuInfo||!numInCart||numInCart<1"></span>\n<!--当前已经购买的数量 -->\n            <span class="buy-result">{{numInCart}}</span>\n            <span class="buy-handler iconfont icon-plus buy-icon"  ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'plus\');"></span>\n          </p>\n        </div>\n<!--秒杀类产品-->\n        <div ng-if="good.isSeckill==1">\n<!--倒计时-->\n          <p class="countdown" ng-if="good.killStarted==0">\n            距开始\n            <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.timeBeforeStart}}" timeid="{{good.activityBgGoodsId}}"></span>\n          </p>\n<!-- 活动已开始同时没有被抢空-->\n          <p class="countdown" ng-if="good.killStarted==1 && good.goodsStatusDisplay!=3">\n            距结束\n            <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.buyLeftTime}}" timeid="{{good.activityBgGoodsId}}"></span>\n          </p>\n<!-- 未开始-->\n          <p class="sold-out" ng-if="good.killStarted==0">未开始</p>\n<!-- 已结束-->\n          <p class="sk-end" ng-if="good.killStarted==2">已结束</p>\n<!-- 已经售空-->\n          <p class="sold-out" ng-if="good.killStarted==1 && good.goodsStatusDisplay==3">抢光了</p>\n<!-- 已经抢过了 -->\n          <p class="sold-geted" ng-if="good.killStarted==1 && good.killed">已抢购</p>\n<!-- 抢购开始 & 没抢购过 & 商品上架状态 -->\n          <p class="sk-icon" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'plus\',true)" ng-if="good.killStarted==1 && !good.killed && good.goodsStatusDisplay==2">抢</p>\n        </div>\n      </div>\n<!--如果是聚合类产品-->\n      <div class="complex-properties" ng-if="good.goodsType==3">\n        <div class="complex-property" ng-repeat="goodProperty in good.skuGoodsPropertyList">\n          <p class="complex-property-name">{{goodProperty.propertyName}}</p>\n          <div class="complex-property-values">\n            <span ng-class="{checked:checkedProperties[goodProperty.propertyNameId]==valueItem.propertyValueId}" ng-click="complexCheckProperty(goodProperty.propertyNameId,valueItem.propertyValueId)" ng-repeat="valueItem in goodProperty.propertyValues">{{valueItem.propertyValue}}</span>\n          </div>\n        </div>\n      </div>\n<!-- 产品描述-->\n      <div class="detail-desc" ng-if="good.goodsDesc && good.goodsDesc.length">\n        <div class="detail-desc-key">产品描述:</div>\n        <div class="detail-desc-main">{{good.goodsDesc}}</div>\n      </div>\n      <div class="detail-desc" ng-if="good.saleSpec && good.saleSpec.length">\n        <div class="detail-desc-key">产品规格:</div>\n        <div class="detail-desc-main">{{good.saleSpec}}/{{good.unit}}</div>\n      </div>\n      <div class="detail-desc" ng-if="good.originPlace && good.originPlace.length">\n        <div class="detail-desc-key">产地:</div>\n        <div class="detail-desc-main">{{good.originPlace}}</div>\n      </div>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/skactive/skactive.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-back" ng-click="goback();"></div>\n  <div class="location-info">{{activityShowName}}</div>\n  <div class="iconfont   icon-share icon-locate-right" ng-click="showShareModel();"></div>\n</div>\n<div class="skWrap" down-tip-cls="{{\'skactive-downtip\'}}" pubname="{{\'skactiveiscrollupdate\'}}" subname="{{\'skactiveheightstatus\'}}" xiaomai-iscroll>\n  <div>\n    <div class="banner">\n      <ks-swiper-container swiper="swiper">\n        <ks-swiper-slide class="swiper-slide" ng-repeat="banner in banners">\n          <div class="skactiveGoodBanner" ng-click="gotoActive(banner);" ng-style="{\'background-image\':\'url(\'+banner.imageUrl+\')\'}"></div>\n        </ks-swiper-slide>\n      </ks-swiper-container>\n    </div>\n    <ul class="skactiveGoodList">\n      <li class="errortip" ng-click="goHomepage();" ng-if="haserror">\n        活动已经结束,去其他活动看看吧\n      </li>\n      <li class="loading" ng-if="isloading">\n        正在加载活动商品列表...\n      </li>\n      <li ng-repeat="good in goods">\n        <div class="goodItem" ng-click="gotoDetail($event,good);">\n          <div class="imgCont" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'>\n<!--如果活动未开始-->\n            <p class="countdown" ng-if="good.killStarted==0">\n              距开始\n              <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.timeBeforeStart}}" timeid="{{good.activityBgGoodsId}}"></span>\n            </p>\n<!-- 活动已开始且没有被抢空-->\n            <p class="countdown" ng-if="good.killStarted==1 && good.goodsStatusDisplay!=3">\n              距结束\n              <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.buyLeftTime}}" timeid="{{good.activityBgGoodsId}}"></span>\n            </p>\n          </div>\n          <div class="details">\n            <p class="goodname">{{good.activityGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n            <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n            <p class="priceCont">\n<!-- 单品或者组合最高价-->\n              <span class="new-price" ng-if="good.goodsType==1||good.goodsType==2">\n                &yen;<i>{{good.skuList[0].activityPrice|xiaomaiprice}}</i>\n              </span>\n              <span class="old-price" ng-if="good.goodsType==1||good.goodsType==2">\n                &yen;{{good.skuList[0].originPrice|xiaomaiprice}}</span>\n            </p>\n<!-- 未开始-->\n            <p class="sold-geted" ng-if="good.killStarted==0">未开始</p>\n<!-- 已结束-->\n            <p class="sk-end" ng-if="good.killStarted==2">已结束</p>\n<!-- 已经售空-->\n            <p class="sold-out" ng-if="good.killStarted==1 && good.goodsStatusDisplay==3">抢光了</p>\n<!-- 已经抢过了 -->\n            <p class="sold-geted" ng-if="good.killStarted==1 && good.killed">已抢购</p>\n<!-- 抢购开始 & 没抢购过 & 商品上架状态 -->\n            <p class="sk-icon" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,good,$index);" ng-if="good.killStarted==1 && !good.killed && good.goodsStatusDisplay==2">抢</p>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n')}]),angular.module("xiaomaiApp").directive("xiaomaiIscroll",["xiaomaiMessageNotify","$timeout","$state",function(e,o,n){var a=function(n,a,t){var i,r=document.createElement("p");r.className+=" "+n.upTipCls;var s=document.createElement("p");s.className+=" "+n.downTipCls;var c=new IScroll(a[0],{click:!0,tap:!0,probeType:2}),l=function(e,o){var n=a.children()[0];r.textContent=e,s.textContent=o,r.className=r.className.replace("pending","").trim(),s.className=s.className.replace("pending","").trim(),n.firstChild!=r&&n.insertBefore(r,n.firstChild),n.lastChild!=s&&n.appendChild(s)};n.scrollstatus="ready",c.on("scrollStart",function(){});var d,u,g=setTimeout(function(){var e=a.children()[0];u=e.offsetHeight-a[0].offsetHeight,c&&c.refresh()},1e3);c.on("scroll",function(){return"ready"!==n.scrollstatus?!1:void(this.y>40?(d&&clearTimeout(d),d=setTimeout(function(){e.pub(n.pubname,"up"),n.scrollstatus="pending"},10)):Math.abs(this.y)>u+15&&(d&&clearTimeout(d),d=setTimeout(function(){e.pub(n.pubname,"down"),n.scrollstatus="pending"},10)))}),n.subname&&e.sub(n.subname,function(o,t,i,d){var p=a.children()[0];"up"==o?"ready"==t?(n.scrollstatus="ready",g&&clearTimeout(g),g=null,setTimeout(function(){c&&c.refresh(),u=p.offsetHeight-a[0].offsetHeight,c.scrollTo(0,0),l(i,d)},50)):(n.scrollstatus="pending",r.className=r.className+" pending",r.textContent=i):"down"==o&&("ready"==t?(n.scrollstatus="ready",g&&clearTimeout(g),g=null,setTimeout(function(){c&&c.refresh(),u=p.offsetHeight-a[0].offsetHeight,l(i,d),e.pub("navmainscrollupdate","down")},500)):(n.scrollstatus="pending",s.className=s.className+" pending",s.textContent=i))}),n.$on("$destroy",function(){c&&c.destroy(),o.cancel(i),c=null,e.remove(n.subname)})};return{scope:{pubname:"@",subname:"@",options:"@",upTipCls:"@",downTipCls:"@"},link:a}}]),angular.module("xiaomaiApp").directive("countdown",["$interval",function(e){function o(e){var o,n,a,t=function(e){return 10>e?"0"+e:e},i=3600,r=60,s=1;return e=Number(e),o=Math.floor(e/i),e%=i,n=Math.floor(e/r),e%=r,a=Math.floor(e/s),[t(o),t(n),t(a)].join(":")}var n=function(n,a,t){var i=n.counttime,r=e(function(){return 0==i?(e.cancel(r),n.countDeadCall({timeid:n.timeid}),!1):(i-=1,void a.html(o(i)))},1e3)};return{template:"<span></span>",scope:{counttime:"@",timeid:"@",countDeadCall:"&"},link:n,replace:!0}}]),angular.module("xiaomaiApp").controller("buy.activeCtrl",["$scope","$state","xiaomaiService","buyProcessManager","xiaomaiCacheManager","xiaomaiMessageNotify","wxshare","getRouterTypeFromUrl","xiaomaiLog",function(e,o,n,a,t,i,r,s,c){var l,d,u,g=function(){return n.fetchOne("activeBanner",{collegeId:l,activityId:d})},p=function(){r({title:"小麦特供-"+e.activityShowName,imgUrl:"http://wap.tmall.imxiaomai.com/img/logo_new.png",desc:"小麦特供,便宜有好货,赶快点进来看看吧!"})},m=function(){return n.fetchOne("activeGoods",{collegeId:l,activityId:d,currentPage:u,recordPerPage:10})};l=o.params.collegeId,d=o.params.activityId,u=o.params.page||1,c("m_p_31singleactivity"+d),c("m_r_31activefrom"+o.params.refer),e.isloading=!0,m().then(function(o){e.activityShowName=o.activityShowName,e.goods=o.goods,e.paginationInfo=o.paginationInfo,e.haserror=e.goods.length?!1:!0},function(){e.haserror=!0})["finally"](function(){e.isloading=!1;var o=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("activeheightstatus","up","ready","",o?"请求下一页数据":""),p()});var v=i.sub("detailGuiManager",function(e){"hide"==e&&setTimeout(function(){p()},100)}),f=i.sub("activeiscrollupdate",function(o){"down"==o&&e.paginationInfo.currentPage!=e.paginationInfo.totalPage&&(i.pub("activeheightstatus","down","pending","","正在请求数据"),!y&&h().then(function(o){var n=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("activeheightstatus","down","ready","",n?"请求下一页数据":"")}))});e.$on("$destroy",function(){i.removeOne("activeiscrollupdate",f),i.removeOne("detailGuiManager",v)}),g().then(function(o){return e.banners=o.banners,o}),e.showShareModel=function(){i.pub("shareModelManager","show"),i.pub("maskManager","show")},e.goback=function(){o.go("root.buy.nav.all")},e.gotoActive=function(e){var n=s(e.hrefUrl,l,"activebanner"+d);return n.hasOwnProperty("path")?window.location.href=n.path:o.go(n.name,n.params),!1},e.gotoDetail=function(e,o){return i.pub("detailGuiManager","show",o.activityGoodsId,o.sourceType,"active"+d),!1},e.buyHandler=function(o,n,t){return c("m_b_31singleactivityadd"+d),3==n.goodsType?(e.gotoDetail(o,n),o.stopPropagation(),!1):(e.goods[t].isPaying=!0,a({distributeType:n.skuList[0].distributeType,goodsId:n.activityGoodsId,sourceType:n.sourceType,skuId:n.skuList[0].activitySkuId,price:n.skuList[0].activityPrice,propertyIds:""},"plus",Math.min(n.maxNum,n.skuList[0].stock)).then(function(){c("m_r_31cartfromactive"+d)},function(e){return alert(e),!1})["finally"](function(){e.goods[t].isPaying=!1}),void o.stopPropagation())};var y=!1,h=function(){return y?!1:(y=!0,n.fetchOne("activeGoods",{collegeId:l,activityId:d,recordPerPage:10,currentPage:e.paginationInfo.currentPage+1}).then(function(o){return y=!1,e.paginationInfo=o.paginationInfo,e.goods=e.goods.concat(o.goods),o}))}}]),angular.module("xiaomaiApp").controller("nav.activeCtrl",["$scope","$state","xiaomaiService","buyProcessManager","xiaomaiCacheManager","xiaomaiMessageNotify","getRouterTypeFromUrl","xiaomaiLog",function(e,o,n,a,t,i,r,s){var c,l,d,u=function(){return n.fetchOne("activeBanner",{collegeId:c,activityId:l})},g=function(){return n.fetchOne("activeGoods",{collegeId:c,activityId:l,currentPage:d,recordPerPage:10})};c=o.params.collegeId,l=o.params.activityId,d=o.params.page||1,s("m_p_31tabactivity"+l),e.isloading=!0;g().then(function(o){e.haserror=o.goods.length?!1:!0,e.goods=o.goods,e.paginationInfo=o.paginationInfo},function(){e.haserror=!0})["finally"](function(){e.isloading=!1;var o=e.paginationInfo.currentPage==e.paginationInfo.totalPage,n=o?"":"请求下一页数据";i.pub("navmainheightstatus","up","ready","",n)}),u().then(function(o){return e.banners=o.banners,o}),e.gotoDetail=function(e,o){return i.pub("detailGuiManager","show",o.activityGoodsId,o.sourceType,"active"+l),!1};var p=i.sub("navmainscrollupdate",function(o){return"up"==o?!1:e.paginationInfo.currentPage==e.paginationInfo.totalPage?!1:(i.pub("navmainheightstatus","down","pending","正在请求数据..."),void(!m&&v().then(function(o){var n=e.paginationInfo.currentPage==e.paginationInfo.totalPage,a=n?"":"请求下一页数据";i.pub("navmainheightstatus","down","ready","",a)})))}),m=!1,v=function(){return m?!1:(m=!0,n.fetchOne("activeGoods",{collegeId:c,activityId:l,recordPerPage:10,currentPage:e.paginationInfo.currentPage+1}).then(function(o){return m=!1,e.paginationInfo=o.paginationInfo,e.goods=e.goods.concat(o.goods),o}))};e.$on("$destroy",function(){i.removeOne("navmainscrollupdate",p)}),e.buyHandler=function(o,n,t){return s("m_b_31homepagetabactivityadd"+l),3==n.goodsType?(e.gotoDetail(o,n),o.stopPropagation(),!1):(e.goods[t].isPaying=!0,a({distributeType:n.skuList[0].distributeType,goodsId:n.activityGoodsId,sourceType:n.sourceType,skuId:n.skuList[0].activitySkuId,price:n.skuList[0].activityPrice,propertyIds:""},"plus",Math.min(n.maxNum,n.skuList[0].stock)).then(function(){s("m_r_31cartfromactive"+l)},function(e){return alert(e),!1})["finally"](function(){e.goods[t].isPaying=!1}),void o.stopPropagation())},e.pagination=function(e){}}]),angular.module("xiaomaiApp").controller("nav.allCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiMessageNotify","xiaomaiCacheManager","xiaomaiLog",function(e,o,n,a,t,i,r){r("m_p_31tabhome"),e.activities=[];var s;e.isloading=!0,a.get().then(function(e){return s=e.collegeId,n.fetchOne("activities",{collegeId:s})}).then(function(o){e.haserror=!1,e.activities=o.activities},function(o){e.haserror=!0})["finally"](function(){e.isloading=!1,t.pub("navmainheightstatus","up","ready","","")}),e.$on("$destroy",function(){i.writeCache("activities",{activities:e.activities})}),e["goto"]=function(e){if("1"==e.isLinkUrl)return window.location.href=e.linkUrl,!1;var n="";switch(e.activityType){case 1:n="root.buy.active";break;default:n="root.buy.skactive"}o.go(n,{collegeId:s,activityId:e.activityId,refer:"homepage"})}}]),angular.module("xiaomaiApp").controller("buyCtrl",["$state","$scope","schoolManager","$q","xiaomaiMessageNotify",function(e,o,n,a,t){o.$on("$stateChangeSuccess",function(o,a,t){n.get().then(function(o){"root.buy"==a.name&&e.go("root.buy.nav.all")},function(){e.go("root.locate")})}),o.closeMask=function(e){t.pub("cartGuiManager","hide"),t.pub("detailGuiManager","hide"),t.pub("shareModelManager","hide"),e.preventDefault()},o.closeShare=function(){t.pub("shareModelManager","hide"),"show"!=i&&"show"!=r&&t.pub("maskManager","hide")};var i,r,s=t.sub("detailGuiManager",function(e){i=e}),c=t.sub("cartGuiManager",function(e){r=e}),l=t.sub("shareModelManager",function(e){o.shareIsShow="show"==e?!0:!1});o.$on("$destroy",function(){t.removeOne("cartGuiManager",c),t.removeOne("detailGuiManager",s),t.removeOne("shareModelManager",l)}),o.$on("$stateChangeStart",function(e,o,n,a,s){("show"==i||"show"==r)&&(t.pub("detailGuiManager","hide"),t.pub("cartGuiManager","hide"),e.preventDefault())})}]),angular.module("xiaomaiApp").controller("buy.detailCtrl",["$scope","$state","xiaomaiService","getSkuInfo","skuListToObject","buyProcessManager","xiaomaiMessageNotify","cartManager","wxshare","xiaomaiLog",function(e,o,n,a,t,i,r,s,c,l){var d,u;e.numInCart=0;var g=r.sub("detailGuiManager",function(o,n,a,t){"show"==o?(l("m_r_31detailfrom"+t),l("m_p_31productdetailinfo"),d=n,u=a,m(d,u).then(function(o){if(e.good=o,e.showdetail=!0,3!=e.good.goodsType){e.skuInfo=e.good.skuList[0];var n=1==e.good.sourceType?e.skuInfo.skuId:e.skuInfo.activitySkuId;return s.getnumInCart(n,e.good.sourceType)}e.skuInfo=!1,e.checkedProperties={},e.skuObject=v(e.good.skuList)}).then(function(o){return angular.isNumber(o)&&(e.numInCart=o)})["finally"](function(){p(),r.pub("detailgoodheightupdate","up","ready","","")})):(e.showdetail=!1,c({title:"",url:"",imgUrl:"",success:"",cancel:""})),r.pub("maskManager",o)}),p=function(){var o="小麦特供-"+(2==e.good.sourceType?e.good.activityGoodsName:e.good.bgGoodsName),n="小麦特供,便宜有好货,赶快点进来看看吧!",a=["http://",window.location.host,window.location.pathname,window.location.search,"#/buy/sharedetail/","?goodId=",d,"&sourceType=",u].join(""),t=e.good.iconImageUrl,i=function(){},r=function(){};c({title:o,link:a,desc:n,imgUrl:t,success:i,cancel:r})};e.$on("$destroy",function(){r.removeOne("detailGuiManager",g)});var m=function(e,o){return n.fetchOne("goodDetail",{goodsId:e,sourceType:o})},v=function(e){return t(e)};e.complexCheckProperty=function(o,n){e.checkedProperties[o]=n;var t=a(e.checkedProperties,e.skuObject);if(e.skuInfo=0==t?!1:t,e.skuInfo){var i=1==e.good.sourceType?e.skuInfo.skuId:e.skuInfo.activitySkuId;s.getnumInCart(i,e.good.sourceType).then(function(o){e.numInCart=o})}else e.numInCart=0},e.showShareModel=function(){r.pub("shareModelManager","show"),l("m_b_31productdetailinfoshare")},e.buyHandler=function(o,n){var a=1==e.good.isSeckill?"m_b_31productdetailinfopanicbuy":"plus"==n?"m_b_31productdetailinfoadd":"m_b_31productdetailinfoless";l(a);var t=[];if(!e.skuInfo)return alert("请选择商品规格"),o.preventDefault(),o.stopPropagation(),!1;angular.forEach(e.checkedProperties,function(e){t.push(e)}),t=t.join("_");var r=2==u?{goodsId:e.good.activityGoodsId,sourceType:2,skuId:e.skuInfo.activitySkuId,distributeType:e.skuInfo.distributeType,price:e.skuInfo.activityPrice,propertyIds:""}:{goodsId:d,sourceType:u,skuId:e.skuInfo.skuId,distributeType:e.skuInfo.distributeType,price:e.skuInfo.wapPrice,propertyIds:t};e.good.isPaying=!0,i(r,n,Math.min(e.good.maxNum,e.skuInfo.stock),e.numInCart).then(function(o){e.numInCart=o,"plus"==n&&l("m_r_31cartfromdetail"),2==e.good.soruceType&&(e.good.killed=!0,alert("抢购成功,赶紧去下单吧!"))},function(e){return alert(e),!1}).then(function(){e.good.isPaying=!1}),o.preventDefault(),o.stopPropagation()},e.timecountdown=function(o){0===e.good.killStarted?(e.good.killStarted=1,e.good.beginTime=-1):1===e.good.killStarted&&(e.good.killStarted=2,e.good.buyLeftTime=-1)},e.closeDetail=function(e){r.pub("detailGuiManager","hide"),e.preventDefault(),l("m_b_31productdetailinfoclose")}}]),angular.module("xiaomaiApp").controller("buy.cartThumbCtrl",["$state","$scope","xiaomaiService","cartManager","$timeout","xiaomaiMessageNotify","env",function(e,o,n,a,t,i,r){a.query(function(e){o.totalCount=e.totalCount,o.totalPrice=e.totalPrice;var n=a.readCartCache();o.hasChange=n.totalCount&&n.totalCount==o.totalCount?!1:!0,o.hasChange&&t(function(){o.hasChange=!1},200)}),i.sub("cartGuiManager",function(e){o.isShowCart="show"==e}),i.sub("detailGuiManager",function(e){o.isShowDetail="show"==e}),o.goSettlement=function(){var o=(e.current.name,/root\.buy(\.nav)?\.(category)/),n="";switch(o[2]){case"all":n="homepage";break;case"recommend":n="recommend";break;case"category":n="category"+e.params.categoryId;break;case"active":n="active"+e.params.activityId;break;case"skactive":n="active"+e.params.activityId}var a="online"==r?"http://h5.imxiaomai.com":"http://wap.tmall.imxiaomai.com";window.location.href=a+"/order/create?r="+n},o.gotoDetail=function(){return o.totalCount&&0!=o.totalCount?(i.pub("detailGuiManager","hide"),void i.pub("cartGuiManager","show")):!1},o.$on("$destroy",function(){a.store(!1)})}]),angular.module("xiaomaiApp").controller("buy.cartDetailCtrl",["$state","$scope","xiaomaiService","cookie_openid","buyProcessManager","xiaomaiMessageNotify","cartManager","env","xiaomaiCacheManager","xiaomaiLog",function(e,o,n,a,t,i,r,s,c,l){var d=i.sub("cartGuiManager",function(e){"show"==e&&(l("m_p_31shoppingcart"),u().then(function(e){return o.goods=e.goods,o.ldcFreight=e.ldcFreight,o.haserror=!1,g()},function(){o.haserror=!0}).then(function(e){c.writeCache("mycoupon",e);var n=[];angular.forEach(e.couponInfo,function(e){0===e.status&&n.push(n)}),o.coupons=n})["finally"](function(){i.pub("shopcartdetailheightupdate","up","ready","","")})),o.showcart="show"==e?!0:!1,i.pub("maskManager",e)});o.$on("destory",function(){i.removeOne("cartGuiManager",d)}),o.gotoCoupon=function(){l("m_b_31shoppingcartcoupons");var e="online"==s?"http://h5.imxiaomai.com":"http://wap.tmall.imxiaomai.com";return window.location.href=e+"/couponwap/myCouponList/webwiew",!1},o.continueShop=function(e){i.pub("cartGuiManager","hide"),e.preventDefault(),l("m_b_31shoppingcartclose")},o.goHomepage=function(){e.go("root.buy.nav.all",{showCart:!1})};var u=function(){return r.queryCartDetail()},g=function(){return n.fetchOne("mycoupon",{openId:a,type:1})};o.buyHandler=function(e,n,a){l("plus"==n?"m_b_31shoppingcartadd":"m_b_31shoppingcartless");var r=o.goods[a],s=r.sourceType,c=r.skuList[0],d=2==s?{goodsId:r.activityGoodsId,sourceType:2,skuId:c.activitySkuId,distributeType:c.distributeType,price:c.activityPrice,propertyIds:c.skuPropertyValueIdList||""}:{goodsId:r.goodsId,sourceType:r.sourceType,distributeType:c.distributeType,skuId:c.skuId,price:c.wapPrice,propertyIds:c.skuPropertyValueIdList||""},r=o.goods[a];o.goods[a].isPaying=!0,t(d,n,Math.min(r.maxNum,r.skuList[0].stock),r.skuList[0].numInCart).then(function(e){"plus"==n&&l("m_r_31cartfromcart"),r.skuList[0].numInCart=e,o.goods[a]&&(o.goods[a].isPaying=!1),0==r.skuList[0].numInCart&&(o.goods.splice(a,1),i.pub("shopcartdetailheightupdate","up","ready","",""))},function(e){alert(e)}),e.stopPropagation(),e.preventDefault()}}]),angular.module("xiaomaiApp").controller("nav.categoryCtrl",["$state","xiaomaiService","$scope","xiaomaiCacheManager","buyProcessManager","xiaomaiMessageNotify","getRouterTypeFromUrl","xiaomaiLog",function(e,o,n,a,t,i,r,s){var c,l;n.$on("$stateChangeSuccess",function(e,o,n){c=n.collegeId,l=n.categoryId,d(),u(),s("m_p_31tabcategory"+l)});n.isloading=!0;var d=function(){o.fetchOne("goods",{collegeId:c,categoryId:l,recordPerPage:10}).then(function(e){n.goods=e.goods,n.paginationInfo=e.paginationInfo,n.haserror=!1},function(e){n.haserror=!0,n.errortip=e})["finally"](function(){n.isloading=!1;var e=n.paginationInfo.currentPage==n.paginationInfo.totalPage,o=e?"":"请求下一页数据";i.pub("navmainheightstatus","up","ready","",o)},function(e){n.errorip=e,n.haserror=!0})},u=function(){o.fetchOne("categoryBanners",{categoryId:l,collegeId:c}).then(function(e){n.banners=e.banners})};n.gotoActive=function(o){var n=r(o.hrefUrl,c,"categorybanner"+l);return n.hasOwnProperty("path")?window.location.href=n.path:e.go(n.name,n.params),!1};var g=i.sub("navmainscrollupdate",function(e){return"up"==e?!1:n.paginationInfo.currentPage==n.paginationInfo.totalPage?!1:(i.pub("navmainheightstatus","down","pending","正在请求数据..."),void(!p&&m().then(function(e){var o=n.paginationInfo.currentPage==n.paginationInfo.totalPage,a=o?"":"请求下一页数据";i.pub("navmainheightstatus","down","ready","",a)})))}),p=!1,m=function(){return p?!1:(p=!0,o.fetchOne("goods",{collegeId:c,categoryId:l,recordPerPage:10,currentPage:n.paginationInfo.currentPage+1}).then(function(e){return p=!1,n.paginationInfo=e.paginationInfo,n.goods=n.goods.concat(e.goods),e}))};n.$on("$destroy",function(){i.removeOne("navmainscrollupdate",g)}),n.gotoDetail=function(e,o){i.pub("detailGuiManager","show",o.goodsId,o.sourceType,"category"+l),e.preventDefault(),e.stopPropagation()},n.buyHandler=function(e,o,a){return s("m_b_31homepagetabcategoryadd"+l),3==o.goodsType?(n.gotoDetail(e,o),e.stopPropagation(),!1):(n.goods[a].isPaying=!0,t({goodsId:o.goodsId,sourceType:o.sourceType,distributeType:o.skuList[0].distributeType,skuId:o.skuList[0].skuId,price:o.skuList[0].wapPrice,propertyIds:""},"plus",Math.min(o.maxNum,o.skuList[0].stock)).then(function(e){s("m_r_31cartfromcategory"+l)},function(e){alert(e)})["finally"](function(){n.goods[a].isPaying=!1}),void e.stopPropagation())}}]),angular.module("xiaomaiApp").controller("collegesCtrl",["$state","$scope","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","xiaomaiLog",function(e,o,n,a,t,i,r){o.countrylist=[],o.$on("$stateChangeSuccess",function(e,o,n){var a=n.cityid;s(a)}),o.isloading=!0;var s=function(e){n.fetchOne("collegelist",{cityId:e}).then(function(e){o.haserror=e.cities.length?!1:!0,o.countrylist=e.cities},function(e){o.haserror=!0})["finally"](function(){i.pub("collegesheightupdate","up","ready","",""),o.isloading=!1})};o.checkCollege=function(o){r("m_b_31manuallyselectsch",o.collegeId),a.set(o).then(function(){return t.clean("navgatorlist"),!0}).then(function(){e.go("root.buy.nav.all")})},o.goback=function(){e.go("root.locate")}}]),angular.module("xiaomaiApp").controller("buy.couponCtrl",["$state","$scope","xiaomaiService",function(e,o,n){n.fetchOne("mycoupon",{}).then(function(e){})}]),angular.module("xiaomaiApp").controller("feedbackCtrl",["$scope","$state","xiaomaiService","xiaomaiLog",function(e,o,n,a){e.goBack=function(){o.go("root.buy.nav.all")},a("m_p_31feedback"),e.feedback="",e.mobile="";var t=/^(\+86)?1[3|4|5|8][0-9]\d{4,8}$/g;e.submit=function(){a("m_b_31feedbacksubmit");var i=e.feedback,r=e.mobile;return i=i.trim&&i.trim(),i&&i.length?r.length&&!t.test(r)?(alert("手机号有误,请确认"),!1):void n.save("feedback",{mobile:r,feedback:i}).then(function(){alert("提交成功!谢谢!"),o.go("root.buy.nav.all")},function(e){alert("提交失败,请重新尝试!\n失败原因:"+e)}):(alert("请输入您的建议或意见"),!1)}}]),angular.module("xiaomaiApp").controller("positionCtrl",["$scope","locationManager","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","xiaomaiLog",function(e,o,n,a,t,i,r,s){e.locationResult=[],e.isloading=!0,s("m_p_31selectsch"),o().then(function(e){return a.fetchOne("locate",{latitude:e.lat,longitude:e.lng})}).then(function(o){e.haserror=!1,e.locationResult=o.colleges},function(o){s("m_b_31manuallyselectcity",""),e.haserror=!0})["finally"](function(){e.isloading=!1}),e.citylist=[],e.isloading=!0,a.fetchOne("citylist",{},!0).then(function(o){e.citylist=o.cities,i.writeCache("citylist",o),e.haserror=!1},function(){e.haserror=!0})["finally"](function(){e.isloading=!1,r.pub("locateheightupdate","up","ready","","")}),e.showCollegeList=function(e){s("m_b_31manuallyselectcity",""),n.go("root.colleges",{cityid:e.cityId})},e.$on("$stateChangeSuccess",function(o,n,a){e.curcityid=a.cityid}),e.checkCollege=function(e,o){s(0==o?"m_b_31autoselectsch1":"m_b_31autoselectsch2",e.collegeId),t.set(e).then(function(){return i.clean("navgatorlist"),!0}).then(function(){n.go("root.buy.nav.all")})},e.goback=function(){n.go("root.buy.nav.all")}}]),angular.module("xiaomaiApp").controller("navCtrl",["$scope","$state",function(e,o){}]),angular.module("xiaomaiApp").controller("nav.headCtrl",["$scope","$state","schoolManager","xiaomaiLog",function(e,o,n,a){n.get().then(function(o){
e.schoolname=o.collegeName}),e.gotoLocate=function(){a("m_b_31homepageswitchsch"),o.go("root.locate")},e.gotoFeedback=function(){a("m_b_31homepagefeedback"),o.go("root.feedback")}}]),angular.module("xiaomaiApp").controller("nav.listCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","xiaomaiLog",function(e,o,n,a,t,i,r){e.navs=[],r("m_p_31homepage"),a.get().then(function(e){return n.fetchOne("navgatorlist",{collegeId:e.collegeId})}).then(function(o){e.navs=o.navigateItems,i.pub("navheightupdate","up","ready","",""),t.writeCache("navgatorlist",o)}),e.paths={0:"root.buy.nav.all",1:"root.buy.nav.recommend",2:"root.buy.nav.active",3:"root.buy.nav.category"},e.navChecked=function(o){var n=!1;switch(e.curpath){case"all":n=0==o.displayType;break;case"recommend":n=1==o.displayType;break;case"active":n=e.activityId==o.activityId;break;case"skactive":n=e.activityId==o.activityId;break;case"category":n=e.curcategoryId==o.categoryId}return n},e.$on("$stateChangeSuccess",function(o,n,a){e.type=a.type;var t=/nav\.(\w+)/,i=n.name.match(t);e.curcategoryId=a.categoryId,e.activityId=a.activityId,i&&i.length&&(e.curpath=i[1])});var s=function(e){var o={0:"m_b_31homepagetabhome",1:"m_b_31homepagetabrec",2:"m_b_31homepagetabactivity"+e.activityId,3:"m_b_31homepagetabcategory"+e.categoryId};r(o[e.displayType])};e.motherNavLog=function(e){r("m_b_31homepagetabmothernavi"),e.preventDefault(),e.stopPropagation()},e["goto"]=function(n,t){a.get().then(function(n){var a,i=n.collegeId,r=t.displayType;t.activityType;s(t),a=e.paths[r],o.go(a,{categoryId:t.categoryId,activityId:t.activityId,collegeId:i,showDetail:!1,showCart:!1})}),n.preventDefault(),n.stopPropagation()}}]),angular.module("xiaomaiApp").controller("nav.recommendCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","buyProcessManager","xiaomaiLog",function(e,o,n,a,t,i,r,s){s("m_p_31tabrecommendation");var c;e.isloading=!0;a.get().then(function(e){return c=e.collegeId,n.fetchOne("categoryGoods",{collegeId:c})}).then(function(o){e.categorys=o,e.haserror=!1},function(){e.haserror=!0})["finally"](function(o){e.isloading=!1,i.pub("navmainheightstatus","up","ready","","")}),e.$on("$destroy",function(){t.writeCache("categoryGoods",e.categorys)}),e.gotocategory=function(e){o.go("root.buy.nav.category",{collegeId:c,categoryId:e.category.categoryId}),s("m_b_31homepagetabrecmore")},e.gotoDetail=function(e,o){i.pub("detailGuiManager","show",o.goodsId,o.sourceType,"recommend"),e.preventDefault(),e.stopPropagation()},e.buyHandler=function(o,n,a,t){return s("m_b_31homepagetabrecadd"),3==n.goodsType?(e.gotoDetail(o,n),o.stopPropagation(),!1):(e.categorys[t].goods[a].isPaying=!0,r({goodsId:n.goodsId,sourceType:n.sourceType,distributeType:n.skuList[0].distributeType,skuId:n.skuList[0].skuId,price:n.skuList[0].wapPrice,propertyIds:""},"plus",Math.min(n.maxNum,n.skuList[0].stock)).then(function(){s("m_r_31cartfromrecommend")},function(e){alert(e)})["finally"](function(){e.categorys[t].goods[a].isPaying=!1}),void o.stopPropagation())}}]),angular.module("xiaomaiApp").controller("sharedetailCtrl",["$scope","$state","xiaomaiService","getSkuInfo","skuListToObject","buyProcessManager","cartManager",function(e,o,n,a,t,i,r){var s,c;e.numInCart=0,e.$on("$stateChangeSuccess",function(o,n,a){s=a.goodId,c=a.sourceType,l(s,c).then(function(o){if(e.good=o,3!=e.good.goodsType){e.skuInfo=e.good.skuList[0];var n=1==e.good.sourceType?e.skuInfo.skuId:e.skuInfo.activitySkuId;return r.getnumInCart(n,e.good.sourceType)}e.skuInfo=!1,e.checkedProperties={},e.skuObject=d(e.good.skuList)}).then(function(o){angular.isNumber(o)&&(e.numInCart=o)})["finally"](function(){xiaomaiMessageNotify.pub("sharedetailheightupdate","up","ready","","")})});var l=function(e,o){return n.fetchOne("goodDetail",{goodsId:e,sourceType:o})},d=function(e){return t(e)};e.complexCheckProperty=function(o,n){e.checkedProperties[o]=n;var t=a(e.checkedProperties,e.skuObject);if(e.skuInfo=0==t?!1:t,e.skuInfo){var i=1==e.good.sourceType?e.skuInfo.skuId:e.skuInfo.activitySkuId;r.getnumInCart(i,e.good.sourceType).then(function(o){e.numInCart=o})}else e.numInCart=0},e.buyHandler=function(o,n,a){var t=[];if(!e.skuInfo)return alert("请选择商品规格"),!1;angular.forEach(e.checkedProperties,function(e){t.push(e)}),t=t.join("_");var r=2==c?{goodsId:e.good.activityGoodsId,sourceType:2,skuId:e.skuInfo.activitySkuId,distributeType:e.skuInfo.distributeType,price:e.skuInfo.activityPrice,propertyIds:""}:{goodsId:s,sourceType:c,skuId:e.skuInfo.skuId,distributeType:e.skuInfo.distributeType,price:e.skuInfo.wapPrice,propertyIds:t};e.good.isPaying=!0,i(r,n,Math.min(e.good.maxNum,e.skuInfo.stock),e.numInCart).then(function(o){e.numInCart=o,2==e.good.soruceType&&(e.good.killed=!0,alert("抢购成功,赶紧去下单吧!"))},function(e){return alert(e),!1}).then(function(){e.good.isPaying=!1}),o.preventDefault(),o.stopPropagation()},e.timecountdown=function(o){0===e.good.killStarted?(e.good.killStarted=1,e.good.beginTime=-1):1===e.good.killStarted&&(e.good.killStarted=2,e.good.buyLeftTime=-1)}}]),angular.module("xiaomaiApp").controller("buy.skactiveCtrl",["$scope","$state","xiaomaiService","buyProcessManager","xiaomaiCacheManager","xiaomaiMessageNotify","wxshare","getRouterTypeFromUrl","xiaomaiLog",function(e,o,n,a,t,i,r,s,c){var l,d,u=1,g=function(){return n.fetchOne("activeBanner",{collegeId:l,activityId:d})};e.goods=[];var p=function(){return n.fetchOne("activeGoods",{collegeId:l,activityId:d,currentPage:u,recordPerPage:10})},m=function(){r({title:"小麦特供-"+e.activityShowName,imgUrl:"http://wap.tmall.imxiaomai.com/img/logo_new.png",desc:"小麦特供,便宜有好货,赶快点进来看看吧!"})},v=!1,f=function(){return v?!1:(v=!0,n.fetchOne("activeGoods",{collegeId:l,activityId:d,currentPage:e.paginationInfo.currentPage+1,recordPerPage:10}).then(function(o){return v=!1,e.paginationInfo=o.paginationInfo,e.goods=e.goods.concat(o.goods),o}))};l=o.params.collegeId,d=o.params.activityId,u=o.params.page||1,c("m_p_31singleactivity"+d),c("m_r_31activefrom"+o.params.refer),e.isloading=!0,p().then(function(o){e.activityShowName=o.activityShowName,e.goods=o.goods,e.paginationInfo=o.paginationInfo,e.haserror=e.goods.length?!1:!0},function(){e.haserror=!0})["finally"](function(){e.isloading=!1;var o=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("skactiveheightstatus","up","ready","",o?"请求下一页数据":""),m()}),g().then(function(o){return e.banners=o.banners,o});var y=i.sub("detailGuiManager",function(e){"hide"==e&&setTimeout(function(){m()},100)}),h=i.sub("skactiveiscrollupdate",function(o){"down"==o&&e.paginationInfo.currentPage!=e.paginationInfo.totalPage&&(i.pub("skactiveheightstatus","down","pending","","正在请求数据"),!v&&f().then(function(o){var n=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("skactiveheightstatus","up","ready","",n?"请求下一页数据":"")}))});e.$on("$destroy",function(){i.removeOne("skactiveiscrollupdate",h),i.removeOne("detailGuiManager",y)}),e.goback=function(){o.go("root.buy.nav.all")},e.gotoActive=function(e){var n=s(e.hrefUrl,l,"activebanner"+d);return n.hasOwnProperty("path")?window.location.href=n.path:o.go(n.name,n.params),!1},e.gotoDetail=function(e,o){return i.pub("detailGuiManager","show",o.activityGoodsId,o.sourceType,"active"+d),!1},e.showShareModel=function(){i.pub("shareModelManager","show"),i.pub("maskManager","show")},e.buyHandler=function(o,n,t){c("m_b_31singleactivitypanicbuy"+d),e.goods[t].isPaying=!0,a({goodsId:n.activityGoodsId,sourceType:2,distributeType:n.skuList[0].distributeType,skuId:n.skuList[0].activitySkuId,price:n.skuList[0].activityPrice,propertyIds:""},"plus",Math.min(n.maxNum,n.skuList[0].stock)).then(function(){c("m_r_31cartfromactive"+d),alert("赶快去下单吧\n否则可能会被其他人抢走了哦"),e.goods[t].killed=!0},function(e){return alert(e),!1})["finally"](function(){e.goods[t].isPaying=!1}),o.stopPropagation()},e.timecountdown=function(o){var n;angular.forEach(e.goodsList,function(e,a){return e.activityBgGoodsId===Number(o)?(n=a,!1):void 0}),0===e.goods[n].killStarted?(e.goods[n].killStarted=1,e.goods[n].beginTime=-1):1===e.goodsList[n].killStarted&&(e.goods[n].killStarted=2,e.goods[n].buyLeftTime=-1)}}]);