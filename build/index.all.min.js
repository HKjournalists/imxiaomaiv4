angular.module("xiaomaiApp",window.__SYS_CONF.dependent_modules),angular.module("xiaomaiApp").config(["$stateProvider","$urlRouterProvider",function(e,n){e.state("root",{url:"/",templateUrl:"../assets/views/root/root.html"}).state("root.buy",{url:"buy/",controller:"buyCtrl",templateUrl:"../assets/views/buy/buy.html"}).state("root.buy.nav",{url:"nav/",templateUrl:"../assets/views/nav/nav.html"}).state("root.buy.nav.all",{url:"all/",templateUrl:"../assets/views/all/all.html",controller:"nav.allCtrl"}).state("root.buy.nav.recommend",{url:"recommend/",controller:"nav.recommendCtrl",templateUrl:"../assets/views/recommend/recommend.html"}).state("root.buy.nav.active",{url:"active/?collegeId&activityId",controller:"nav.activeCtrl",templateUrl:"../assets/views/active/nav.active.html"}).state("root.buy.active",{url:"active/?collegeId&activityId",controller:"buy.activeCtrl",templateUrl:"../assets/views/active/active.html"}).state("root.buy.skactive",{url:"skactive/?collegeId&activityId",controller:"buy.skactiveCtrl",templateUrl:"../assets/views/skactive/skactive.html"}).state("root.buy.nav.category",{url:"category/?collegeId&categoryId",controller:"nav.categoryCtrl",templateUrl:"../assets/views/category/category.html"}).state("root.locate",{url:"locate/",controller:"positionCtrl",templateUrl:"../assets/views/locate/locate.html"}).state("root.colleges",{url:"colleges/?cityid",controller:"collegesCtrl",templateUrl:"../assets/views/colleges/colleges.html"}).state("root.buy.sharedetail",{url:"sharedetail/?goodId&sourceType",controller:"sharedetailCtrl",templateUrl:"../assets/views/sharedetail/sharedetail.html"}).state("root.buy.coupon",{url:"coupon/",controller:"buy.couponCtrl",templateUrl:"../assets/views/coupon/coupon.html"}).state("root.feedback",{url:"feedback",controller:"feedbackCtrl",templateUrl:"../assets/views/feedback/feedback.html"}).state("root.notfound",{url:"404/",templateUrl:"../assets/views/notfound/notfound.html"})}]),angular.module("xiaomaiApp").run(["$state","$rootScope","$timeout",function(e,n,o){var a=o(function(){e.go("root.buy.nav.all")},50);n.$on("$stateChangeStart",function(e,n,t){o.cancel(a)})}]),document.addEventListener("touchmove",function(e){e.preventDefault()},!1),angular.module("xiaomaiApp").filter("xiaomaiprice",function(){return function(e){return(e/100).toFixed(2)}}),angular.module("xiaomaiApp").factory("xiaomaimodelManage",function(){var e={navgatorlist:{url:"/wap/navigate/index",type:"GET"},locate:{url:"/wap/college/locate",type:"GET"},citylist:{url:"/wap/geography/cities",type:"GET"},collegelist:{url:"/wap/geography/colleges",type:"GET"},getSchool:{url:"/wap/college/detail",type:"GET"},saveSchool:{url:"/wap/college/detail",type:"POST"},activities:{url:"/wap/college/activities",type:"GET"},activeGoods:{url:"/wap/activity/goods",type:"GET"},activeBanner:{url:"/wap/activity/banners",type:"GET"},categoryGoods:{url:"/wap/index/categoryGoods",type:"GET"},categoryBanners:{type:"GET",url:"/wap/category/banners"},goods:{url:"/wap/category/goods",type:"GET"},goodDetail:{url:"/wap/goods/detail",type:"GET"},removeCart:{url:"/wap/cart/remove",type:"POST"},whitelist:{type:"GET",url:"/wap/college/whitelist"},addCart:{url:"/wap/cart/add",type:"POST"},queryCart:{url:"/wap/cart/sync",type:"GET"},queryCartDetail:{url:"/wap/cart/get",type:"GET"},mycoupon:{url:"/couponwap/myCouponList",type:"GET"},getWxConfig:{url:"/wap/getWxConfig",type:"GET"},feedback:{url:"/wap/feedback/detail",type:"POST"}},n=function(){var n=Array.prototype.slice.call(arguments,0),o=n[0],a=n[1]||"GET";return e.hasOwnProperty(o)&&e[o].type===a?e[o].url:!1};return n}),angular.module("xiaomaiApp").factory("urlInterceptor",["env",function(e){var n=function(n){return"develop"!==e?n:"/api"+n+".json"};return n}]),angular.module("xiaomaiApp").factory("xiaomaiService",["env","$q","urlInterceptor","xiaomaimodelManage","$http","xiaomaiCacheManager","getDataType","httpRequstParam","$timeout",function(e,n,o,a,t,i,s,r,c){var l=function(e,n){var o=a(e,n);return o},d=function(e){return 0==e.code&&e.data&&("number"!=s(e.data)||e.data.length)&&("object"!=s(e.data)||Object.keys(e.data).length)?e.data:!1},u=function(){return n.defer()},g=function(e){var n,a=u(),r=Array.prototype.slice.call(arguments,0),e=r[0],c={};return"object"==s(r[1])&&(c=r[1]),n=l(e,"GET"),(n=o(n))?i.readCache(e)?(a.resolve(i.readCache(e)),a.promise):(t({url:n,method:"GET",params:angular.extend({v:Math.random().toString().replace(/\./,"")},c)}).success(function(e){d(e)===!1?a.reject(e.msg):a.resolve(e.hasOwnProperty("data")?e.data:e)}).error(function(e){a.reject("接口请求错误")}),a.promise):(a.reject("接口错误或接口请求方式错误"),a.promise)},p=function(){},v=function(){},f=function(n,a){var i=u();if(url=l(n,"POST"),url=o(url),!url)return i.reject("接口错误或接口请求方式错误"),i.promise;var s="develop"==e?{method:"GET",params:a}:{method:"POST",data:r(a)};return t(angular.extend(s,{url:url,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})).success(function(e){0==e.code?i.resolve(e.data):i.reject(e.msg)}).error(function(){i.reject("接口异常")}),i.promise};return{fetchOne:g,fetchAll:p,fetchOrder:v,save:f}}]),angular.module("xiaomaiApp").factory("httpRequstParam",[function(){var e=function(n){var o,a,t,i,s,r,c,l="";for(o in n)if(a=n[o],a instanceof Array)for(c=0;c<a.length;++c)s=a[c],t=o+"["+c+"]",r={},r[t]=s,l+=e(r)+"&";else if(a instanceof Object)for(i in a)s=a[i],null!=s&&(t=o+"."+i,r={},r[t]=s,l+=e(r)+"&");else void 0!==a&&(l+=encodeURIComponent(o)+"="+encodeURIComponent(a)+"&");return l.length?l.substr(0,l.length-1):l};return e}]),angular.module("xiaomaiApp").factory("xiaomaiQuicksort",[function(){var e=function(n){if(n.length<=1)return n;var o=Array.prototype.slice.call(arguments,0),n=o[0],a=o[1]||"number",t=o[2],i=Math.ceil(n.length/2),s="number"==a?n[i]:n[i][t],r=[],c=[];return $.each(n,function(e,n){var o="number"===a?n:n[t];return e==i?!0:void(s>=o?r.push(n):c.push(n))}),e(r).concat([n[i]]).concat(e(c))};return e}]),angular.module("xiaomaiApp").factory("xiaomaiCacheManager",["xiaomaiQuicksort",function(e){var n=[],o=20,a=function(e){var o=t(e);return o===!1?!1:(n[o].timestamp=+new Date,angular.extend({},n[o].result))},t=function(e){if(!n.length)return!1;var o=-1;return angular.forEach(n,function(n,a){return n.name===e?(o=a,!1):void 0}),-1===o?!1:o},i=function(a,i){var s=t(a);return s!==!1?(n[s]={name:a,result:i,timestamp:+new Date},!1):(n.length==o&&(n=e(n,"object",timestamp),n.shift()),void n.push({name:a,result:i,timestamp:+new Date}))},s=function(e){var o=t(e);o!==!1&&n.splice(o,1)};return{readCache:a,writeCache:i,clean:s}}]),angular.module("xiaomaiApp").factory("skuListToObject",function(){return function(e){var n={};return angular.forEach(e,function(e,o){var a=[];angular.forEach(e.skuPropertyList,function(e,n){a.push(e.propertyNameId+"="+e.propertyValueId)}),n[a.join("&")]=e}),n}}),angular.module("xiaomaiApp").factory("cartManager",["$q","xiaomaiService","xiaomaiCacheManager",function(e,n,o){var a,t=function(e){o.writeCache("queryCart",e),o.clean("queryCartDetail"),a&&a(e)},i=function(){return e.defer()},s=function(e){var o=i();return n.save("addCart",e).then(function(e){t(e),o.resolve(e)},function(e){o.reject(e)}),o.promise},r=function(e){var o=i();return n.save("removeCart",e).then(function(e){t(e),o.resolve(e)},function(e){o.reject(e)}),o.promise},c=function(e){a=e,n.fetchOne("queryCart").then(function(e){a(e),o.writeCache("queryCart",e)},function(e){a("error")})},l=function(e){e&&angular.isObject(e)?o.writeCache("queryCart",e):o.clean("queryCart")},d=function(){return o.readCache("queryCart")},u=function(){},g=function(){var a=e.defer();return n.fetchOne("queryCartDetail").then(function(e){a.resolve(e),o.writeCache("queryCartDetail",e)}),a.promise},p=function(n,o){var a=[],t=e.defer();return g().then(function(e){return a=e,a.goods}).then(function(e){var a=-1;angular.forEach(e,function(e,t){var i=e.skuList[0];2==o&&i.activitySkuId==n?a=t:1==o&&i.skuId==n&&(a=t)}),t.resolve(-1==a?0:e[a].skuList[0].numInCart)},function(){t.reject(!1)}),t.promise};return{getnumInCart:p,add:s,remove:r,query:c,clear:u,store:l,readCartCache:d,queryCartDetail:g}}]),angular.module("xiaomaiApp").factory("getSkuInfo",[function(){var e=/([^&=]+)=([^&=]+)/;return function(n,o){var a=!1;return angular.forEach(o,function(o,t){var i=!0;angular.forEach(t.split("&"),function(o){if(!o.match(e)||!o.match(e).length)return i=!1,!1;var a=o.match(e),t=a[1],s=a[2];return n.hasOwnProperty(t)?n[t]!=s?(i=!1,!1):void 0:(i=!1,!1)}),1==i&&(a=o)}),a}}]),angular.module("xiaomaiApp").factory("buyProcessManager",["$q","cartManager",function(e,n){var o=!1;return function(){var a=e.defer(),t=Array.prototype.slice.call(arguments,0),i=t[0]||{},s=t[1],r=t[2],c=t[3],l=i.skuId,d=i.sourceType,u="plus"==s?"add":"remove";if(o)return a.reject("正在添加到购物车,请稍等"),a.promise;if(t.length<3)return a.reject("参数缺失!"),a.promise;if("minus"==s&&0>=c)return a.reject("该商品已经不存在"),a.promise;if(angular.isNumber(c)){if("plus"==s&&c>=r)return a.reject("该商品购买数量超上限了哦~"),a.promise;n[u](i).then(function(){a.resolve("plus"==s?c+1:c-1)},function(e){a.reject(e)})}else{var g=void 0;n.getnumInCart(l,d).then(function(e){return angular.isNumber(e)&&r>e?(c=e,n[u](i)):void a.reject("该商品购买数量超上限了哦")}).then(function(e){g="plus"==s?g+1:g-1,a.resolve(c)},function(){a.reject("操作失败")})}return a.promise}}]),angular.module("xiaomaiApp").factory("env",["$window",function(e){var n=/h5\.imxiaomai\.com/,o=/(wap\.tmall\.imxiaomai\.com)|(qa\.wap\.test\.imxiaomai\.com)/,a=e.location.host;return n.test(a)?"online":o.test(a)?"test":"develop"}]),angular.module("xiaomaiApp").factory("systemInfo",["$window",function(e){var n,o,a,t,i=e.navigator.userAgent,s=/(android)\s+([\d\.]+)/i,r=/(iphone|ipad).+(os\s[\d_]+)/i,c=/micromessenger/;return i.match(s)&&i.match(s).length?(t=i.match(s),n=t[1],o=i.match(s)[2]):i.match(r)&&i.match(s).length?(t=i.match(r),n=t[1],o=t[2]):(n="unknown",o="unknown"),a=c.test(i)?"wechart":"other",{platform:n,version:o,browser:a}}]),angular.module("xiaomaiApp").factory("getDataType",[function(){return function(e){var n=Object.prototype.toString.call(e),o=/\s(\w+)/;return n.match(o)[1].toLowerCase()}}]),angular.module("xiaomaiApp").factory("parseUrlParams",[function(){return function(e,n){var o=new RegExp("[\\?&]"+n+"=([^\\?&]+)"),a=e.match(o);return a&&a.length?a[1]:!1}}]),angular.module("xiaomaiApp").factory("getRouterTypeFromUrl",function(){return function(e,n){var o={};return e.match(/[\?&]m=([^\?&]+)/)?(o.name="root.buy.nav.category",o.params={categoryId:e.match(/[\?&]id=([^\?&]+)/)[1],collegeId:n}):e.match(/skActivity/)?(o.name="root.buy.skactive",o.params={collegeId:n,activityId:e.match(/[\?&]activityId=([^\?&]+)/)[1]}):e.match(/activity/)?(o.name="root.buy.skactive",o.params={collegeId:n,activityId:e.match(/[\?&]activityId=([^\?&]+)/)[1]}):o.path=e,o}}),angular.module("xiaomaiApp").factory("cookieManager",["ipCookie",function(e){}]),angular.module("xiaomaiApp").factory("cookie_openid",["env","ipCookie",function(e,n){return"develop"!=e?n("xiaomai_open_id")||"":"oTS2xjtXWVPcdQd9OPI11jjBheco"}]),angular.module("xiaomaiApp").directive("maskGui",["xiaomaiMessageNotify",function(e){var n=function(n,o,a){e.sub("maskManager",function(e){o.css({display:"show"==e?"block":"none"})})};return{link:n}}]),angular.module("xiaomaiApp").factory("xiaomaiMessageNotify",["xiaomaiCacheManager","$window",function(e,n){var o={},a=function(e,n){var a=o.hasOwnProperty(e)?o[e]:{},t=(""+Math.random()).replace(/\./,"");return a[t]=n,o[e]=a,t},t=function(e){var a=o[e];if(!angular.isObject(a)||!Object.keys(a).length)return!1;var t=Array.prototype.slice.call(arguments,1);angular.forEach(a,function(e){angular.isFunction(e)&&e.apply(n,t)})},i=function(e,n){var a=o[e];angular.isObject(a)&&a.hasOwnProperty(n)&&delete a[n]},s=function(e){delete o[e]};return{pub:t,sub:a,removeOne:i,remove:s}}]),angular.module("xiaomaiApp").factory("schoolManager",["$q","xiaomaiService","env","xiaomaiCacheManager",function(e,n,o,a){var t=[],i=!1,s=function(){if(i=!1,!t.length)return!1;var e=t.shift();r(e)},r=function(e){i=!0;var o;n.fetchOne("getSchool").then(function(e){return a.writeCache("getSchool",e),o=e,n.fetchOne("whitelist")}).then(function(n){var t=new RegExp(",?("+o.collegeId+"),?");a.writeCache("whitelist",n),t.test(n.collegeWhiteList)?(e.resolve(o),s()):window.location.href="http://"+window.location.host})},c=function(){var n=e.defer();return i?t.push(n):r(n),n.promise},l=function(o){var t=e.defer(),i=o;return n.save("saveSchool",{collegeId:o.collegeId}).then(function(e){return a.writeCache("getSchool",e),n.fetchOne("whitelist")}).then(function(e){var n=new RegExp(",?("+i.collegeId+"),?");return a.writeCache("whitelist",e),n.test(e.collegeWhiteList)?t.resolve(i):window.location.href="http://"+window.location.host,!1},function(e){t.reject(e)}),t.promise};return{get:c,set:l}}]),angular.module("xiaomaiApp").factory("siblingsNav",["$q","xiaomaiService",function(e,n){var o=function(e,n,o,a){var t=-1;switch(o){case 0:angular.forEach(e,function(e,n){return 0==e.displayType?(t=n,!1):void 0});break;case 1:angular.forEach(e,function(e,n){return 1==e.displayType?(t=n,!1):void 0});break;case 2:angular.forEach(e,function(e,n){return 2==e.displayType&&e.activityId==a?(t=n,!1):void 0});break;case 3:angular.forEach(e,function(e,n){return 3==e.displayType&&e.categoryId==a?(t=n,!1):void 0})}return"up"==n?-1==t?!1:t-1:"down"==n?t==e.length-1?!1:t+1:void 0},a=function(e,n){var o={0:"root.buy.nav.all",1:"root.buy.nav.recommend",2:"root.buy.nav.active",3:"root.buy.nav.category"};return{text:e.navigateName,name:o[e.displayType],params:{collegeId:n,categoryId:e.categoryId,activityId:e.activityId}}};return function(t,i,s,r){var c=e.defer();return n.fetchOne("navgatorlist",{collegeId:i}).then(function(e){var n=e.navigateItems,l=o(n,t,s,r);angular.isNumber(l)?c.resolve(a(n[l],i)):c.reject()}),c.promise}}]),angular.module("xiaomaiApp").factory("registerWx",["$q","xiaomaiService","env",function(e,n,o){var a=e.defer(),t=["onMenuShareTimeline","onMenuShareAppMessage","getNetworkType","getLocation","openLocation"],i=function(e){wx.config({debug:!1,appId:e.appId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:t}),wx.ready(function(){a.resolve()}),wx.error(function(e){a.reject(JSON.stringify(e))})};return n.fetchOne("getWxConfig",{url:encodeURIComponent([location.protocol,"//",location.host,location.pathname,location.search].join(""))}).then(function(e){i(e)}),a.promise}]),angular.module("xiaomaiApp").factory("locationManager",["$q","$timeout","env","registerWx",function(e,n,o,a){var t=function(){var o=e.defer(),t=n(function(){o.reject("网络超时")},5e3);return a.then(function(){wx.getLocation({type:"wgs84",success:function(e){var a=e.latitude,i=e.longitude;n.cancel(t),o.resolve({lat:a,lng:i})}})},function(e){o.reject(e)}),o.promise};return t}]),angular.module("xiaomaiApp").factory("networkType",["$q","registerWx",function(e,n){return xiaomaiApp}]),angular.module("xiaomaiApp").factory("wxshare",["$q","registerWx",function(e,n){return function(e){n.then(function(){wx.onMenuShareTimeline(e),wx.onMenuShareAppMessage(e)})}}]),angular.module("xiaomaiApp").run(["$templateCache",function(e){e.put("../assets/views/active/active.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-back" ng-click="goback();"></div>\n  <div class="location-info">{{activityShowName}}</div>\n  <div class="iconfont   icon-share icon-locate-right" ng-click="showShareModel();"></div>\n</div>\n\n<div class="activeWrap" down-tip-cls="{{\'skactive-downtip\'}}" xiaomai-iscroll subname="{{\'activeheightstatus\'}}" pubname="{{\'activeiscrollupdate\'}}">\n  <div>\n    <div class="banner">\n      <ks-swiper-container on-ready="onReadySwiper(swiper)" swiper="swiper">\n        <ks-swiper-slide class="swiper-slide" ng-repeat="banner in banners">\n          <div class="activeGoodBanner" ng-click="gotoActive(banner);" ng-style="{\'background-image\':\'url(\'+banner.imageUrl+\')\'}"></div>\n        </ks-swiper-slide>\n      </ks-swiper-container>\n    </div>\n    <ul class="activeGoodList">\n      <li class="errortip" ng-if="haserror">\n        活动已经结束,去其他活动看看吧\n      </li>\n      <li class="loading" ng-if="isloading">\n        正在加载活动商品列表...\n      </li>\n      <li ng-repeat="good in goods">\n        <div class="goodItem" ng-click="gotoDetail(good);">\n          <div class="imgCont" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'>\n            <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n          </div>\n          <div class="details">\n<!-- 输出标签29分钟达/次日达 -->\n            <p class="goodname">{{good.activityGoodsName}}</p>\n            <p class="priceCont">\n<!-- 单品或者组合最高价-->\n              <span class="new-price" ng-if="good.goodsType==1||good.goodsType==2">\n                &yen;<i>{{good.skuList[0].activityPrice|xiaomaiprice}}</i>\n              </span>\n              <span class="old-price" ng-if="good.goodsType==1||good.goodsType==2">\n                &yen;{{good.skuList[0].originPrice|xiaomaiprice}}</span>\n<!-- 聚合 -->\n              <span class="aggregate-price" ng-if="good.goodsType==3">\n                &yen;{{good.minWapPrice|xiaomaiprice}} ~ &yen;{{good.maxWapPrice|xiaomaiprice}}\n              </span>\n            </p>\n            <p class="buy-icon iconfont icon-plus" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,good,$index);" ng-if="good.goodsStatusDisplay!=3"></p>\n            <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n'),e.put("../assets/views/active/nav.active.html",'<div class="errortip" ng-if="haserror">\n  活动已经结束 去其他类目看看吧\n</div>\n<div class="loading" ng-if="isloading">\n  正在加载......\n</div>\n<div class="GoodsCont">\n  <div class="GoodCont" ng-click="gotoDetail(good);" ng-repeat="good in goods">\n    <div class="imgCont" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'></div>\n    <div class="details">\n      <p class="goodname">{{good.activityGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n      <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n      <p class="priceCont">\n<!-- 单品或者组合最高价-->\n        <span class="new-price" ng-if="good.goodsType==1||good.goodsType==2">\n          &yen;<i>{{good.skuList[0].activityPrice|xiaomaiprice}}</i>\n        </span>\n        <span class="old-price" ng-if="good.goodsType==1||good.goodsType==2">\n          &yen;{{good.skuList[0].originPrice|xiaomaiprice}}</span>\n<!-- 聚合 -->\n        <span class="aggregate-price" ng-if="good.goodsType==3">\n          &yen;{{good.minWapPrice|xiaomaiprice}} ~ &yen;{{good.maxWapPrice|xiaomaiprice}}\n        </span>\n      </p>\n      <p class="buy-icon iconfont icon-plus" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,good,$index);" ng-if="good.goodsStatusDisplay!=3"></p>\n      <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/all/all.html",'<ul class="category-active-list" style="">\n  <li class="loading" ng-if="isloading">loading...</li>\n  <li class="errortip" ng-if="haserror">错误提示....</li>\n  <li ng-repeat="item in activities" class="tag-active" ng-click="goto(item);" ng-style="{\'background-image\':\'url(\'+item.wapImageUrl+\')\'}"></li>\n</ul>\n'),e.put("../assets/views/buy/buy.html",'<div ui-view></div>\n<!-- 购物车x-->\n<div class="pub-footer" ng-controller="buy.cartThumbCtrl">\n  <div class="cartThumb" ng-class="{showcart:isShowCart,showdetail:isShowDetail}">\n    <span class="iconfont icon-cart" ng-click="gotoDetail();">\n      <span class="totalCount" ng-class="{big:hasChange}" ng-show="totalCount && totalCount!=0">{{totalCount}}</span>\n    </span>\n    <p class="totalPrice" ng-show="totalCount && totalCount!=0">共计<em>&yen;</em>\n      <span>{{totalPrice|xiaomaiprice}}</span></p>\n    <div class="gotoPay" ng-show="totalCount && totalCount!=0" ng-click="goSettlement();">选好了</div>\n    <p class="emptyTip" ng-show="!totalCount || totalCount==0">购物车是空的,快快选购吧~</p>\n  </div>\n  <div class="cartDetail" ng-class="{\'cartDetail-show\':showcart}" ng-controller="buy.cartDetailCtrl">\n    <span class="goback" ng-click="continueShop();">继续购物<i class=" iconfont icon-YF_more"></i>\n    </span>\n    <div class="cartDetailWrap" subname="{{\'shopcartdetailheightupdate\'}}" xiaomai-iscroll>\n      <div>\n        <div class="haserror" ng-click="goHomepage();" ng-if="haserror">购物车空了 赶快去<span>购物吧</span></div>\n        <div class="good-info" ng-repeat="good in goods">\n          <div class="goodWrap">\n            <p class="good-title">{{good.sourceType==2?good.activityGoodsName:good.bgGoodsName}}</p>\n            <p class="good-price">&yen;{{good.minWapPrice|xiaomaiprice}}</p>\n            <lable class="label" ng-class="{ldc:$index==0,rdc:$index==1}" ng-repeat="distribute in good.distributeTypeDisplay" ng-show="distribute.length">{{distribute}}</lable>\n          </div>\n          <div class="iconWrap">\n            <i class="iconfont icon-minus" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'minus\',$index);"></i>\n            <span class="good-count">{{good.skuList[0].numInCart}}</span>\n            <i class="iconfont icon-plus" ng-class="{paying:goo.isPaying}" ng-click="buyHandler($event,\'plus\',$index);"></i>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="cartDetail-tip">\n      <p class="cartDetail-tip-freight" ng-if="ldcFreight.sub && ldcFreight.sub!=0">29分钟达产品满{{ldcFreight.total|xiaomaiprice}}减{{ldcFreight.sub|xiaomaiprice}}</p>\n      <p ng-click="gotoCoupon();" class="cartDetail-tip-coupon" ng-if="coupons.length">{{coupons.length}}张可用优惠劵<i class="couponMore iconfont icon-YF_more"></i>\n      </p>\n      <p class="cartDetail-tip-coupon" ng-if="!coupons.length">暂无可用优惠劵</p>\n    </div>\n  </div>\n</div>\n<!--遮罩-->\n<div class="mask" mask-gui ng-click="closeMask($event);"></div>\n<div class="shareModel" ng-show="shareIsShow" ng-click="closeShare();"></div>\n\n\n\n<!--商品详情-->\n<div class="goodDetail" ng-class="{\'goodDetail-show\':showdetail}" ng-controller="buy.detailCtrl">\n  <div class="detailCont">\n    <div class="goodIconWrap">\n      <div class="iconfont icon-share" ng-click="showShareModel();"></div>\n      <div class="iconfont icon-unfold" ng-click="closeDetail();"></div>\n    </div>\n    <div class="goodDetailWrap" subname="{{\'detailgoodheightupdate\'}}" xiaomai-iscroll>\n      <div>\n        <div class="imgCont" ng-style="{\'background-image\':\'url(\'+(skuInfo&&skuInfo.imageUrl?skuInfo.imageUrl:good.imageUrl)+\')\'}">\n<!--到达类型-->\n          <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n        </div>\n        <div class="good-normal-info">\n<!--产品名称-->\n          <p class="title">{{good.sourceType==2?good.activityGoodsName:good.bgGoodsName}}</p>\n<!--产品价格-->\n\n          <p class="priceCont" ng-if="skuInfo">\n            <span class="new-price">&yen;<i>{{good.sourceType==2?skuInfo.activityPrice:skuInfo.wapPrice|xiaomaiprice}}</i></span>\n            <span class="old-price">&yen;{{skuInfo.originPrice|xiaomaiprice}}</span>\n          </p>\n          <p class="priceCont" ng-if="!skuInfo">\n            <span class="aggregate-price">&yen;{{good.minWapPrice|xiaomaiprice}}</span>\n            <span class="f14 aggregate-price">\n            ~&yen;{{good.maxWapPrice|xiaomaiprice}}\n            </span>\n          </p>\n<!--普通类活动-->\n          <div ng-if="good.isSeckill!=1">\n<!--如果没有货 显示补货中-->\n            <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n<!--进行数量选择-->\n            <p class="buy-handler-cont " ng-if="good.goodsStatusDisplay!=3">\n              <span class="buy-handler iconfont icon-minus" ng-class="{paying:good.isPaying}" ng-hide="!skuInfo||!numInCart||numInCart<1" ng-click="buyHandler($event,\'minus\');"></span>\n<!--当前已经购买的数量 -->\n              <span class="buy-result">{{numInCart}}</span>\n              <span class="buy-handler iconfont icon-plus buy-icon" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'plus\');"></span>\n            </p>\n          </div>\n<!--秒杀类产品-->\n          <div ng-if="good.isSeckill==1">\n<!--倒计时-->\n            <p class="countdown" ng-if="good.killStarted==0">\n              距开始\n              <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.timeBeforeStart}}" timeid="{{good.activityBgGoodsId}}"></span>\n            </p>\n<!-- 活动已开始同时没有被抢空-->\n            <p class="countdown" ng-if="good.killStarted==1 && good.goodsStatusDisplay!=3">\n              距结束\n              <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.buyLeftTime}}" timeid="{{good.activityBgGoodsId}}"></span>\n            </p>\n<!-- 未开始-->\n            <p class="sold-out" ng-if="good.killStarted==0">未开始</p>\n<!-- 已结束-->\n            <p class="sk-end" ng-if="good.killStarted==2">已结束</p>\n<!-- 已经售空-->\n            <p class="sold-out" ng-if="good.killStarted==1 && good.goodsStatusDisplay==3">抢光了</p>\n<!-- 已经抢过了 -->\n            <p class="sold-geted" ng-if="good.killStarted==1 && good.killed">已抢购</p>\n<!-- 抢购开始 & 没抢购过 & 商品上架状态 -->\n            <p class="sk-icon" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'plus\',true)" ng-if="good.killStarted==1 && !good.killed && good.goodsStatusDisplay==2">抢</p>\n          </div>\n        </div>\n<!--如果是聚合类产品-->\n        <div class="complex-properties" ng-if="good.goodsType==3">\n          <div class="complex-property" ng-repeat="goodProperty in good.skuGoodsPropertyList">\n            <p class="complex-property-name">{{goodProperty.propertyName}}</p>\n            <div class="complex-property-values">\n              <span ng-class="{checked:checkedProperties[goodProperty.propertyNameId]==valueItem.propertyValueId}" ng-click="complexCheckProperty(goodProperty.propertyNameId,valueItem.propertyValueId)" ng-repeat="valueItem in goodProperty.propertyValues">{{valueItem.propertyValue}}</span>\n            </div>\n          </div>\n        </div>\n<!-- 产品描述-->\n        <div class="detail-desc" ng-if="good.goodsDesc && good.goodsDesc.length">\n          <div class="detail-desc-key">产品描述:</div>\n          <div class="detail-desc-main">{{good.goodsDesc}}</div>\n        </div>\n        <div class="detail-desc" ng-if="good.saleSpec && good.saleSpec.length">\n          <div class="detail-desc-key">产品规格:</div>\n          <div class="detail-desc-main">{{good.saleSpec}}/{{good.unit}}</div>\n        </div>\n        <div class="detail-desc" ng-if="good.originPlace && good.originPlace.length">\n          <div class="detail-desc-key">产地:</div>\n          <div class="detail-desc-main">{{good.originPlace}}</div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/category/category.html",'<div class="GoodsCont">\n\n  <div class="errortip" ng-if="haserror">{{errortip}}</div>\n  <div  ng-if="isloading" class="loading">\n      正在加载\n  </div>\n  <div class="banner">\n    <ks-swiper-container swiper="swiper">\n      <ks-swiper-slide class="swiper-slide" ng-repeat="banner in banners">\n        <div class="categoryBanners" ng-click="gotoActive(banner);" ng-style="{\'background-image\':\'url(\'+banner.imageUrl+\')\'}"></div>\n      </ks-swiper-slide>\n    </ks-swiper-container>\n  </div>\n  <div class="GoodCont" ng-repeat="good in goods" ng-click="gotoDetail(good);">\n    <div class="imgCont" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'></div>\n    <div class="details">\n      <p class="goodname">{{good.bgGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n      <label class="label" ng-class="{\'ldc\':$index===0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.trim().length">{{label}}</label>\n      <p class="priceCont">\n<!-- 单品或者组合最高价-->\n        <span class="new-price" ng-if="good.goodsType!=3">\n          &yen;<i>{{good.skuList[0].wapPrice|xiaomaiprice}}</i>\n        </span>\n        <span class="old-price" ng-if="good.goodsType!=3">\n          &yen;{{good.skuList[0].originPrice|xiaomaiprice}}\n        </span>\n<!-- 聚合 -->\n        <span class="aggregate-price" ng-if="good.goodsType==3">\n          &yen;{{good.minWapPrice|xiaomaiprice}} ~ &yen;{{good.maxWapPrice|xiaomaiprice}}\n        </span>\n      </p>\n      <p ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,good,$index);" class="buy-icon iconfont icon-plus" ng-if="good.goodsStatusDisplay!=3"></p>\n      <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/colleges/colleges.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-back" ng-click="goback();"></div>\n  <div class="location-info">选择学校</div>\n  <div class="iconfont icon-locate-right"></div>\n</div>\n<div class="colleges_content" xiaomai-iscroll subname="{{\'collegesheightupdate\'}}">\n  <ul class="countrylist">\n    <li class="loading" ng-if="isloading">学校信息正在加载....</li>\n    <li class="errortip" ng-if="haserror">该城市还没有相关学校</li>\n    <li ng-repeat="country in countrylist" >\n      <p class="countryname">{{country.cityName}}</p>\n      <div ng-class="{holiday:college.isOpen!=1}" class="" ng-click="checkCollege(college)" ng-click="checkCollege(college);" ng-repeat="college in country.colleges">{{college.collegeName}}</div>\n    </li>\n  </ul>\n</div>\n'),e.put("../assets/views/coupon/coupon.html",""),e.put("../assets/views/feedback/feedback.html",'<div class="feedback-wrap">\n  <div class="feedback-head">\n    <div back-icon class="iconfont icon-back icon-left" back-icon ng-click="goBack();"></div>\n    <div class="icon-middle">意见反馈</div>\n  </div>\n  <div class="feedback-main">\n    <div class="textareaCont">\n      <textarea class="feedback-cont" ng-model="feedback" placeholder="您的意见或建议是我们不断前进的巨大动力"></textarea>\n    </div>\n    <input placeholder="请留下您的联系方式(可选)" type="number" ng-model="mobile"/>\n    <div ng-click="submit();" class="icon-right submitBtn">提交</div>\n  </div>\n</div>\n'),e.put("../assets/views/locate/locate.html",'<div class="pub-header">\n  <div class="iconfont icon-back" ng-click="goback();"></div>\n  <div class="location-info">选择学校</div>\n\n  <div class="iconfont icon-locate-right"></div>\n</div>\n<div class="colleges_content" xiaomai-iscroll subname="{{\'locateheightupdate\'}}">\n  <div class="">\n    <p class="title">定位学校</p>\n    <div class="localColleges" ng-class="{locating:isLocating}">\n      <p class="" ng-if="isloading"></p>\n      <p class="locateerrortip" ng-if="haserror">小麦迷路了,手动选择一下吧</p>\n      <p class="locateCollege" ng-class="{holiday:item.isOpen!=1}" ng-click="checkCollege(item)" ng-repeat="item in locationResult">{{item.collegeName}}</p>\n    </div>\n    <p class="title">手动选择</p>\n    <div class="allSchools">\n      <ul class="citylist iconfont">\n        <li ng-class="{checked:item.cityId==curcityid}" ng-click="showCollegeList(item);" ng-repeat="item in citylist">{{item.cityName}}</li>\n      </ul>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/nav/nav.html",'<div class="pub-header" ng-controller="nav.headCtrl">\n  <div class="iconfont icon-feedback" ng-click="gotoFeedback();"></div>\n  <div class="location-info iconfont icon-school" ng-click="gotoLocate();">\n    <i class="locate iconfont"></i>\n    {{schoolname}}\n    <i class="changeLocate"></i>\n  </div>\n  <div class="iconfont icon-user" style="display:none;"></div>\n\n</div>\n<div class="list-main main-both" >\n  <div class="list-category" xiaomai-iscroll subname="{{\'navheightupdate\'}}">\n    <ul ng-controller="nav.listCtrl">\n      <li ng-repeat="nav in navs" ng-class="{\'nav-checked\':navChecked(nav)}" class="nav  nav-super nav-mark-{{nav.labelType}}" ng-click="goto(nav);" ng-if="nav.displayType!=3">{{nav.navigateName}}</li>\n     <li  class="nav nav-parent" ng-init="isShowSub=true;">\n        <p class="arrow-down" ng-class="{\'arrow-up\':!isShowSub}" ng-click="isShowSub=!isShowSub;">聚类导航</p>\n        <ul ng-show="isShowSub">\n          <li ng-click="goto(subnav);" class="nav-sub nav-mark-{{subnav.labelType}}" ng-class="{\'nav-checked\':subnav.categoryId==curcategoryId}" ng-if="subnav.displayType==3" class="nav-sub" ng-repeat="subnav in navs">{{subnav.navigateName}}</li>\n        </ul>\n      </li>\n    </ul>\n  </div>\n  <div class="list-product" up-tip-cls="{{\'navmain-uptip\'}}" down-tip-cls="{{\'navmain-downtip\'}}" xiaomai-iscroll subname="{{\'navmainheightstatus\'}}" pubname="{{\'navmainscrollupdate\'}}">\n      <div ui-view></div>\n  </div>\n</div>\n'),
e.put("../assets/views/notfound/notfound.html",""),e.put("../assets/views/recommend/recommend.html",'<div class="recommendCategoryCont">\n  <div class="errortip" ng-if="haserror">\n    错误提示....\n  </div>\n  <div class="loading" ng-if="isloading">\n    loading...\n  </div>\n  <div class="" ng-repeat="item in categorys">\n    <div class="recommendCateTitle">\n      <h3>{{item.category.categoryName}}</h3>\n      <span class="iconfont icon-unfold" ng-click="gotocategory(item);"></span>\n    </div>\n    <div class="recommendCateColumn">\n      <div class="recommendCateGood" ng-repeat="good in item.goods" ng-click="gotoDetail(good);">\n        <div class="imgCont" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'></div>\n        <div class="details">\n          <p class="goodname">{{good.bgGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n          <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n          <p class="priceCont">\n<!-- 单品或者组合最高价-->\n            <span class="new-price" ng-if="good.goodsType==1||good.goodsType==2">\n              &yen;<i>{{good.skuList[0].wapPrice|xiaomaiprice}}</i>\n            </span>\n            <span class="old-price" ng-if="good.goodsType==1||good.goodsType==2">\n              &yen;{{good.skuList[0].originPrice|xiaomaiprice}}</span>\n<!-- 聚合 -->\n            <span class="aggregate-price" ng-if="good.goodsType==3">\n              &yen;{{good.minWapPrice|xiaomaiprice}} ~ &yen;{{good.maxWapPrice|xiaomaiprice}}\n            </span>\n          </p>\n          <p class="buy-icon iconfont icon-plus" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,good ,$index,$parent.$parent.$index);" ng-if="good.goodsStatusDisplay!=3"></p>\n          <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/root/root.html","<div ui-view></div>\n"),e.put("../assets/views/sharedetail/sharedetail.html",'<style media="screen">\n.shareGoodDetail .goodDetailWrap{\n  position:fixed;\n  left:0;\n  right:0;\n  top:0;\n  bottom:4.5rem;\n}\n\n</style>\n<div class="shareGoodDetail">\n  <div class="goodDetailWrap detailCont" subname="{{\'sharedetailheightupdate\'}}" xiaomai-iscroll>\n    <div>\n      <div class="imgCont" ng-style="{\'background-image\':\'url(\'+(skuInfo&&skuInfo.imageUrl?skuInfo.imageUrl:good.imageUrl)+\')\'}">\n<!--到达类型-->\n        <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n      </div>\n      <div class="good-normal-info">\n<!--产品名称-->\n        <p class="title">{{good.sourceType==2?good.activityGoodsName:good.bgGoodsName}}</p>\n<!--产品价格-->\n        <p class="priceCont" ng-if="skuInfo">\n          <span class="new-price">&yen;<i>{{good.sourceType==2?skuInfo.activityPrice:skuInfo.wapPrice|xiaomaiprice}}</i></span>\n          <span class="old-price">&yen;{{skuInfo.originPrice|xiaomaiprice}}</span>\n        </p>\n        <p class="priceCont" ng-if="!skuInfo">\n          <span class="aggregate-price">&yen;{{good.minWapPrice|xiaomaiprice}}</span>\n          <span class="f14 aggregate-price">\n            ~&yen;{{good.maxWapPrice|xiaomaiprice}}\n          </span>\n        </p>\n<!--普通类活动-->\n        <div ng-if="good.isSeckill!=1">\n<!--如果没有货 显示补货中-->\n          <p class="sold-out" ng-if="good.goodsStatusDisplay==3">补货中</p>\n<!--进行数量选择-->\n          <p class="buy-handler-cont " ng-if="good.goodsStatusDisplay!=3">\n            <span class="buy-handler iconfont icon-minus" ng-click="buyHandler($event,\'minus\');" ng-class="{paying:good.isPaying}" ng-hide="!skuInfo||!numInCart||numInCart<1"></span>\n<!--当前已经购买的数量 -->\n            <span class="buy-result">{{numInCart}}</span>\n            <span class="buy-handler iconfont icon-plus buy-icon"  ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'plus\');"></span>\n          </p>\n        </div>\n<!--秒杀类产品-->\n        <div ng-if="good.isSeckill==1">\n<!--倒计时-->\n          <p class="countdown" ng-if="good.killStarted==0">\n            距开始\n            <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.timeBeforeStart}}" timeid="{{good.activityBgGoodsId}}"></span>\n          </p>\n<!-- 活动已开始同时没有被抢空-->\n          <p class="countdown" ng-if="good.killStarted==1 && good.goodsStatusDisplay!=3">\n            距结束\n            <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.buyLeftTime}}" timeid="{{good.activityBgGoodsId}}"></span>\n          </p>\n<!-- 未开始-->\n          <p class="sold-out" ng-if="good.killStarted==0">未开始</p>\n<!-- 已结束-->\n          <p class="sk-end" ng-if="good.killStarted==2">已结束</p>\n<!-- 已经售空-->\n          <p class="sold-out" ng-if="good.killStarted==1 && good.goodsStatusDisplay==3">抢光了</p>\n<!-- 已经抢过了 -->\n          <p class="sold-geted" ng-if="good.killStarted==1 && good.killed">已抢购</p>\n<!-- 抢购开始 & 没抢购过 & 商品上架状态 -->\n          <p class="sk-icon" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'plus\',true)" ng-if="good.killStarted==1 && !good.killed && good.goodsStatusDisplay==2">抢</p>\n        </div>\n      </div>\n<!--如果是聚合类产品-->\n      <div class="complex-properties" ng-if="good.goodsType==3">\n        <div class="complex-property" ng-repeat="goodProperty in good.skuGoodsPropertyList">\n          <p class="complex-property-name">{{goodProperty.propertyName}}</p>\n          <div class="complex-property-values">\n            <span ng-class="{checked:checkedProperties[goodProperty.propertyNameId]==valueItem.propertyValueId}" ng-click="complexCheckProperty(goodProperty.propertyNameId,valueItem.propertyValueId)" ng-repeat="valueItem in goodProperty.propertyValues">{{valueItem.propertyValue}}</span>\n          </div>\n        </div>\n      </div>\n<!-- 产品描述-->\n      <div class="detail-desc" ng-if="good.goodsDesc && good.goodsDesc.length">\n        <div class="detail-desc-key">产品描述:</div>\n        <div class="detail-desc-main">{{good.goodsDesc}}</div>\n      </div>\n      <div class="detail-desc" ng-if="good.saleSpec && good.saleSpec.length">\n        <div class="detail-desc-key">产品规格:</div>\n        <div class="detail-desc-main">{{good.saleSpec}}/{{good.unit}}</div>\n      </div>\n      <div class="detail-desc" ng-if="good.originPlace && good.originPlace.length">\n        <div class="detail-desc-key">产地:</div>\n        <div class="detail-desc-main">{{good.originPlace}}</div>\n      </div>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/skactive/skactive.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-back" ng-click="goback();"></div>\n  <div class="location-info">{{activityShowName}}</div>\n  <div class="iconfont   icon-share icon-locate-right" ng-click="showShareModel();"></div>\n</div>\n<div class="skWrap" down-tip-cls="{{\'skactive-downtip\'}}" pubname="{{\'skactiveiscrollupdate\'}}" subname="{{\'skactiveheightstatus\'}}" xiaomai-iscroll>\n  <div>\n    <div class="banner">\n      <ks-swiper-container swiper="swiper">\n        <ks-swiper-slide class="swiper-slide" ng-repeat="banner in banners">\n          <div class="skactiveGoodBanner" ng-click="gotoActive(banner);" ng-style="{\'background-image\':\'url(\'+banner.imageUrl+\')\'}"></div>\n        </ks-swiper-slide>\n      </ks-swiper-container>\n    </div>\n    <ul class="skactiveGoodList">\n      <li class="errortip" ng-click="goHomepage();" ng-if="haserror">\n        活动已经结束,去其他活动看看吧\n      </li>\n      <li class="loading" ng-if="isloading">\n        正在加载活动商品列表...\n      </li>\n      <li ng-repeat="good in goods">\n        <div class="goodItem" ng-click="gotoDetail(good);">\n          <div class="imgCont" ng-style=\'{"background-image":"url("+good.imageUrl+")"}\'>\n<!--如果活动未开始-->\n            <p class="countdown" ng-if="good.killStarted==0">\n              距开始\n              <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.timeBeforeStart}}" timeid="{{good.activityBgGoodsId}}"></span>\n            </p>\n<!-- 活动已开始且没有被抢空-->\n            <p class="countdown" ng-if="good.killStarted==1 && good.goodsStatusDisplay!=3">\n              距结束\n              <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.buyLeftTime}}" timeid="{{good.activityBgGoodsId}}"></span>\n            </p>\n          </div>\n          <div class="details">\n            <p class="goodname">{{good.activityGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n            <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay" ng-show="label.length">{{label}}</label>\n            <p class="priceCont">\n<!-- 单品或者组合最高价-->\n              <span class="new-price" ng-if="good.goodsType==1||good.goodsType==2">\n                &yen;<i>{{good.skuList[0].activityPrice|xiaomaiprice}}</i>\n              </span>\n              <span class="old-price" ng-if="good.goodsType==1||good.goodsType==2">\n                &yen;{{good.skuList[0].originPrice|xiaomaiprice}}</span>\n            </p>\n<!-- 未开始-->\n            <p class="sold-geted" ng-if="good.killStarted==0">未开始</p>\n<!-- 已结束-->\n            <p class="sk-end" ng-if="good.killStarted==2">已结束</p>\n<!-- 已经售空-->\n            <p class="sold-out" ng-if="good.killStarted==1 && good.goodsStatusDisplay==3">抢光了</p>\n<!-- 已经抢过了 -->\n            <p class="sold-geted" ng-if="good.killStarted==1 && good.killed">已抢购</p>\n<!-- 抢购开始 & 没抢购过 & 商品上架状态 -->\n            <p class="sk-icon" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,good,$index);" ng-if="good.killStarted==1 && !good.killed && good.goodsStatusDisplay==2">抢</p>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n')}]),angular.module("xiaomaiApp").directive("xiaomaiIscroll",["xiaomaiMessageNotify","$timeout","$state",function(e,n,o){var a=function(o,a,t){var i,s=document.createElement("p");s.className+=" "+o.upTipCls;var r=document.createElement("p");r.className+=" "+o.downTipCls;var c=new IScroll(a[0],{click:!0,tap:!0,probeType:2}),l=function(e,n){var o=a.children()[0];s.textContent=e,r.textContent=n,s.className=s.className.replace("pending","").trim(),r.className=r.className.replace("pending","").trim(),o.firstChild!=s&&o.insertBefore(s,o.firstChild),o.lastChild!=r&&o.appendChild(r)};o.scrollstatus="ready",c.on("scrollStart",function(){});var d,u,g=setTimeout(function(){var e=a.children()[0];u=e.offsetHeight-a[0].offsetHeight,c&&c.refresh()},1e3);c.on("scroll",function(){return"ready"!==o.scrollstatus?!1:void(this.y>40?(d&&clearTimeout(d),d=setTimeout(function(){e.pub(o.pubname,"up"),o.scrollstatus="pending"},10)):Math.abs(this.y)>u+15&&(d&&clearTimeout(d),d=setTimeout(function(){e.pub(o.pubname,"down"),o.scrollstatus="pending"},10)))}),o.subname&&e.sub(o.subname,function(n,t,i,d){var p=a.children()[0];"up"==n?"ready"==t?(o.scrollstatus="ready",g&&clearTimeout(g),g=null,setTimeout(function(){c&&c.refresh(),u=p.offsetHeight-a[0].offsetHeight,c.scrollTo(0,0),l(i,d)},50)):(o.scrollstatus="pending",s.className=s.className+" pending",s.textContent=i):"down"==n&&("ready"==t?(o.scrollstatus="ready",g&&clearTimeout(g),g=null,setTimeout(function(){c&&c.refresh(),u=p.offsetHeight-a[0].offsetHeight,l(i,d),e.pub("navmainscrollupdate","down")},500)):(o.scrollstatus="pending",r.className=r.className+" pending",r.textContent=i))}),o.$on("$destroy",function(){c&&c.destroy(),n.cancel(i),c=null,e.remove(o.subname)})};return{scope:{pubname:"@",subname:"@",options:"@",upTipCls:"@",downTipCls:"@"},link:a}}]),angular.module("xiaomaiApp").directive("countdown",["$interval",function(e){function n(e){var n,o,a,t=function(e){return 10>e?"0"+e:e},i=3600,s=60,r=1;return e=Number(e),n=Math.floor(e/i),e%=i,o=Math.floor(e/s),e%=s,a=Math.floor(e/r),[t(n),t(o),t(a)].join(":")}var o=function(o,a,t){var i=o.counttime,s=e(function(){return 0==i?(e.cancel(s),o.countDeadCall({timeid:o.timeid}),!1):(i-=1,void a.html(n(i)))},1e3)};return{template:"<span></span>",scope:{counttime:"@",timeid:"@",countDeadCall:"&"},link:o,replace:!0}}]),angular.module("xiaomaiApp").controller("buy.activeCtrl",["$scope","$state","xiaomaiService","buyProcessManager","xiaomaiCacheManager","xiaomaiMessageNotify","wxshare","getRouterTypeFromUrl",function(e,n,o,a,t,i,s,r){var c,l,d,u=function(){return o.fetchOne("activeBanner",{collegeId:c,activityId:l})},g=function(){s({title:e.activityShowName})},p=function(){return o.fetchOne("activeGoods",{collegeId:c,activityId:l,currentPage:d,recordPerPage:10})};c=n.params.collegeId,l=n.params.activityId,d=n.params.page||1,e.isloading=!0,p().then(function(n){e.activityShowName=n.activityShowName,e.goods=n.goods,e.paginationInfo=n.paginationInfo,e.haserror=e.goods.length?!1:!0},function(){e.haserror=!0})["finally"](function(){e.isloading=!1;var n=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("activeheightstatus","up","ready","",n?"请求下一页数据":""),g()});var v=i.sub("detailGuiManager",function(e){"hide"==e&&setTimeout(function(){g()},100)}),f=i.sub("activeiscrollupdate",function(n){"down"==n&&e.paginationInfo.currentPage!=e.paginationInfo.totalPage&&(i.pub("activeheightstatus","down","pending","","正在请求数据"),!m&&y().then(function(n){var o=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("activeheightstatus","down","ready","",o?"请求下一页数据":"")}))});e.$on("$destroy",function(){i.removeOne("activeiscrollupdate",f),i.removeOne("detailGuiManager",v)}),u().then(function(n){return e.banners=n.banners,n}),e.showShareModel=function(){i.pub("shareModelManager","show"),i.pub("maskManager","show")},e.goback=function(){n.go("root.buy.nav.all")},e.gotoActive=function(e){var o=r(e.hrefUrl);return o.hasOwnProperty("path")?window.location.href=o.path:n.go(o.name,o.params),!1},e.gotoDetail=function(e){return i.pub("detailGuiManager","show",e.activityGoodsId,e.sourceType),!1},e.buyHandler=function(n,o,t){return 3==o.goodsType?(e.gotoDetail(o),n.stopPropagation(),!1):(e.goods[t].isPaying=!0,a({distributeType:o.skuList[0].distributeType,goodsId:o.activityGoodsId,sourceType:o.sourceType,skuId:o.skuList[0].activitySkuId,price:o.skuList[0].activityPrice,propertyIds:""},"plus",Math.min(o.maxNum,o.skuList[0].stock)).then(function(){},function(e){return alert(e),!1})["finally"](function(){e.goods[t].isPaying=!1}),void n.stopPropagation())};var m=!1,y=function(){return m?!1:(m=!0,o.fetchOne("activeGoods",{collegeId:c,activityId:l,recordPerPage:10,currentPage:e.paginationInfo.currentPage+1}).then(function(n){return m=!1,e.paginationInfo=n.paginationInfo,e.goods=e.goods.concat(n.goods),n}))}}]),angular.module("xiaomaiApp").controller("nav.activeCtrl",["$scope","$state","xiaomaiService","buyProcessManager","xiaomaiCacheManager","xiaomaiMessageNotify","getRouterTypeFromUrl",function(e,n,o,a,t,i,s){var r,c,l,d=function(){return o.fetchOne("activeBanner",{collegeId:r,activityId:c})},u=function(){return o.fetchOne("activeGoods",{collegeId:r,activityId:c,currentPage:l,recordPerPage:10})};r=n.params.collegeId,c=n.params.activityId,l=n.params.page||1,e.isloading=!0;u().then(function(n){e.haserror=n.goods.length?!1:!0,e.goods=n.goods,e.paginationInfo=n.paginationInfo},function(){e.haserror=!0})["finally"](function(){e.isloading=!1;var n=e.paginationInfo.currentPage==e.paginationInfo.totalPage,o=n?"":"请求下一页数据";i.pub("navmainheightstatus","up","ready","",o)}),d().then(function(n){return e.banners=n.banners,n}),e.gotoDetail=function(e){return i.pub("detailGuiManager","show",e.activityGoodsId,e.sourceType),!1};var g=i.sub("navmainscrollupdate",function(n){return"up"==n?!1:e.paginationInfo.currentPage==e.paginationInfo.totalPage?!1:(i.pub("navmainheightstatus","down","pending","正在请求数据..."),void(!p&&v().then(function(n){var o=e.paginationInfo.currentPage==e.paginationInfo.totalPage,a=o?"":"请求下一页数据";i.pub("navmainheightstatus","down","ready","",a)})))}),p=!1,v=function(){return p?!1:(p=!0,o.fetchOne("activeGoods",{collegeId:r,activityId:c,recordPerPage:10,currentPage:e.paginationInfo.currentPage+1}).then(function(n){return p=!1,e.paginationInfo=n.paginationInfo,e.goods=e.goods.concat(n.goods),n}))};e.$on("$destroy",function(){i.removeOne("navmainscrollupdate",g)}),e.buyHandler=function(n,o,t){return 3==o.goodsType?(e.gotoDetail(o),n.stopPropagation(),!1):(e.goods[t].isPaying=!0,a({distributeType:o.skuList[0].distributeType,goodsId:o.activityGoodsId,sourceType:o.sourceType,skuId:o.skuList[0].activitySkuId,price:o.skuList[0].activityPrice,propertyIds:""},"plus",Math.min(o.maxNum,o.skuList[0].stock)).then(function(){},function(e){return alert(e),!1})["finally"](function(){e.goods[t].isPaying=!1}),void n.stopPropagation())},e.pagination=function(e){}}]),angular.module("xiaomaiApp").controller("buyCtrl",["$state","$scope","schoolManager","$q","xiaomaiMessageNotify",function(e,n,o,a,t){n.$on("$stateChangeSuccess",function(n,a,t){o.get().then(function(n){"root.buy"==a.name&&e.go("root.buy.nav.all")},function(){e.go("root.locate")})}),n.closeMask=function(e){t.pub("cartGuiManager","hide"),t.pub("detailGuiManager","hide"),t.pub("shareModelManager","hide"),e.preventDefault()},n.closeShare=function(){t.pub("shareModelManager","hide"),"show"!=i&&"show"!=s&&t.pub("maskManager","hide")};var i,s,r=t.sub("detailGuiManager",function(e){i=e}),c=t.sub("cartGuiManager",function(e){s=e}),l=t.sub("shareModelManager",function(e){n.shareIsShow="show"==e?!0:!1});n.$on("$destroy",function(){t.removeOne("cartGuiManager",c),t.removeOne("detailGuiManager",r),t.removeOne("shareModelManager",l)}),n.$on("$stateChangeStart",function(e,n,o,a,r){("show"==i||"show"==s)&&(t.pub("detailGuiManager","hide"),t.pub("cartGuiManager","hide"),e.preventDefault())})}]),angular.module("xiaomaiApp").controller("buy.detailCtrl",["$scope","$state","xiaomaiService","getSkuInfo","skuListToObject","buyProcessManager","xiaomaiMessageNotify","cartManager","wxshare",function(e,n,o,a,t,i,s,r,c){var l,d;e.numInCart=0;var u=s.sub("detailGuiManager",function(n,o,a){"show"==n?(l=o,d=a,p(l,d).then(function(n){if(e.good=n,e.showdetail=!0,3!=e.good.goodsType){e.skuInfo=e.good.skuList[0];var o=1==e.good.sourceType?e.skuInfo.skuId:e.skuInfo.activitySkuId;return r.getnumInCart(o,e.good.sourceType)}e.skuInfo=!1,e.checkedProperties={},e.skuObject=v(e.good.skuList)}).then(function(n){return angular.isNumber(n)&&(e.numInCart=n)})["finally"](function(){g(),s.pub("detailgoodheightupdate","up","ready","","")})):(e.showdetail=!1,c({title:"",url:"",imgUrl:"",success:"",cancel:""})),s.pub("maskManager",n)}),g=function(){var n=2==e.good.sourceType?e.good.activityGoodsName:e.good.bgGoodsName,o=["http://",window.location.host,window.location.pathname,window.location.search,"#/buy/sharedetail/","?goodId=",l,"&sourceType=",d].join(""),a=e.good.iconImageUrl,t=function(){},i=function(){};c({title:n,link:o,imgUrl:a,success:t,cancel:i})};e.$on("$destroy",function(){s.removeOne("detailGuiManager",u)});var p=function(e,n){return o.fetchOne("goodDetail",{goodsId:e,sourceType:n})},v=function(e){return t(e)};e.complexCheckProperty=function(n,o){e.checkedProperties[n]=o;var t=a(e.checkedProperties,e.skuObject);if(e.skuInfo=0==t?!1:t,e.skuInfo){var i=1==e.good.sourceType?e.skuInfo.skuId:e.skuInfo.activitySkuId;r.getnumInCart(i,e.good.sourceType).then(function(n){e.numInCart=n})}else e.numInCart=0},e.showShareModel=function(){s.pub("shareModelManager","show")},e.buyHandler=function(n,o,a){var t=[];if(!e.skuInfo)return alert("请选择商品规格"),!1;angular.forEach(e.checkedProperties,function(e){t.push(e)}),t=t.join("_");var s=2==d?{goodsId:e.good.activityGoodsId,sourceType:2,skuId:e.skuInfo.activitySkuId,distributeType:e.skuInfo.distributeType,price:e.skuInfo.activityPrice,propertyIds:""}:{goodsId:l,sourceType:d,skuId:e.skuInfo.skuId,distributeType:e.skuInfo.distributeType,price:e.skuInfo.wapPrice,propertyIds:t};e.good.isPaying=!0,i(s,o,Math.min(e.good.maxNum,e.skuInfo.stock),e.numInCart).then(function(n){e.numInCart=n,2==e.good.soruceType&&(e.good.killed=!0,alert("抢购成功,赶紧去下单吧!"))},function(e){return alert(e),!1}).then(function(){e.good.isPaying=!1}),n.preventDefault(),n.stopPropagation()},e.timecountdown=function(n){0===e.good.killStarted?(e.good.killStarted=1,e.good.beginTime=-1):1===e.good.killStarted&&(e.good.killStarted=2,e.good.buyLeftTime=-1)},e.closeDetail=function(){s.pub("detailGuiManager","hide")}}]),angular.module("xiaomaiApp").controller("buy.cartThumbCtrl",["$state","$scope","xiaomaiService","cartManager","$timeout","xiaomaiMessageNotify","env",function(e,n,o,a,t,i,s){a.query(function(e){n.totalCount=e.totalCount,n.totalPrice=e.totalPrice;var o=a.readCartCache();n.hasChange=o.totalCount&&o.totalCount==n.totalCount?!1:!0,n.hasChange&&t(function(){n.hasChange=!1},200)}),i.sub("cartGuiManager",function(e){n.isShowCart="show"==e}),i.sub("detailGuiManager",function(e){n.isShowDetail="show"==e}),n.goSettlement=function(){var e="online"==s?"http://h5.imxiaomai.com":"http://wap.tmall.imxiaomai.com";window.location.href=e+"/order/create"},n.gotoDetail=function(){return n.totalCount&&0!=n.totalCount?(i.pub("detailGuiManager","hide"),void i.pub("cartGuiManager","show")):!1},n.$on("$destroy",function(){a.store(!1)})}]),angular.module("xiaomaiApp").controller("buy.cartDetailCtrl",["$state","$scope","xiaomaiService","cookie_openid","buyProcessManager","xiaomaiMessageNotify","cartManager","env","xiaomaiCacheManager",function(e,n,o,a,t,i,s,r,c){var l=i.sub("cartGuiManager",function(e){"show"==e&&d().then(function(e){return n.goods=e.goods,n.ldcFreight=e.ldcFreight,n.haserror=!1,u()},function(){n.haserror=!0}).then(function(e){c.writeCache("mycoupon",e);var o=[];angular.forEach(e.couponInfo,function(e){0===e.status&&o.push(o)}),n.coupons=o})["finally"](function(){i.pub("shopcartdetailheightupdate","up","ready","","")}),n.showcart="show"==e?!0:!1,i.pub("maskManager",e)});n.$on("destory",function(){i.removeOne("cartGuiManager",l)}),n.gotoCoupon=function(){var e="online"==r?"http://h5.imxiaomai.com":"http://wap.tmall.imxiaomai.com";return window.location.href=e+"/couponwap/myCouponList/webwiew",!1},n.continueShop=function(){i.pub("cartGuiManager","hide")},n.goHomepage=function(){e.go("root.buy.nav.all",{showCart:!1})};var d=function(){return s.queryCartDetail()},u=function(){return o.fetchOne("mycoupon",{openId:a,type:1})};n.buyHandler=function(e,o,a){var s=n.goods[a],r=s.sourceType,c=s.skuList[0],l=2==r?{goodsId:s.activityGoodsId,sourceType:2,skuId:c.activitySkuId,distributeType:c.distributeType,price:c.activityPrice,propertyIds:c.skuPropertyValueIdList||""}:{goodsId:s.goodsId,sourceType:s.sourceType,distributeType:c.distributeType,skuId:c.skuId,price:c.wapPrice,propertyIds:c.skuPropertyValueIdList||""},s=n.goods[a];n.goods[a].isPaying=!0,t(l,o,Math.min(s.maxNum,s.skuList[0].stock),s.skuList[0].numInCart).then(function(e){s.skuList[0].numInCart=e,n.goods[a]&&(n.goods[a].isPaying=!1),0==s.skuList[0].numInCart&&(n.goods.splice(a,1),i.pub("shopcartdetailheightupdate","up","ready","",""))},function(e){alert(e)}),e.stopPropagation(),e.preventDefault()}}]),angular.module("xiaomaiApp").controller("nav.categoryCtrl",["$state","xiaomaiService","$scope","xiaomaiCacheManager","buyProcessManager","xiaomaiMessageNotify","getRouterTypeFromUrl",function(e,n,o,a,t,i,s){var r,c;o.$on("$stateChangeSuccess",function(e,n,o){r=o.collegeId,c=o.categoryId,l(),d()});o.isloading=!0;var l=function(){n.fetchOne("goods",{collegeId:r,categoryId:c,recordPerPage:10}).then(function(e){o.goods=e.goods,o.paginationInfo=e.paginationInfo,o.haserror=!1},function(e){o.haserror=!0,o.errortip=e})["finally"](function(){o.isloading=!1;var e=o.paginationInfo.currentPage==o.paginationInfo.totalPage,n=e?"":"请求下一页数据";i.pub("navmainheightstatus","up","ready","",n)},function(e){o.errorip=e,o.haserror=!0})},d=function(){n.fetchOne("categoryBanners",{categoryId:c,collegeId:r}).then(function(e){o.banners=e.banners})};o.gotoActive=function(n){var o=s(n.hrefUrl);return o.hasOwnProperty("path")?window.location.href=o.path:e.go(o.name,o.params),!1};var u=i.sub("navmainscrollupdate",function(e){return"up"==e?!1:o.paginationInfo.currentPage==o.paginationInfo.totalPage?!1:(i.pub("navmainheightstatus","down","pending","正在请求数据..."),void(!g&&p().then(function(e){var n=o.paginationInfo.currentPage==o.paginationInfo.totalPage,a=n?"":"请求下一页数据";i.pub("navmainheightstatus","down","ready","",a)})))}),g=!1,p=function(){return g?!1:(g=!0,n.fetchOne("goods",{collegeId:r,categoryId:c,recordPerPage:10,currentPage:o.paginationInfo.currentPage+1}).then(function(e){return g=!1,o.paginationInfo=e.paginationInfo,o.goods=o.goods.concat(e.goods),e}))};o.$on("$destroy",function(){i.removeOne("navmainscrollupdate",u)}),o.gotoDetail=function(e){return i.pub("detailGuiManager","show",e.goodsId,e.sourceType),!1},o.buyHandler=function(e,n,a){return 3==n.goodsType?(o.gotoDetail(n),e.stopPropagation(),!1):(o.goods[a].isPaying=!0,t({goodsId:n.goodsId,sourceType:n.sourceType,distributeType:n.skuList[0].distributeType,skuId:n.skuList[0].skuId,price:n.skuList[0].wapPrice,propertyIds:""},"plus",Math.min(n.maxNum,n.skuList[0].stock)).then(function(e){},function(e){alert(e)})["finally"](function(){o.goods[a].isPaying=!1}),void e.stopPropagation())}}]),angular.module("xiaomaiApp").controller("nav.allCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiMessageNotify","xiaomaiCacheManager","siblingsNav",function(e,n,o,a,t,i,s){e.activities=[];var r;e.isloading=!0,a.get().then(function(e){return r=e.collegeId,o.fetchOne("activities",{collegeId:r})}).then(function(n){e.haserror=!1,e.activities=n.activities},function(n){e.haserror=!0})["finally"](function(){e.isloading=!1,t.pub("navmainheightstatus","up","ready","","")}),e.$on("$destory",function(){i.writeCache("activities",{activities:e.activities})}),e["goto"]=function(e){if("1"==e.isLinkUrl)return window.location.href=e.linkUrl,!1;var o="";switch(e.activityType){case 1:o="root.buy.active";break;default:o="root.buy.skactive"}n.go(o,{collegeId:r,activityId:e.activityId})}}]),angular.module("xiaomaiApp").controller("buy.couponCtrl",["$state","$scope","xiaomaiService",function(e,n,o){o.fetchOne("mycoupon",{}).then(function(e){})}]),angular.module("xiaomaiApp").controller("positionCtrl",["$scope","locationManager","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify",function(e,n,o,a,t,i,s){e.locationResult=[],e.isloading=!0,n().then(function(e){return a.fetchOne("locate",{latitude:e.lat,longitude:e.lng})}).then(function(n){e.haserror=!1,e.locationResult=n.colleges},function(n){e.haserror=!0})["finally"](function(){e.isloading=!1}),e.citylist=[],e.isloading=!0,a.fetchOne("citylist",{},!0).then(function(n){e.citylist=n.cities,i.writeCache("citylist",n),e.haserror=!1},function(){e.haserror=!0})["finally"](function(){e.isloading=!1,s.pub("locateheightupdate","up","ready","","")}),e.showCollegeList=function(e){o.go("root.colleges",{cityid:e.cityId})},e.$on("$stateChangeSuccess",function(n,o,a){e.curcityid=a.cityid}),e.checkCollege=function(e){t.set(e).then(function(){return i.clean("navgatorlist"),!0}).then(function(){o.go("root.buy.nav.all")})},e.goback=function(){o.go("root.buy.nav.all")}}]),angular.module("xiaomaiApp").controller("collegesCtrl",["$state","$scope","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify",function(e,n,o,a,t,i){n.countrylist=[],n.$on("$stateChangeSuccess",function(e,n,o){var a=o.cityid;s(a)}),n.isloading=!0;var s=function(e){o.fetchOne("collegelist",{cityId:e}).then(function(e){n.haserror=e.cities.length?!1:!0,n.countrylist=e.cities},function(e){n.haserror=!0})["finally"](function(){i.pub("collegesheightupdate","up","ready","",""),n.isloading=!1})};n.checkCollege=function(n){a.set(n).then(function(){return t.clean("navgatorlist"),!0}).then(function(){e.go("root.buy.nav.all")})},n.goback=function(){e.go("root.locate")}}]),angular.module("xiaomaiApp").controller("feedbackCtrl",["$scope","$state","xiaomaiService",function(e,n,o){e.goBack=function(){n.go("root.buy.nav.all")},e.feedback="",e.mobile="";var a=/^(\+86)?1[3|4|5|8][0-9]\d{4,8}$/g;e.submit=function(){var t=e.feedback,i=e.mobile;return t=t.trim&&t.trim(),t&&t.length?i.length&&!a.test(i)?(alert("手机号有误,请确认"),!1):void o.save("feedback",{mobile:i,feedback:t}).then(function(){alert("提交成功!谢谢!"),n.go("root.buy.nav.all")},function(e){alert("提交失败,请重新尝试!\n失败原因:"+e)}):(alert("请输入您的建议或意见"),!1)}}]),angular.module("xiaomaiApp").controller("navCtrl",["$scope","$state",function(e,n){}]),angular.module("xiaomaiApp").controller("nav.headCtrl",["$scope","$state","schoolManager",function(e,n,o){o.get().then(function(n){e.schoolname=n.collegeName}),e.gotoLocate=function(){n.go("root.locate")},e.gotoFeedback=function(){n.go("root.feedback")}}]),angular.module("xiaomaiApp").controller("nav.listCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify",function(e,n,o,a,t,i){e.navs=[],a.get().then(function(e){return o.fetchOne("navgatorlist",{collegeId:e.collegeId})}).then(function(n){e.navs=n.navigateItems,i.pub("navheightupdate","up","ready","",""),t.writeCache("navgatorlist",n)}),e.paths={0:"root.buy.nav.all",1:"root.buy.nav.recommend",2:"root.buy.nav.active",3:"root.buy.nav.category"},e.navChecked=function(n){var o=!1;switch(e.curpath){case"all":o=0==n.displayType;break;case"recommend":o=1==n.displayType;break;case"active":o=e.activityId==n.activityId;break;case"skactive":o=e.activityId==n.activityId;break;case"category":o=e.curcategoryId==n.categoryId}return o},e.$on("$stateChangeSuccess",function(n,o,a){e.type=a.type;var t=/nav\.(\w+)/,i=o.name.match(t);e.curcategoryId=a.categoryId,e.activityId=a.activityId,i&&i.length&&(e.curpath=i[1])}),e["goto"]=function(o){a.get().then(function(a){var t,i=a.collegeId,s=o.displayType;o.activityType;t=e.paths[s],n.go(t,{categoryId:o.categoryId,activityId:o.activityId,collegeId:i,showDetail:!1,showCart:!1})})}}]),angular.module("xiaomaiApp").controller("nav.recommendCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","buyProcessManager","siblingsNav",function(e,n,o,a,t,i,s,r){var c;e.isloading=!0;a.get().then(function(e){return c=e.collegeId,o.fetchOne("categoryGoods",{collegeId:c})}).then(function(n){e.categorys=n,e.haserror=!1},function(){e.haserror=!0})["finally"](function(n){e.isloading=!1,i.pub("navmainheightstatus","up","ready","","")}),e.$on("$destroy",function(){t.writeCache("categoryGoods",e.categorys)}),e.gotocategory=function(e){n.go("root.buy.nav.category",{collegeId:c,categoryId:e.category.categoryId})},e.gotoDetail=function(e){i.pub("detailGuiManager","show",e.goodsId,e.sourceType)},e.buyHandler=function(n,o,a,t){return 3==o.goodsType?(e.gotoDetail(o),n.stopPropagation(),!1):(e.categorys[t].goods[a].isPaying=!0,s({goodsId:o.goodsId,sourceType:o.sourceType,distributeType:o.skuList[0].distributeType,skuId:o.skuList[0].skuId,price:o.skuList[0].wapPrice,propertyIds:""},"plus",Math.min(o.maxNum,o.skuList[0].stock)).then(function(){},function(e){alert(e)})["finally"](function(){e.categorys[t].goods[a].isPaying=!1}),void n.stopPropagation())}}]),angular.module("xiaomaiApp").controller("buy.skactiveCtrl",["$scope","$state","xiaomaiService","buyProcessManager","xiaomaiCacheManager","xiaomaiMessageNotify","wxshare","getRouterTypeFromUrl",function(e,n,o,a,t,i,s,r){var c,l,d=1,u=function(){return o.fetchOne("activeBanner",{collegeId:c,activityId:l})};e.goods=[];var g=function(){return o.fetchOne("activeGoods",{collegeId:c,activityId:l,currentPage:d,recordPerPage:10})},p=function(){s({title:e.activityShowName})},v=!1,f=function(){return v?!1:(v=!0,o.fetchOne("activeGoods",{collegeId:c,activityId:l,currentPage:e.paginationInfo.currentPage+1,recordPerPage:10}).then(function(n){return v=!1,e.paginationInfo=n.paginationInfo,e.goods=e.goods.concat(n.goods),n}))};c=n.params.collegeId,l=n.params.activityId,d=n.params.page||1,e.isloading=!0,g().then(function(n){e.activityShowName=n.activityShowName,
e.goods=n.goods,e.paginationInfo=n.paginationInfo,e.haserror=e.goods.length?!1:!0},function(){e.haserror=!0})["finally"](function(){e.isloading=!1;var n=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("skactiveheightstatus","up","ready","",n?"请求下一页数据":""),p()}),u().then(function(n){return e.banners=n.banners,n});var m=i.sub("detailGuiManager",function(e){"hide"==e&&setTimeout(function(){p()},100)}),y=i.sub("skactiveiscrollupdate",function(n){"down"==n&&e.paginationInfo.currentPage!=e.paginationInfo.totalPage&&(i.pub("skactiveheightstatus","down","pending","","正在请求数据"),!v&&f().then(function(n){var o=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("skactiveheightstatus","up","ready","",o?"请求下一页数据":"")}))});e.$on("$destroy",function(){i.removeOne("skactiveiscrollupdate",y),i.removeOne("detailGuiManager",m)}),e.goback=function(){n.go("root.buy.nav.all")},e.gotoActive=function(e){var o=r(e.hrefUrl);return o.hasOwnProperty("path")?window.location.href=o.path:n.go(o.name,o.params),!1},e.gotoDetail=function(e){return i.pub("detailGuiManager","show",e.activityGoodsId,e.sourceType),!1},e.showShareModel=function(){i.pub("shareModelManager","show"),i.pub("maskManager","show")},e.buyHandler=function(n,o,t){e.goods[t].isPaying=!0,a({goodsId:o.activityGoodsId,sourceType:2,distributeType:o.skuList[0].distributeType,skuId:o.skuList[0].activitySkuId,price:o.skuList[0].activityPrice,propertyIds:""},"plus",Math.min(o.maxNum,o.skuList[0].stock)).then(function(){alert("赶快去下单吧\n否则可能会被其他人抢走了哦"),e.goods[t].killed=!0},function(e){return alert(e),!1})["finally"](function(){e.goods[t].isPaying=!1}),n.stopPropagation()},e.timecountdown=function(n){var o;angular.forEach(e.goodsList,function(e,a){return e.activityBgGoodsId===Number(n)?(o=a,!1):void 0}),0===e.goods[o].killStarted?(e.goods[o].killStarted=1,e.goods[o].beginTime=-1):1===e.goodsList[o].killStarted&&(e.goods[o].killStarted=2,e.goods[o].buyLeftTime=-1)}}]),angular.module("xiaomaiApp").controller("sharedetailCtrl",["$scope","$state","xiaomaiService","getSkuInfo","skuListToObject","buyProcessManager","cartManager",function(e,n,o,a,t,i,s){var r,c;e.numInCart=0,e.$on("$stateChangeSuccess",function(n,o,a){r=a.goodId,c=a.sourceType,l(r,c).then(function(n){if(e.good=n,3!=e.good.goodsType){e.skuInfo=e.good.skuList[0];var o=1==e.good.sourceType?e.skuInfo.skuId:e.skuInfo.activitySkuId;return s.getnumInCart(o,e.good.sourceType)}e.skuInfo=!1,e.checkedProperties={},e.skuObject=d(e.good.skuList)}).then(function(n){angular.isNumber(n)&&(e.numInCart=n)})["finally"](function(){xiaomaiMessageNotify.pub("sharedetailheightupdate","up","ready","","")})});var l=function(e,n){return o.fetchOne("goodDetail",{goodsId:e,sourceType:n})},d=function(e){return t(e)};e.complexCheckProperty=function(n,o){e.checkedProperties[n]=o;var t=a(e.checkedProperties,e.skuObject);if(e.skuInfo=0==t?!1:t,e.skuInfo){var i=1==e.good.sourceType?e.skuInfo.skuId:e.skuInfo.activitySkuId;s.getnumInCart(i,e.good.sourceType).then(function(n){e.numInCart=n})}else e.numInCart=0},e.buyHandler=function(n,o,a){var t=[];if(!e.skuInfo)return alert("请选择商品规格"),!1;angular.forEach(e.checkedProperties,function(e){t.push(e)}),t=t.join("_");var s=2==c?{goodsId:e.good.activityGoodsId,sourceType:2,skuId:e.skuInfo.activitySkuId,distributeType:e.skuInfo.distributeType,price:e.skuInfo.activityPrice,propertyIds:""}:{goodsId:r,sourceType:c,skuId:e.skuInfo.skuId,distributeType:e.skuInfo.distributeType,price:e.skuInfo.wapPrice,propertyIds:t};e.good.isPaying=!0,i(s,o,Math.min(e.good.maxNum,e.skuInfo.stock),e.numInCart).then(function(n){e.numInCart=n,2==e.good.soruceType&&(e.good.killed=!0,alert("抢购成功,赶紧去下单吧!"))},function(e){return alert(e),!1}).then(function(){e.good.isPaying=!1}),n.preventDefault(),n.stopPropagation()},e.timecountdown=function(n){0===e.good.killStarted?(e.good.killStarted=1,e.good.beginTime=-1):1===e.good.killStarted&&(e.good.killStarted=2,e.good.buyLeftTime=-1)}}]);