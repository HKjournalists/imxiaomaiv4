angular.module("xiaomaiApp",window.__SYS_CONF.dependent_modules),angular.module("xiaomaiApp").config(["$stateProvider","$urlRouterProvider",function(e,n){e.state("root",{url:"/",templateUrl:"../assets/views/root/root.html"}).state("root.buy",{url:"buy/",controller:"buyCtrl",templateUrl:"../assets/views/buy/buy.html"}).state("root.buy.nav",{url:"nav/",templateUrl:"../assets/views/nav/nav.html"}).state("root.buy.nav.all",{url:"all/",templateUrl:"../assets/views/all/all.html",controller:"nav.allCtrl"}).state("root.buy.nav.recommend",{url:"recommend/",controller:"nav.recommendCtrl",templateUrl:"../assets/views/recommend/recommend.html"}).state("root.buy.nav.active",{url:"active/?collegeId&activityId",controller:"nav.activeCtrl",templateUrl:"../assets/views/active/nav.active.html"}).state("root.buy.active",{url:"active/?collegeId&activityId&refer",controller:"buy.activeCtrl",templateUrl:"../assets/views/active/active.html"}).state("root.buy.nav.category",{url:"category/?collegeId&categoryId",controller:"nav.categoryCtrl",templateUrl:"../assets/views/category/category.html"}).state("root.locate",{url:"locate/",controller:"positionCtrl",templateUrl:"../assets/views/locate/locate.html"}).state("root.colleges",{url:"colleges/?cityid",controller:"collegesCtrl",templateUrl:"../assets/views/colleges/colleges.html"}).state("root.buy.sharedetail",{url:"sharedetail/?goodId&sourceType&collegeId",controller:"sharedetailCtrl",templateUrl:"../assets/views/sharedetail/sharedetail.html"}).state("root.buy.coupon",{url:"coupon/",controller:"buy.couponCtrl",templateUrl:"../assets/views/coupon/coupon.html"}).state("root.feedback",{url:"feedback",controller:"feedbackCtrl",templateUrl:"../assets/views/feedback/feedback.html"}).state("root.search",{url:"search/",controller:"searchCtrl",templateUrl:"../assets/views/search/search.html"}).state("root.buy.searchresult",{url:"searchresult/?key&page",controller:"searchresultCtrl",templateUrl:"../assets/views/search/searchresult.html"}).state("root.confirmorder",{url:"confirmorder/?r",controller:"orderCtrl",templateUrl:"../assets/views/confirmorder/confirmorder.html"}).state("root.confirmorder.couponlist",{url:"couponlist/?couponid",controller:"confirmorder.couponListCtrl",templateUrl:"../assets/views/confirmorder/confirmorder.couponlist.html"}).state("root.wechartprepay",{url:"wechartprepay/?userId&orderId",controller:"wechartprepayCtrl",templateUrl:"../assets/views/wechartprepay/wechartprepay.html"}).state("root.paySuccess",{url:"paySuccess/?userId&orderId",controller:"paySuccessCtrl",templateUrl:"../assets/views/paySuccess/paySuccess.html"}).state("root.payFail",{url:"payFail/?userId&orderId",controller:"payFailCtrl",templateUrl:"../assets/views/payFail/payFail.html"}).state("root.binduser",{url:"binduser?redirect",templateUrl:"../assets/views/binduser/binduser.html"}).state("root.addr",{url:"orderaddr/?addrId&userId",templateUrl:"../assets/views/addr/addr.html",controller:"addrListCtrl"}).state("root.addrAdd",{url:"addrAdd/?userId&addrId",templateUrl:"../assets/views/addr/add.html",controller:"addrAddCtrl"}).state("root.addrEdit",{url:"addrEdit/?userId&userAddrId&addrId",controller:"addrEditCtrl",templateUrl:"../assets/views/addr/edit.html"}).state("root.addrLocate",{url:"addrLocate/?r&userId&userAddrId",controller:"addrLocateCtrl",templateUrl:"../assets/views/addr/addrLocate.html"}).state("root.addrColleges",{url:"addrColleges/?r&userId&userAddrId&cityId",controller:"addrCollegesCtrl",templateUrl:"../assets/views/addr/addrColleges.html"}).state("root.user",{url:"user/",controller:"userCtrl",templateUrl:"../assets/views/user/user.html"}).state("root.notfound",{url:"404/",templateUrl:"../assets/views/notfound/notfound.html"})}]),angular.module("xiaomaiApp").run(["$state","$rootScope","$timeout",function(e,n,o){var a=o(function(){e.go("root.buy.nav.all")},50),t=n.$on("$stateChangeStart",function(e,n,i){o.cancel(a),t()})}]),document.addEventListener("touchmove",function(e){e.preventDefault()},!1),angular.module("xiaomaiApp").filter("xiaomaimoment",function(){return function(e){var n=Math.floor(e/60),o=e%60;return n=n>=0?n:0,o=o>=0?o:0,n=10>n?"0"+n:n,o=10>o?"0"+o:o,n+"分"+o+"秒"}}),angular.module("xiaomaiApp").filter("xiaomaiprice",function(){return function(e){return(e/100).toFixed(2)}}),angular.module("xiaomaiApp").factory("xiaomaimodelManage",function(){var e={navgatorlist:{url:"/wap/navigate/index",type:"GET"},locate:{url:"/wap/college/locate",type:"GET"},citylist:{url:"/wap/geography/cities",type:"GET"},collegelist:{url:"/wap/geography/colleges",type:"GET"},getSchool:{url:"/wap/college/detail",type:"GET"},saveSchool:{url:"/wap/college/detail",type:"POST"},activities:{url:"/wap/college/activities",type:"GET"},activeGoods:{url:"/wap/activity/goods",type:"GET",canstore:!1},activeBanner:{url:"/wap/activity/banners",type:"GET"},categoryGoods:{url:"/wap/index/categoryGoods",type:"GET"},categoryBanners:{type:"GET",url:"/wap/category/banners"},goods:{url:"/wap/category/goods",type:"GET",canstore:!1},goodDetail:{url:"/wap/goods/detail",type:"GET"},removeCart:{url:"/wap/cart/remove",type:"POST"},emptyCart:{url:"/wap/cart/delete",type:"POST"},whitelist:{type:"GET",url:"/wap/college/whitelist"},addCart:{url:"/wap/cart/add",type:"POST"},queryCart:{url:"/wap/cart/sync",type:"GET",canstore:!1},queryCartDetail:{url:"/wap/cart/get",type:"GET"},mycoupon:{url:"/couponwap/myCouponList",type:"GET"},getWxConfig:{url:"/wap/getWxConfig",type:"GET"},feedback:{url:"/wap/feedback/detail",type:"POST"},log:{url:"http://logger.imxiaomai.com/client/event",type:"GET"},searchresult:{url:"/wap/goods/search",type:"GET"},searchsuggest:{url:"/wap/goods/suggest",type:"GET"},sendCode:{url:"/wap/userBind/sendCode",type:"POST"},bindUser:{url:"/wap/userBind/bind",type:"POST"},checkUser:{url:"/wap/userBind/check",type:"POST"},addrList:{url:"/wap/useraddr/query",type:"GET"},addrDel:{url:"/wap/useraddr/delete",type:"GET"},getAddr:{url:"/wap/useraddr/get",type:"GET"},setAddr:{url:"/wap/useraddr/set",type:"POST"},addAddr:{url:"/wap/useraddr/add",type:"POST"},createOrder:{url:"/wap/order/createOrder",type:"POST"},queryReferOrder:{url:"/wap/order/refer",type:"GET"},userAuth:{url:"/wap/userBind/auth",type:"GET"},confirmOrder:{url:"/wap/order/confirm",type:"POST"},queryOrder:{url:"/wap/order/query",type:"GET"},payStatusCheck:{url:"/wap/order/pay/check",type:"POST"},ldcDeliveryTime:{url:"/wap/get/ldc/deliveryTime",type:"GET"},usercenter:{url:"/wap/usercenter/index",type:"GET"}},n=function(){var n=Array.prototype.slice.call(arguments,0),o=n[0],a=n[1]||"GET";return e.hasOwnProperty(o)&&e[o].type===a?e[o]:!1};return n}),angular.module("xiaomaiApp").factory("urlInterceptor",["env",function(e){var n=99999999,o=window.location.search,a=/xiaomai_schoolid+=([^\?&#])/;n=angular.isArray(o.match(a))?o.match(a)[1]:n;var t=function(o){return"develop"!==e?o+"?xiaomai_schoolid="+n:"/api"+o+".json?xiaomai_schoolid="+n};return t}]),angular.module("xiaomaiApp").factory("xiaomaiService",["env","$q","urlInterceptor","xiaomaimodelManage","$http","xiaomaiCacheManager","getDataType","httpRequstParam","$timeout",function(e,n,o,a,t,i,r,s,c){var l=function(e,n){var o=a(e,n);return o},d=function(e){return 0==e.code&&e.data&&("number"!=r(e.data)||e.data.length)&&("object"!=r(e.data)||Object.keys(e.data).length)?e.data:!1},u={},p=function(e,n){if(u[e].queue.length){var o=u[e].queue.shift();u[e].lock=!0,angular.isObject(n)?(o.deferred.reject(n),p(e,n)):g(o.deferred,o.name,o.params)}else delete u[e]},g=function(e,n,r){var s,c,l,g,m=a(n,"GET");return m===!1?(g={code:"404",msg:"接口请求错误"},e.reject(g),p(n,g),!1):(s=o(m.url),c=m.canstore!==!1,l=i.readCache(n,r),c&&l?(e.resolve(l),p(n),!1):void t({url:s,method:"GET",params:angular.extend({redirect:"mall",v:Math.random().toString().replace(".","")},r)}).success(function(o){d(o)===!1?(g=o,e.reject(o)):(g=!1,c&&i.writeCache(n,o.data,r),e.resolve(o.hasOwnProperty("data")?o.data:o))}).error(function(n){g={code:"503",msg:"接口异常"},e.reject(g)})["finally"](function(){u[n].lock=!1,p(n,g)}))},m=function(e){var o=n.defer(),a=Array.prototype.slice.call(arguments,0),e=a[0],t={};return"object"==r(a[1])&&(t=a[1]),u.hasOwnProperty(e)&&1==u[e].lock?u[e].queue.push({deferred:o,name:e,params:t}):(u[e]={lock:!0,queue:[]},g(o,e,t)),o.promise},f=function(){},v=function(){},h=function(a,i,r){var c,d,u=n.defer();if(c=l(a,"POST"),!c)return u.reject({code:"404",msg:"接口错误或接口请求方式错误"}),u.promise;d=o(c.url);var p="develop"==e?{method:"GET",params:i}:{method:"POST",data:r?i:s(i)};return t(angular.extend(p,{url:d,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})).success(function(e){0==e.code?u.resolve(e.data):u.reject(e)}).error(function(){u.reject({msg:"接口异常"})}),u.promise};return{fetchOne:m,fetchAll:f,fetchOrder:v,save:h}}]),angular.module("xiaomaiApp").factory("httpRequstParam",[function(){var e=function(n){var o,a,t,i,r,s,c,l="";for(o in n)if(a=n[o],a instanceof Array)for(c=0;c<a.length;++c)r=a[c],t=o+"["+c+"]",s={},s[t]=r,l+=e(s)+"&";else if(a instanceof Object)for(i in a)r=a[i],null!=r&&(t=o+"."+i,s={},s[t]=r,l+=e(s)+"&");else void 0!==a&&(l+=encodeURIComponent(o)+"="+encodeURIComponent(a)+"&");return l.length?l.substr(0,l.length-1):l};return e}]),angular.module("xiaomaiApp").factory("xiaomaiQuicksort",[function(){var e=function(n){if(n.length<=1)return n;var o=Array.prototype.slice.call(arguments,0),n=o[0],a=o[1]||"number",t=o[2],i=Math.ceil(n.length/2),r="number"==a?n[i]:n[i][t],s=[],c=[];return $.each(n,function(e,n){var o="number"===a?n:n[t];return e==i?!0:void(r>=o?s.push(n):c.push(n))}),e(s).concat([n[i]]).concat(e(c))};return e}]),angular.module("xiaomaiApp").factory("xiaomaiCacheManager",["xiaomaiQuicksort",function(e){var n=[],o=20,a=function(e,o){var a=t(e);if(a===!1)return!1;if(o&&angular.isObject(o)&&angular.isObject(n[a].params)){var i=!0;if(angular.forEach(o,function(e,o){e!=n[a].params[o]&&(i=!1)}),0==i)return!1}return angular.extend({},n[a].result)},t=function(e){if(!n.length)return!1;var o=-1;return angular.forEach(n,function(n,a){return n.name===e?(o=a,!1):void 0}),-1===o?!1:o},i=function(e,a,i){var r=t(e);if(r!==!1){n.splice(r,1)[0];return n.push({name:e,result:a,params:i}),!1}n.length==o&&n.shift(),n.push({name:e,result:a,params:i})},r=function(e){var o=t(e);o!==!1&&n.splice(o,1)};return{readCache:a,writeCache:i,clean:r}}]),angular.module("xiaomaiApp").factory("skuListToObject",function(){return function(e){var n={};return angular.forEach(e,function(e,o){var a=[];angular.forEach(e.skuPropertyList,function(e,n){a.push(e.propertyNameId+"="+e.propertyValueId)}),n[a.join("&")]=e}),n}}),angular.module("xiaomaiApp").factory("cartManager",["$q","xiaomaiService","xiaomaiCacheManager",function(e,n,o){var a,t=function(e){o.writeCache("queryCart",e),o.clean("queryCartDetail"),a&&a(e)},i=function(){return e.defer()},r=function(){o.clean("queryCart"),n.fetchOne("queryCart").then(function(e){t(e)})},s=function(e){var o=i();return n.save("addCart",e).then(function(e){t(e),o.resolve(e)},function(e){o.reject(e)}),o.promise},c=function(e){var o=i();return n.save("removeCart",e).then(function(e){t(e),o.resolve(e)},function(e){o.reject(e)}),o.promise},l=function(e){a=e,n.fetchOne("queryCart").then(function(e){a(e),o.writeCache("queryCart",e)},function(e){a("error")})},d=function(e){e&&angular.isObject(e)?o.writeCache("queryCart",e):o.clean("queryCart")},u=function(){return o.readCache("queryCart")},p=function(){var a=e.defer();return n.save("emptyCart").then(function(e){a.resolve(e),o.clean("queryCart"),o.clean("queryCartDetail")}),a.promise},g=function(){var a=e.defer();return n.fetchOne("queryCartDetail").then(function(e){a.resolve(e),o.writeCache("queryCartDetail",e)}),a.promise},m=function(n,o){var a=[],t=e.defer();return g().then(function(e){return a=e,a.goods}).then(function(e){var a=-1;angular.forEach(e,function(e,t){var i=e.skuList[0];2==o&&i.activitySkuId==n?a=t:1==o&&i.skuId==n&&(a=t)}),t.resolve(-1==a?0:e[a].skuList[0].numInCart)},function(){t.reject(!1)}),t.promise};return{getnumInCart:m,add:s,remove:c,query:l,clear:p,store:d,readCartCache:u,queryCartDetail:g,update:r}}]),angular.module("xiaomaiApp").factory("getSkuInfo",[function(){var e=/([^&=]+)=([^&=]+)/;return function(n,o){var a=!1;return angular.forEach(o,function(o,t){var i=!0;angular.forEach(t.split("&"),function(o){if(!o.match(e)||!o.match(e).length)return i=!1,!1;var a=o.match(e),t=a[1],r=a[2];return n.hasOwnProperty(t)?n[t]!=r?(i=!1,!1):void 0:(i=!1,!1)}),1==i&&(a=o)}),a}}]),angular.module("xiaomaiApp").factory("buyProcessManager",["$q","cartManager","orderManager",function(e,n,o){var a=!1;return function(){var t=e.defer(),i=Array.prototype.slice.call(arguments,0),r=i[0]||{},s=i[1],c=i[2],l=i[3],d=r.skuId,u=r.sourceType,p="plus"==s?"add":"remove",g=function(e){e="plus"==s?e+1:e-1,t.resolve(l),o.deleteOrder()};if(a)return t.reject("正在添加到购物车,请稍等"),t.promise;if(i.length<3)return t.reject("参数缺失!"),t.promise;if("minus"==s&&0>=l)return t.reject("该商品已经不存在"),t.promise;if(angular.isNumber(l)){if("plus"==s&&l>=c)return t.reject("该商品购买数量超上限了哦~"),t.promise;n[p](r).then(function(){l="plus"==s?l+1:l-1,g(l)},function(e){t.reject(e.msg)})}else{n.getnumInCart(d,u).then(function(e){return angular.isNumber(e)&&c>e?(l=e,n[p](r)):void t.reject("该商品购买数量超上限了哦")}).then(function(e){g(l)},function(){t.reject("操作失败")})}return t.promise}}]),angular.module("xiaomaiApp").factory("env",["$window",function(e){var n=/h5\.imxiaomai\.com/,o=/127\.0\.0\.1|localhost|172\.16\.110\.188/;return host=e.location.host,n.test(host)?"online":o.test(host)?"develop":"test"}]),angular.module("xiaomaiApp").factory("systemInfo",["$window",function(e){var n,o,a,t,i=e.navigator.userAgent,r=/(android)\s+([\d\.]+)/i,s=/(iphone|ipad).+(os\s[\d_]+)/i,c=/micromessenger\/[\d\.]+/i;return i.match(r)&&i.match(r).length?(t=i.match(r),n=t[1],o=i.match(r)[2]):i.match(s)&&i.match(s).length?(t=i.match(s),n=t[1],o=t[2]):(n="unknown",o="unknown"),a=i.match(c)&&i.match(c).length?i.match(c)[0]:"other",{platform:n,version:o,browser:a}}]),angular.module("xiaomaiApp").factory("getDataType",[function(){return function(e){var n=Object.prototype.toString.call(e),o=/\s(\w+)/;return n.match(o)[1].toLowerCase()}}]),angular.module("xiaomaiApp").factory("parseUrlParams",[function(){return function(e,n){var o=new RegExp("[\\?&]"+n+"=([^\\?&]+)"),a=e.match(o);return a&&a.length?a[1]:!1}}]),angular.module("xiaomaiApp").factory("getRouterTypeFromUrl",function(){return function(e,n){var o={};return e.match(/[\?&]m=([^\?&]+)/)?(o.name="root.buy.nav.category",o.params={categoryId:e.match(/[\?&]id=([^\?&]+)/)[1],collegeId:n}):e.match(/skActivity/)?(o.name="root.buy.active",o.params={collegeId:n,activityId:e.match(/[\?&]activityId=([^\?&]+)/)[1]}):e.match(/activity/)?(o.name="root.buy.active",o.params={collegeId:n,activityId:e.match(/[\?&]activityId=([^\?&]+)/)[1]}):o.path=e,o}}),angular.module("xiaomaiApp").factory("safeApply",["$rootScope",function(e){return function(n){var o=e.$$phase;"$apply"==o||"$digest"==o?angular.isFunction(n)&&n():e.$apply(n)}}]),angular.module("xiaomaiApp").factory("quickGetImgHeight",["$q",function(e){return function(n){var o=e.defer(),a=function(){},t=document.createElement("img");t.src=n;var i,r,s=!1;return t.addEventListener("load",function(){return s?!1:(s=!0,void o.resolve({width:t.width,height:t.height}))}),t.addEventListener("error",function(){return s?!1:(s=!0,void o.resolve({width:t.width,height:t.height}))}),i=setInterval(function(){return 0!=t.height&&t.height==r?(clearInterval(i),s=!0,o.resolve({width:t.width,height:t.height}),!1):(r=t.height,void a(t.width,a.height))},50),o.promise}}]),angular.module("xiaomaiApp").factory("cookieManager",["ipCookie",function(e){}]),angular.module("xiaomaiApp").factory("cookie_openid",["env","ipCookie",function(e,n){return"develop"!=e?n("xiaomai_open_id")||"":"oTS2xjtXWVPcdQd9OPI11jjBheco"}]),angular.module("xiaomaiApp").factory("searchcookieManager",["ipCookie",function(e){var n="xiaomaiusersearchrecord",o=e(n)||[],a=function(a){o.length?e(n,o):e.remove(n)},t=function(){return o},i=function(e){if(!o.length)return!1;var n=-1;return angular.forEach(o,function(o,a){return o.name===e?(n=a,!1):void 0}),-1===n?!1:n},r=function(e){if(i(e)!==!1){var n=o.splice(i(e),1)[0];return n.name=e,o.unshift(n),a(),!1}o.length>=10&&o.pop(),o.unshift({name:e}),a()},s=function(){o=[],a()};return{getCookies:t,writeCookie:r,cleanCookies:s}}]),angular.module("xiaomaiApp").directive("maskGui",["xiaomaiMessageNotify",function(e){var n=function(n,o,a){e.sub("maskManager",function(e){o.css({display:"show"==e?"block":"none"})})};return{link:n}}]),angular.module("xiaomaiApp").factory("xiaomaiLog",["xiaomaiService","cookie_openid","xiaomaiLogDate","systemInfo","schoolManager","$http",function(e,n,o,a,t,i){var r=function(e,t){var r=/(\w+)\+?(\d+)?\+?(dataid\d+)?\+?(tag\d+)?\+?(category\d+)?\+?(good\d+)?/,s=e.match(r),c=s[1],l=s[2],d=s[3],u=s[4],p=s[5],g=s[6],m=[o(),c,a.browser].join("^")+"~"+t+"~"+n+"~"+(l||"")+"~~^"+[d?d.replace("dataid",""):"data",u?u.replace("tag",""):"tag",p?p.replace("category",""):"",g?g.replace("good",""):""].join("~")+"~^";i.jsonp("http://logger.imxiaomai.com/client/event?callback=JSON_CALLBACK&data="+m)};return function(e,n){var o=Array.prototype.slice.call(arguments,0);1==o.length?t.get().then(function(n){r(e,n.collegeId)}):2==o.length&&r(e,n)}}]),angular.module("xiaomaiApp").factory("xiaomaiLogDate",[function(){return function(){var e=new Date,n=e.toString(),o=e.getFullYear(),a=e.getMonth()+1,t=e.getDate(),i=/(\d{2}):(\d{2}):(\d{2})/,r=n.match(i);return a=10>a?"0"+a:a,t=10>t?"0"+t:t,[o,a,t].concat(r.slice(1)).join("")}}]),angular.module("xiaomaiApp").factory("xiaomaiMessageNotify",["xiaomaiCacheManager","$window",function(e,n){var o={},a=function(e,n){var a=o.hasOwnProperty(e)?o[e]:{},t=(""+Math.random()).replace(/\./,"");return a[t]=n,o[e]=a,t},t=function(e){var a=o[e];if(!angular.isObject(a)||!Object.keys(a).length)return!1;var t=Array.prototype.slice.call(arguments,1);angular.forEach(a,function(e){angular.isFunction(e)&&e.apply(n,t)})},i=function(e,n){var a=o[e];angular.isObject(a)&&a.hasOwnProperty(n)&&delete a[n]},r=function(e){delete o[e]};return{pub:t,sub:a,removeOne:i,remove:r}}]),angular.module("xiaomaiApp").factory("isEmptyObject",function(){return function(e){if(angular.isFunction(Object.keys))return 0==Object.keys(e).length;for(var n in e)if(e.hasOwnProperty(n))return!1;return!0}}),angular.module("xiaomaiApp").factory("orderManager",["xiaomaiService","ipCookie","$q","isEmptyObject","schoolManager","$q",function(xiaomaiService,ipCookie,$q,isEmptyObject,schoolManager,$q){var orderInfo={},createOrder=function(){var e=$q.defer();return isEmptyObject(orderInfo)?ipCookie("xiaomaiv4_order")&&!isEmptyObject(ipCookie("xiaomaiv4_order"))?(e.resolve(),e.promise):(xiaomaiService.save("createOrder").then(function(n){orderInfo=angular.extend({},n.orderInfo),e.resolve(),ipCookie("xiaomaiv4_order",{userId:orderInfo.order.userId,orderId:orderInfo.order.orderId,limitTime:orderInfo.limitTime,createTime:+new Date},{expirationUnit:"minutes",expires:orderInfo.limitTime})},function(n){e.reject(n)}),e.promise):(e.resolve(),e.promise)},deleteOrder=function(){ipCookie.remove("xiaomaiv4_order"),orderInfo={}},queryOrderStatus=function(){var e=getUserId();return e===!1?!1:!0},getUserId=function(){var e=ipCookie("xiaomaiv4_order");return angular.isObject(e)?e.userId:!1},getOrderId=function(){var e=ipCookie("xiaomaiv4_order");return angular.isObject(e)?e.orderId:!1},getRemaintime=function(){return queryOrderStatus()?{createTime:ipCookie("xiaomaiv4_order").createTime,limitTime:ipCookie("xiaomaiv4_order").limitTime}:{createTime:0,limitTime:0}},getOrderInfo=function(querystring){var deferred=$q.defer(),collegeId,userId=getUserId(),orderId=getOrderId();return userId?(schoolManager.get().then(function(e){return collegeId=e.collegeId,xiaomaiService.fetchOne("queryReferOrder",{userId:userId,orderId:orderId,collegeId:collegeId})}).then(function(res){try{deferred.resolve(eval("res."+querystring))}catch(e){deferred.reject()}}),deferred.promise):(deferred.reject(),deferred.promise)};return{createOrder:createOrder,getOrderInfo:getOrderInfo,getUserId:getUserId,getRemaintime:getRemaintime,deleteOrder:deleteOrder}}]),angular.module("xiaomaiApp").factory("addrMananger",["orderManager","isEmptyObject","$q",function(e,n,o){var a={},t=function(){var t=o.defer();return n(a)?(e.getOrderInfo("defaultUserAddr").then(function(e){t.resolve(e)}),t.promise):(t.resolve(a),t.promise)},i=function(e){a=e};return{getAddr:t,setAddr:i}}]),angular.module("xiaomaiApp").factory("schoolManager",["$q","$window","xiaomaiService","env","xiaomaiCacheManager","$timeout",function(e,n,o,a,t,i){var r,s=function(e){var o=window.location.search,a=/[\?&]xiaomai_schollid=([^\?&#]+)/,t=angular.isArray(o.match(a))?Number(o.match(a)[1]):-9999;return 3270!==t&&3270===e?(n.location.href="/page/newv4/index.html?xiaomai_schollid=3270",!0):3270===t&&3270!==e?(n.location.href="/page/newv4/index.html",!0):!1},c=function(){var n=e.defer();return o.fetchOne("getSchool").then(function(e){r&&i.cancel(r),r=i(function(){s(e.collegeId)},10),n.resolve(e)}),n.promise},l=function(n){var a=e.defer(),i=n;return o.save("saveSchool",{collegeId:n.collegeId}).then(function(e){e.hasOwnProperty("collegeId")?(t.writeCache("getSchool",e),s(e.collegeId),a.resolve(i)):a.reject(msg)},function(e){a.reject(e)}),a.promise};return{get:c,set:l}}]),angular.module("xiaomaiApp").factory("siblingsNav",["$q","xiaomaiService",function(e,n){var o=function(e,n,o,a){var t=-1;switch(o){case 0:angular.forEach(e,function(e,n){return 0==e.displayType?(t=n,!1):void 0});break;case 1:angular.forEach(e,function(e,n){return 1==e.displayType?(t=n,!1):void 0});break;case 2:angular.forEach(e,function(e,n){return 2==e.displayType&&e.activityId==a?(t=n,!1):void 0});break;case 3:angular.forEach(e,function(e,n){return 3==e.displayType&&e.categoryId==a?(t=n,!1):void 0})}return"up"==n?-1==t?!1:t-1:"down"==n?t==e.length-1?!1:t+1:void 0},a=function(e,n){var o={0:"root.buy.nav.all",1:"root.buy.nav.recommend",2:"root.buy.nav.active",3:"root.buy.nav.category"};return{text:e.navigateName,name:o[e.displayType],params:{collegeId:n,categoryId:e.categoryId,activityId:e.activityId}}};return function(t,i,r,s){var c=e.defer();return n.fetchOne("navgatorlist",{collegeId:i}).then(function(e){var n=e.navigateItems,l=o(n,t,r,s);angular.isNumber(l)?c.resolve(a(n[l],i)):c.reject()}),c.promise}}]),angular.module("xiaomaiApp").factory("registerWx",["$q","xiaomaiService","env",function(e,n,o){var a=e.defer(),t=["onMenuShareTimeline","onMenuShareAppMessage","getNetworkType","getLocation","openLocation"],i=function(e){wx.config({debug:!1,appId:e.appId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:t}),wx.ready(function(){a.resolve()}),wx.error(function(e){a.reject(JSON.stringify(e))})};return n.fetchOne("getWxConfig",{url:encodeURIComponent([location.protocol,"//",location.host,location.pathname,location.search].join(""))}).then(function(e){i(e)}),a.promise}]),angular.module("xiaomaiApp").factory("locationManager",["$q","$timeout","env","registerWx",function(e,n,o,a){var t=function(){var o=e.defer(),t=n(function(){o.reject("网络超时")},3e3);return a.then(function(){wx.getLocation({type:"wgs84",success:function(e){var a=e.latitude,i=e.longitude;n.cancel(t),o.resolve({lat:a,lng:i})}})},function(e){o.reject(e)}),o.promise};return t}]),angular.module("xiaomaiApp").factory("networkType",["$q","registerWx",function(e,n){return xiaomaiApp}]),angular.module("xiaomaiApp").factory("wxshare",["$q","registerWx",function(e,n){return function(e){n.then(function(){wx.onMenuShareTimeline(e),wx.onMenuShareAppMessage(e)})}}]),angular.module("xiaomaiApp").run(["$templateCache",function(e){e.put("../assets/views/active/active.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-fanhui lefticon" ng-click="goback();"></div>\n  <div class="location-info middlearea">{{activityShowName}}</div>\n  <div class="iconfont active-share icon-fenxiang icon-locate-right righticon" ng-click="showShareModel();"></div>\n</div>\n\n<div class="activeWrap" down-tip-cls="{{\'navmain-downtip\'}}" xiaomai-iscroll subname="{{\'activeheightstatus\'}}" pubname="{{\'activeiscrollupdate\'}}">\n  <div>\n    <div class="banner">\n      <ks-swiper-container on-ready="onReadySwiper(swiper)" swiper="swiper">\n        <ks-swiper-slide class="swiper-slide" ng-repeat="banner in banners">\n          <div class="activeGoodBanner" ng-click="gotoActive(banner);" ng-style="{\'background-image\':\'url(\'+banner.imageUrl+\')\'}"></div>\n        </ks-swiper-slide>\n      </ks-swiper-container>\n    </div>\n    <div  class="errortip" ng-if="haserror" class="">活动已经结束,去其他活动看看吧</div>\n    <div class="loading" ng-if="isloading">正在加载活动商品列表...</div>\n    <ul ng-class="{\'skactiveGoodList\':goods[0].isSeckill==1,\'activeGoodList\':goods[0].isSeckill!=1}">\n      <li ng-repeat="good in goods">\n        <div class="goodItem"  ng-if="good.isSeckill!=1" >\n          <div xiaomai-good-list-item goods="good" detail-source-event="active+{{activityId}}" click-event="m_b_31singleactivityadd+{{activityId}}" source-event="m_r_31cartfromactive+{{activityId}}"  column="{{true}}" ></div>\n        </div>\n        <div ng-if="good.isSeckill==1" xiaomai-good-list-item-sk goods="good"></div>\n      </li>\n    </ul>\n  </div>\n</div>\n'),e.put("../assets/views/active/nav.active.html",'<div class="errortip" ng-if="haserror">\n  活动已经结束 去其他活动看看吧\n</div>\n<div class="loading" ng-if="isloading">\n  正在加载......\n</div>\n<div class="GoodsCont">\n  <div class="GoodCont" ng-click="gotoDetail($event,good);" ng-repeat="good in goods">\n    <div xiaomai-good-list-item goods="good" detail-source-event="active+{{activityId}}" click-event="m_b_31homepagetabactivityadd+{{activityId}}" source-event="m_r_31cartfromactive+{{activityId}}"></div>\n  </div>\n</div>\n'),e.put("../assets/views/addr/add.html",'<div class="pub-header">\n  <div class="lefticon iconfont icon-fanhui" ng-click="goBack($event);"></div>\n  <div class="location-info icon-school middlearea">编辑收货人信息</div>\n</div>\n<div class="addrItemCont">\n    <p>\n      <span class="addrItem-key">联系人</span>\n      <span class="addrItem-value">\n        <input ng-model="receiverName" type="text">\n      </span>\n    </p>\n    <p>\n      <span class="addrItem-key">联系电话</span>\n      <span class="addrItem-value">\n        <input ng-model="receiverPhone" type="tel">\n      </span>\n    </p>\n    <p>\n      <span class="addrItem-key">所在学校</span>\n      <span class="addrItem-value">{{receiverCollegeName}}</span>\n      <i class="iconfont icon-yfmore" ng-click="goLocate($event);"></i>\n    </p>\n</div>\n<div class="addrHanlderBtnCont">\n  <span class="disabled" ng-click="save($event);">保存</span>\n</div>\n'),e.put("../assets/views/addr/addr.html",'<div class="pub-header">\n  <div class="lefticon iconfont icon-fanhui" ng-click="goBack($event);"></div>\n  <div class="location-info icon-school middlearea">选择收货人</div>\n</div>\n<div class="addrListCont" subname="{{\'addrHeightUpdate\'}}" xiaomai-iscroll>\n  <div style="overflow:auto;">\n<!--默认收货-->\n    <div class="defaultAddr addrItem" ng-click="choosenAddr($event,defaultUserAddr);">\n      <span class="name">{{defaultUserAddr.receiverName}}</span>\n      <span class="telephone">{{defaultUserAddr.receiverPhone}}</span>\n      <div class="colleges">{{defaultUserAddr.receiverCollegeName}}</div>\n      <i class="iconfont icon-ok" ng-class="{checked:defaultUserAddr.userAddrId==addrId}"></i>\n    </div>\n<!-- 可选地址列表 -->\n    <ul ng-repeat="addr in addrList track by $index">\n      <li>\n        <div class="addrItem" ng-click="choosenAddr($event,addr);">\n          <span class="name">{{addr.receiverName}}</span>\n          <span class="telephone">{{addr.receiverPhone}}</span>\n          <div class="colleges">{{addr.receiverCollegeName}}</div>\n          <i class="iconfont icon-ok" ng-class="{checked:addr.userAddrId==addrId}"></i>\n        </div>\n        <div class="addrHandlers">\n            <span ng-click="gotoEdit($event,addr.receiverCollegeId);">\n              <i class="iconfont icon-bianji"></i>\n              编辑\n            </span>\n            <span ng-show="addr.userAddrId!=addrId" ng-click="delOneAddr($event,addr.receiverCollegeId,$index);">\n              <i class="iconfont icon-cuo"></i>\n              删除\n            </span>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n<footer class="addAddrCont">\n  <span class="addAddrBtn" ng-click="gotoAdd($event);">新增收货地址</span>\n</footer>\n'),e.put("../assets/views/addr/addrColleges.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-fanhui lefticon" ng-click="goback();"></div>\n  <div class="middlearea">选择学校</div>\n</div>\n<div class="colleges_content" xiaomai-iscroll subname="{{\'collegesheightupdate\'}}">\n  <ul class="countrylist">\n    <li class="loading" ng-if="isloading">学校信息正在加载....</li>\n    <li class="errortip" ng-if="haserror">该城市还没有相关学校</li>\n    <li ng-repeat="country in countrylist" >\n      <p class="countryname">{{country.cityName}}</p>\n      <div ng-class="{holiday:college.isOpen!=1}" class="" ng-click="checkCollege($event,college)" ng-click="checkCollege(college);" ng-repeat="college in country.colleges">{{college.collegeName}}</div>\n    </li>\n  </ul>\n</div>\n'),e.put("../assets/views/addr/addrLocate.html",'<div class="pub-header">\n  <div class="iconfont icon-fanhui lefticon" ng-click="goback($event);"></div>\n  <div class="middlearea">选择学校</div>\n</div>\n<div class="colleges_content" xiaomai-iscroll subname="{{\'locateheightupdate\'}}">\n  <div class="">\n    <p class="title">定位学校</p>\n    <div class="localColleges">\n      <p class="locateerrortip" ng-if="islocating">正在进行定位</p>\n      <p class="locateerrortip" ng-if="haserror">小麦迷路了,手动选择一下吧</p>\n      <p class="locateCollege" ng-class="{holiday:item.isOpen!=1}" ng-click="checkCollege($event,item,$index)" ng-repeat="item in locationResult">{{item.collegeName}}</p>\n    </div>\n    <p class="title">手动选择</p>\n    <div class="allSchools">\n      <ul class="citylist">\n        <li ng-class="{checked:item.cityId==curcityid}" ng-click="showCollegeList($event,item);" ng-repeat="item in citylist">\n          {{item.cityName}}\n          <i class="iconfont icon-yfmore"></i>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/addr/edit.html",'<div class="pub-header">\n  <div class="lefticon iconfont icon-fanhui" ng-click="goBack($event);"></div>\n  <div class="location-info icon-school middlearea">编辑收货人信息</div>\n</div>\n\n<div class="addrItemCont">\n    <p>\n      <span class="addrItem-key">联系人</span>\n      <span class="addrItem-value">\n        <input ng-model="receiverName" type="text">\n      </span>\n    </p>\n    <p>\n      <span class="addrItem-key">联系电话</span>\n      <span class="addrItem-value">\n        <input ng-model="receiverPhone" type="tel">\n      </span>\n    </p>\n    <p>\n      <span class="addrItem-key">所在学校</span>\n      <span class="addrItem-value">{{receiverCollegeName}}</span>\n      <i class="iconfont icon-yfmore" ng-click="goLocate($event);"></i>\n    </p>\n</div>\n<div class="addrHanlderBtnCont">\n  <span class="disabled" ng-click="save($event);">保存</span>\n</div>\n'),e.put("../assets/views/all/all.html",'<ul class="category-active-list" style="">\n  <li class="loading" ng-if="isloading">正在加载......</li>\n  <li class="errortip" ng-if="haserror">暂无活动</li>\n  <li ng-repeat="item in activities" class="tag-active" ng-click="goto(item);" ng-style="{\'background-image\':\'url(\'+item.wapImageUrl+\')\'}"></li>\n</ul>\n'),e.put("../assets/views/binduser/binduser.html",'<div class="bindUserWrap" ng-controller="bindUserCtrl">\n  <p class="note">为了验证您的身份，请绑定您的手机号</p>\n  <div class="block_tel">\n    <input ng-model="tel" placeholder="请输入您的手机号" type="number">\n    <input ng-model="smsCode" placeholder="请输入您的手机验证码" type="number"/>\n    <span class="sendCodeBtn" ng-click="sendCode($event);" ng-show="!sendLeftTime">获取验证码</span>\n    <span class="sendCodeBtn disabled" ng-show="sendLeftTime">重新发送({{sendLeftTime}})S</span>\n\n  </div>\n  <span class="confirmbutton disabled" ng-click="bindUser($event)">确定</span>\n  <div class="pos_checkP" ng-init="agreedeal=true;">\n    <input ng-checked="agreedeal" type="checkbox"/>\n    <i class="iconfont" ng-class="{\'icon-checkbox-checked\':agreedeal,\' icon-checkbox\':!agreedeal}" ng-click="agreedeal=!agreedeal;"></i>\n    <span>已阅读并同意</span>\n    <a href="http://open.imxiaomai.com/app/user.html">小麦公社协议</a>\n  </div>\n</div>\n'),
e.put("../assets/views/buy/buy.html",'<div ui-view></div>\n<!-- 购物车x-->\n<div class="pub-footer" ng-controller="buy.cartThumbCtrl">\n  <div class="cartThumb" ng-class="{showcart:isShowCart,showdetail:isShowDetail}">\n    <div class="shopcarticons">\n      <span class="iconfont icon-cart icon-gouwuche" ng-click="gotoDetail();"></span>\n      <span class="totalCount" ng-class="{big:hasChange}" ng-show="totalCount && totalCount!=0">{{totalCount}}</span>\n    </div>\n\n    <p class="totalPrice" ng-show="totalCount && totalCount!=0">共计<em>&yen;</em>\n      <span>{{totalPrice|xiaomaiprice}}</span></p>\n    <div class="gotoPay" ng-class="{disabled:lockSettle}" ng-click="goSettlement($event);" ng-show="totalCount && totalCount!=0">选好了</div>\n    <p class="emptyTip" ng-show="!totalCount || totalCount==0">购物车是空的,快快选购吧~</p>\n  </div>\n  <div class="cartDetail" ng-class="{\'cartDetail-show\':showcart}" ng-controller="buy.cartDetailCtrl">\n    <span class="goback" ng-click="continueShop($event);">继续购物<i class=" iconfont icon-yfmore"></i>\n    </span>\n    <div class="cartDetailWrap" subname="{{\'shopcartdetailheightupdate\'}}" xiaomai-iscroll>\n      <div>\n        <div class="haserror" ng-if="isloading">正在购物车信息......</div>\n        <div class="haserror" ng-if="haserror">购物车空了 赶快去购物吧</div>\n        <div class="good-info" ng-repeat="good in goods">\n          <div class="goodWrap">\n            <p class="good-title">{{good.sourceType==2?good.activityGoodsName:good.bgGoodsName}}</p>\n            <p class="good-price">&yen;{{good.sourceType==2?good.skuList[0].activityPrice:good.skuList[0].wapPrice|xiaomaiprice}}</p>\n            <lable class="label" ng-class="{ldc:$index==0,rdc:$index==1}" ng-repeat="distribute in good.distributeTypeDisplay track by $index" ng-show="distribute.length">{{distribute}}</lable>\n          </div>\n          <div class="iconWrap">\n            <i class="iconfont icon-jianqugouwuche" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'minus\',$index);"></i>\n            <span class="good-count">{{good.skuList[0].numInCart}}</span>\n            <i class="iconfont icon-tianjiagouwuche" ng-class="{paying:goo.isPaying}" ng-click="buyHandler($event,\'plus\',$index);"></i>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="cartDetail-tip">\n      <p class="cartDetail-tip-freight" ng-if="ldcFreight.sub && ldcFreight.sub!=0">29分钟达产品满{{ldcFreight.total|xiaomaiprice}}减{{ldcFreight.sub|xiaomaiprice}}</p>\n      <p class="cartDetail-tip-coupon" ng-click="gotoCoupon();" ng-if="coupons.length">{{coupons.length}}张可用优惠劵<i class="couponMore iconfont icon-YF_more"></i>\n      </p>\n      <p class="cartDetail-tip-coupon" ng-if="!coupons.length">暂无可用优惠劵</p>\n    </div>\n  </div>\n</div>\n<!--遮罩-->\n<div class="mask" mask-gui ng-click="closeMask($event);"></div>\n<div class="shareModel"  ng-click="closeShare($event);" ng-if="shareIsShow"></div>\n\n<!--商品详情-->\n<div class="goodDetail" ng-class="{\'goodDetail-show\':showdetail}" ng-controller="buy.detailCtrl">\n  <div class="detailCont">\n    <div class="goodIconWrap">\n      <div class="iconfont icon-fenxiang" ng-click="showShareModel($event);"></div>\n      <div class="iconfont icon-unfold" ng-click="closeDetail($event);"></div>\n    </div>\n\n    <div class="goodDetailWrap" subname="{{\'detailgoodheightupdate\'}}" xiaomai-iscroll>\n        <div image-loaded-call="imageLoadedCall();" good-detail goods-id="goodsId" source-type="sourceType" load-success="openDetailPop();"></div>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/category/category.html",'<div class="GoodsCont">\n\n  <div class="errortip" ng-if="haserror">{{errortip}}</div>\n  <div  ng-if="isloading" class="loading">\n      正在加载\n  </div>\n  <div class="banner">\n    <ks-swiper-container swiper="swiper">\n      <ks-swiper-slide class="swiper-slide" ng-repeat="banner in banners">\n        <div class="categoryBanners" ng-click="gotoActive(banner);" ng-style="{\'background-image\':\'url(\'+banner.imageUrl+\')\'}"></div>\n      </ks-swiper-slide>\n    </ks-swiper-container>\n  </div>\n  <div class="GoodCont" ng-repeat="good in goods">\n    <div class="recommendCateGood"  xiaomai-good-list-item goods="good" detail-source-event="category+{{categoryId}}" click-event="m_b_31homepagetabcategoryadd+{{categoryId}}" source-event="m_r_31cartfromcategory+{{categoryId}}"></div>\n  </div>\n</div>\n'),e.put("../assets/views/colleges/colleges.html",'<div class="pub-header">\n  <div back-icon class="iconfont icon-fanhui lefticon" ng-click="goback();"></div>\n  <div class="middlearea">选择学校</div>\n</div>\n<div class="colleges_content" xiaomai-iscroll subname="{{\'collegesheightupdate\'}}">\n  <ul class="countrylist">\n    <li class="loading" ng-if="isloading">学校信息正在加载....</li>\n    <li class="errortip" ng-if="haserror">该城市还没有相关学校</li>\n    <li ng-repeat="country in countrylist" >\n      <p class="countryname">{{country.cityName}}</p>\n      <div ng-class="{holiday:college.isOpen!=1}" class="" ng-click="checkCollege($event,college)" ng-click="checkCollege(college);" ng-repeat="college in country.colleges">{{college.collegeName}}</div>\n    </li>\n  </ul>\n</div>\n'),e.put("../assets/views/confirmorder/confirmorder.couponlist.html",'<div class="pub-header">\n  <div class="lefticon iconfont icon-fanhui" ng-click="goback($event);"></div>\n  <div class="middlearea">选择优惠劵</div>\n  <div class="righticon closecouponlist" ng-click="goback($event)">关闭</div>\n</div>\n<div class="couponlistContents" subname="{{\'confirmCouponListHeightUpdate\'}}" xiaomai-iscroll>\n  <div>\n      <p class="notUsed" ng-click="chooseCoupon($event,\'none\');">不使用任何优惠劵</p>\n      <!-- 首次减免优惠劵-->\n      <div ng-click="chooseCoupon($event,\'firstsub\');" class="couponBox firstCouponBox" ng-show="firstCoupon" ng-class="{\'checked\':checkedCouponId===0}">\n          <div class="couponCard">\n              <p class="couponAmount">{{firstCoupon/100}}</p>\n              <p class="couponName">首单减免</p>\n          </div>\n          <p class="couponDesc">新用户首单可用</p>\n          <p class="couponDate"></p>\n      </div>\n      <!-- 用户其他优惠劵-->\n      <div ng-click="chooseCoupon($event,\'othercoupon\',$index);" class="couponBox firstCouponBox" ng-class="{\'checked\':checkedCouponId===coupon.couponId}" ng-repeat="coupon in couponlist" ng-click="chooseCoupon(coupon);">\n          <div class="couponCard">\n              <p class="couponAmount">{{coupon.money/100}}</p>\n              <p class="couponName">{{coupon.couponName}}</p>\n          </div>\n          <p class="couponDesc">{{coupon.couponDesc}}</p>\n          <p class="couponDate">有效期{{coupon.startTime|date:\'MM/dd\'}}-{{coupon.endTime|date:\'MM/dd\'}}</p>\n          <p class="couponRemaintime">还有{{coupon.remainDays}}天过期</p>\n      </div>\n  </div>\n</div>\n'),e.put("../assets/views/confirmorder/confirmorder.html",'<div class="pub-header">\n  <div class="lefticon iconfont icon-fanhui" ng-click="goBack($event);"></div>\n  <div class="location-info icon-school middlearea">确认订单</div>\n</div>\n<div class="order_contents" subname="{{\'confirmoderHeightUpdate\'}}" xiaomai-iscroll>\n  <div style="overflow:auto;">\n<!--收货信息-->\n    <div class="block_bg" ng-controller="addrCtrl">\n      <p class="title addrTitle">收货信息</p>\n      <div class="addrInfo" ng-click="gotoAddr($event,addrInfo.userAddrId);">\n        <span class="username" ng-bind="addrInfo.receiverName"></span>\n        <span class="telephone" ng-bind="addrInfo.receiverPhone"></span>\n        <p class="college" ng-bind="addrInfo.receiverCollegeName||addrInfo.receiverAddr"></p>\n        <i class="iconfont icon-yfmore addrsLink"></i>\n      </div>\n    </div>\n<!-- 第三方订单-->\n    <div class="block_bg" ng-controller="thirdOrderCtrl" ng-init="initGoodShowLength=3;" ng-show="showOrder">\n      <p class="title thirdsellerTitle">第三方卖家商品订单</p>\n      <div class="contents">\n        <p class="orderDistribute">\n          <span class="orderDistribute-key">配送地址</span>\n          <span class="orderDistribute-values" ng-bind="collegeAddr"></span>\n        </p>\n        <div ng-repeat="thirdOrder in thirdChildOrderList">\n          <p class="subTitle rdcSubTitle">{{thirdOrder.storageName}}</p>\n          <p class="orderChildGoods" ng-repeat="orderItem in thirdOrder.childOrderDetailList" ng-show="initGoodShowStatus||$index<initGoodShowLength">\n            <span class="goodname" ng-bind="orderItem.skuName"></span>\n            <span class="price" ng-bind="\'&yen;\'+(orderItem.skuPrice|xiaomaiprice)"></span>\n            <span class="count" ng-bind="\'*\'+orderItem.skuNum"></span>\n          </p>\n          <div class="orderDistribute">\n            <span class="orderDistribute-key">配送服务费</span>\n            <p class="orderDistribute-values">\n              <span class="ldcOrderFreight orderfreight" ng-bind="\'&yen;\'+(thirdOrder.freight-thirdOrder.freightSub|xiaomaiprice)"></span>\n              <span class="ldcOrderFreightSub orderfreightsub" ng-bind="\'&yen;\'+(thirdOrder.freight|xiaomaiprice)"></span>\n            </p>\n          </div>\n          <p class="showMore" ng-click="triggerShowStatus($event);" ng-show="childOrderDetailList.length>initGoodShowLength">\n            <i class="iconfont icon-unfold"></i>\n            <span class="text">{{initGoodShowStatus?\'点击收起\':\'点击查看全部\'}}</span>\n          </p>\n        </div>\n      </div>\n    </div>\n<!-- 次日达订单-->\n    <div class="block_bg" ng-controller="rdcOrderCtrl" ng-init="initGoodShowLength=3;" ng-show="showOrder">\n      <p class="title rdcTitle">次日达订单</p>\n      <div class="contents">\n        <div class="orderDistribute">\n          <span class="orderDistribute-key">门店自提</span>\n          <p class="orderDistribute-values" ng-bind="rdcSelfPickUpAddress"></p>\n        </div>\n        <p class="subTitle rdcSubTitle">小麦特供</p>\n        <p class="orderChildGoods" ng-repeat="orderItem in childOrderDetailList" ng-show="initGoodShowStatus||$index<initGoodShowLength">\n          <span class="goodname" ng-bind="orderItem.skuName">{{}}</span>\n          <span class="price" ng-bind="\'&yen;\'+(orderItem.skuPrice|xiaomaiprice)"></span>\n          <span class="count" ng-bind="\'*\'+orderItem.skuNum"></span>\n        </p>\n        <p class="showMore" ng-click="triggerShowStatus($event);" ng-show="childOrderDetailList.length>initGoodShowLength">\n          <i class="iconfont icon-unfold"></i>\n          <span class="text">{{initGoodShowStatus?\'点击收起\':\'点击查看全部\'}}</span>\n        </p>\n      </div>\n    </div>\n<!-- 当日达订单-->\n    <div class="block_bg" ng-controller="ldcOrderCtrl" ng-init="initGoodShowLength=3;" ng-show="showOrder">\n      <p class="title ldcTitle">当日达订单</p>\n      <div class="contents">\n        <div class="orderDistribute">\n          <span class="orderDistribute-key">配送方式</span>\n          <p class="orderDistribute-values">\n            <span class="deliveryRadio" ng-if="initDeliveryType==0">\n              门店自提\n            </span>\n            <span class="deliveryRadio" ng-if="initDeliveryType==1">\n              送货上门\n            </span>\n            <span class="deliveryRadio" ng-click="chooseType(item.type);" ng-if="initDeliveryType==2" ng-repeat="item in [{type:0,text:\'门店自提\'},{type:1,text:\'送货上门\'}]">\n              <i class="deliveryRadioBtn" ng-class="{checked:ldcDeliveryType==item.type}"></i>\n              {{item.text}}\n            </span>\n          </p>\n        </div>\n        <div class="orderDistribute" ng-if="ldcDeliveryType==0">\n          <span class="orderDistribute-key">自提地址</span>\n          <p class="orderDistribute-values" ng-bind="ldcSelfPickUpAddress"></p>\n        </div>\n        <div class="orderDistribute" ng-if="ldcDeliveryType==1">\n          <span class="orderDistribute-key">配送地址</span>\n          <p class="orderDistribute-values" trigger-mob-iscroll>\n            {{ldcAddressName}}\n            <select mobiscroll-options="{showInput:false,onSelect:chooseAddress,lang:\'zh\',group:true,display:\'bottom\',theme:\'mobiscroll\'}" mobiscroll-select ng-model="ldcAddressName" style="display:none;">\n              <optgroup label="{{ldcAddress.addressType}}" ng-repeat="ldcAddress in ldcAddressList">\n                <option ng-repeat="address in ldcAddress.addresses" value="{{ldcAddress.addressType}}-{{address}}">{{ldcAddress.addressType}}-{{address}}</option>\n              </optgroup>\n            </select>\n            <i class="iconfont icon-unfold showLdcAddressList"></i>\n          </p>\n        </div>\n\n        <div class="orderDistribute" ng-if="ldcDeliveryType==1">\n          <span class="orderDistribute-key">配送时间</span>\n          <p class="orderDistribute-values" ng-if="ldcTimeSwitch&&!ldcTypeIsSc" trigger-mob-iscroll>\n            {{ldcAddressTime}}\n            <select ng-if="!deliveryTimes.length"  mobiscroll-options="{showInput:false,onSelect:chooseTime,lang:\'zh\',group:true,display:\'bottom\',theme:\'mobiscroll\'}" mobiscroll-select ng-model="ldcAddressTime" style="display:none;">\n              <optgroup label="29分钟达" ng-if="ldcTimeIsOpen">\n                  <option value="29分钟达">29分钟达</option>\n              </optgroup>\n            </select>\n            <select ng-if="deliveryTimes.length"  mobiscroll-options="{showInput:false,onSelect:chooseTime,lang:\'zh\',group:true,display:\'bottom\',theme:\'mobiscroll\'}" mobiscroll-select ng-model="ldcAddressTime" style="display:none;">\n              <optgroup label="29分钟达" ng-if="ldcTimeIsOpen">\n                  <option value="29分钟达">29分钟达</option>\n              </optgroup>\n              <optgroup label="定时达">\n                <option ng-repeat="deliveryTime in deliveryTimes" value="{{deliveryTime.startTime+\'~\'+deliveryTime.endTime}}">{{deliveryTime.startTime|filterldctomorrow}}~{{deliveryTime.endTime|filterldctomorrow}}</option>\n              </optgroup>\n            </select>\n            <i class="iconfont icon-unfold showLdcAddressList"></i>\n          </p>\n          <p class="orderDistribute-values" ng-if="!ldcTimeSwitch||ldcTypeIsSc">{{ldcAddressTime}}</p>\n        </div>\n        <div class="orderDistribute" ng-if="ldcDeliveryType==1">\n          <span class="orderDistribute-key">配送服务费</span>\n          <p class="orderDistribute-values">\n            <span class="ldcOrderFreight orderfreight" ng-bind="\'&yen;\'+(freight-freightSub|xiaomaiprice)"></span>\n            <span class="ldcOrderFreightSub orderfreightsub" ng-bind="\'&yen;\'+(freight|xiaomaiprice)"></span>\n          </p>\n        </div>\n        <div class="orderDistribute" ng-if="ldcDeliveryType==1" ng-init="remarkMultiple=1;" ng-style="{\'height\':5+(remarkMultiple-1)*3+\'rem\'}">\n          <span class="orderDistribute-key">备注</span>\n          <p class="orderDistribute-values">\n            <textarea  class="ldcUserRemark" ng-focus="remarkMultiple=3;" ng-blur="remarkMultiple=1;" ng-style="{\'height\':3+(remarkMultiple-1)*3+\'rem\'}" ng-model="ldcRemark" ng-change="updateLdcRemark($event,ldcRemark);" maxlength="50"/></textarea>\n          </p>\n\n        </div>\n        <p class="subTitle ldcSubTitle">小麦特供</p>\n        <p class="orderChildGoods" ng-repeat="orderItem in childOrderDetailList" ng-show="initGoodShowStatus||$index<initGoodShowLength">\n          <span class="goodname" ng-bind="orderItem.skuName"></span>\n          <span class="price" ng-bind="\'&yen;\'+(orderItem.skuPrice|xiaomaiprice)"></span>\n          <span class="count" ng-bind="\'*\'+orderItem.skuNum"></span>\n        </p>\n        <p class="showMore" ng-click="triggerShowStatus($event);" ng-show="childOrderDetailList.length>initGoodShowLength">\n          <i class="iconfont icon-unfold"></i>\n          <span class="text">{{initGoodShowStatus?\'点击收起\':\'点击查看全部\'}}</span>\n        </p>\n      </div>\n    </div>\n<!-- 优惠劵信息-->\n    <div class="block_bg" ng-controller="orderCouponCtrl" ng-show="showCoupon">\n      <p class="title couponTitle">优惠信息</p>\n      <div class="contents">\n        <p class="couponThumb">\n          <span class="couponName">优惠劵</span>\n          <span class="couponNum" ng-bind="firstCoupon?(couponlist.length+1):couponlist.length+\'张可用\'"></span>\n          <span ng-if="checkedCouponInfo.couponType==\'none\'"></span>\n          <span ng-if="checkedCouponInfo.couponType==\'firstsub\'">-&yen;{{checkedCouponInfo.firstsub|xiaomaiprice}}</span>\n          <span ng-if="checkedCouponInfo.couponType==\'othercoupon\'">-&yen;{{checkedCouponInfo.coupon.money|xiaomaiprice}}</span>\n          <i class="iconfont icon-yfmore showMore" ng-click="gotoCoupon($event);">{{orderItem.skuNum}}</i>\n        </p>\n      </div>\n    </div>\n<!-- 支付信息-->\n    <div class="block_bg" ng-controller="orderOnlinepayCtrl">\n      <p class="title payTypeTitle">支付方式</p>\n      <div class="contents">\n        <div class="content_column pay_column" ng-click="choosePaytype($event,1);">\n          <i class="iconfont icon-weixin"></i>\n          <span class="payTypeNote">微信支付</span>\n          <i class="payCheckeBox deliveryRadioBtn" ng-class="{checked:payType==1}"></i>\n        </div>\n        <div class="content_column pay_column" ng-click="choosePaytype($event,2);">\n          <i class="iconfont icon-zhifubao"></i>\n          <span class="payTypeNote">支付宝支付</span>\n          <i class="payCheckeBox deliveryRadioBtn" ng-class="{checked:payType==2}"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n<!--倒计时-->\n<footer class="fixOrderFooter clear">\n  <div class="pos_a pos_tab info f12 moveL">\n    <div class="thumbInfo">\n      <p ng-controller="orderAmountCtrl">\n        合计:\n        <i class="totalPrice" ng-bind="\'&yen;\'+((totalAmount+totalFreight-totalCoupon)>0?(totalAmount+totalFreight-totalCoupon):1|xiaomaiprice)">&yen;0.01</i>\n      </p>\n      <p class="js_countdown_info" ng-controller="orderCountdownCtrl">请在{{realremaintime|xiaomaimoment}}内支付否则订单自动失效</p>\n    </div>\n  </div>\n  <span class="confirmBtn" ng-class="{disabled:lock}" ng-click="confirm($event);" ng-controller="orderConfirmCtrl">去支付</span>\n</footer>\n<div ui-view></div>\n<div class="confirorderloading" ng-if="isloading">正在加载......</div>\n'),e.put("../assets/views/coupon/coupon.html",""),e.put("../assets/views/feedback/feedback.html",'<div class="feedback-wrap">\n  <div class="pub-header">\n    <div back-icon class="iconfont icon-fanhui lefticon" back-icon ng-click="goBack();"></div>\n    <div class="middlearea">意见反馈</div>\n  </div>\n  <div class="feedback-main">\n    <div class="textareaCont">\n      <textarea class="feedback-cont" ng-model="feedback" placeholder="您的意见或建议是我们不断前进的巨大动力"></textarea>\n    </div>\n    <input placeholder="请留下您的联系方式(可选)" type="number" ng-model="mobile"/>\n    <div ng-click="submit();" class="icon-right submitBtn">提交</div>\n  </div>\n</div>\n'),e.put("../assets/views/goodListItem/goodListItem.html",'<div ng-class="{\'goodlistItem-column\':column&&column==\'true\',\'goodlistitem-row\':column!=\'true\'}"  ng-click="gotoDetail($event,goods);">\n  <div class="imgCont" ng-style=\'{"background-image":"url("+goods.imageUrl+")"}\'></div>\n  <div class="details">\n    <p class="goodname">{{goods.sourceType==2?goods.activityGoodsName:goods.bgGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n    <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in goods.distributeTypeDisplay track by $index" ng-show="label.length">{{label}}</label>\n    <p class="priceCont">\n<!-- 单品或者组合最高价-->\n      <span class="new-price" ng-if="goods.goodsType!=3">\n        &yen;<i>{{goods.sourceType==2?goods.skuList[0].activityPrice:goods.skuList[0].wapPrice|xiaomaiprice}}</i>\n      </span>\n      <span class="old-price" ng-if="goods.goodsType!=3">\n        &yen;{{goods.skuList[0].originPrice|xiaomaiprice}}\n      </span>\n<!-- 聚合 -->\n      <span class="aggregate-price" ng-if="goods.goodsType==3">\n        &yen;{{goods.minWapPrice|xiaomaiprice}} ~ &yen;{{goods.maxWapPrice|xiaomaiprice}}\n      </span>\n    </p>\n    <p class="buy-icon iconfont icon-tianjiagouwuche" ng-class="{paying:goods.isPaying}" ng-click="buyHandler($event,good);" ng-if="goods.goodsStatusDisplay==2"></p>\n    <p class="iconfont icon-buhuozhong sold-out" ng-if="goods.goodsStatusDisplay==3"></p>\n    <p class="iconfont icon-dayangle close-time" ng-if="goods.goodsStatusDisplay==5"></p>\n  </div>\n</div>\n'),e.put("../assets/views/goodListItem/goodListItemSk.html",'<div class="goodItem goodlistitem-row" ng-click="gotoDetail($event);">\n  <div class="imgCont" ng-style=\'{"background-image":"url("+goods.imageUrl+")"}\'>\n<!--如果活动未开始-->\n    <p class="countdown" ng-if="goods.killStarted==0">\n      距开始\n      <span count-dead-call="timecountdown(timeid);" countdown counttime="{{goods.timeBeforeStart}}" timeid="{{goods.activityBgGoodsId}}"></span>\n    </p>\n    <!-- 活动已开始且没有被抢空-->\n    <p class="countdown" ng-if="goods.killStarted==1 && !goods.killed && goods.goodsStatusDisplay==2">\n      距结束\n      <span count-dead-call="timecountdown();" countdown counttime="{{goods.buyLeftTime}}"></span>\n    </p>\n  </div>\n  <div class="details">\n    <p class="goodname">{{goods.activityGoodsName}}</p>\n<!-- 输出标签29分钟达/次日达 -->\n    <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in goods.distributeTypeDisplay track by $index" ng-show="label.length">{{label}}</label>\n    <p class="priceCont">\n<!-- 单品或者组合最高价-->\n      <span class="new-price">\n        &yen;<i>{{goods.skuList[0].activityPrice|xiaomaiprice}}</i>\n      </span>\n      <span class="old-price">\n        &yen;{{goods.skuList[0].originPrice|xiaomaiprice}}</span>\n    </p>\n<!-- 未开始-->\n    <p class="skicon sk-snap iconfont icon-qianggou disabled" ng-if="goods.killStarted==0"></p>\n<!-- 已结束-->\n    <p class="skicon cantsnap iconfont icon-yijieshu" ng-if="goods.killStarted==2"></p>\n<!-- 已经售空-->\n    <p class="skicon cantsnap sold-out iconfont icon-buhuozhong" ng-if="goods.killStarted==1 && goods.goodsStatusDisplay==3"></p>\n<!-- 已经抢过了 -->\n    <p class="skicon cantsnap sk-geted iconfont icon-yiqianggou" ng-if="goods.killStarted==1 && goods.killed"></p>\n<!-- 抢购开始 & 没抢购过 & 商品上架状态 -->\n    <p class="skicon sk-snap iconfont icon-qianggou" ng-class="{paying:goods.isPaying}" ng-click="buyHandler($event,good,$index);" ng-if="goods.killStarted==1 && !goods.killed && goods.goodsStatusDisplay==2"></p>\n<!--打烊了-->\n    <p class="skicon cantsnap sk-snap iconfont icon-dayangle" ng-if="goods.killStarted==1 && goods.goodsStatusDisplay==5"></p>\n  </div>\n</div>\n'),e.put("../assets/views/gooddetail/gooddetail.html",'<!-- 聚合类商品选中了最小单元-->\n<div class="imgCont" ng-if="skuInfo&&good.goodsType==3" ng-style="{\'background-image\':\'url(\'+(skuInfo&&skuInfo.imageUrl?skuInfo.imageUrl:good.imageUrl)+\')\'}"></div>\n<!--非聚合类商品或者聚合类商品没有选中最小单元-->\n\n<div class="imgCont" ng-if="(!skuInfo || good.goodsType!=3) && good.goodsImageList.length==1" ng-style="{\'background-image\':\'url(\'+good.goodsImageList[0].imageUrl+\')\'}"></div>\n\n<div class="gooddetail-swiper" ng-if="(!skuInfo || good.goodsType!=3) && good.goodsImageList.length>1">\n  <div class="gooddetail-swiper-nums">\n    <i class="gooddetail-swiper-num" ng-class="{active:swiperIndex==$index}" ng-repeat="goodsImage in good.goodsImageList"></i>\n  </div>\n  <div class="gooddetail-swiper-prev-btn iconfont icon-fanhui" ng-class="{disabled:swiperIndex==0}" ng-click="swiperSlider($event,\'prev\')">\n  </div>\n  <div class="gooddetail-swiper-next-btn iconfont icon-yfmore" ng-class="{disabled:swiperIndex==good.goodsImageList.length-1}" ng-click="swiperSlider($event,\'next\')">\n\n  </div>\n  <ks-swiper-container on-ready="onReadySwiper(swiper)" swiper="swiper" initial-slide="0">\n    <ks-swiper-slide class="swiper-slide" ng-repeat="goodsImage in good.goodsImageList">\n      <div class="gooddetail-swiper-item" style="background-image:url({{goodsImage.imageUrl}});"></div>\n    </ks-swiper-slide>\n  </ks-swiper-container>\n</div>\n\n<div class="good-normal-info">\n  <label class="label" ng-class="{\'ldc\':$index==0,\'rdc\':$index===1}" ng-repeat="label in good.distributeTypeDisplay track by $index" ng-show="label.length">{{label}}</label>\n<!--产品名称-->\n  <p class="title">{{good.sourceType==2?good.activityGoodsName:good.bgGoodsName}}</p>\n<!--产品价格-->\n  <p class="priceCont" ng-if="skuInfo">\n    <span class="new-price">&yen;<i>{{good.sourceType==2?skuInfo.activityPrice:skuInfo.wapPrice|xiaomaiprice}}</i></span>\n    <span class="old-price">&yen;{{skuInfo.originPrice|xiaomaiprice}}</span>\n  </p>\n  <p class="priceCont" ng-if="!skuInfo">\n    <span class="aggregate-price">&yen;{{good.minWapPrice|xiaomaiprice}}</span>\n    <span class="f14 aggregate-price">\n      ~&yen;{{good.maxWapPrice|xiaomaiprice}}\n    </span>\n  </p>\n<!--普通类活动-->\n  <div ng-if="good.isSeckill!=1">\n<!--如果没有货 显示补货中-->\n    <p class="skicon cantsnap sk-snap iconfont icon-buhuozhong" ng-if="good.goodsStatusDisplay==3"></p>\n    <!--下架-->\n    <p class="skicon cantsnap sk-snap iconfont icon-buhuozhong" ng-if="good.goodsStatusDisplay==4"></p>\n    <p class="skicon cantsnap sk-snap iconfont icon-dayangle" ng-if="good.goodsStatusDisplay==5"></p>\n<!--进行数量选择-->\n    <p class="buy-handler-cont " ng-if="good.goodsStatusDisplay==2">\n      <span class="buy-handler iconfont icon-jianqugouwuche" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'minus\');" ng-hide="!skuInfo||!numInCart||numInCart==0"></span>\n<!--当前已经购买的数量 -->\n      <span class="buy-result">{{numInCart}}</span>\n      <span class="buy-handler iconfont icon-tianjiagouwuche buy-icon" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'plus\');"></span>\n    </p>\n  </div>\n<!--秒杀类产品-->\n  <div ng-if="good.isSeckill==1">\n<!--倒计时-->\n    <p class="countdown" ng-if="good.killStarted==0">\n      距开始\n      <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.timeBeforeStart}}" timeid="{{good.activityBgGoodsId}}"></span>\n    </p>\n<!-- 活动已开始同时没有被抢空-->\n    <p class="countdown" ng-if="good.killStarted==1 && good.goodsStatusDisplay!=3 &&!good.killed">\n      距结束\n      <span count-dead-call="timecountdown(timeid);" countdown counttime="{{good.buyLeftTime}}" timeid="{{good.activityBgGoodsId}}"></span>\n    </p>\n    <p class="skicon sk-snap iconfont icon-qianggou disabled" ng-if="good.killStarted==0"></p>\n<!-- 已结束-->\n    <p class="skicon cantsnap iconfont icon-yijieshu" ng-if="good.killStarted==2"></p>\n<!-- 已经售空-->\n    <p class="skicon cantsnap sold-out iconfont icon-buhuozhong" ng-if="good.killStarted==1 && good.goodsStatusDisplay==3"></p>\n    <p class="skicon cantsnap sold-out iconfont icon-buhuozhong" ng-if="good.killStarted==1 && good.goodsStatusDisplay==4"></p>\n\n<!-- 已经抢过了 -->\n    <p class="skicon cantsnap sk-geted iconfont icon-yiqianggou" ng-if="good.killStarted==1 && good.killed"></p>\n<!-- 抢购开始 & 没抢购过 & 商品上架状态 -->\n    <p class="skicon sk-snap iconfont icon-qianggou" ng-class="{paying:good.isPaying}" ng-click="buyHandler($event,\'plus\',true);" ng-if="good.killStarted==1 && !good.killed && good.goodsStatusDisplay==2"></p>\n<!--打烊了-->\n    <p class="skicon cantsnap sk-snap iconfont icon-dayangle" ng-if="good.killStarted==1 && good.goodsStatusDisplay==5"></p>\n  </div>\n</div>\n\n<!-- 如果是第三方卖家-->\n<p class="thirdsellertip" ng-if="good.storageName&&good.storageName.length">本商品由<span>{{good.storageName}}</span>提供服务</p>\n\n<!--如果是聚合类产品-->\n<div class="complex-properties" ng-if="good.goodsType==3">\n  <div class="complex-property" ng-repeat="goodProperty in good.skuGoodsPropertyList">\n    <p class="complex-property-name">{{goodProperty.propertyName}}</p>\n    <div class="complex-property-values">\n      <span ng-class="{disabled:valueItem.disabled,checked:checkedProperties[goodProperty.propertyNameId]==valueItem.propertyValueId}" ng-click="complexCheckProperty($event,goodProperty.propertyNameId,valueItem)" ng-repeat="valueItem in goodProperty.propertyValues">{{valueItem.propertyValue}}</span>\n    </div>\n  </div>\n</div>\n\n<!-- 产品描述-->\n<div class="detail-info" ng-if="good.saleSpec && good.saleSpec.length">\n  <div class="detail-info-key">产品规格:</div>\n  <div class="detail-info-main">{{good.saleSpec}}/{{good.unit}}</div>\n</div>\n<div class="detail-info" ng-if="good.originPlace && good.originPlace.length">\n  <div class="detail-info-key">产地:</div>\n  <div class="detail-info-main">{{good.originPlace}}</div>\n</div>\n<div class="detail-info" ng-if="good.packageSpec && good.packageSpec.length">\n  <div class="detail-info-key">产品包装:</div>\n  <div class="detail-info-main">{{good.packageSpec}}</div>\n</div>\n<div class="detail-info" ng-if="good.brand && good.brand.length">\n  <div class="detail-info-key">品牌:</div>\n  <div class="detail-info-main">{{good.brand}}</div>\n</div>\n<div class="detail-info" ng-if="good.shelfLife && good.shelfLife.length">\n  <div class="detail-info-key">保质期:</div>\n  <div class="detail-info-main">{{good.shelfLife}}</div>\n</div>\n<div class="detail-desc" ng-if="good.goodsDesc && good.goodsDesc.length">{{good.goodsDesc}}</div>\n<div class="detail-desc" ng-if="good.activityGoodsDesc && good.activityGoodsDesc.length">{{good.activityGoodsDesc}}</div>\n\n<!-- 图文详情-->\n<div class="detail-graphics" ng-if="good.goodsDetailImageList && good.goodsDetailImageList.length">\n  <img ng-src="{{goodsDetailImage.imageUrl}}" class="detail-graphic" ng-repeat="goodsDetailImage in good.goodsDetailImageList track by $index"/>\n</div>\n'),e.put("../assets/views/locate/locate.html",'<div class="pub-header">\n  <div class="iconfont icon-fanhui lefticon" ng-click="goback();"></div>\n  <div class="middlearea">选择学校</div>\n</div>\n<div class="colleges_content" xiaomai-iscroll subname="{{\'locateheightupdate\'}}">\n  <div class="">\n    <p class="title">定位学校</p>\n    <div class="localColleges">\n      <p class="locateerrortip" ng-if="islocating">正在进行定位</p>\n      <p class="locateerrortip" ng-if="haserror">小麦迷路了,手动选择一下吧</p>\n      <p class="locateCollege" ng-class="{holiday:item.isOpen!=1}" ng-click="checkCollege($event,item,$index)" ng-repeat="item in locationResult">{{item.collegeName}}</p>\n    </div>\n    <p class="title">手动选择</p>\n    <div class="allSchools">\n      <ul class="citylist">\n        <li ng-class="{checked:item.cityId==curcityid}" ng-click="showCollegeList(item);" ng-repeat="item in citylist">\n          {{item.cityName}}\n          <i class="iconfont icon-yfmore"></i>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/nav/nav.html",'<div class="pub-header" ng-controller="nav.headCtrl">\n  <div class="lefticon iconfont icon-gerenzhongxin usercenter" ng-click="gotoFeedback($event);"></div>\n  <div class="location-info icon-school middlearea" ng-click="gotoLocate($event);">\n    <i class="locate icon-locate iconfont"></i>\n    {{schoolname}}\n    <i class="changeLocate"></i>\n  </div>\n  <div class="iconfont icon-sousuo righticon" ng-click="gotoSearch($event);"></div>\n</div>\n<div class="list-main main-both">\n  <div class="list-category" subname="{{\'navheightupdate\'}}" xiaomai-iscroll>\n    <ul ng-controller="nav.listCtrl">\n      <li class="nav nav-super nav-mark-{{nav.labelType}}" ng-class="{\'nav-checked\':navChecked(nav)}" ng-click="goto($event,nav);" ng-if="nav.displayType!=3" ng-repeat="nav in navs">{{nav.navigateName}}</li>\n      <li class="nav nav-parent" ng-init="isShowSub=true;">\n        <p class="arrow-down" ng-class="{\'arrow-up\':!isShowSub}" ng-click="triggleSub($event);">商品分类</p>\n        <ul ng-show="isShowSub">\n          <li class="nav-sub nav-mark-{{subnav.labelType}}" class="nav-sub" ng-class="{\'nav-checked\':subnav.categoryId==curcategoryId}" ng-click="goto($event,subnav);" ng-if="subnav.displayType==3" ng-repeat="subnav in navs">{{subnav.navigateName}}</li>\n        </ul>\n      </li>\n    </ul>\n  </div>\n  <div class="list-product" down-tip-cls="{{\'navmain-downtip\'}}" pubname="{{\'navmainscrollupdate\'}}" subname="{{\'navmainheightstatus\'}}" up-tip-cls="{{\'navmain-uptip\'}}" xiaomai-iscroll>\n    <div ui-view></div>\n  </div>\n</div>\n'),
e.put("../assets/views/payFail/payFail.html",'<div class="pub-header">\n  <div class="location-info icon-school middlearea">支付信息</div>\n  <div class="righticon closeWindow" ng-click="closeWindow($event)">关闭</div>\n</div>\n<div class="container" id="payFailPage">\n  <div class="pos_order" id="list_order">\n    <div id="orderScroller">\n      <div class="wrapForm f14">\n        <div class="block_bg" id="payFailBlock">\n          <div class="wrapLeftInfo fl">\n            <span>\n              <i class="fl iconfont icon-jinggao"></i>\n              <strong class="fl">支付失败</strong>\n            </span>\n            <span>如果您已付款，请稍后查看订单。<br/>或检查您的支付账户。</span>\n          </div>\n          <div class="wrapRtImg fr">\n            <i class="i_failImgBox"></i>\n          </div>\n          <div class="clear"></div>\n        </div>\n      </div>\n      <div class="rePayWrap">\n        <span class="btn_bg_pos btn_bg_on js_repay btn_cart" ng-click="gotoIndex($event);">重新支付</span>\n      </div>\n      <div class="cancelOrderWrap">\n        <span class="btn_bg_pos btn_bg_normal cancelOrder" ng-click="deleteOrder($event);">\n          取消订单\n        </span>\n      </div>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/paySuccess/paySuccess.html",'<div class="pub-header">\n  <div class="location-info icon-school middlearea">支付信息</div>\n  <div class="righticon closeWindow" ng-click="goback($event)">关闭</div>\n</div>\n<div class="container" id="paySucPage">\n  <header class="fixHeader">\n    <div class="wrap_title">\n<!-- <i class="i_back canBack"></i> -->\n      <i class="btn_close" ng-click="closeWindow($event)">关闭</i>\n      <h2 class="tx_pos">支付信息</h2>\n    </div>\n  </header>\n  <div class="pos_order" id="list_order">\n    <div id="orderScroller">\n      <div class="wrapForm f14">\n        <div class="block_bg" id="paySucBlock">\n          <div class="wrapLeftInfo fl">\n            <span>\n              <i class="fl iconfont icon-ok1"></i>\n              <a class="toBonus"></a>\n              <strong class="fl">支付成功</strong>\n            </span>\n            <span>我们将会很快送货到您手中，<br/>请耐心等待！</span>\n          </div>\n          <div class="wrapRtImg fr">\n            <i class="i_succImgBox"></i>\n          </div>\n          <div class="clear"></div>\n        </div>\n      </div>\n      <div class="rePayWrap">\n        <span class="btn_bg_pos btn_bg_on js_repay btn_cart" ng-click="gotoIndex($event);">返回首页</span>\n      </div>\n      <div class="showOrderWrap" ng-click="queryOrderDetail($event);">\n        <span class="btn_bg_pos btn_bg_normal checkDetail">\n          查看订单详情\n        </span>\n      </div>\n    </div>\n  </div>\n  <div id="toShare">\n    <div class="share_mask" ng-show="showRedpacketDialog"></div>\n    <div class="share_box" ng-show="showRedpacketDialog">\n      <div class="share_pic"></div>\n      <h2>\n        小麦助你做土豪<br>10个红包在这里，拿去随便发！\n      </h2>\n      <div>\n        <a class="left_button" ng-click="cancelSendRedpacket($event);">取消</a>\n        <a class="right_button" ng-click="goRedpacket($event);">去发红包</a>\n      </div>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/recommend/recommend.html",'<div class="recommendCategoryCont">\n  <div class="errortip" ng-if="haserror">\n    暂无推荐商品,去类目看看吧\n  </div>\n  <div class="loading" ng-if="isloading">\n    正在加载......\n  </div>\n  <div class="" ng-repeat="item in categorys track by $index">\n    <div class="recommendCateTitle">\n      <h3>{{item.category.categoryName}}</h3>\n      <span class="iconfont icon-yfmore" ng-click="gotocategory(item);"></span>\n    </div>\n    <div class="recommendCateColumn">\n      <div ng-repeat="goods in item.goods track by $index">\n        <div xiaomai-good-list-item goods="goods" detail-source-event="recommend" click-event="m_b_31homepagetabrecadd+dataid{{goods.goodsId}}+category{{$parent.$index+1}}+good{{$index+1}}" source-event="m_r_31cartfromrecommend+dataid{{goods.goodsId}}+category{{$parent.$index+1}}+good{{$index+1}}"></div>\n      </div>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/root/root.html","<div ui-view></div>\n"),e.put("../assets/views/search/search.html",'<div class="pub-header search-handler">\n  <div class="lefticon iconfont icon-fanhui" ng-click="goback();"></div>\n  <div class="middlearea">\n    <input autofocus tabindex="1" ng-change="updateSearchKey($event)" maxlength="20" ng-keypress="updatesearch($event,searchkey);" class="searchtext" ng-model="searchkey" type="text"/>\n  </div>\n  <div class="righticon searchbtn" ng-class="{disabled:!searchkey || searchkey.length==0}" ng-click="gotosearch($event,searchkey);">搜索</div>\n</div>\n<div class="searchhistory" ng-controller="searchrecordCtrl" ng-show="showCookie">\n    <p class="searchhistory-tip">搜索历史</p>\n    <ul class="searchhistory-list" ng-show="cookies.length">\n      <li ng-click="goresult($event,cookie.name);"  ng-repeat="cookie in cookies track by $index">{{cookie.name}}</li>\n    </ul>\n    <p class="searchhistory-norecord" ng-show="!cookies.length">暂无搜索记录</p>\n    <p class="searchhistory-clean" ng-show="cookies.length" ng-click="cleancookie($event);">清除历史</p>\n</div>\n<!--搜索提示列表-->\n<div ng-controller="searchsuggestCtrl" ng-show="showSuggest" class=searchsuggests>\n  <ul class="searchtiplist">\n      <li  ng-repeat="suggest in suggests" ng-click="goresult($event,suggest);">{{suggest}}</li>\n  </ul>\n  <p class="searchsuggest-loading" ng-if="isloading">正在请求数据</p>\n</div>\n'),e.put("../assets/views/search/searchresult.html",'<div class="pub-header search-handler">\n  <div class="lefticon iconfont icon-fanhui" ng-click="gohomepage($event);"></div>\n  <div class="middlearea">\n    <p class="searchtext" ng-click="gotosearch($event,searchkey)">{{searchkey}}</p>\n    <i class="iconfont icon-guanbi1 delsearchkey" ng-click="gotosearch($event);"></i>\n  </div>\n  <div class="righticon searchbtn" ng-click="gotosearch($event);">取消</div>\n</div>\n<div class="search-result-cont" down-tip-cls="{{\'navmain-downtip\'}}" pubname="{{\'searchresultscrollupdate\'}}" subname="{{\'searchresultheightupdate\'}}" up-tip-cls="{{\'navmain-uptip\'}}" xiaomai-iscroll>\n    <div class="loadingAnimation" ng-if="loading"></div>\n    <div class="loadText" ng-if="isloading">小麦麦正在努力搜索中...</div>\n    <div class="haserror errorip" ng-if="haserror">小麦没有找到与"{{searchkey}}"相关的商品<br/>试试搜索其他商品吧~~</div>\n    <ul>\n        <li ng-repeat="good in goods track by $index" ng-if="good">\n          <div xiaomai-good-list-item goods="good" detail-source-event="search" click-event="m_b_31searchadd" source-event="m_r_31cartfromsearch"></div>\n        </li>\n    </ul>\n</div>\n'),e.put("../assets/views/sharedetail/sharedetail.html",'<div class="shareGoodDetail">\n  <div class="goodDetailWrap detailCont" subname="{{\'sharedetailheightupdate\'}}" xiaomai-iscroll>\n    <div>\n      <div good-detail goods-id="goodsId" image-loaded-call="imageLoadedCall();" source-type="sourceType" load-success="loadDetailSuccess();"></div>\n    </div>\n  </div>\n</div>\n'),e.put("../assets/views/user/user.html",'<div class="user-wrap">\n    <div class="pub-header">\n        <div class="iconfont icon-fanhui lefticon" ng-click="goHome($event);"></div>\n        <div class="middlearea">个人中心</div>\n    </div>\n    <div class="user-main">\n        <div class="user-Info">\n            <div class="user-name">{{userInfo.userName}}</div>\n            <div class="user-phone">{{userInfo.phone}}</div>\n        </div>\n        <ul class="user-list">\n            <li class="user-myOrder" ng-click="gotoMyOrder($event);">\n                <i class="iconfont icon-dingdan"></i>我的订单<i class="iconfont icon-yfmore"></i>\n            </li>\n            <!--\n            <li style="display:none">\n                <i class="iconfont icon-credit"></i> 我的积分\n                <span class="user-list-detail"></span>\n                <i class="iconfont icon-yfmore"></i>\n            </li>\n          -->\n            <li class="user-couponList" ng-click="gotoCoupon($event);" >\n                <i class="iconfont icon-youhuiquan"></i> 我的优惠券\n                <span class="user-list-detail" ng-if="coupons.length">{{coupons.length}}张</span>\n                <i class="iconfont icon-yfmore"></i>\n            </li>\n        </ul>\n        <ul class="user-public">\n            <li class="user-feedback" ng-click="gotofeedback($event)">\n                <i class="iconfont icon-fankui"></i>意见反馈<i class="iconfont icon-yfmore"></i>\n            </li>\n            <li class="user-contactUs">\n                <i class="iconfont icon-kefu"></i> 联系客服\n                <span class="user-public-detail"> <a href="tel:400-1249876">400-1249876</a></span>\n                <i class="iconfont icon-yfmore"></i>\n            </li>\n        </ul>\n    </div>\n</div>\n'),e.put("../assets/views/wechartprepay/wechartprepay.html",'<div class="pub-header">\n  <div class="lefticon iconfont icon-fanhui" style="display:none;"></div>\n  <div class="location-info icon-school middlearea">订单详情</div>\n</div>\n<div class="order_contents" subname="{{\'wechartPayHeightUpdate\'}}" xiaomai-iscroll>\n  <div style="overflow:auto;">\n<!--收货信息-->\n    <div class="block_bg">\n      <p class="title addrTitle">收货信息</p>\n      <div class="addrInfo">\n        <span class="username">{{order.receiverName}}</span>\n        <span class="telephone">{{order.receiverPhone}}</span>\n        <p class="college">{{order.collegeName}}</p>\n      </div>\n    </div>\n<!-- 第三方订单-->\n    <div class="block_bg" ng-repeat="orderInfo in order.childOrderList" ng-if="orderInfo.distributeType==2">\n      <p class="title thirdsellerTitle">第三方卖家商品订单</p>\n      <div class="contents">\n        <p class="orderDistribute">\n          <span class="orderDistribute-key">配送地址</span>\n          <span class="orderDistribute-values">{{orderInfo.deliveryAddress}}</span>\n        </p>\n        <div ng-repeat="thirdOrder in orderInfo.th3ChildOrderList">\n          <p class="subTitle rdcSubTitle">{{thirdOrder.storageName}}</p>\n          <p class="orderChildGoods" ng-repeat="orderItem in thirdOrder.childOrderDetailList">\n            <span class="goodname">{{orderItem.skuName}}</span>\n            <span class="price">&yen;{{orderItem.skuPrice|xiaomaiprice}}</span>\n            <span class="count">{{orderItem.skuNum}}</span>\n          </p>\n          <div class="orderDistribute">\n            <span class="orderDistribute-key">配送服务费</span>\n            <p class="orderDistribute-values">\n              <span class="ldcOrderFreight orderfreight" ng-bind="\'&yen;\'+(thirdOrder.freight-thirdOrder.freightSub|xiaomaiprice)"></span>\n              <span class="ldcOrderFreightSub orderfreightsub" ng-bind="\'&yen;\'+(thirdOrder.freight|xiaomaiprice)"></span>\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n<!-- 次日达订单-->\n    <div class="block_bg" ng-repeat="orderInfo in order.childOrderList" ng-if="orderInfo.distributeType==0">\n      <p class="title rdcTitle">次日达订单</p>\n      <div class="contents">\n        <div class="orderDistribute">\n          <span class="orderDistribute-key">门店自提</span>\n          <p class="orderDistribute-values">{{orderInfo.deliveryAddress}}</p>\n        </div>\n        <p class="subTitle rdcSubTitle">小麦特供</p>\n        <p class="orderChildGoods" ng-repeat="orderItem in orderInfo.childOrderDetailList">\n          <span class="goodname">{{orderItem.skuName}}</span>\n          <span class="price">&yen;{{orderItem.skuPrice|xiaomaiprice}}</span>\n          <span class="count">*{{orderItem.skuNum}}</span>\n        </p>\n      </div>\n    </div>\n<!-- 当日达订单-->\n    <div class="block_bg" ng-repeat="orderInfo in order.childOrderList" ng-if="orderInfo.distributeType==1">\n      <p class="title ldcTitle">当日达订单</p>\n      <div class="contents">\n        <div class="orderDistribute">\n          <span class="orderDistribute-key">配送方式</span>\n          <p class="orderDistribute-values">\n            <span class="deliveryRadio" ng-if="orderInfo.deliveryType==0">\n              门店自提\n            </span>\n            <span class="deliveryRadio" ng-if="orderInfo.deliveryType==1">\n              送货上门\n            </span>\n          </p>\n        </div>\n        <div class="orderDistribute" ng-if="orderInfo.deliveryType==0">\n          <span class="orderDistribute-key">自提地址</span>\n          <p class="orderDistribute-values">{{orderInfo.selfPickUpAddress}}</p>\n        </div>\n        <div class="orderDistribute" ng-if="orderInfo.deliveryType==1">\n          <span class="orderDistribute-key">配送地址</span>\n          <p class="orderDistribute-values">{{orderInfo.deliveryAddress}}</p>\n        </div>\n        <div class="orderDistribute orderDistributeTime" ng-if="orderInfo.deliveryType==1">\n          <span class="orderDistribute-key">配送时间</span>\n          <p class="orderDistribute-values">{{orderInfo.deliveryBeginTime|date:\'yyyy-MM-dd HH:mm\'}}~{{orderInfo.deliveryEndTime|date:\'yyyy-MM-dd HH:mm\'}}</p>\n        </div>\n        <div class="orderDistribute orderDistributeFreight" ng-if="orderInfo.deliveryType==1">\n          <span class="orderDistribute-key">配送服务费</span>\n          <p class="orderDistribute-values">\n            <span class="ldcOrderFreight orderfreight">&yen;{{orderInfo.freight-orderInfo.freightSub|xiaomaiprice}}</span>\n          </p>\n        </div>\n        <div class="orderDistribute orderDistributeFreight" ng-if="orderInfo.deliveryType==1">\n          <span class="orderDistribute-key">备注</span>\n          <p class="orderDistribute-values">{{orderInfo.remark}}</p>\n        </div>\n        <p class="subTitle ldcSubTitle">小麦特供</p>\n        <p class="orderChildGoods" ng-repeat="orderItem in orderInfo.childOrderDetailList">\n          <span class="goodname">{{orderItem.skuName}}</span>\n          <span class="price">&yen;{{orderItem.skuPrice|xiaomaiprice}}</span>\n          <span class="count">*{{orderItem.skuNum}}</span>\n        </p>\n      </div>\n    </div>\n  </div>\n</div>\n<footer class="fixOrderFooter fixwechartpayFooter clear">\n  <div class="prepayprice">合计:<span>&yen;{{order.totalPay|xiaomaiprice}}</span></div>\n  <span class="confirmBtn" ng-class="{disabled:lock}" ng-click="toPay($event);">去支付</span>\n</footer>\n')}]),angular.module("xiaomaiApp").directive("countdown",["$interval",function(e){function n(e){var n,o,a,t=function(e){return 10>e?"0"+e:e},i=3600,r=60,s=1;return e=Number(e),n=Math.floor(e/i),e%=i,o=Math.floor(e/r),e%=r,a=Math.floor(e/s),[t(n),t(o),t(a)].join(":")}var o=function(o,a,t){var i=o.counttime,r=e(function(){return 0==i?(e.cancel(r),o.countDeadCall(),!1):(i-=1,void a.html(n(i)))},1e3)};return{template:"<span></span>",scope:{counttime:"@",countDeadCall:"&"},link:o,replace:!0}}]),angular.module("xiaomaiApp").directive("xiaomaiIscroll",["xiaomaiMessageNotify","$timeout","$state","systemInfo",function(e,n,o,a){var t=function(o,t,i){var r,s=document.createElement("p");s.className+=" "+o.upTipCls;var c=document.createElement("p");c.className+=" "+o.downTipCls;var l=new IScroll(t[0],{click:!0,tap:!0,probeType:2,bounce:"android"==a.platform.toLowerCase()?!1:!0}),d=function(e,n){var o=t.children()[0];s.textContent=e,c.textContent=n,s.className=s.className.replace("pending","").trim(),c.className=c.className.replace("pending","").trim(),o.firstChild!=s&&o.insertBefore(s,o.firstChild),o.lastChild!=c&&o.appendChild(c)};o.scrollstatus="ready",l.on("scrollStart",function(){});var u,p,g=setTimeout(function(){var e=t.children()[0];p=e.offsetHeight-t[0].offsetHeight,l&&l.refresh()},1e3);l.on("scrollEnd",function(){Math.abs(this.y)==p&&(u&&clearTimeout(u),u=setTimeout(function(){e.pub(o.pubname,"down"),o.scrollstatus="pending"},10))}),o.subname&&e.sub(o.subname,function(e,n,a,i){var r=t.children()[0];"up"==e?"ready"==n?(o.scrollstatus="ready",s.className=s.className.replace(/\s?pending\s?/,""),g&&clearTimeout(g),g=null,setTimeout(function(){l&&l.refresh(),p=r.offsetHeight-t[0].offsetHeight,l.scrollTo(0,0),d(a,i)},50)):(o.scrollstatus="pending",s.className=s.className+" pending",s.textContent=a,l&&l.refresh()):"down"==e&&("ready"==n?(o.scrollstatus="ready",g&&clearTimeout(g),g=null,c.className=c.className.replace(/\s?pending\s?/,""),setTimeout(function(){l&&l.refresh(),p=r.offsetHeight-t[0].offsetHeight,d(a,i)},50)):(o.scrollstatus="pending",c.className=c.className+" pending",c.textContent=a,l&&l.refresh()))}),o.$on("$destroy",function(){l&&l.destroy(),n.cancel(r),l=null,e.remove(o.subname)})};return{scope:{pubname:"@",subname:"@",options:"@",upTipCls:"@",downTipCls:"@"},link:t}}]),angular.module("xiaomaiApp").controller("buy.activeCtrl",["$scope","$state","xiaomaiService","buyProcessManager","xiaomaiCacheManager","xiaomaiMessageNotify","wxshare","getRouterTypeFromUrl","schoolManager","xiaomaiLog",function(e,n,o,a,t,i,r,s,c,l){var d,u=n.params.activityId,p=1;e.activityId=u,e.isloading=!0,c.get().then(function(e){return d=e.collegeId,g()}).then(function(e){return m(e)})["finally"](function(){if(e.isloading=!1,e.haserror)e.errortip="活动已结束,将跳转到首页",setTimeout(function(){n.go("root.buy.nav.all")},300);else{var o=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("activeheightstatus","up","ready","",o?"请求下一页数据":""),f()}});var g=function(){return o.fetchOne("activeGoods",{collegeId:d,activityId:u,currentPage:p,recordPerPage:10}).then(function(n){return e.activityShowName=n.activityShowName,e.goods=n.goods,e.paginationInfo=n.paginationInfo,e.haserror=e.goods.length?!1:!0,e.haserror?!1:!0},function(){return e.haserror=!0,!1})},m=function(n){return n?o.fetchOne("activeBanner",{collegeId:d,activityId:u}).then(function(n){return angular.forEach(n.banners,function(e){e.imageUrl+="&imageView2/0/w/600"}),e.banners=n.banners,n}):!1},f=function(){r({title:"小麦特供-"+e.activityShowName,imgUrl:"http://xiaomai-p2p.qiniudn.com/2b7ef2e2c2ce364303283bf49131a40f",desc:"小麦特供,便宜有好货,赶快点进来看看吧!"})};l("m_p_31singleactivity+"+u),l("m_r_31activefrom"+n.params.refer);var v=i.sub("detailGuiManager",function(e){"hide"==e&&setTimeout(function(){f()},100)}),h=i.sub("activeiscrollupdate",function(n){"down"==n&&e.paginationInfo.currentPage!=e.paginationInfo.totalPage&&(i.pub("activeheightstatus","down","pending","","正在请求数据"),!y&&b().then(function(n){var o=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("activeheightstatus","down","ready","",o?"请求下一页数据":"")}))});e.$on("$destroy",function(){i.removeOne("activeiscrollupdate",h),i.removeOne("detailGuiManager",v)}),e.showShareModel=function(){i.pub("shareModelManager","show"),i.pub("maskManager","show")},e.goback=function(){n.go("root.buy.nav.all")},e.gotoActive=function(e){var o=s(e.hrefUrl,d);return o.hasOwnProperty("path")?window.location.href=o.path:n.go(o.name,angular.extend(o.params,{r:"activebanner+"+u})),!1},e.gotoDetail=function(e,n){return i.pub("detailGuiManager","show",n.activityGoodsId,n.sourceType,"active"+u),!1};var y=!1,b=function(){return y?!1:(y=!0,o.fetchOne("activeGoods",{collegeId:d,activityId:u,recordPerPage:10,currentPage:e.paginationInfo.currentPage+1}).then(function(n){return y=!1,e.paginationInfo=n.paginationInfo,e.goods=e.goods.concat(n.goods),n}))}}]),angular.module("xiaomaiApp").controller("nav.activeCtrl",["$scope","$state","xiaomaiService","buyProcessManager","xiaomaiCacheManager","xiaomaiMessageNotify","getRouterTypeFromUrl","xiaomaiLog","schoolManager","wxshare",function(e,n,o,a,t,i,r,s,c,l){var d,u=n.params.activityId,p=1;e.activityId=u,e.isloading=!0,c.get().then(function(e){return d=e.collegeId,g()}).then(function(e){return m(e)})["finally"](function(){if(e.isloading=!1,e.haserror)e.errortip="活动已结束,将跳转到首页",setTimeout(function(){n.go("root.buy.nav.all")},500);else{var o=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("activeheightstatus","up","ready","",o?"请求下一页数据":""),f()}});var g=function(){return o.fetchOne("activeGoods",{collegeId:d,activityId:u,currentPage:p,recordPerPage:10}).then(function(n){return e.activityShowName=n.activityShowName,e.goods=n.goods,e.paginationInfo=n.paginationInfo,e.haserror=e.goods.length?!1:!0,e.haserror?!1:!0},function(){return e.haserror=!0,!1})},m=function(n){return n?o.fetchOne("activeBanner",{collegeId:d,activityId:u}).then(function(n){return angular.forEach(n.banners,function(e){e.imageUrl+="&imageView2/0/w/600"}),e.banners=n.banners,n}):!1},f=function(){l({title:"小麦特供-"+e.activityShowName,imgUrl:"http://xiaomai-p2p.qiniudn.com/2b7ef2e2c2ce364303283bf49131a40f",desc:"小麦特供,便宜有好货,赶快点进来看看吧!"})};s("m_p_31singleactivity+"+u);var v=i.sub("detailGuiManager",function(e){"hide"==e&&setTimeout(function(){f()},500)}),h=i.sub("activeiscrollupdate",function(n){"down"==n&&e.paginationInfo.currentPage!=e.paginationInfo.totalPage&&(i.pub("activeheightstatus","down","pending","","正在请求数据"),!y&&b().then(function(n){var o=e.paginationInfo.currentPage!=e.paginationInfo.totalPage;i.pub("activeheightstatus","down","ready","",o?"请求下一页数据":"")}))});e.$on("$destroy",function(){i.removeOne("activeiscrollupdate",h),i.removeOne("detailGuiManager",v)}),e.showShareModel=function(){i.pub("shareModelManager","show"),i.pub("maskManager","show")},e.goback=function(){n.go("root.buy.nav.all")},e.gotoActive=function(e){var o=r(e.hrefUrl,d);return o.hasOwnProperty("path")?window.location.href=o.path:n.go(o.name,angular.extend(o.params,{r:"activebanner+"+u})),!1},e.gotoDetail=function(e,n){return i.pub("detailGuiManager","show",n.activityGoodsId,n.sourceType,"active"+u),!1};var y=!1,b=function(){return y?!1:(y=!0,o.fetchOne("activeGoods",{collegeId:d,activityId:u,recordPerPage:10,currentPage:e.paginationInfo.currentPage+1}).then(function(n){return y=!1,e.paginationInfo=n.paginationInfo,e.goods=e.goods.concat(n.goods),n}))}}]),angular.module("xiaomaiApp").controller("nav.allCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiMessageNotify","xiaomaiCacheManager","xiaomaiLog",function(e,n,o,a,t,i,r){r("m_p_31tabhome"),e.activities=[];var s;e.isloading=!0,a.get().then(function(e){return s=e.collegeId,o.fetchOne("activities",{collegeId:s})}).then(function(n){e.haserror=!1,angular.forEach(n.activities,function(e){e.hasOwnProperty("wapImageUrl")&&(e.wapImageUrl=e.wapImageUrl+"&imageView2/0/w/400/q/100")}),e.activities=n.activities},function(n){e.haserror=!0})["finally"](function(){e.isloading=!1,t.pub("navmainheightstatus","up","ready","","")}),e["goto"]=function(e){return"1"==e.isLinkUrl?(window.location.href=e.linkUrl,!1):void n.go("root.buy.active",{collegeId:s,activityId:e.activityId,refer:"homepage"})}}]),angular.module("xiaomaiApp").controller("addrAddCtrl",["$scope","$state","xiaomaiService","xiaomaiCacheManager","xiaomaiLog",function(e,n,o,a,t){t("m_p_33newcontact");var i=n.params.userId,r=n.params.addrId;if(a.readCache("addrCollegeInfo")){var s=a.readCache("addrCollegeInfo");e.receiverCollegeId=s.collegeId,e.receiverCollegeName=s.collegeName}if(a.readCache("addraddInfo")){var c=a.readCache("addraddInfo");e.receiverName=c.receiverName,e.receiverPhone=c.receiverPhone,a.readCache("addrCollegeInfo")||(e.receiverCollegeId=c.receiverCollegeId,e.receiverCollegeName=c.receiverCollegeName)}e.$on("$destroy",function(){"root.addrLocate"==n.current.name?a.writeCache("addraddInfo",{receiverName:e.receiverName,receiverPhone:e.receiverPhone,receiverCollegeId:e.receiverCollegeId,receiverCollegeName:e.receiverCollegeName}):a.clean("addraddInfo");a.clean("addrCollegeInfo")}),e.goBack=function(e){e.preventDefault(),e.stopPropagation(),n.go("root.addr",{userId:i,addrId:r})},e.goLocate=function(e){e.preventDefault(),e.stopPropagation(),n.go("root.addrLocate",{r:n.current.name})},e.save=function(t){return t.preventDefault(),t.stopPropagation(),/[\w\u4e00-\u9fa5]+/.test(e.receiverName||"")?/^(\+86)?1[3|4|5|8][0-9]\d{4,8}$/.test(e.receiverPhone)?e.receiverCollegeId?void o.save("addAddr",{userId:i,receiverName:e.receiverName,receiverPhone:e.receiverPhone,receiverCollegeId:e.receiverCollegeId}).then(function(){a.clean("addrList"),n.go("root.addr",{userId:i})}):(alert("请选择学校信息"),!1):(alert("请输入正确的手机号"),!1):(alert("请输入正确的联系人信息"),!1)}}]),angular.module("xiaomaiApp").controller("addrListCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","addrMananger","$q","orderManager","xiaomaiMessageNotify","xiaomaiLog",function(e,n,o,a,t,i,r,s,c,l){l("m_p_33selectcontact");var d,u=n.params.userId;e.addrId=n.params.addrId,a.get().then(function(e){return d=e.collegeId,o.fetchOne("addrList",{userId:u,collegeId:d})}).then(function(n){e.addrList=n.addrList,e.defaultUserAddr=n.defaultUserAddr})["finally"](function(){c.pub("addrHeightUpdate","up","ready","","")});var p=!0;s.getOrderInfo("order.childOrderList").then(function(e){e&&e.length&&(p=!1)}),e.choosenAddr=function(o,a){return o.preventDefault(),o.stopPropagation(),a.userAddrId==e.addrId?!1:0==p&&d!=a.receiverCollegeId?(alert("您购买的商品中包含次日达或当日达商品，无法更改学校。\n如需配送到其他学校，请返回到首页，点击顶部学校名更改学校。"),!1):(e.addrId=a.userAddrId,i.setAddr(a),void n.go("root.confirmorder"))},e.delOneAddr=function(n,a,i){return n.preventDefault(),n.stopPropagation(),a==e.addrId?(alert("该收货人信息正在使用,无法删除"),!1):confirm("确定要删除当前收货人信息？")?void o.fetchOne("addrDel",{userId:u,userAddrId:a}).then(function(n){e.addrList.splice(i,1),t.clean("addrList")},function(n){0===n.code?(e.addrList.splice(i,1),t.clean("addrList")):alert("删除用户地址失败，请再试一次~")}):!1},e.gotoEdit=function(e,o){e.preventDefault(),e.stopPropagation(),n.go("root.addrEdit",{userId:u,userAddrId:o})},e.gotoAdd=function(o){o.preventDefault(),o.stopPropagation(),n.go("root.addrAdd",{userId:u,addrId:e.addrId})},e.goBack=function(e){e.preventDefault(),e.stopPropagation(),n.go("root.confirmorder")}}]),angular.module("xiaomaiApp").controller("addrCollegesCtrl",["$state","$scope","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","xiaomaiLog",function(e,n,o,a,t,i,r){n.countrylist=[];var s;n.$on("$stateChangeSuccess",function(e,n,o){s=o.cityId,c(s)}),n.isloading=!0;var c=function(e){o.fetchOne("collegelist",{cityId:e}).then(function(e){n.haserror=e.cities.length?!1:!0,n.countrylist=e.cities},function(e){n.haserror=!0})["finally"](function(){i.pub("collegesheightupdate","up","ready","",""),n.isloading=!1})},l=e.params.r,d=e.params.userId,u=e.params.userAddrId;n.checkCollege=function(n,o,a){t.writeCache("addrCollegeInfo",o),n.preventDefault(),n.stopPropagation(),e.go(l,{userId:d,userAddrId:u,chosenCollege:!0})},n.goback=function(n){e.go("root.addrLocate",{r:l,userId:d,userAddrId:u})}}]),angular.module("xiaomaiApp").controller("addrLocateCtrl",["$scope","locationManager","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","xiaomaiLog",function(e,n,o,a,t,i,r,s){e.locationResult=[],i.readCache("locate")?e.locationResult=i.readCache("locate").colleges:(e.islocating=!0,n().then(function(e){return a.fetchOne("locate",{latitude:e.lat,longitude:e.lng})}).then(function(n){e.haserror=!1,e.locationResult=n.colleges},function(n){s("m_b_31manuallyselectcity",""),e.haserror=!0})["finally"](function(){e.islocating=!1})),e.citylist=[],e.isloading=!0,a.fetchOne("citylist",{}).then(function(n){e.citylist=n.cities,i.writeCache("citylist",n),e.haserror=!1},function(){e.haserror=!0})["finally"](function(){e.isloading=!1,r.pub("locateheightupdate","up","ready","","")}),e.showCollegeList=function(e,n){e.preventDefault(),e.stopPropagation(),o.go("root.addrColleges",{cityId:n.cityId,userId:l,userAddrId:l,r:c})};var c=o.params.r,l=o.params.userId,d=o.params.userAddrId;e.checkCollege=function(e,n,a){e.preventDefault(),e.stopPropagation(),i.writeCache("addrCollegeInfo",n),o.go(c,{userId:l,userAddrId:d,chosenCollege:!0})},e.goback=function(e){e.preventDefault(),e.stopPropagation(),o.go(c,{userId:l,userAddrId:d})}}]),angular.module("xiaomaiApp").controller("addrEditCtrl",["$scope","$state","xiaomaiService","xiaomaiCacheManager","xiaomaiLog",function(e,n,o,a,t){t("m_p_33editcontact");var i=n.params.userId,r=n.params.addrId,s=n.params.userAddrId;o.fetchOne("getAddr",{userId:i,userAddrId:s}).then(function(n){return e.receiverName=n.receiverName,e.receiverPhone=n.receiverPhone,n}).then(function(n){var o=a.readCache("addrCollegeInfo");o?(e.receiverCollegeId=o.collegeId,e.receiverCollegeName=o.collegeName):(e.receiverCollegeId=n.receiverCollegeId,e.receiverCollegeName=n.receiverCollegeName)}),e.$on("$destroy",function(){a.writeCache("getAddr",{receiverName:e.receiverName,receiverPhone:e.receiverPhone,receiverCollegeId:e.receiverCollegeId,receiverCollegeName:e.receiverCollegeName},{userId:i,userAddrId:s}),a.clean("addrCollegeInfo")}),e.goBack=function(e){e.preventDefault(),e.stopPropagation(),n.go("root.addr",{userId:i,addrId:r})},e.goLocate=function(e){e.preventDefault(),e.stopPropagation(),n.go("root.addrLocate",{r:"root.addrEdit"})},e.save=function(t){return t.preventDefault(),t.stopPropagation(),/[\w\u4e00-\u9fa5]+/.test(e.receiverName||"")?/^(\+86)?1[3|4|5|8][0-9]\d{4,8}$/.test(e.receiverPhone)?void o.save("setAddr",{userId:i,userAddrId:s,receiverName:e.receiverName,receiverPhone:e.receiverPhone,receiverCollegeId:e.receiverCollegeId}).then(function(){a.clean("addrList"),n.go("root.addr",{userId:i,addrId:r})}):(alert("请输入正确的手机号"),!1):(alert("请输入正确的联系人信息"),!1)}}]),angular.module("xiaomaiApp").controller("bindUserCtrl",["$scope","$state","$interval","xiaomaiService","schoolManager","cookie_openid","xiaomaiLog",function(e,n,o,a,t,i,r){r("m_p_33banding");var s=/^(\+86)?1[3|4|5|8][0-9]\d{4,8}$/;e.sendCode=function(n){return r("m_b_33logingetcode"),n.preventDefault(),n.stopPropagation(),s.test(e.tel)?void a.save("sendCode",{phone:e.tel}).then(function(){e.sendLeftTime=60;var n=o(function(){e.sendLeftTime=e.sendLeftTime-1,e.sendLeftTime<=0&&o.cancel(n)},1e3)},function(e){alert(e.msg||"获取验证码失败"),1===e.code&&r("m_b_33loginbinded")}):(alert("请输入正确手机号"),!1)},e.bindUser=function(o){o.preventDefault(),o.stopPropagation(),r("m_b_33logingo");return e.agreedeal?e.tel&&s.test(e.tel)?/\d{4,6}/.test(""+e.smsCode)?void t.get().then(function(n){var o=n.collegeId;return a.save("bindUser",{phone:e.tel,openId:i||"",collegeId:o,smsCode:e.smsCode,type:0})}).then(function(e){alert("绑定成功"),n.go("root.buy.nav.all")},function(e){alert(e.msg)}):(alert("请输入正确验证码"),!1):(alert("请输入正确手机号"),!1):(alert("请阅读并同意小麦公社协议"),!1)}}]),angular.module("xiaomaiApp").controller("buyCtrl",["$state","$scope","schoolManager","$q","xiaomaiMessageNotify",function(e,n,o,a,t){n.$on("$stateChangeSuccess",function(n,a,t){o.get().then(function(n){"root.buy"==a.name&&e.go("root.buy.nav.all")},function(){alert("无法获取学校信息,将跳转到选择学校页~"),e.go("root.locate")})}),n.closeMask=function(e){t.pub("cartGuiManager","hide"),t.pub("detailGuiManager","hide"),t.pub("shareModelManager","hide"),e.preventDefault()},n.closeShare=function(e){t.pub("shareModelManager","hide"),"show"!=i&&"show"!=r&&t.pub("maskManager","hide"),e.preventDefault(),e.stopPropagation()};var i,r,s=t.sub("detailGuiManager",function(e){i=e}),c=t.sub("cartGuiManager",function(e){r=e}),l=t.sub("shareModelManager",function(e){n.shareIsShow="show"==e?!0:!1});n.$on("$destroy",function(){t.removeOne("cartGuiManager",c),t.removeOne("detailGuiManager",s),t.removeOne("shareModelManager",l)});var d=["root.confirmorder"];n.$on("$stateChangeStart",function(e,n,o,a,s){"show"!=i&&"show"!=r||-1!=d.join(",").indexOf(n.name)||(t.pub("detailGuiManager","hide"),t.pub("cartGuiManager","hide"),e.preventDefault())})}]),angular.module("xiaomaiApp").controller("buy.cartDetailCtrl",["$state","$scope","xiaomaiService","cookie_openid","buyProcessManager","xiaomaiMessageNotify","cartManager","env","xiaomaiCacheManager","xiaomaiLog",function(e,n,o,a,t,i,r,s,c,l){var d=i.sub("createOrderFail",function(e){var n=[];angular.forEach(e,function(e){angular.forEach(e.goodsList,function(e){n.push(e.skuId)})}),u(n)}),u=function(e){var o=[];angular.forEach(n.goods,function(n,a){var t=1==n.sourceType?n.skuList[0].skuId:n.skuList[0].activitySkuId,i=new RegExp("(,"+t+")|("+t+",)");i.test(e.join(","))||o.push(n)}),n.goods=o},p=function(){return n.isloading=!0,r.queryCartDetail().then(function(e){return n.goods=e.goods,n.ldcFreight=e.ldcFreight,
n.haserror=!1,e},function(){n.haserror=!0})["finally"](function(){n.isloading=!1})},g=function(){return o.fetchOne("mycoupon",{openId:a,type:1}).then(function(e){var o=[];angular.forEach(e.couponInfo,function(e){0===e.status&&o.push(o)}),n.coupons=o})},m=i.sub("cartGuiManager",function(e){"show"==e&&(l("m_p_31shoppingcart"),p(),g(),setTimeout(function(){i.pub("shopcartdetailheightupdate","up","ready","","")},600)),n.showcart="show"==e?!0:!1,i.pub("maskManager",e)});n.$on("destory",function(){i.removeOne("cartGuiManager",m),i.removeOne("createOrderFail",d)}),n.gotoCoupon=function(){l("m_b_31shoppingcartcoupons");var e="online"==s?"http://h5.imxiaomai.com":"http://wap.tmall.imxiaomai.com";return window.location.href=e+"/couponwap/myCouponList/webwiew",!1},n.continueShop=function(e){i.pub("cartGuiManager","hide"),e.preventDefault(),l("m_b_31shoppingcartclose")},n.buyHandler=function(e,o,a){l("plus"==o?"m_b_31shoppingcartadd":"m_b_31shoppingcartless");var r=n.goods[a],s=r.sourceType,c=r.skuList[0],d=2==s?{goodsId:r.activityGoodsId,sourceType:2,skuId:c.activitySkuId,distributeType:c.distributeType,price:c.activityPrice,propertyIds:c.skuPropertyValueIdList||""}:{goodsId:r.goodsId,sourceType:r.sourceType,distributeType:c.distributeType,skuId:c.skuId,price:c.wapPrice,propertyIds:c.skuPropertyValueIdList||""},r=n.goods[a];n.goods[a].isPaying=!0,t(d,o,Math.min(r.maxNum,r.skuList[0].stock),r.skuList[0].numInCart).then(function(e){"plus"==o&&l("m_r_31cartfromcart"),r.skuList[0].numInCart=e,0==r.skuList[0].numInCart&&(n.goods.splice(a,1),i.pub("shopcartdetailheightupdate","up","ready","",""))},function(e){alert(e)})["finally"](function(){n.goods[a]&&(n.goods[a].isPaying=!1)}),e.stopPropagation(),e.preventDefault()}}]),angular.module("xiaomaiApp").controller("buy.detailCtrl",["$scope","$state","xiaomaiMessageNotify","xiaomaiLog",function(e,n,o,a){e.numInCart=0;var t=o.sub("detailGuiManager",function(n,t,i,r){"show"==n?(a("m_r_31detailfrom"+r),a("m_p_31productdetailinfo"),e.goodsId=t,e.sourceType=i):(e.goodsId="",e.sourceType="",e.showdetail=!1,o.pub("maskManager","hide"))});e.openDetailPop=function(){e.showdetail=!0,o.pub("maskManager","show"),setTimeout(function(){o.pub("detailgoodheightupdate","up","ready","","")},600)},e.$on("$destroy",function(){o.removeOne("detailGuiManager",t)}),e.showShareModel=function(){o.pub("shareModelManager","show"),a("m_b_31productdetailinfoshare")},e.closeDetail=function(e){o.pub("detailGuiManager","hide"),e.preventDefault(),a("m_b_31productdetailinfoclose")},e.imageLoadedCall=function(){o.pub("detailgoodheightupdate","up","ready","","")}}]),angular.module("xiaomaiApp").controller("buy.cartThumbCtrl",["$state","$scope","xiaomaiService","cartManager","$timeout","xiaomaiMessageNotify","xiaomaiLog","cookie_openid","orderManager",function(e,n,o,a,t,i,r,s,c){a.query(function(e){n.totalCount=e.totalCount,n.totalPrice=e.totalPrice;var o=a.readCartCache();n.hasChange=o.totalCount&&o.totalCount==n.totalCount?!1:!0,n.hasChange&&t(function(){n.hasChange=!1},200)}),i.sub("cartGuiManager",function(e){n.isShowCart="show"==e}),i.sub("detailGuiManager",function(e){n.isShowDetail="show"==e});var l=function(){var n=e.current.name,o=/root\.buy(\.nav)?\.(\w+)/,a="";switch(n.match(o)[2]){case"all":a="homepage";break;case"category":a="category+"+e.params.categoryId;break;case"active":a="active+"+e.params.activityId;break;default:a=n.match(o)[2]}return a};n.lockSettle=!1,n.goSettlement=function(o){return o.stopPropagation(),o.preventDefault(),n.lockSettle?!1:(n.lockSettle=!0,r("m_b_31shoppingsettle"),c.createOrder().then(function(n){var o=l();e.go("root.confirmorder",{r:o})},function(e){switch(e.code){case-1:u(e.data.items);break;case 1:alert(e.msg);break;case 2:d();break;case 3:alert(e.msg)}})["finally"](function(){n.lockSettle=!1}),!1)};var d=function(){return window.location.href="/wap/userBind/auth",!1},u=function(e){var n=["很遗憾，由于商品缺货，创建订单失败:"];angular.forEach(e,function(e){angular.forEach(e.goodsList,function(e){n.push(e.goodsName)}),n.push(e.title)}),alert(n.join("\n")),a.update(),i.pub("createOrderFail",e)};n.gotoDetail=function(){return n.totalCount&&0!=n.totalCount?(i.pub("detailGuiManager","hide"),void i.pub("cartGuiManager","show")):!1},n.$on("$destroy",function(){a.store(!1)})}]),angular.module("xiaomaiApp").controller("nav.categoryCtrl",["$state","xiaomaiService","$scope","xiaomaiCacheManager","buyProcessManager","xiaomaiMessageNotify","getRouterTypeFromUrl","schoolManager","wxshare","xiaomaiLog",function(e,n,o,a,t,i,r,s,c,l){var d,u=e.params.categoryId;l("m_p_31tabcategory"+u),s.get().then(function(e){return d=e.collegeId,p()}).then(function(e){return f(e)})["finally"](function(){o.isloading=!1;var e=o.paginationInfo.currentPage==o.paginationInfo.totalPage,n=e?"":"请求下一页数据";i.pub("navmainheightstatus","up","ready","",n)});o.isloading=!0;var p=function(){return n.fetchOne("goods",{collegeId:d,categoryId:u,recordPerPage:10}).then(function(e){return o.goods=e.goods,o.paginationInfo=e.paginationInfo,o.haserror=o.goods.length?!1:!0,g(),!0},function(e){return o.haserror=!0,!1})["finally"](function(){o.errortip=o.haserror?"类目不存在,将跳转到首页":"",o.haserror&&setTimeout(function(){e.go("root.buy.nav.all")},500)})},g=function(){var e="";n.fetchOne("navgatorlist",{collegeId:d}).then(function(n){var o=n.navigateItems;return angular.forEach(o,function(n){return u==n.categoryId?(e=n.navigateName,!1):void 0}),e}).then(function(e){c({title:"小麦特供-"+e,imgUrl:"http://xiaomai-p2p.qiniudn.com/2b7ef2e2c2ce364303283bf49131a40f",desc:"小麦特供,便宜有好货,赶快点进来看看吧!"})})},m=i.sub("detailGuiManager",function(e){"hide"==e&&setTimeout(function(){g()},100)}),f=function(e){return e?n.fetchOne("categoryBanners",{categoryId:u,collegeId:d}).then(function(e){angular.forEach(e.banners,function(e){e.imageUrl+="&imageView2/0/w/600"}),o.banners=e.banners}):!1};o.gotoActive=function(n){var o=r(n.hrefUrl,d);return o.hasOwnProperty("path")?window.location.href=o.path:e.go(o.name,angular.extend(o.params,{refer:"categorybanner+"+u})),!1};var v=i.sub("navmainscrollupdate",function(e){"down"==e&&o.paginationInfo.currentPage!=o.paginationInfo.totalPage&&(i.pub("navmainheightstatus","down","pending","正在请求数据..."),!h&&y().then(function(e){var n=o.paginationInfo.currentPage==o.paginationInfo.totalPage,a=n?"":"请求下一页数据";i.pub("navmainheightstatus","down","ready","",a)}))}),h=!1,y=function(){return h?!1:(h=!0,n.fetchOne("goods",{collegeId:d,categoryId:u,recordPerPage:10,currentPage:o.paginationInfo.currentPage+1}).then(function(e){return h=!1,o.paginationInfo=e.paginationInfo,o.goods=o.goods.concat(e.goods),e}))};o.$on("$destroy",function(){i.removeOne("navmainscrollupdate",v),i.removeOne("detailGuiManager",m)})}]),angular.module("xiaomaiApp").controller("collegesCtrl",["$state","$scope","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","xiaomaiLog",function(e,n,o,a,t,i,r){n.countrylist=[],n.$on("$stateChangeSuccess",function(e,n,o){var a=o.cityid;s(a)}),n.isloading=!0;var s=function(e){o.fetchOne("collegelist",{cityId:e}).then(function(e){n.haserror=e.cities.length?!1:!0,n.countrylist=e.cities},function(e){n.haserror=!0})["finally"](function(){i.pub("collegesheightupdate","up","ready","",""),n.isloading=!1})};n.checkCollege=function(n,o){n.preventDefault(),n.stopPropagation(),r("m_b_31manuallyselectsch",o.collegeId),a.set(o).then(function(){e.go("root.buy.nav.all")})},n.goback=function(){e.go("root.locate")}}]),angular.module("xiaomaiApp").controller("addrCtrl",["$scope","$state","orderManager","addrMananger","xiaomaiLog",function(e,n,o,a,t){a.getAddr().then(function(n){e.addrInfo=n});var i=o.getUserId();e.gotoAddr=function(o){n.go("root.addr",{addrId:e.addrInfo.userAddrId,userId:i}),o.preventDefault(),o.stopPropagation(),t("m_b_33confordereditcontact")},e.$on("$destroy",function(){a.setAddr({})})}]),angular.module("xiaomaiApp").controller("orderAmountCtrl",["$scope","orderManager","$q","xiaomaiMessageNotify",function(e,n,o,a){e.totalAmount=0,e.totalFreight=0,e.totalCoupon=0;var t,i,r;o.all([n.getOrderInfo("order.totalPay"),n.getOrderInfo("ldcFreight")]).then(function(n){e.totalAmount=n[0];var o=n[1].freight,a=n[1].sub;t=n[1].total>=e.totalAmount?o-a:o,e.totalFreight+=t})["finally"](function(){r=a.sub("updateLdcDeliveryType",function(n){1===n?e.totalFreight+=t:0===n&&(e.totalFreight-=t)})}),o.all([n.getOrderInfo("order.thirdFreight"),n.getOrderInfo("order.thirdFreightSub")]).then(function(n){i=n[0]-n[1],e.totalFreight+=i});var s=a.sub("updateOrderCouponInfo",function(n){switch(n.couponType){case"none":e.totalCoupon=0;break;case"firstsub":e.totalCoupon=n.firstsub;break;case"othercoupon":e.totalCoupon=n.coupon.money}});e.$on("$destroy",function(){a.removeOne("updateLdcDeliveryType",r),a.removeOne("updateOrderCouponInfo",s)})}]),angular.module("xiaomaiApp").controller("orderConfirmCtrl",["$scope","$state","orderSubmitManager","xiaomaiMessageNotify","orderManager","xiaomaiCacheManager","xiaomaiLog",function(e,n,o,a,t,i,r){o.initConfirm(),e.$on("$destroy",function(){o.destroyConfirm(),a.removeOne("updateOnlinePayType",c)});var s,c=a.sub("updateOnlinePayType",function(e){s=e});e.confirm=function(n){return n.preventDefault(),n.stopPropagation(),r("m_b_33conforderpay"),e.lock?!1:(e.lock=!0,void o.doConfirm().then(function(e){l(e)},function(e){d(e)})["finally"](function(){e.lock=!1}))};var l=function(e){if(5==e.order.status)return void alert("您已经支付了，请勿重复提交支付请求。");if(t.deleteOrder(),1===s)i.writeCache("prepayData",e.prepayData),n.go("root.wechartprepay",{userId:e.order.userId,orderId:e.order.orderId});else if(2==s)try{_AP.pay(e.prepayData.payUrl,e.order.orderId,e.order.userId)}catch(o){}},d=function(e){1===e.code?(n.go("root.paySuccess",{orderId:e.data.order.userId,userId:e.data.order.orderId}),t.deleteOrder()):"none"==e.code?alert(e.msg):(alert(e.msg),n.go("root.payFail",{orderId:e.data.order.userId,userId:e.data.order.orderId}),t.deleteOrder())}}]),angular.module("xiaomaiApp").factory("orderSubmitManager",["xiaomaiMessageNotify","orderManager","addrMananger","xiaomaiService","$q","cookie_openid",function(e,n,o,a,t,i){var r,s,c,l,d,u={},p=function(){u={openId:i,userId:"",orderId:"",collegeId:"",receiverCollegeId:"",receiverName:"",receiverPhone:"",rdcDeliveryType:0,rdcSelfPickUpAddress:"",rdcDeliveryAddress:"",rdcDeliveryBeginTime:"",rdcDeliveryEndTime:"",ldcDeliveryType:-1,ldcSelfPickUpAddress:"",ldcDeliveryAddress:"",ldcDeliveryBeginTime:"",ldcDeliveryEndTime:"",ldcRemark:"",onlinePayType:"",couponId:"",couponPay:"",firstSub:"",fullSub:""}},g=function(){p(),t.all([n.getOrderInfo("order.userId"),n.getOrderInfo("order.orderId"),n.getOrderInfo("college.collegeId"),n.getOrderInfo("college.rdcSelfPickUpAddress"),n.getOrderInfo("college.ldcSelfPickUpAddress"),n.getOrderInfo("order.fullSub")]).then(function(e){u=angular.extend(u,{userId:""+e[0],orderId:""+e[1],collegeId:""+e[2],rdcSelfPickUpAddress:e[3],ldcSelfPickUpAddress:e[4],fullSub:e[5]})}),o.getAddr().then(function(e){u=angular.extend(u,{receiverCollegeId:""+e.receiverCollegeId,receiverName:e.receiverName,receiverPhone:e.receiverPhone})}),r=e.sub("updateLdcDeliveryType",function(e){u=angular.extend(u,{ldcDeliveryType:e})}),s=e.sub("updateLdcDeliveryAddress",function(e){u=angular.extend(u,{ldcDeliveryAddress:e})}),l=e.sub("updateLdcDeliveryTime",function(e){u=angular.extend(u,e)}),subCouponupdateId=e.sub("updateOrderCouponInfo",function(e){switch(e.couponType){case"none":u=angular.extend(u,{couponId:"",couponPay:0,firstSub:0});break;case"firstsub":u=angular.extend(u,{couponId:"",couponPay:0,firstSub:e.firstsub});break;case"othercoupon":u=angular.extend(u,{couponId:""+e.coupon.couponId,couponPay:e.coupon.money,firstSub:0})}}),c=e.sub("updateOnlinePayType",function(e){u=angular.extend(u,{onlinePayType:e})}),d=e.sub("updateLdcRemark",function(e){return e=e.replace(/[\s\n\r]+/gm,",").replace(/^\s+|\s+$/gm,""),-1!=e.indexOf("script")?!1:void(u=angular.extend(u,{ldcRemark:e}))})},m=function(){e.removeOne("updateLdcDeliveryType",s),e.removeOne("updateOrderCouponInfo",subCouponupdateId),e.removeOne("updateLdcDeliveryAddress",s),e.removeOne("updateOnlinePayType",c),e.removeOne("updateLdcDeliveryTime",l),e.removeOne("updateLdcRemark",d)},f=function(){var e=t.defer();return u.receiverName&&u.receiverName.length?(a.save("confirmOrder",u,!0).then(function(n){e.resolve(n)},function(n){e.reject(n)}),e.promise):(e.reject({code:"none",msg:"请完善收货人信息"}),e.promise)};return{initConfirm:g,doConfirm:f,destroyConfirm:m}}]),angular.module("xiaomaiApp").controller("orderCouponCtrl",["$scope","$state","xiaomaiMessageNotify","orderManager","$q",function(e,n,o,a,t){e.showCoupon=!1,t.all([a.getOrderInfo("firstCoupon"),a.getOrderInfo("couponList")]).then(function(n){e.firstCoupon=n[0],e.couponlist=n[1],e.showCoupon=e.firstCoupon||e.couponlist.length?!0:!1,o.pub("updateOrderCouponInfo",{couponType:e.firstCoupon?"firstsub":e.couponlist.length?"othercoupon":"none",coupon:e.couponlist[0],firstsub:e.firstCoupon})});var i=o.sub("updateOrderCouponInfo",function(n){e.checkedCouponInfo=n});e.$on("$destroy",function(){o.removeOne("updateOrderCouponInfo",i)}),e.gotoCoupon=function(o){o.preventDefault(),o.stopPropagation();var a;switch(e.checkedCouponInfo.couponType){case"none":a=-1;break;case"firstsub":a=0;break;case"othercoupon":a=e.checkedCouponInfo.coupon.couponId}n.go("root.confirmorder.couponlist",{couponid:a})}}]),angular.module("xiaomaiApp").controller("confirmorder.couponListCtrl",["$scope","$state","orderManager","$q","xiaomaiMessageNotify","xiaomaiLog",function(e,n,o,a,t,i){i("m_p_33mycoupons"),e.$on("$stateChangeSuccess",function(n,o,a){e.checkedCouponId=Number(a.couponid)}),e.goback=function(e){e.preventDefault(),e.stopPropagation(),i("m_b_33selectcouponsnocoupons"),n.go("root.confirmorder")},a.all([o.getOrderInfo("firstCoupon"),o.getOrderInfo("couponList")]).then(function(n){e.firstCoupon=n[0],angular.forEach(n[1],function(e){var n=e.endTime-e.curTime;e.remainDays=Math.floor(n/864e5)}),e.couponlist=n[1]})["finally"](function(){t.pub("confirmCouponListHeightUpdate","up","ready","","")}),e.chooseCoupon=function(o,a,r){o.preventDefault(),o.stopPropagation(),i("none"==a?"m_b_33selectcouponsclose":"m_b_33selectcouponsselectone"),t.pub("updateOrderCouponInfo",{couponType:a,firstsub:e.firstCoupon,coupon:e.couponlist[r]||e.couponlist[0]}),n.go("root.confirmorder")}}]),angular.module("xiaomaiApp").controller("orderCtrl",["$scope","$state","xiaomaiLog","orderManager","xiaomaiMessageNotify","xiaomaiLog",function(e,n,o,a,t,o){o("m_p_33conforder"),e.goBack=function(e){e.preventDefault(),e.stopPropagation(),n.go("root.buy.nav.all")},e.isloading=!0,a.getOrderInfo("order").then(function(e){t.pub("confirmoderHeightUpdate","up","ready","","")},function(){alert("当前订单已经不存在,\n将回到首页"),n.go("root.buy.nav.all")})["finally"](function(){e.isloading=!1})}]),angular.module("xiaomaiApp").controller("orderCountdownCtrl",["$scope","$state","orderManager","$interval",function(e,n,o,a){var t=o.getRemaintime(),i=+new Date,r=i-t.createTime,s=60*t.limitTime*1e3-r;e.realremaintime=Math.floor(s/1e3);var c=a(function(){e.realremaintime=e.realremaintime-1,e.realremaintime<=0&&(a.cancel(c),l())},1e3);e.$on("$destroy",function(){a.cancel(c)});var l=function(){o.deleteOrder(),alert("当前订单已经失效,\n去商城重新下单吧"),n.go("root.buy.nav.all")}}]),angular.module("xiaomaiApp").controller("orderOnlinepayCtrl",["$scope","xiaomaiMessageNotify","$timeout",function(e,n,o){var a=function(e){n.pub("updateOnlinePayType",e)};e.payType=1,o(function(){a(e.payType)},10),e.choosePaytype=function(n,o){n.preventDefault(),n.stopPropagation(),e.payType=o,a(o)}}]),angular.module("xiaomaiApp").directive("triggerMobIscroll",[function(){var e=function(e,n,o){n.on("click",function(e){var o=n.find("select");o.length&&o.mobiscroll("getInst").show(),e.preventDefault(),e.stopPropagation()})};return{template:'<p  class="" ng-transclude></p>',link:e,transclude:!0}}]),angular.module("xiaomaiApp").filter("filterldctomorrow",function(){return function(e){var n=/\d{4}[-\/]\d{2}[-\/]\d{2}/,o=(new Date).getTime(),a=new Date(e.match(n)[0]).getTime();return e.replace(/\d{4}[-\/]\d{2}[-\/]\d{2}\s{0,}/,a>o?"明天":"")}}),angular.module("xiaomaiApp").controller("ldcOrderCtrl",["$scope","orderManager","xiaomaiMessageNotify","$q","xiaomaiService","schoolManager","xiaomaiLog",function(e,n,o,a,t,i,r){e.showOrder=!1;var s,c=function(e){var n=/\d{4}[-\/]\d{2}[-\/]\d{2}/,o=(new Date).getTime(),a=new Date(e.match(n)[0]).getTime();return e.replace(/\d{4}[-\/]\d{2}[-\/]\d{2}\s{0,}/,a>o?"明天":"")};a.all([n.getOrderInfo("order.childOrderList"),n.getOrderInfo("ldcTimeSwitch"),n.getOrderInfo("college")]).then(function(n){var o=n[0];e.ldcTimeSwitch=0==n[1],s=n[2].collegeId,l(o),d()});var l=function(n){angular.forEach(n,function(n){1==n.distributeType&&(e.showOrder=!0,e.orderInfo=n,e.childOrderDetailList=n.childOrderDetailList,e.ldcTimeIsOpen=0==n.deliveryTimeType,e.ldcTypeIsSc=2==n.orderDeliveryTimeType,e.initLldcAddressTime=e.ldcTimeIsOpen?n.deliveryTimeStr:c(n.ldcFixBeginTime)+"~"+c(n.ldcFixEndTime),e.ldcAddressTime=e.initLldcAddressTime,o.pub("updateLdcDeliveryTime",{ldcDeliveryBeginTime:n.ldcFixBeginTime,ldcDeliveryEndTime:n.ldcFixEndTime}))})};e.deliveryTimes=[];var d=function(){return!e.ldcTimeSwitch||e.ldcTypeIsSc?!1:void t.fetchOne("ldcDeliveryTime",{collegeId:s}).then(function(n){n.ldcTimeList.length&&(e.deliveryTimes=n.ldcTimeList)})};a.all([n.getOrderInfo("order.totalPay"),n.getOrderInfo("ldcFreight")]).then(function(n){var o=n[0],a=n[1].freight,t=n[1].sub;freightTotal=n[1].total>=o?a-t:a,e.freight=freightTotal,e.freightSub=t}),n.getOrderInfo("ldcAddressList").then(function(n){e.ldcAddressList=n,e.ldcAddressName=n[0].addressType+"-"+n[0].addresses[0],e.chooseAddress(e.ldcAddressName)}),n.getOrderInfo("college").then(function(n){e.ldcSelfPickUpAddress=n.ldcSelfPickUpAddress,e.initDeliveryType=n.ldcDeliveryType,e.chooseType(2!=n.ldcDeliveryType?n.ldcDeliveryType:1)}),e.initGoodShowStatus=!1,e.triggerShowStatus=function(n){r("m_b_33confordergoodslistdetail"),n.preventDefault(),n.stopPropagation(),e.initGoodShowStatus=!e.initGoodShowStatus,o.pub("confirmoderHeightUpdate","down","ready","","")},e.chooseType=function(n){e.ldcDeliveryType=n,o.pub("updateLdcDeliveryType",n)},e.chooseAddress=function(e){o.pub("updateLdcDeliveryAddress",e)};var u=function(e){var n=e.getFullYear(),o=e.getMonth()+1,a=e.getDate();return o=10>o?"0"+o:o,a=10>a?"0"+a:a,[n,o,a].join("-")},p=function(e){var n=new Date((new Date).getTime()+864e5),o=new Date;return-1!=e.indexOf("明天")?u(n)+" "+e.replace("明天",""):u(o)+" "+e};e.chooseTime=function(n){e.ldcAddressTime=n;var a=/\d{2}:\d{2}/;if(n.match(a)){var t=n.split("~");o.pub("updateLdcDeliveryTime",{ldcDeliveryBeginTime:p(t[0]),ldcDeliveryEndTime:p(t[1])})}else o.pub("updateLdcDeliveryTime",{ldcDeliveryBeginTime:"",ldcDeliveryEndTime:""})},e.updateLdcRemark=function(e,n){return n.length>=50?(e.preventDefault(),!1):void o.pub("updateLdcRemark",n)}}]),angular.module("xiaomaiApp").controller("rdcOrderCtrl",["$scope","orderManager","xiaomaiMessageNotify","xiaomaiLog",function(e,n,o,a){e.showOrder=!1,n.getOrderInfo("order.childOrderList").then(function(n){angular.forEach(n,function(n){0==n.distributeType&&(e.showOrder=!0,e.childOrderDetailList=n.childOrderDetailList)})}),n.getOrderInfo("college").then(function(n){e.rdcSelfPickUpAddress=n.rdcSelfPickUpAddress}),e.initGoodShowStatus=!1,e.triggerShowStatus=function(n){n.preventDefault(),n.stopPropagation(),e.initGoodShowStatus=!e.initGoodShowStatus,o.pub("confirmoderHeightUpdate","down","ready","","")}}]),angular.module("xiaomaiApp").controller("thirdOrderCtrl",["$scope","orderManager","$q",function(e,n,o){e.showOrder=!1,n.getOrderInfo("college").then(function(n){e.collegeAddr=n.collegeAddr}),n.getOrderInfo("order.thirdChildOrderList").then(function(n){return n&&n.length?(e.showOrder=!0,void(e.thirdChildOrderList=n)):!1}),o.all([n.getOrderInfo("order.thirdFreight"),n.getOrderInfo("order.thirdFreightSub")]).then(function(n){e.thirdFreight=n[0],e.thirdFreightSub=n[1]}),e.initGoodShowStatus=!1,e.triggerShowStatus=function(n){n.preventDefault(),n.stopPropagation(),e.initGoodShowStatus=!e.initGoodShowStatus,xiaomaiMessageNotify.pub("confirmoderHeightUpdate","down","ready","","")}}]),angular.module("xiaomaiApp").controller("buy.couponCtrl",["$state","$scope","xiaomaiService",function(e,n,o){o.fetchOne("mycoupon",{}).then(function(e){})}]),angular.module("xiaomaiApp").controller("feedbackCtrl",["$scope","$state","xiaomaiService","xiaomaiLog",function(e,n,o,a){e.goBack=function(){n.go("root.buy.nav.all")},a("m_p_31feedback"),e.feedback="",e.mobile="";var t=/^(\+86)?1[3|4|5|8][0-9]\d{4,8}$/;e.submit=function(){a("m_b_31feedbacksubmit");var i=e.feedback,r=""+e.mobile;return i=i.trim&&i.trim(),i&&i.length?r.length&&!t.test(r)?(alert("手机号有误,请确认"),!1):void o.save("feedback",{mobile:r,feedback:i}).then(function(){alert("提交成功!谢谢!"),n.go("root.buy.nav.all")},function(e){alert("提交失败,请重新尝试!\n失败原因:"+e)}):(alert("请输入您的建议或意见"),!1)}}]),angular.module("xiaomaiApp").directive("xiaomaiGoodListItem",["xiaomaiMessageNotify","xiaomaiLog","buyProcessManager",function(e,n,o){var a=function(a,t,i){var r=i.clickEvent,s=i.sourceEvent,c=i.detailSourceEvent;a.gotoDetail=function(n,o){var a=2==o.sourceType?o.activityGoodsId:o.goodsId;e.pub("detailGuiManager","show",a,o.sourceType,c),n.preventDefault(),n.stopPropagation()},a.buyHandler=function(e){if(n(r),3==a.goods.goodsType)return a.gotoDetail(e,a.goods),e.stopPropagation(),!1;a.goods.isPaying=!0;var t=2==a.goods.sourceType?{goodsId:a.goods.activityGoodsId,sourceType:2,skuId:a.goods.skuList[0].activitySkuId,distributeType:a.goods.skuList[0].distributeType,price:a.goods.skuList[0].activityPrice,propertyIds:""}:{goodsId:a.goods.goodsId,sourceType:a.goods.sourceType,skuId:a.goods.skuList[0].skuId,distributeType:a.goods.skuList[0].distributeType,price:a.goods.skuList[0].wapPrice,propertyIds:""},i=Math.min(a.goods.maxNum,a.goods.skuList[0].stock);o(t,"plus",i).then(function(){n(s)},function(e){alert(e)})["finally"](function(){a.goods.isPaying=!1}),e.stopPropagation()}};return{link:a,scope:{goods:"=",column:"@"},templateUrl:"../assets/views/goodListItem/goodListItem.html",replace:!0}}]),angular.module("xiaomaiApp").directive("xiaomaiGoodListItemSk",["xiaomaiMessageNotify","xiaomaiLog","buyProcessManager","cartManager",function(e,n,o,a){var t=function(t,i,r){t.gotoDetail=function(n){e.pub("detailGuiManager","show",t.goods.activityGoodsId,t.goods.sourceType,"active+"+t.goods.activityId),n.preventDefault(),n.stopPropagation()};var s=t.$watch("goods",function(){return t.goods&&angular.isObject(t.goods)?(s(),void a.getnumInCart(t.goods.skuList[0].activitySkuId,t.goods.sourceType).then(function(e){1==e&&(t.goods.killed=!0)})):!1});t.buyHandler=function(e){e.preventDefault(),e.stopPropagation(),n("m_b_31singleactivitypanicbuy+"+t.goods.activityId);var a=t.goods,i=a.activityId;t.goods.isPaying=!0,o({goodsId:a.activityGoodsId,sourceType:2,distributeType:a.skuList[0].distributeType,skuId:a.skuList[0].activitySkuId,price:a.skuList[0].activityPrice,propertyIds:""},"plus",Math.min(a.maxNum,a.skuList[0].stock)).then(function(){n("m_r_31cartfromactive+"+i),alert("赶快去下单吧\n否则可能会被其他人抢走了哦"),t.goods.killed=!0},function(e){return alert(e),!1})["finally"](function(){t.goods.isPaying=!1})},t.timecountdown=function(){0===t.goods.killStarted?(t.goods.killStarted=1,t.goods.beginTime=-1):1===t.goods.killStarted&&(t.goods.killStarted=2,t.goods.buyLeftTime=-1)}};return{link:t,scope:{goods:"="},templateUrl:"../assets/views/goodListItem/goodListItemSk.html",replace:!0}}]),angular.module("xiaomaiApp").directive("goodDetail",["$state","$q","$timeout","xiaomaiService","getSkuInfo","skuListToObject","buyProcessManager","cartManager","wxshare","xiaomaiLog","quickGetImgHeight","schoolManager","safeApply",function(e,n,o,a,t,i,r,s,c,l,d,u,p){var g=function(e,o,g){e.swiper={},e.swiperIndex=0,e.onReadySwiper=function(n){n.update(!0),e.swiperIndex=0,e.swiperSlider=function(e,o){e.preventDefault(),e.stopPropagation(),n["prev"==o?"slidePrev":"slideNext"]()},n.on("slideChangeStart",function(n){var o=Array.prototype.slice.call(arguments)[0];p(function(){e.swiperIndex=o.activeIndex}),l("m_b_32productdetailinfomultipic")})};var m,f=e.$watch("goodsId+sourceType",function(){return/\d+/.test(e.goodsId)&&/\d+/.test(e.sourceType)?void v(e.goodsId,e.sourceType):!1}),v=function(n,o){u.get().then(function(e){return m=e.collegeId,a.fetchOne("goodDetail",{goodsId:n,sourceType:o})}).then(function(n){if(angular.isArray(n.goodsDetailImageList)&&angular.forEach(n.goodsDetailImageList,function(e){e.imageUrl+="&imageView2/0/w/410/q/100"}),e.good=n,y(),e.good.hasOwnProperty("goodsDetailImageList")&&h(),3==e.good.goodsType)return e.skuInfo=!1,e.checkedProperties={},e.skuObject=b(e.good.skuList),e.numInCart=0,!1;e.skuInfo=e.good.skuList[0];var o=1==e.good.sourceType?e.skuInfo.skuId:e.skuInfo.activitySkuId;return s.getnumInCart(o,e.good.sourceType)}).then(function(n){return angular.isNumber(n)&&(e.numInCart=n,1==n&&(e.good.killed=!0)),!1})["finally"](function(){angular.isFunction(e.loadSuccess)&&e.loadSuccess()})},h=function(){var o=(e.good.goodsDetailImageList&&e.good.goodsDetailImageList.length,[]);angular.forEach(e.good.goodsDetailImageList,function(e){o.push(d(e.imageUrl))}),n.all(o).then(function(){e.imageLoadedCall&&e.imageLoadedCall()})},y=function(){var n="小麦特供-"+(2==e.good.sourceType?e.good.activityGoodsName:e.good.bgGoodsName),o="小麦特供,便宜有好货,赶快点进来看看吧!",a=["http://",window.location.host,window.location.pathname,window.location.search,"#/buy/sharedetail/","?goodId=",e.goodsId,"&sourceType=",e.sourceType,"&collegeId=",m].join(""),t=e.good.iconImageUrl,i=function(){},r=function(){};c({title:n,link:a,desc:o,imgUrl:t,success:i,cancel:r})},b=function(e){return i(e)},I=function(n){var o=[];angular.forEach(e.skuObject,function(n,a){var t=!0;angular.forEach(e.checkedProperties,function(e,n){var o=new RegExp(n+"="+e);return o.test(a)?void 0:(t=!1,!1)}),1==t&&o.push(a)});var a=e.good.skuGoodsPropertyList;angular.forEach(a,function(e){angular.forEach(e.propertyValues,function(n,a){var t=e.propertyNameId+"="+n.propertyValueId;-1!=o.join("&").indexOf(t)?n.disabled=!1:n.disabled=!0})}),e.good.skuGoodsPropertyList=a};e.complexCheckProperty=function(n,o,a){if(n.preventDefault(),n.stopPropagation(),a.disabled)return!1;var i=a.propertyValueId;e.checkedProperties[o]===i?delete e.checkedProperties[o]:e.checkedProperties[o]=i,I(o);var r=t(e.checkedProperties,e.skuObject);if(e.skuInfo=0==r?!1:r,e.skuInfo){var c=1==e.good.sourceType?e.skuInfo.skuId:e.skuInfo.activitySkuId;s.getnumInCart(c,e.good.sourceType).then(function(n){e.numInCart=n})}else e.numInCart=0},e.buyHandler=function(n,o){n.preventDefault(),n.stopPropagation();var a=1==e.good.isSeckill?"m_b_31productdetailinfopanicbuy":"plus"==o?"m_b_31productdetailinfoadd":"m_b_31productdetailinfoless";l(a);var t=[];if(!e.skuInfo)return alert("请选择商品规格"),!1;angular.forEach(e.checkedProperties,function(e){t.push(e)}),t=t.join("_");var i=2==e.sourceType?{goodsId:e.good.activityGoodsId,sourceType:e.sourceType,skuId:e.skuInfo.activitySkuId,distributeType:e.skuInfo.distributeType,price:e.skuInfo.activityPrice,propertyIds:t}:{goodsId:e.good.goodsId,sourceType:e.sourceType,skuId:e.skuInfo.skuId,distributeType:e.skuInfo.distributeType,price:e.skuInfo.wapPrice,propertyIds:t};e.good.isPaying=!0,r(i,o,Math.min(e.good.maxNum,e.skuInfo.stock),e.numInCart).then(function(n){e.numInCart=n,"plus"==o&&l("m_r_31cartfromdetail"),1==e.good.isSeckill&&(e.good.killed=!0,alert("抢购成功,赶紧去下单吧!"))},function(e){return alert(e),!1})["finally"](function(){e.good.isPaying=!1})},e.timecountdown=function(){0===e.good.killStarted?(e.good.killStarted=1,e.good.beginTime=-1):1===e.good.killStarted&&(e.good.killStarted=2,e.good.buyLeftTime=-1)},e.$on("$destroy",function(){f()})};return{link:g,templateUrl:"../assets/views/gooddetail/gooddetail.html",repalce:!0,scope:{goodsId:"=",sourceType:"=",loadSuccess:"&",imageLoadedCall:"&"}}}]),angular.module("xiaomaiApp").controller("positionCtrl",["$scope","locationManager","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","xiaomaiLog",function(e,n,o,a,t,i,r,s){e.locationResult=[],s("m_p_31selectsch"),i.readCache("locate")?e.locationResult=i.readCache("locate").colleges:(e.islocating=!0,n().then(function(e){return a.fetchOne("locate",{latitude:e.lat,longitude:e.lng})}).then(function(n){e.haserror=!1,e.locationResult=n.colleges},function(n){s("m_b_31manuallyselectcity",""),e.haserror=!0})["finally"](function(){e.islocating=!1})),e.citylist=[],e.isloading=!0,a.fetchOne("citylist",{},!0).then(function(n){e.citylist=n.cities,e.haserror=!1},function(){e.haserror=!0})["finally"](function(){e.isloading=!1,r.pub("locateheightupdate","up","ready","","")}),e.showCollegeList=function(e){s("m_b_31manuallyselectcity",""),o.go("root.colleges",{cityid:e.cityId})},e.$on("$stateChangeSuccess",function(n,o,a){e.curcityid=a.cityid}),e.checkCollege=function(e,n,a){s(0==a?"m_b_31autoselectsch1":"m_b_31autoselectsch2",n.collegeId),t.set(n).then(function(){return i.clean("navgatorlist"),!0}).then(function(){o.go("root.buy.nav.all")}),e.preventDefault(),e.stopPropagation()},e.goback=function(){o.go("root.buy.nav.all")}}]),angular.module("xiaomaiApp").controller("navCtrl",["$scope","$state",function(e,n){}]),angular.module("xiaomaiApp").controller("nav.headCtrl",["$scope","$state","schoolManager","xiaomaiLog","xiaomaiService",function(e,n,o,a,t){o.get().then(function(n){e.schoolname=n.collegeName}),e.gotoLocate=function(e){e.preventDefault(),e.stopPropagation(),a("m_b_31homepageswitchsch"),n.go("root.locate")},e.gotoFeedback=function(e){e.preventDefault(),e.stopPropagation(),a("m_b_31homepageusercenter"),n.go("root.user")},e.gotoSearch=function(e){e.preventDefault(),e.stopPropagation(),a("m_b_31homepagesearch"),n.go("root.search")}}]),angular.module("xiaomaiApp").controller("nav.listCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","xiaomaiLog",function(e,n,o,a,t,i,r){e.navs=[],r("m_p_31homepage");var s;a.get().then(function(e){return s=e.collegeId,o.fetchOne("navgatorlist",{collegeId:e.collegeId})}).then(function(n){e.navs=n.navigateItems,i.pub("navheightupdate","up","ready","","")}),e.paths={0:"root.buy.nav.all",1:"root.buy.nav.recommend",2:"root.buy.nav.active",3:"root.buy.nav.category"},e.navChecked=function(n){var o=!1;switch(e.curpath){case"all":o=0==n.displayType;break;case"recommend":o=1==n.displayType;break;case"active":o=e.activityId==n.activityId;break;case"category":o=e.curcategoryId==n.categoryId}return o},e.$on("$stateChangeSuccess",function(n,o,a){e.type=a.type;var t=/nav\.(\w+)/,i=o.name.match(t);e.curcategoryId=a.categoryId,e.activityId=a.activityId,i&&i.length&&(e.curpath=i[1])});var c=function(e){var n={0:"m_b_31homepagetabhome",1:"m_b_31homepagetabrec",2:"m_b_31homepagetabactivity+"+e.activityId,3:"m_b_31homepagetabcategory+"+e.categoryId};r(n[e.displayType])};e.triggleSub=function(n){e.isShowSub=!e.isShowSub,i.pub("navheightupdate","up","ready","",""),r("m_b_31homepagetabmothernavi"),n.preventDefault(),n.stopPropagation()},e["goto"]=function(o,a){c(a);var t=a.displayType,i=(a.activityType,e.paths[t]);n.go(i,{categoryId:a.categoryId,activityId:a.activityId}),o.preventDefault(),o.stopPropagation()}}]),angular.module("xiaomaiApp").controller("payFailCtrl",["$scope","$state","cartManager","xiaomaiLog",function(e,n,o,a){n.params.userId,n.params.orderId;a("m_p_33failedpay"),e.closeWindow=function(e){e.preventDefault(),e.stopPropagation(),a("m_b_32failedpayclose"),WeixinJSBridge.invoke("closeWindow",{},function(e){})},e.gotoIndex=function(e){e.preventDefault(),e.stopPropagation(),a("m_b_32failedpayrepay"),n.go("root.buy.nav.all")},e.deleteOrder=function(e){e.preventDefault(),e.stopPropagation(),a("m_b_32failedpaycancel"),o.clear().then(function(){n.go("rooy.buy.nav.all")})}}]),angular.module("xiaomaiApp").controller("paySuccessCtrl",["$scope","$state","xiaomaiService","cartManager","xiaomaiLog",function(e,n,o,a,t){
var i=n.params.userId,r=n.params.orderId;t("m_p_33paymentsuccess"),e.showRedpacketDialog=!0,e.closeWindow=function(e){e.preventDefault(),e.stopPropagation(),t("m_b_32paymentsuccessclose"),WeixinJSBridge.invoke("closeWindow",{},function(e){})},a.clear().then(function(){}),e.queryOrderDetail=function(e){e.preventDefault(),e.stopPropagation(),t("m_b_32paymentsuccessorderditail"),window.location.href="/order/orderDetail?orderId="+r+"&userId="+i},e.gotoIndex=function(e){e.preventDefault(),e.stopPropagation(),t("m_b_32paymentsuccessreturnhome"),n.go("root.buy.nav.all")},e.goRedpacket=function(e){e.preventDefault(),e.stopPropagation(),window.location.href="/couponwap/fusion/share?orderId="+r},e.cancelSendRedpacket=function(n){n.preventDefault(),n.stopPropagation(),e.showRedpacketDialog=!1}}]),angular.module("xiaomaiApp").controller("nav.recommendCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiCacheManager","xiaomaiMessageNotify","buyProcessManager","xiaomaiLog",function(e,n,o,a,t,i,r,s){s("m_p_31tabrecommendation");var c;e.isloading=!0;a.get().then(function(e){return c=e.collegeId,o.fetchOne("categoryGoods",{collegeId:c})}).then(function(n){e.categorys=n,e.haserror=!1},function(){e.haserror=!0})["finally"](function(n){e.isloading=!1,i.pub("navmainheightstatus","up","ready","","")}),e.gotocategory=function(e){n.go("root.buy.nav.category",{collegeId:c,categoryId:e.category.categoryId}),s("m_b_31homepagetabrecmore")}}]),angular.module("xiaomaiApp").controller("searchCtrl",["$scope","$state","xiaomaiMessageNotify","searchcookieManager","xiaomaiMessageNotify","$timeout","searchcookieManager","xiaomaiLog",function(e,n,o,a,o,t,a,i){var r,s;i("m_p_32search"),e.$on("$stateChangeSuccess",function(e,n,o,a,t){r=a.name||"root.buy.nav.all",s=t}),e.searchkey=n.params.key||"",e.goback=function(){i("m_b_32searchback"),n.go(r,s)},e.updatesearch=function(e,o){13==e.keyCode&&o&&o.length&&(n.go("root.buy.searchresult",{key:encodeURIComponent(o),page:1}),a.writeCookie(o),e.preventDefault(),e.stopPropagation())},e.gotosearch=function(e,o){return e.preventDefault(),e.stopPropagation(),i("m_b_32searchsearch"),o&&o.length?(n.go("root.buy.searchresult",{key:encodeURIComponent(o),page:1}),void a.writeCookie(o)):!1};var c,l=/^\s+|\s+$/g;e.updateSearchKey=function(n){c&&t.cancel(c),c=null,c=t(function(){o.pub("searchkeyupdate",e.searchkey.replace(l,""))},100)}}]),angular.module("xiaomaiApp").controller("searchrecordCtrl",["$scope","$state","searchcookieManager","xiaomaiMessageNotify","searchcookieManager","xiaomaiLog",function(e,n,o,a,o,t){e.showCookie=!0;var i=a.sub("searchkeyupdate",function(n){e.showCookie=n.length?!1:!0});e.cookies=o.getCookies(),e.goresult=function(e,a){t("m_b_32searchhistory"),o.writeCookie(a),n.go("root.buy.searchresult",{key:encodeURIComponent(a),page:1}),e.preventDefault(),e.stopPropagation()},e.$on("$destroy",function(){a.removeOne("searchkeyupdate",i)}),e.cleancookie=function(n){n.preventDefault(),n.stopPropagation(),t("m_b_32searchcleanhistory"),confirm("确定要清除搜索历史吗?")&&(o.cleanCookies(),e.cookies=[],t("m_b_32searchcleanbutton"))}}]),angular.module("xiaomaiApp").controller("searchsuggestCtrl",["$scope","$state","searchcookieManager","xiaomaiMessageNotify","xiaomaiService","xiaomaiLog",function(e,n,o,a,t,i){e.showSuggest=!1;var r=a.sub("searchkeyupdate",function(n){e.showSuggest=n.length?!0:!1,n.length?s(n):e.suggests=[],e.keywords=n});e.$on("$destroy",function(){a.removeOne("searchkeyupdate",r)});var s=function(n){e.isloading=!0,t.fetchOne("searchsuggest",{keywords:n}).then(function(n){e.suggests=n.suggestGoods,e.haserror=e.suggests&&e.suggests.length?!1:!0},function(){e.suggests=[],e.haserror=!0})["finally"](function(){e.isloading=!1})};e.goresult=function(e,a){i("m_b_32searchsuggestion"),o.writeCookie(a),n.go("root.buy.searchresult",{key:encodeURIComponent(a),page:1}),e.preventDefault(),e.stopPropagation()}}]),angular.module("xiaomaiApp").controller("searchresultCtrl",["$scope","$state","xiaomaiService","schoolManager","xiaomaiMessageNotify","xiaomaiLog",function(e,n,o,a,t,i){i("m_p_31searchresult"),e.$on("$stateChangeSuccess",function(n,o,a){e.searchkey=decodeURIComponent(a.key),e.isloading=!0,s(e.searchkey)}),e.gohomepage=function(e){n.go("root.buy.nav.all"),e.preventDefault(),e.stopPropagation()},e.gotosearch=function(e,o){n.go("root.search",{key:o}),e.preventDefault(),e.stopPropagation()};var r,s=function(n){e.isloading=!0,a.get().then(function(e){return r=e.collegeId,o.fetchOne("searchresult",{collegeId:r,keywords:n,currentPage:1})}).then(function(n){e.goods=n.goods,e.paginationInfo=n.paginationInfo,e.haserror=!e.goods||!e.goods.length},function(){e.haserror=!0})["finally"](function(){e.isloading=!1;var n=e.goods&&e.goods.length&&e.paginationInfo.currentPage!=e.paginationInfo.totalPage;t.pub("searchresultheightupdate","up","ready","",n?"请求下一页数据":"")})},c=t.sub("searchresultscrollupdate",function(n){var o=e.goods&&e.goods.length&&e.paginationInfo.currentPage!=e.paginationInfo.totalPage;"down"==n&&o&&e.paginationInfo.currentPage!=e.paginationInfo.totalPage&&(t.pub("searchresultheightupdate","down","pending","正在请求数据..."),!l&&d().then(function(n){var o=e.paginationInfo.currentPage==e.paginationInfo.totalPage,a=o?"":"请求下一页数据";t.pub("searchresultheightupdate","down","ready","",a)}))}),l=!1,d=function(){return l?!1:(l=!0,o.fetchOne("searchresult",{collegeId:r,keywords:e.searchkey,currentPage:e.paginationInfo.currentPage+1}).then(function(n){return l=!1,e.paginationInfo=n.paginationInfo,e.goods=e.goods.concat(n.goods),n}))};e.$on("$destroy",function(){t.removeOne("searchresultheightupdate",c)})}]),angular.module("xiaomaiApp").controller("sharedetailCtrl",["$scope","$state","schoolManager","xiaomaiMessageNotify",function(e,n,o,a){e.numInCart=0,e.$on("$stateChangeSuccess",function(n,o,a){e.goodsId=a.goodId,e.sourceType=a.sourceType,e.collegeId=a.collegeId}),o.get().then(function(o){o.collegeId!=e.collegeId&&(alert("您选择的学校门店中找不到该商品,将跳转到首页~"),n.go("root.buy.nav.all"))}),e.loadDetailSuccess=function(){a.pub("sharedetailheightupdate","up","ready","","")},e.imageLoadedCall=function(){a.pub("sharedetailheightupdate","up","ready","","")}}]),angular.module("xiaomaiApp").controller("userCtrl",["$scope","$state","xiaomaiService","xiaomaiCacheManager","xiaomaiLog",function(e,n,o,a,t){e.goHome=function(e){e.preventDefault(),e.stopPropagation(),n.go("root.buy.nav.all")},o.fetchOne("usercenter").then(function(n){e.userInfo=n.userInfo},function(){}),o.fetchOne("mycoupon").then(function(n){var o=[];angular.forEach(n.couponInfo,function(e){1===e.status&&o.push(o)}),e.coupons=o},function(){})["finally"](function(){}),e.gotoCoupon=function(e){return e.preventDefault(),e.stopPropagation(),window.location.href="/couponwap/myCouponList/webwiew",!1},e.gotoMyOrder=function(e){return e.preventDefault(),e.stopPropagation(),window.location.href="/order/myOrder",!1},e.gotofeedback=function(e){e.preventDefault(),e.stopPropagation(),n.go("root.feedback")}}]),angular.module("xiaomaiApp").controller("wechartprepayCtrl",["$scope","$state","xiaomaiService","xiaomaiCacheManager","xiaomaiMessageNotify","$timeout","safeApply","xiaomaiLog",function(e,n,o,a,t,i,r,s){s("m_p_33weixinprepay"),e.lock=!0;var c=i(function(){e.lock=!1},3e3),l=n.params.userId,d=n.params.orderId;o.fetchOne("queryOrder",{userId:l,orderId:d}).then(function(n){e.order=n.order})["finally"](function(){t.pub("","up","ready","",""),t.pub("wechartPayHeightUpdate","up","ready","","")});var u=a.readCache("prepayData");a.clean("prepayData");var p=function(){e.lock=!0,s("m_b_33weixinprepayalert"),WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:u.appId,timeStamp:u.timeStamp,signType:u.signType,"package":u.packageStr,nonceStr:u.nonceStr,paySign:u.paySign},function(e){i.cancel(c),"get_brand_wcpay_request:ok"==e.err_msg?g():m()})},g=function(){o.save("payStatusCheck",{userId:l,orderId:d}).then(function(e){n.go("root.paySuccess",{userId:l,orderId:d})},function(){n.go("root.payFail",{userId:l,orderId:d})})["finally"](function(){e.lock=!1})},m=function(){alert("支付失败,再试一次!"),s("m_b_33weixinprepayfail"),r(function(){e.lock=!1})};"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",p,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",p),document.attachEvent("onWeixinJSBridgeReady",p)):p(),e.toPay=function(n){return n.preventDefault(),n.stopPropagation(),s("m_b_33weixinprepaypay"),e.lock?!1:(e.lock=!0,void p())}}]);